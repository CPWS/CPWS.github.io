<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">

    

    

    <title>Prossible&#39;s Blog</title>
    <meta name="author" content="zhuli">
    <meta name="keywords" content>
    <meta name="description" content>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    
    <link rel="alternate" href="https://sanonz.github.io/atom.xml" title="Prossible&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="https://cpws.github.io/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/CPWS.github.io/fonts/icomoon.eot?q628ml");
        src: url("/CPWS.github.io/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/CPWS.github.io/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/CPWS.github.io/fonts/icomoon.woff?q628ml") format('woff'),
             url("/CPWS.github.io/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    <link rel="stylesheet" href="/CPWS.github.io/css/style.css">

    <!--[if lt IE 9]>
    <style type="text/css">
    .nav-inner {top:0;}
    .author-meta {position:static;top:0;}
    .search-form {height:36px;}
    </style>
    <script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <![endif]-->
</head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">Prossible&#39;s Blog</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item active" href="/CPWS.github.io/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/CPWS.github.io/categories/front-end">
                <span class="nav-text">前端</span>
            </a>
        
            <a class="nav-item" href="/CPWS.github.io/categories/back-end">
                <span class="nav-text">后端</span>
            </a>
        
            <a class="nav-item" href="/CPWS.github.io/tags">
                <span class="nav-text">标签</span>
            </a>
        
            <a class="nav-item" href="/CPWS.github.io/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="https://sanonz.github.io/atom.xml">
                <span class="nav-text">订阅</span>
            </a>
        
            <a class="nav-item" href="/CPWS.github.io/about">
                <span class="nav-text">关于</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="https://CPWS.github.io"></form>

        
        

        
        <div class="author-meta">
            
            <div class="author-avatar">
                <a href="/CPWS.github.io/">
                    <img src="http://img.mp.itc.cn/q_mini,c_zoom,w_640/upload/20161221/c495640d0fc24a91b9c95dc0d54b6002_th.jpeg" title="ZHUCHULI">
                </a>
            </div>
            
            <div class="author-name">ZHUCHULI</div>
            <div class="author-work">Web Developer &amp; Designer</div>
            <div class="author-location">
                <i class="icon-location vm"></i>
                <span class="vm">GuangZhou, China</span>
            </div>
            
            <div class="author-thread-wrap">
                <div class="author-threads clearfix">
                    
                        <a class="thread-item" href="https://github.com/CPWS" target="_blank" rel="noopener">
                            <!-- Generated by IcoMoon.io -->
<svg viewbox="0 0 1024 1024" width="38" height="38" fill="currentColor">
<path d="M512 32.12c-265.004 0-479.88 220.23-479.88 492.090 0 217.446 137.536 401.684 328.202 466.81 23.994 4.498 32.778-10.712 32.778-23.78 0-11.782-0.428-42.632-0.642-83.764-133.466 29.778-161.744-65.984-161.744-65.984-21.852-56.772-53.344-71.982-53.344-71.982-43.49-30.636 3.214-29.992 3.214-29.992 48.202 3.428 73.482 50.772 73.482 50.772 42.846 75.196 112.258 53.558 139.68 40.918 4.284-31.706 16.71-53.558 30.42-65.77-106.474-12.426-218.516-54.63-218.516-243.152 0-53.772 18.638-97.69 49.274-131.966-4.928-12.426-21.424-62.556 4.714-130.252 0 0 40.276-13.282 131.966 50.344 38.348-10.926 79.266-16.282 120.184-16.496 40.704 0.214 81.836 5.57 120.184 16.496 91.692-63.626 131.752-50.344 131.752-50.344 26.136 67.698 9.64 117.828 4.714 130.252 30.636 34.492 49.274 78.408 49.274 131.966 0 188.952-112.258 230.514-219.16 242.724 17.138 15.21 32.564 45.202 32.564 91.048 0 65.77-0.642 118.898-0.642 134.966 0 13.068 8.57 28.492 32.992 23.566 191.094-64.912 328.418-249.152 328.418-466.382 0-271.86-214.874-492.090-479.88-492.090z"/>
</svg>

                        </a>
                    
                        <a class="thread-item" href="http://weibo.com/sanonz" target="_blank" rel="noopener">
                            <!-- Generated by IcoMoon.io -->
<svg viewbox="0 0 1024 1024" width="38" height="38" fill="currentColor">
<path d="M21.332 512c0-270.988 219.68-490.666 490.668-490.666s490.666 219.68 490.666 490.666c0 270.988-219.678 490.666-490.666 490.666s-490.666-219.678-490.666-490.666zM960 512c0-247.424-200.576-448-448-448s-448 200.576-448 448c0 247.424 200.576 448 448 448s448-200.576 448-448zM768 597.332c47.128 0 85.332-38.206 85.332-85.332s-38.206-85.332-85.332-85.332c-47.128 0-85.332 38.204-85.332 85.332s38.206 85.332 85.332 85.332zM512 597.332c47.128 0 85.332-38.206 85.332-85.332s-38.206-85.332-85.332-85.332c-47.128 0-85.332 38.204-85.332 85.332s38.204 85.332 85.332 85.332zM255.998 597.332c47.128 0 85.332-38.206 85.332-85.332s-38.204-85.332-85.332-85.332c-47.128 0-85.332 38.204-85.332 85.332s38.204 85.332 85.332 85.332z"/>
</svg>

                        </a>
                    
                        <a class="thread-item" href="https://twitter.com/sanonze" target="_blank" rel="noopener">
                            <!-- Generated by IcoMoon.io -->
<svg viewbox="0 0 1024 1024" width="38" height="38" fill="currentColor">
<path d="M512.029 31.011c-263.32 0-476.784 213.502-476.784 476.784 0 263.32 213.464 476.743 476.784 476.743s476.743-213.424 476.743-476.743c0-263.282-213.444-476.784-476.743-476.784zM752.193 411.663c0.251 5.151 0.349 10.319 0.349 15.548 0 158.786-120.856 341.85-341.85 341.85-67.844 0-131.021-19.884-184.188-53.961 9.41 1.104 18.955 1.665 28.656 1.665 56.305 0 108.115-19.208 149.221-51.425-52.567-0.987-96.925-35.741-112.22-83.468 7.32 1.433 14.85 2.149 22.595 2.149 10.959 0 21.569-1.433 31.656-4.201-54.987-11.035-96.402-59.634-96.402-117.796 0-0.524 0-1.025 0.020-1.549 16.186 9.003 34.716 14.404 54.427 15.044-32.258-21.587-53.458-58.317-53.458-100.023 0-22.015 5.925-42.673 16.264-60.408 59.266 72.683 147.807 120.527 247.676 125.521-2.053-8.77-3.118-17.968-3.118-27.378 0-66.333 53.787-120.14 120.158-120.14 34.561 0 65.771 14.599 87.69 37.93 27.378-5.363 53.091-15.393 76.305-29.16-9.003 28.074-28.036 51.618-52.858 66.47 24.338-2.903 47.495-9.37 69.024-18.917-16.070 24.144-36.459 45.306-59.945 62.248z"/>
</svg>

                        </a>
                    
                </div>
            </div>
            
        </div>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 800px">
                
    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/CPWS.github.io/2019/09/02/注解与反射/">注解与反射</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://CPWS.github.io/page/4/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-09-02T08:08:40.000Z" itemprop="datePublished">2019-09-02</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/CPWS.github.io/tags/注解与反射/">注解与反射</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h2 id="注解入门"><a href="#注解入门" class="headerlink" title="注解入门"></a>注解入门</h2><blockquote>
<ul>
<li>Annotation是JDK5.0开始引入的新技术</li>
<li>Annotation的作用<blockquote>
<ul>
<li>不是程序本身，可以对程序作出解释。</li>
<li>可以被其他程序（比如：编译器等）读取。（注解信息处理流程，是注解和注释的重大区别。如果没有注解信息处理流程，则注解毫无意义）。</li>
</ul>
</blockquote>
</li>
<li>Annotation格式<blockquote>
<ul>
<li>注解是以“@注释名”在代码中存在的，可以添加一些参数值，例如：@SeppressWarnings(value=”unchecked”)。 </li>
</ul>
</blockquote>
</li>
<li>Annotation在哪里使用？<blockquote>
<ul>
<li>可以附加在package，class，method，field等上面，相当于它它们添加了额外的辅助信息，我们可以通过反射机制编程实现对这些数据的访问。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="内置注解"><a href="#内置注解" class="headerlink" title="内置注解"></a>内置注解</h2><blockquote>
<ul>
<li><code>@Override</code>：定义在<code>java.lang.Override</code>中，此注释只适用修饰方法，表示一个方法声明打算重写超类中的另一个方法声明。</li>
<li><code>@Deprecated</code>：定义在<code>java.lang.Deprecated</code>中，此注释可以用于修饰方法、属性、类，表示不鼓励程序员使用这样的元素，通常是因为它很危险吗或存在更好的选择。（一般不建议使用）</li>
<li><code>@SuppressWarnings</code>：用来抑制编译器运行时的警告信息。<blockquote>
<ul>
<li><code>@SuppressWarnings(&quot;unchecked&quot;)</code><br>告诉编译器忽略 unchecked 警告信息，如使用List，ArrayList等未进行参数化产生的警告信息。</li>
<li><code>@SuppressWarnings(&quot;serial&quot;)</code><br>如果编译器出现这样的警告信息：The serializable class WmailCalendar does not declare a static final serialVersionUID field of type long<br>   使用这个注释将警告信息去掉。</li>
<li><code>@SuppressWarnings(&quot;deprecation&quot;)</code><br>如果使用了使用@Deprecated注释的方法，编译器将出现警告信息。<br>   使用这个注释将警告信息去掉。</li>
<li><code>@SuppressWarnings(&quot;unchecked&quot;, &quot;deprecation&quot;)</code><br>告诉编译器同时忽略unchecked和deprecation的警告信息。</li>
<li><code>@SuppressWarnings(value={&quot;unchecked&quot;, &quot;deprecation&quot;})</code><br>等同于@SuppressWarnings(“unchecked”, “deprecation”)   </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="自定义注解、元注解"><a href="#自定义注解、元注解" class="headerlink" title="自定义注解、元注解"></a>自定义注解、元注解</h2><h3 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h3><blockquote>
<ul>
<li>@Target<blockquote>
<ul>
<li>作用：用于描述注解的使用范围</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>|所修饰的范围|取值ElemnetType|<br>|-|-|-|<br>|package包|PACKAGE|<br>|类、接口、枚举、Annotation类型|TYPE|<br>|类型成员（方法、构造器、成员变量、枚举值）|CONSTRUCTOR：用于描述构造器。<br>FIELD：用于描述域<br>METHOD：用于描述方法|<br>|方法参数和本地变量|LOCAL_VALUE：用于描述局部变量<br>PARANETER：用于描述参数|</p>
<blockquote>
<blockquote>
<ul>
<li>@Target(value=ElementType.Type)</li>
<li>@Retention</li>
<li>作用：表示需要在什么级别保存该注解，用于描述注解的生命周期。</li>
</ul>
</blockquote>
</blockquote>
<table>
<thead>
<tr>
<th>取值 RetentionPolicy</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>SOURCE</td>
<td>在源文件中有效（即源文件保存）</td>
</tr>
<tr>
<td>CLASS</td>
<td>在class文件中有效（即class保留）</td>
</tr>
<tr>
<td>RUNTIME</td>
<td>在运行时有效（即运行时保留）<br>为Runtime可以被反射机制读取</td>
</tr>
</tbody></table>
<ul>
<li>注意：<ul>
<li>注解元素的参数的默认值一般设置为<code>0</code>或<code>空字符窜</code>；</li>
<li>也可能是-1，表示什么也没有</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>@Documented</code><blockquote>
<ul>
<li>作用：用于描述其它类型的annotation应该被作为被标注的程序成员的公共API，因此可以被例如javadoc此类的工具文档化。它是一个标记注解，没有成员。</li>
</ul>
</blockquote>
</li>
<li><code>@Inherited</code><blockquote>
<ul>
<li>作用：用于表示某个被标注的类型是被继承的。如果一个使用了@Inherited修饰的annotation类型被用于一个class，则这个annotation将被用于该class的子类</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="反射机制读取注解"><a href="#反射机制读取注解" class="headerlink" title="反射机制读取注解"></a>反射机制读取注解</h2><blockquote>
<ul>
<li>什么是ORM（Object Relationship Mapping）<blockquote>
<ul>
<li>类和表结构对应</li>
<li>属性和字段对应</li>
<li>对象和记录对应</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="使用注解完成类和表结构的映射关系"><a href="#使用注解完成类和表结构的映射关系" class="headerlink" title="使用注解完成类和表结构的映射关系"></a>使用注解完成类和表结构的映射关系</h2><blockquote>
<ul>
<li>学了反射机制后，我们可以定义注解的执行流程读取这些注解，实现更复杂的功能</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Target</span>(value = ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Table &#123;</span><br><span class="line">	<span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(value = ElementType.FIELD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Field &#123;</span><br><span class="line">	<span class="function">String <span class="title">columnName</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">String <span class="title">type</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">length</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"><span class="meta">@Table</span>(<span class="string">"tb_student"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Field</span>(columnName=<span class="string">"id"</span>,type=<span class="string">"int"</span>,length=<span class="number">3</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="meta">@Field</span>(columnName=<span class="string">"sname"</span>,type=<span class="string">"varchar"</span>,length=<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">private</span> String studentName;</span><br><span class="line">	<span class="meta">@Field</span>(columnName=<span class="string">"age"</span>,type=<span class="string">"int"</span>,length=<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStudentName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> studentName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentName</span><span class="params">(String studentName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.studentName = studentName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用反射处理注解信息，模拟处理注解信息的流程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz=Class.forName(<span class="string">"annotation.Student"</span>);</span><br><span class="line">			<span class="comment">//获取类所有有效的注解</span></span><br><span class="line">			Annotation[] annotations=clazz.getAnnotations();</span><br><span class="line">			<span class="keyword">for</span>(Annotation a:annotations) &#123;</span><br><span class="line">				System.out.println(a);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//获取指定的注解</span></span><br><span class="line">			Table table=(Table) clazz.getAnnotation(Table.class);</span><br><span class="line">			System.out.println(table.value());</span><br><span class="line">			<span class="comment">//获取类的属性的注解</span></span><br><span class="line">			Field f=clazz.getDeclaredField(<span class="string">"studentName"</span>).getAnnotation(Field.class);</span><br><span class="line">			System.out.println(f.columnName() + <span class="string">"---&gt;"</span> + f.type() + <span class="string">"---&gt;"</span> + f.length());</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Java的动态性"><a href="#Java的动态性" class="headerlink" title="Java的动态性"></a>Java的动态性</h2><blockquote>
<ul>
<li>动态语言：程序运行时，可以改变程序结果或变量类。</li>
<li>Java可以称为准动态语言。</li>
</ul>
</blockquote>
<h3 id="反射机制-reflection"><a href="#反射机制-reflection" class="headerlink" title="反射机制 reflection"></a>反射机制 reflection</h3><blockquote>
<ul>
<li>指的是可以于运行时加载、探知、使用编译期间完全未知的类。</li>
<li>程序在运行状态中，可以动态加载一个只有名称的类，对于任意一个已加载的类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class c=Class.forName(<span class="string">"包名.类名"</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>加载完类之后，在堆内存中，就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，通过这个镜子可以看到类的结构，所以我们形象的称之为：反射。</li>
<li>Class类的对象如何获取<blockquote>
<ul>
<li>运用getClass()</li>
<li>运用Class.forName()（最常被使用） </li>
<li>运用类.class</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试java.lang.Class对象的获取方式。</span></span><br><span class="line"><span class="comment"> * 测试各种数据类型java.lang.Class对象的获取方式。</span></span><br><span class="line"><span class="comment"> * 1.利用类.class</span></span><br><span class="line"><span class="comment"> * 2.利用类.getClass()</span></span><br><span class="line"><span class="comment"> * 3.利用Class.forName()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String path= <span class="string">"com.zhuchuli.testBean.User"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz = Class.forName(path);</span><br><span class="line">			<span class="comment">//对象是表示或封装一些数据。一个类被加载之后，Jvm会创建一个对应该类的Class对象，类的整个结构信息会放到对象的Class对象中。</span></span><br><span class="line">			<span class="comment">//这个Class对象就像一面镜子一样，通过这个镜子，我们可以看到类的全部信息。</span></span><br><span class="line">			System.out.println(clazz.hashCode());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//获取Class对象的三种方式</span></span><br><span class="line">			Class strClazz=String.class;</span><br><span class="line">			Class strClazz2=path.getClass();</span><br><span class="line">			System.out.println(strClazz==strClazz2);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//基本数据类型</span></span><br><span class="line">			Class intClaszz=<span class="keyword">int</span>.class;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>反射机制的常见作用</li>
</ul>
</blockquote>
<hr>
<blockquote>
<blockquote>
<ul>
<li>动态加载类、动态获取类的信息（属性、方法、构造器）</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 应用反射API，获取类的信息（类的名字、属性、方法、构造器等）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String path= <span class="string">"com.zhuchuli.testBean.User"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz = Class.forName(path);</span><br><span class="line">			<span class="comment">//获取类的名字</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取类名---------------------------------"</span>);</span><br><span class="line">			System.out.println(clazz.getName());<span class="comment">//获得包名+类名 com.zhuchuli.testBean.User</span></span><br><span class="line">			System.out.println(clazz.getSimpleName());<span class="comment">//获得类名 User</span></span><br><span class="line">			System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">			<span class="comment">//获取属性信息</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取属性---------------------------------"</span>);</span><br><span class="line">			<span class="comment">//Field[] fields=clazz.getFields();//只能获取public的属性</span></span><br><span class="line">			Field[] fields=clazz.getDeclaredFields();<span class="comment">//获得所有的field</span></span><br><span class="line">			Field f=clazz.getDeclaredField(<span class="string">"uname"</span>);</span><br><span class="line">			System.out.println(f);</span><br><span class="line">			<span class="keyword">for</span>(Field field:fields) &#123;</span><br><span class="line">				System.out.println(<span class="string">"属性："</span>+field);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">			<span class="comment">//获取方法信息</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取方法---------------------------------"</span>);</span><br><span class="line">			Method[] methods=clazz.getMethods();<span class="comment">//只能获取public修饰的方法</span></span><br><span class="line">			Method[] methodss=clazz.getDeclaredMethods();<span class="comment">//获取所有的方法</span></span><br><span class="line">			Method m01=clazz.getDeclaredMethod(<span class="string">"getUname"</span>, <span class="keyword">null</span>);</span><br><span class="line">			System.out.println(m01);</span><br><span class="line">			Method m02=clazz.getDeclaredMethod(<span class="string">"setUname"</span>, String.class);<span class="comment">//如果方法有参数，则必须指明参数的类型，即参数类型.class</span></span><br><span class="line">			System.out.println(m02);</span><br><span class="line">			<span class="keyword">for</span>(Method method:methodss) &#123;</span><br><span class="line">				System.out.println(<span class="string">"方法："</span>+method);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">			<span class="comment">//获取构造器信息</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取构造器---------------------------------"</span>);</span><br><span class="line">			Constructor[] constructors=clazz.getConstructors();<span class="comment">//获取public修饰的构造器</span></span><br><span class="line">            Constructor[] constructorss=clazz.getDeclaredConstructors();</span><br><span class="line">            <span class="keyword">for</span>(Constructor constructor:constructorss) &#123;</span><br><span class="line">            	System.out.println(<span class="string">"构造器："</span>+constructor);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"根据参数类型获取构造器"</span>);</span><br><span class="line">            Constructor c=clazz.getDeclaredConstructor(<span class="keyword">null</span>);</span><br><span class="line">            System.out.println(<span class="string">"构造器："</span>+c);</span><br><span class="line">            Constructor cc=clazz.getConstructor(<span class="keyword">int</span>.class,String.class,<span class="keyword">int</span>.class);</span><br><span class="line">            System.out.println(<span class="string">"构造器："</span>+cc);</span><br><span class="line">            System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>动态构造对象</li>
<li>动态调用类和对象的任意方法、构造器</li>
<li>动态调用和处理属性</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 通过反射API动态的操作：构造器，方法和属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//动态操作构造器</span></span><br><span class="line">		String path= <span class="string">"com.zhuchuli.testBean.User"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz = Class.forName(path);</span><br><span class="line">			<span class="comment">//通过反射API调用构造方法，构造对象</span></span><br><span class="line">			User u=(User) clazz.getConstructor().newInstance();<span class="comment">//其实调用JavaBean的无参数构造器</span></span><br><span class="line">			System.out.println(u);</span><br><span class="line">			</span><br><span class="line">			Constructor&lt;User&gt; c=clazz.getConstructor(<span class="keyword">int</span>.class,String.class,<span class="keyword">int</span>.class);</span><br><span class="line">			User u2=c.newInstance(<span class="number">1001</span>,<span class="string">"lee"</span>,<span class="number">18</span>);</span><br><span class="line">			System.out.println(u2.getId()+<span class="string">"--"</span>+u2.getUname()+<span class="string">"--"</span>+u2.getAge());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//通过反射API调用普通方法</span></span><br><span class="line">			User u3=(User) clazz.getConstructor().newInstance();</span><br><span class="line">			Method method=clazz.getDeclaredMethod(<span class="string">"setUname"</span>, String.class);</span><br><span class="line">			method.invoke(u3, <span class="string">"lee2"</span>);<span class="comment">//类似于u3.setUname="lee2"</span></span><br><span class="line">			System.out.println(u3.getUname());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//通过反射API调用属性</span></span><br><span class="line">			User u4=(User) clazz.getConstructor().newInstance();</span><br><span class="line">			Field f=clazz.getDeclaredField(<span class="string">"uname"</span>);</span><br><span class="line">			f.setAccessible(<span class="keyword">true</span>);<span class="comment">//这个属性不需要做安全检查，可以直接访问。</span></span><br><span class="line">			f.set(u4, <span class="string">"lee3"</span>);<span class="comment">//通过放射获取属性的值</span></span><br><span class="line">			System.out.println(u4.getUname());</span><br><span class="line">			System.out.println(f.get(u4));<span class="comment">//通过反射读取对象的值</span></span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>获取泛型信息（Generic）<blockquote>
<ul>
<li>Java使用泛型擦除机制来引入泛型。Java中的泛型仅仅是给编译器JavaC使用的，确保数据的安全性和免去强制类型转换的麻烦。但是编译一旦完成，所有和泛型有关的类全部被擦除。</li>
<li>为了通过反射操作这些类型以迎合实际开发的需要，Java新增了PatameterType，GenericArrayType，TypeVariable，和WildCardType几种类型来代表不能被归一到Class类中的类型但是又和原始类型齐名的类型。<blockquote>
<ul>
<li>ParameterizedType:表示一种参数化的类型，比如Collection&lt; String &gt;.</li>
<li>GenericArrayType:表示一种元素类型是参数化类型或者类型变量的数组类型.</li>
<li>TypeVariable:是各种类型变量的公共父接.</li>
<li>WildcardType:代表一种通配符类型表达式，比如？、？ extends Number、？ super Integer。（wildcard是一个单词：就是”通配符“）.</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 通过反射获取泛型信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">(Map&lt;String,User&gt; map,List&lt;User&gt; list)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Demo04 test01()"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;Integer,User&gt; <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Demo01 test02()"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取执行方法参数的泛型信息</span></span><br><span class="line">			Method method = Demo04.class.getDeclaredMethod(<span class="string">"test01"</span>, Map.class, List.class);</span><br><span class="line">			Type[] t=method.getGenericParameterTypes();</span><br><span class="line">			<span class="keyword">for</span>(Type paramType:t) &#123;</span><br><span class="line">				System.out.println(<span class="string">"#"</span>+paramType);</span><br><span class="line">				<span class="keyword">if</span>(paramType <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">					<span class="comment">//获取泛型中的具体信息</span></span><br><span class="line">					Type[] genericTypes = ((ParameterizedType) paramType).getActualTypeArguments();</span><br><span class="line">					<span class="keyword">for</span>(Type genericType:genericTypes) &#123;</span><br><span class="line">						System.out.println(<span class="string">"泛型类型："</span> + genericType);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//获取指定方法返回值泛型信息</span></span><br><span class="line">			Method method2=Demo04.class.getDeclaredMethod(<span class="string">"test02"</span>,<span class="keyword">null</span>);</span><br><span class="line">			Type returnType=method2.getGenericReturnType();</span><br><span class="line">			<span class="keyword">if</span>(returnType <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">				<span class="comment">//获取泛型中的具体信息</span></span><br><span class="line">				Type[] genericTypes = ((ParameterizedType) returnType).getActualTypeArguments();</span><br><span class="line">				<span class="keyword">for</span>(Type genericType:genericTypes) &#123;</span><br><span class="line">					System.out.println(<span class="string">"泛型类型："</span> + genericType);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>处理注解：功能与案例代码与上面雷同。</li>
</ul>
</blockquote>
</blockquote>
<hr>
<blockquote>
<ul>
<li>反射机制的性能问题<blockquote>
<ul>
<li>setAccessible<blockquote>
<ul>
<li>启动和禁用访问安全检查的机关，值为true则指示反射的对象在使用时应该取消Java语言访问检查。值为false则指示表明反射的对象应该实施Java语言访问检查。并不是为true就能访问为false就不能访问。</li>
<li>禁止安全检查，可以提高反射的运行速度。</li>
</ul>
</blockquote>
</li>
<li>可以考虑使用：cglib/javaassist字节码操作 </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		User user=<span class="keyword">new</span> User();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">long</span> before=System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++) &#123;</span><br><span class="line">			user.getUname();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> after=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"没有反射，共消耗：&lt;"</span>+(after-before)+<span class="string">"&gt;毫秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		User user=<span class="keyword">new</span> User();</span><br><span class="line">		Method method=Class.forName(<span class="string">"com.zhuchuli.testBean.User"</span>).getDeclaredMethod(<span class="string">"getUname"</span>, <span class="keyword">null</span>);</span><br><span class="line">		<span class="keyword">long</span> before=System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++) &#123;</span><br><span class="line">			method.invoke(user, <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> after=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"加安全检查，共消耗：&lt;"</span>+(after-before)+<span class="string">"&gt;毫秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		User user=<span class="keyword">new</span> User();</span><br><span class="line">		Method method=Class.forName(<span class="string">"com.zhuchuli.testBean.User"</span>).getDeclaredMethod(<span class="string">"getUname"</span>, <span class="keyword">null</span>);</span><br><span class="line">		method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">		<span class="keyword">long</span> before=System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++) &#123;</span><br><span class="line">			method.invoke(user, <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> after=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"不加安全检查，共消耗：&lt;"</span>+(after-before)+<span class="string">"&gt;毫秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		test01();</span><br><span class="line">		test02();</span><br><span class="line">		test03();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态编译"><a href="#动态编译" class="headerlink" title="动态编译"></a>动态编译</h3><blockquote>
<ul>
<li>Java6.0引入了动态编译机制</li>
<li>动态编译的应用场景<blockquote>
<ul>
<li>可以做一个浏览器端编写java代码，上传服务器编译和运行的在线测评系统。</li>
<li>服务器动态加载某些类文件进行编译。</li>
</ul>
</blockquote>
</li>
<li>动态编译的两种方式<blockquote>
<ul>
<li>通过Runtime调用javac，启动新的进程去操作<blockquote>
<ul>
<li>Runtime run=Runtime.getRuntime();</li>
<li>Process process=run.exec(javac -cp d:/myjava/ HelloWorld.java);</li>
</ul>
</blockquote>
</li>
<li>通过JavaCompiler动态编译</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String str=<span class="string">"public class Hi&#123;public static void main(String[] args[]) &#123;System.out.println(\"Hello Hi haha\");&#125;&#125;"</span>;</span><br><span class="line">		BufferedWriter br=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"d:/MyJava/Hi.java"</span>));</span><br><span class="line">		br.write(str);</span><br><span class="line">		br.flush();</span><br><span class="line">		<span class="comment">//获得系统编译器，如果使用jre（运行环境）则无法获得编译器</span></span><br><span class="line">		JavaCompiler complier=ToolProvider.getSystemJavaCompiler();</span><br><span class="line">		<span class="keyword">int</span> result=complier.run(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>,<span class="string">"d:/MyJava/Hi.java"</span>);</span><br><span class="line">		System.out.println(result==<span class="number">0</span>?<span class="string">"编译成功"</span>:<span class="string">"编译失败"</span>);</span><br><span class="line">		br.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>编译结果</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<p><img src="image/1567512289(1).png" alt="avator.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String str=<span class="string">"public class Hi&#123;public static void main(String[] args) &#123;System.out.println(\"Hello Hi haha\");&#125;&#125;"</span>;</span><br><span class="line">		BufferedWriter bw=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"d:/MyJava/Hi.java"</span>));</span><br><span class="line">		bw.write(str);</span><br><span class="line">		bw.flush();</span><br><span class="line">		<span class="comment">//获得系统编译器，如果使用jre（运行环境）则无法获得编译器</span></span><br><span class="line">		JavaCompiler complier=ToolProvider.getSystemJavaCompiler();</span><br><span class="line">		<span class="keyword">int</span> result=complier.run(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>,<span class="string">"d:/MyJava/Hi.java"</span>);</span><br><span class="line">		System.out.println(result==<span class="number">0</span>?<span class="string">"编译成功"</span>:<span class="string">"编译失败"</span>);</span><br><span class="line">		</span><br><span class="line">		Runtime run=Runtime.getRuntime();</span><br><span class="line">		Process process=run.exec(<span class="string">"java -cp d:/MyJava Hi"</span>);</span><br><span class="line">		BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream()));</span><br><span class="line">		String info=<span class="string">""</span>;</span><br><span class="line">		<span class="keyword">while</span>((info=br.readLine())!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			System.out.println(info);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>编译结果</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<p><img src="image/1567512221(1).png" alt="avator.png"></p>
<blockquote>
<blockquote>
<ul>
<li>通过反射机制，启动新的线程去执行</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过反射机制调用执行类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String str=<span class="string">"public class Hi&#123;public static void main(String[] args) &#123;System.out.println(\"Hello Hi haha\");&#125;&#125;"</span>;</span><br><span class="line">		BufferedWriter bw=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"d:/MyJava/Hi.java"</span>));</span><br><span class="line">		bw.write(str);</span><br><span class="line">		bw.flush();</span><br><span class="line">		<span class="comment">//获得系统编译器，如果使用jre（运行环境）则无法获得编译器</span></span><br><span class="line">		JavaCompiler complier=ToolProvider.getSystemJavaCompiler();</span><br><span class="line">		<span class="keyword">int</span> result=complier.run(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>,<span class="string">"d:/MyJava/Hi.java"</span>);</span><br><span class="line">		System.out.println(result==<span class="number">0</span>?<span class="string">"编译成功"</span>:<span class="string">"编译失败"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			URL[] urls=<span class="keyword">new</span> URL[] &#123;<span class="keyword">new</span> URL(<span class="string">"file:/"</span>+<span class="string">"d:/MyJava/"</span>)&#125;;</span><br><span class="line">			URLClassLoader loader=<span class="keyword">new</span> URLClassLoader(urls);</span><br><span class="line">			Class c=loader.loadClass(<span class="string">"Hi"</span>);</span><br><span class="line">			Method m=c.getMethod(<span class="string">"main"</span>, String[].class);</span><br><span class="line">			m.invoke(<span class="keyword">null</span>, (Object)<span class="keyword">new</span> String[] &#123;&#125;);</span><br><span class="line">			<span class="comment">//m.invoke(null,new String[] &#123;"a","b"&#125;);</span></span><br><span class="line">			<span class="comment">//由于可变参数是Java5.0之后才有。上面的代码会被运行成;m.invoke(null,"a","b")，就发生了参数个数不匹配，从而出现错误,因此要加上(Object)转型，避免出现出错;</span></span><br><span class="line">			<span class="comment">//public static void mmm(String[] a,String[] b)</span></span><br><span class="line">			<span class="comment">//public static void main(String[] args);</span></span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<p>编译结果</p>
</blockquote>
</blockquote>
</blockquote>
<p><img src="image/1567513472(1).png" alt="avator.png"></p>
<h3 id="动态执行javascript代码"><a href="#动态执行javascript代码" class="headerlink" title="动态执行javascript代码"></a>动态执行javascript代码</h3><blockquote>
<ul>
<li>Java脚本引擎是从JDK6.0之后添加的新功能</li>
<li>脚本引擎介绍<blockquote>
<ul>
<li>使得Java应用程序可以通过一套固定的接口与各种脚本引擎交互，从而达到在Java平台上调用各种脚本语言的目的。</li>
<li>Java脚本API是连通Java平台和脚本语言的桥梁。</li>
<li>可以把一些复杂异变的业务逻辑交给与脚本语言处理，这又大大提高了开发效率。</li>
</ul>
</blockquote>
</li>
<li>获得脚本引擎<blockquote>
<ul>
<li>ScriptEngineManager sem=new ScriptEngineManager();</li>
<li>ScriptEngine engine=sem.getEngineByName(“javascript”);</li>
</ul>
</blockquote>
</li>
<li>Java脚本API为开发者提供了如下功能：<blockquote>
<ul>
<li>获取脚本程序输入，通过脚本引擎运行脚本并返回运行结果，这是最核心的接口。<blockquote>
<ul>
<li>注意是：接口。Java可以使用各种不同的表现，从而通用的调用js、groovy、python等脚本</li>
<li>js使用了:Rhino，Rhino是一种使用Java语言编写的JavaScript的开源实现，原先是由Mozilla开发，现在被集成进入JDK6.0</li>
</ul>
</blockquote>
</li>
<li>通过脚本引擎的运行上下文在脚本和Java平台间交换数据。</li>
<li>通过Java应用程序调用脚本函数。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.rhino;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.script.Invocable;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试脚本引擎执行JavaScript代码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ScriptException, NoSuchMethodException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取脚本引擎对象</span></span><br><span class="line">		ScriptEngineManager sem=<span class="keyword">new</span> ScriptEngineManager();</span><br><span class="line">		ScriptEngine engine=sem.getEngineByName(<span class="string">"javascript"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//定义变量，存储到引擎上下文中</span></span><br><span class="line">		engine.put(<span class="string">"msg"</span>, <span class="string">"lee is a good student"</span>);</span><br><span class="line">		String str=<span class="string">"var user= &#123;name:'aaa',age:18,schools:['gdaib','dgef']&#125;;"</span>;</span><br><span class="line">		str += <span class="string">"print(user.schools);"</span>;</span><br><span class="line">		<span class="comment">//执行脚本</span></span><br><span class="line">		engine.eval(str);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//修改msg的值</span></span><br><span class="line">		engine.eval(<span class="string">"msg='very happy today'"</span>);</span><br><span class="line">		System.out.println(engine.get(<span class="string">"msg"</span>));</span><br><span class="line">		System.out.println(<span class="string">"--------------------"</span>);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//定义函数</span></span><br><span class="line">		engine.eval(<span class="string">"function add(a,b)&#123;var sum=a+b;return sum;&#125;"</span>);</span><br><span class="line">		<span class="comment">//执行js函数 取得调用接口</span></span><br><span class="line">		Invocable jsInvoke=(Invocable) engine;</span><br><span class="line">		<span class="comment">//执行脚本中定义的方法</span></span><br><span class="line">		Object i=jsInvoke.invokeFunction(<span class="string">"add"</span>, <span class="keyword">new</span> Object[] &#123;<span class="number">10</span>,<span class="number">20</span>&#125;);                                            </span><br><span class="line">		System.out.println(i);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//导入其他java包，使用其他包中的java类</span></span><br><span class="line">		String jsCode=<span class="string">"var list=java.util.Arrays.asList([\"北京尚学堂\",\"北京大学\"]);"</span>;</span><br><span class="line">		engine.eval(jsCode);</span><br><span class="line">		List&lt;String&gt; list2=(List&lt;String&gt;) engine.get(<span class="string">"list"</span>);</span><br><span class="line">		<span class="keyword">for</span>(String temp:list2) &#123;                                                                                      </span><br><span class="line">			System.out.println(temp);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//执行一个JS文件</span></span><br><span class="line">		URL url=Demo01.class.getClassLoader().getResource(<span class="string">"a.js"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			FileReader fr = <span class="keyword">new</span> FileReader(url.getPath());</span><br><span class="line">			engine.eval(fr);</span><br><span class="line">			fr.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>运行结果</li>
</ul>
</blockquote>
</blockquote>
<p><img src="image/1567583317(1).png" alt="avator.png"></p>
<h3 id="动态字字节码操作：javaassist"><a href="#动态字字节码操作：javaassist" class="headerlink" title="动态字字节码操作：javaassist"></a>动态字字节码操作：javaassist</h3><blockquote>
<ul>
<li>Java动态性的两种常见实现方式：<blockquote>
<ul>
<li>字节码操作</li>
<li>反射</li>
</ul>
</blockquote>
</li>
<li>运行时操作字节码可以让我们实现如下功能<blockquote>
<ul>
<li>动态生成新的类。</li>
<li>动态改变某个类的结构（添加、删除、修改  新的属性、方法 ）</li>
</ul>
</blockquote>
</li>
<li>优势<blockquote>
<ul>
<li>比反射开销小，性能高。</li>
<li>Javaassist性能高于反射，低于ASM</li>
</ul>
</blockquote>
</li>
<li>常见的字节码操作类库<blockquote>
<ul>
<li>BCEL 基于底层Jvm的操作和指令</li>
<li>ASM 基于底层Jvm的操作和指令</li>
<li>CGLIB 基于ASM实现</li>
<li>Javaassist</li>
</ul>
</blockquote>
</li>
<li>Javaassist库的API详解<blockquote>
<ul>
<li>javaassist的最外层的API和java的反射包中的API颇为类似。</li>
<li>它主要有CtClass,CtMethod，以及CtField几个类组成。用以执行和JDK反射API中java.lang.Class,java.lang.reflection.Method，java.lang.reflection.Field相同的操作。</li>
</ul>
</blockquote>
</li>
<li>JAVAassist库的简单使用。<blockquote>
<ul>
<li>创建一个全新的类</li>
<li>使用XJAD反编译工具，将生成的class文件反编译成Java文件\</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.javaassist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.CannotCompileException;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> javassist.CtField;</span><br><span class="line"><span class="keyword">import</span> javassist.CtMethod;</span><br><span class="line"><span class="keyword">import</span> javassist.NotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试 使用javaassist动态生成一个新类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CannotCompileException, NotFoundException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">//创建一个类池</span></span><br><span class="line">		ClassPool pool=ClassPool.getDefault();</span><br><span class="line">		CtClass cc=pool.makeClass(<span class="string">"com.zhuchuli.bean.Emp"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建属性</span></span><br><span class="line">		CtField f1=CtField.make(<span class="string">"private String ename;"</span>,cc); </span><br><span class="line">		CtField f2=CtField.make(<span class="string">"private int empno;"</span>,cc);</span><br><span class="line">		cc.addField(f1);</span><br><span class="line">		cc.addField(f2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建方法</span></span><br><span class="line">		CtMethod c1=CtMethod.make(<span class="string">"public String getEname()&#123;return ename;&#125; "</span>, cc);</span><br><span class="line">		CtMethod c2=CtMethod.make(<span class="string">"public void setEname(String ename)&#123;this.ename=ename;&#125; "</span>, cc);</span><br><span class="line">		cc.addMethod(c1);</span><br><span class="line">		cc.addMethod(c2);</span><br><span class="line">		CtMethod c3=CtMethod.make(<span class="string">"public int getEmpno()&#123;return empno;&#125; "</span>, cc);</span><br><span class="line">		CtMethod c4=CtMethod.make(<span class="string">"public void setEmpno(int empno)&#123;this.empno=empno;&#125; "</span>, cc);</span><br><span class="line">		cc.addMethod(c3);</span><br><span class="line">		cc.addMethod(c4);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建构造器</span></span><br><span class="line">		CtConstructor constructor=<span class="keyword">new</span> CtConstructor(<span class="keyword">new</span> CtClass[] &#123;pool.get(<span class="string">"java.lang.String"</span>), CtClass.intType&#125;, cc);</span><br><span class="line">		constructor.setBody(<span class="string">"&#123;this.ename=ename;this.empno=empno;&#125;"</span>);</span><br><span class="line">		CtConstructor constructor2=<span class="keyword">new</span> CtConstructor(<span class="keyword">null</span>,cc);</span><br><span class="line">		cc.addConstructor(constructor);</span><br><span class="line">		cc.addConstructor(constructor2);</span><br><span class="line">		</span><br><span class="line">		cc.writeFile(<span class="string">"d:/MyJava/Emp.java"</span>);<span class="comment">//将创建的这一类存放到指定位置上</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Javaassist的AIP使用</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.javaassist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtMethod;</span><br><span class="line"><span class="keyword">import</span> javassist.Modifier;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试Javaassist的API</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">	<span class="comment">//处理类的基本用法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPool pool=ClassPool.getDefault();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			CtClass cc = pool.get(<span class="string">"com.zhuchuli.javaassist.Emp"</span>);</span><br><span class="line">			<span class="comment">//将类转换成字节数组</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytes=cc.toBytecode();</span><br><span class="line">			System.out.println(Arrays.toString(bytes));</span><br><span class="line">			System.out.println(cc.getName());<span class="comment">//获取类名</span></span><br><span class="line">			System.out.println(cc.getSuperclass());<span class="comment">//获取父类</span></span><br><span class="line">			System.out.println(cc.getInterfaces());<span class="comment">//获取接口</span></span><br><span class="line">			System.out.println(cc.getSimpleName ());<span class="comment">//获得简要类名</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//处理方法的基本用法 产生新的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPool pool=ClassPool.getDefault();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			CtClass cc = pool.get(<span class="string">"com.zhuchuli.javaassist.Emp"</span>);</span><br><span class="line">     		<span class="comment">//CtMethod method=CtMethod.make("public int add(int a,int b)&#123;System.out.println(\"test02\");return a+b;&#125;", cc);</span></span><br><span class="line">			<span class="comment">//第一个参数为返回值类型,第二个参数为方法名 第三个参数为方法参数 第四个参数为所要加入的对象</span></span><br><span class="line">			CtMethod m=<span class="keyword">new</span> CtMethod(CtClass.intType, <span class="string">"add"</span>, <span class="keyword">new</span> CtClass[] &#123;CtClass.intType,CtClass.intType&#125;,cc);</span><br><span class="line">			<span class="comment">//设置方法的修饰符</span></span><br><span class="line">			m.setModifiers(Modifier.PUBLIC);</span><br><span class="line">			<span class="comment">//设置方法体 $1代表参数位置</span></span><br><span class="line">			m.setBody(<span class="string">"&#123;System.out.println(\"test02\");return $1+$2;&#125;"</span>);</span><br><span class="line">			cc.addMethod(m);</span><br><span class="line">			</span><br><span class="line">			Class&lt;?&gt; clazz=cc.toClass();</span><br><span class="line">			</span><br><span class="line">			Object obj=clazz.getConstructor().newInstance();</span><br><span class="line">			</span><br><span class="line">			Method method=clazz.getDeclaredMethod(<span class="string">"add"</span>, <span class="keyword">int</span>.class,<span class="keyword">int</span>.class);</span><br><span class="line">			Object result=method.invoke(obj, <span class="number">200</span>,<span class="number">300</span>);</span><br><span class="line">			System.out.println(result);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//... 还有注解 构造器 和 属性</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		test01();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JVM运行和类加载全过程"><a href="#JVM运行和类加载全过程" class="headerlink" title="JVM运行和类加载全过程"></a>JVM运行和类加载全过程</h2><blockquote>
<ul>
<li>为什么要研究加载全过程？<blockquote>
<ul>
<li>有助于了解JVM运行过程</li>
<li>更深入了解Java动态性（解耦部署，动态加载），提高程序的灵活性。</li>
</ul>
</blockquote>
</li>
<li>类加载全过程 （如下图所示）<blockquote>
<ul>
<li>加载 </li>
<li>链接 （验证 准备 解析）:将Java类的二进制代码合并到JVM的运行状态之中的过程。</li>
<li>初始化：静态属性或静态方法或静态块只会被初始化一次。</li>
<li>使用</li>
<li>卸载</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p><img src="image/1567642828(1).png" alt="avator.png"></p>
<blockquote>
<ul>
<li>类的主动引用（一定会发生类初始化）<blockquote>
<ul>
<li>new一个类的对象。</li>
<li>调用类的静态成员（除了final常量）和静态方法。</li>
<li>使用java.lang.reflect包的方法对类进行反射调用。</li>
<li>当虚拟机启动，java hello则一定会初始化Hello类，说白了就是先启动main方法所在的类。</li>
<li>当初始化一个类，如果其父类没有被初始化，则会先初始化他的父类。</li>
</ul>
</blockquote>
</li>
<li>类的被动引用<blockquote>
<ul>
<li>当访问一个静态域时，只有真正声明这个域的类才会被初始化。<blockquote>
<ul>
<li>通过子类引用父类的静态变量，不会导致子类初始化。</li>
</ul>
</blockquote>
</li>
<li>通过数组定义类引用，不会触发此类的初始化</li>
<li>引用常量不会触发此类的初始化（常量在编译阶段就存入调用类的常量池中了）。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="深入类加载器"><a href="#深入类加载器" class="headerlink" title="深入类加载器"></a>深入类加载器</h2><blockquote>
<ul>
<li>类加载器原理<blockquote>
<ul>
<li>类加载器的作用：将class文件字节码内容加载到内存中，并将这些静态数据转换成方法区中的运行时数据结构，在堆中生成一个代表这个类的java.lang.Class对象，作为方法区类数据的访问入口。</li>
<li>类缓存：标准的JavaSE类加载器可以按要求查找类，但一旦某个类被加载到类加载器中，它将维持加载（缓存）一段时间。不过JVM垃圾集成器可以回收这些Class对象。</li>
</ul>
</blockquote>
</li>
<li>类加载器树状结构，双亲委托（代理）机制<blockquote>
<ul>
<li>引导类加载器（bootstrap class loader）</li>
<li>扩展类加载器（extensions class loader）</li>
<li>应用程序类加载器（application clasas loader）</li>
<li>自定义类加载器 </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p><img src="image/1567659790(1).png" alt="avator.png"></p>
<p><img src="image/1567659996(1).png" alt="avator.png"></p>
<blockquote>
<blockquote>
<ul>
<li>双亲委托机制是为了保证Java核心库的类型安全。（请求  —&gt; 交给父类  —&gt; 交给爷爷辈）</li>
<li>tomcat则与此相反</li>
<li>自定义类加载器（文件、网络、加密）</li>
</ul>
<ul>
<li>注意：同一个类被不同的加载器加载，JVM也会认为他们不是相同的类</li>
</ul>
<ul>
<li>线程上下文类加载器</li>
<li>服务器类加载器原理和OSGI介绍(面向Java的动态模块系统)<blockquote>
<ul>
<li>Eclipse是基于OSGI技术来构建的</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>

        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/CPWS.github.io/2019/06/28/文件上传/">文件上传</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://CPWS.github.io/page/4/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-06-28T01:51:14.000Z" itemprop="datePublished">2019-06-28</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/CPWS.github.io/tags/文件上传/">文件上传</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h3 id="1-文件上传功能的实现"><a href="#1-文件上传功能的实现" class="headerlink" title="1. 文件上传功能的实现"></a>1. 文件上传功能的实现</h3><p><code>上传和下载</code>是<code>Web</code>应用开发需求中出现频率较高的词汇。在JSP应用开发过程中，编写“文件上传”功能代码主要有三种方式：</p>
<blockquote>
<ul>
<li>采用自编写的<code>JavaBean</code>组件</li>
<li>采用<code>JspSmart</code>公司自己编写的<code>JspSmartUnload</code>组件</li>
<li>采用<code>O’Reilly</code>公司的<code>Cos</code>组件</li>
</ul>
</blockquote>
<h4 id="1-1-采用自编写的JavaBean组件"><a href="#1-1-采用自编写的JavaBean组件" class="headerlink" title="1.1 采用自编写的JavaBean组件"></a>1.1 采用自编写的<code>JavaBean</code>组件</h4><blockquote>
<ul>
<li>要编写一个实现文件上传功能的组件，首先需要先了解数据传输的原理，根据数据处理的规律来完成相关的编码。步骤为：<blockquote>
<blockquote>
<p>1.获取上传数据的规律。案列如下：</p>
</blockquote>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--如果要实现文件上传功能 需要添加 enctype=<span class="string">"MULTIPART/FORM-DATA"</span>--&gt;</span><br><span class="line">&lt;form enctype="MULTIPART/FORM-DATA"&gt;&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//js版给form添加属性，实现文件上传</span></span><br><span class="line">form.encding=<span class="string">"multipart/form-data"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--index.jsp--&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;文件上载&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">"up.jsp"</span> enctype=<span class="string">"multipart/form-data"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        作者： &lt;input type=<span class="string">"text"</span> name=<span class="string">"author"</span>&gt;&lt;br&gt;</span><br><span class="line">        公司： &lt;input type=<span class="string">"text"</span> name=<span class="string">"company"</span>&gt;&lt;br&gt;</span><br><span class="line">        选择要上传的文件 &lt;input type=<span class="string">"file"</span> name=<span class="string">"filename"</span>&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"上载"</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;!--up.jsp--&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;jsp:useBean id=<span class="string">"TheBean"</span> scope=<span class="string">"page"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.xmh.demo.UploadBean"</span> /&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        TheBean.doUpload(request);</span><br><span class="line">    %&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.xmh.demo;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletInputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadBean</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doUpload</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        PrintWriter pw=<span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"d:\\xmh.txt"</span>)));</span><br><span class="line">        ServletInputStream in=request.getInputStream();</span><br><span class="line">        <span class="keyword">int</span> i=in.read();</span><br><span class="line">        <span class="keyword">while</span>(i!=-<span class="number">1</span>)&#123;</span><br><span class="line">            pw.print((<span class="keyword">char</span>)i);</span><br><span class="line">            i=in.read();</span><br><span class="line">        &#125;</span><br><span class="line">        pw.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ol start="2">
<li>编写上传组件。<blockquote>
<ul>
<li>根据上文所述，如果想要获取表单提取的数据，需要设计一个功能类来处理相关的数据信息。下面设计了一个FileUploadBean.java的类，他就是自定义处理上传功能的类。</li>
</ul>
</blockquote>
</li>
<li>使用自编写的上传组件。 <blockquote>
<ul>
<li>案例2</li>
</ul>
</blockquote>
</li>
</ol>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>自编写上传组件--文件上传示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"selfBean.jsp"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        作者：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"author"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        公司：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"company"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        说明: <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"comment"</span> &gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        选择要上载的文件: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">file</span> <span class="attr">name</span>=<span class="string">"filename"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        文件描述: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"description"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Upload"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;jsp:useBean id=<span class="string">"TheBean"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.xmh.demo.FileUploadBean"</span>  scope=<span class="string">"page"</span>&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        TheBean.setSavePath(<span class="string">"d:/"</span>);</span><br><span class="line">        TheBean.doUpload(request);</span><br><span class="line"></span><br><span class="line">        out.println(<span class="string">"Filename:"</span>+TheBean.getFilename());</span><br><span class="line">        out.println(<span class="string">"&lt;BR&gt;内容类型:"</span>+TheBean.getContentType());</span><br><span class="line">        out.println(<span class="string">"&lt;BR&gt;作者:"</span>+TheBean.getFieldValue(<span class="string">"author"</span>));</span><br><span class="line">        out.println(<span class="string">"&lt;BR&gt;公司:"</span>+TheBean.getFieldValue(<span class="string">"company"</span>));</span><br><span class="line">        out.println(<span class="string">"&lt;BR&gt;说明:"</span>+TheBean.getFieldValue(<span class="string">"comment"</span>));</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;/jsp:useBean&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.xmh.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletInputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String savePath;</span><br><span class="line">    <span class="keyword">private</span> String filepath;</span><br><span class="line">    <span class="keyword">private</span> String filename;</span><br><span class="line">    <span class="keyword">private</span> String contentType;</span><br><span class="line">    <span class="keyword">private</span> Hashtable&lt;String, String&gt; fields;</span><br><span class="line">    <span class="comment">// 返回filename私有域的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilename</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filename;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回filepath私有域的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilepath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filepath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回savePath私有域的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSavePath</span><span class="params">(String savePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.savePath = savePath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回contentType私有域的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contentType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回HTML表单中指定输入元素的值，元素的名字通过fieldName参数指定</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFieldValue</span><span class="params">(String fieldName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fields == <span class="keyword">null</span> || fieldName == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> (String) fields.get(fieldName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setFilename</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> pos = s.indexOf(<span class="string">"filename=\""</span>);</span><br><span class="line">        <span class="keyword">if</span> (pos != -<span class="number">1</span>) &#123;</span><br><span class="line">            filepath = s.substring(pos + <span class="number">10</span>, s.length() - <span class="number">1</span>);</span><br><span class="line"><span class="comment">// Windows浏览器发送完整的文件路径和名字</span></span><br><span class="line"><span class="comment">// 但Linux/Unix和Mad浏览器只发送文件名字</span></span><br><span class="line">            pos = filepath.lastIndexOf(<span class="string">"\\"</span>);</span><br><span class="line">            <span class="keyword">if</span> (pos != -<span class="number">1</span>)</span><br><span class="line">                filename = filepath.substring(pos + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                filename = filepath;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setContentType</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> pos = s.indexOf(<span class="string">": "</span>);</span><br><span class="line">        <span class="keyword">if</span> (pos != -<span class="number">1</span>)</span><br><span class="line">            contentType = s.substring(pos + <span class="number">2</span>, s.length());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//处理请求数据的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doUpload</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServletInputStream in = request.getInputStream();</span><br><span class="line">        <span class="comment">// 创建字节数组充当缓冲容器的作用</span></span><br><span class="line">        <span class="keyword">byte</span>[] line = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">128</span>];</span><br><span class="line">        <span class="keyword">int</span> i = in.readLine(line, <span class="number">0</span>, <span class="number">128</span>);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">3</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// -2丢弃换行字符</span></span><br><span class="line">        <span class="keyword">int</span> boundaryLength = i - <span class="number">2</span>;</span><br><span class="line">        String boundary = <span class="keyword">new</span> String(line, <span class="number">0</span>, boundaryLength);</span><br><span class="line">        fields = <span class="keyword">new</span> Hashtable&lt;String, String&gt;();</span><br><span class="line">        <span class="keyword">while</span>(i!=-<span class="number">1</span>)&#123;</span><br><span class="line">            String newLine=<span class="keyword">new</span> String(line,<span class="number">0</span>,i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(newLine.startsWith(<span class="string">"Content-Disposition: form-data; name=\""</span>))&#123;</span><br><span class="line">                <span class="comment">//判断文件类型</span></span><br><span class="line">                <span class="keyword">if</span>(newLine.indexOf(<span class="string">"filename=\""</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">                    setFilename(<span class="keyword">new</span> String(line,<span class="number">0</span>,i-<span class="number">2</span>));</span><br><span class="line">                    <span class="keyword">if</span>(filename == <span class="keyword">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    i=in.readLine(line,<span class="number">0</span>,<span class="number">128</span>);</span><br><span class="line">                    setContentType(<span class="keyword">new</span> String(line,<span class="number">0</span>,i-<span class="number">2</span>));</span><br><span class="line">                    i=in.readLine(line,<span class="number">0</span>,<span class="number">128</span>);</span><br><span class="line">                    newLine=<span class="keyword">new</span> String(line,<span class="number">0</span>,i);</span><br><span class="line">                    PrintWriter pw=<span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter((savePath == <span class="keyword">null</span> ? <span class="string">""</span>:savePath)+filename)));</span><br><span class="line">                    <span class="keyword">while</span>(i!=-<span class="number">1</span> &amp;&amp; !newLine.startsWith(boundary))&#123;</span><br><span class="line">                        <span class="comment">//文件的最后一行包含换行符</span></span><br><span class="line">                        <span class="comment">//因此必须检查当前行是否是最后一行</span></span><br><span class="line">                        i=in.readLine(line,<span class="number">0</span>,<span class="number">128</span>);</span><br><span class="line">                        <span class="keyword">if</span>( (i == boundaryLength+<span class="number">2</span> || i==boundaryLength+<span class="number">4</span>) &amp;&amp; (<span class="keyword">new</span> String(line,<span class="number">0</span>,i).startsWith(boundary)))&#123;</span><br><span class="line">                            pw.print(newLine.substring(<span class="number">0</span>,newLine.length()-<span class="number">2</span>));</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            pw.print(newLine);</span><br><span class="line">                        &#125;</span><br><span class="line">                        newLine=<span class="keyword">new</span> String(line,<span class="number">0</span>,i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    pw.close();</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//普通表单输入元素</span></span><br><span class="line">                    <span class="comment">//获取输入元素名字</span></span><br><span class="line">                    <span class="keyword">int</span> pos=newLine.indexOf(<span class="string">"name=\""</span>);</span><br><span class="line">                    String fieldName=newLine.substring(pos+<span class="number">6</span>,newLine.length()-<span class="number">3</span>);</span><br><span class="line">                    i=in.readLine(line,<span class="number">0</span>,<span class="number">128</span>);</span><br><span class="line">                    newLine=<span class="keyword">new</span> String(line,<span class="number">0</span>,i);</span><br><span class="line">                    StringBuffer fieldValue=<span class="keyword">new</span> StringBuffer(<span class="number">128</span>);</span><br><span class="line">                    <span class="keyword">while</span>(i!=-<span class="number">1</span> &amp;&amp; !newLine.startsWith(boundary))&#123;</span><br><span class="line">                        <span class="comment">//最后一行包含换行符</span></span><br><span class="line">                        <span class="comment">//因此必须检查当前行是否是最后一行</span></span><br><span class="line">                        i=in.readLine(line,<span class="number">0</span>,<span class="number">128</span>);</span><br><span class="line">                        <span class="keyword">if</span>( (i==boundaryLength+<span class="number">2</span> || i==boundaryLength+<span class="number">4</span>) &amp;&amp;(<span class="keyword">new</span> String(line,<span class="number">0</span>,i).startsWith(boundary)))&#123;</span><br><span class="line">                            fieldValue.append(newLine.substring(<span class="number">0</span>,newLine.length()-<span class="number">2</span>));</span><br><span class="line">                        &#125;<span class="keyword">else</span></span><br><span class="line">                            fieldValue.append(newLine);</span><br><span class="line"></span><br><span class="line">                        newLine=<span class="keyword">new</span> String(line,<span class="number">0</span>,i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    fields.put(fieldName,fieldValue.toString());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            i=in.readLine(line,<span class="number">0</span>,<span class="number">128</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-JspSmartUpload上传组件"><a href="#1-2-JspSmartUpload上传组件" class="headerlink" title="1.2 JspSmartUpload上传组件"></a>1.2 <code>JspSmartUpload</code>上传组件</h4><p><code>JspSmartUpload</code>是由<code>JspSmart</code>公司开发的，它可以免费下载，下载地址:<br><code>https://pan.baidu.com/s/10OTcN5GOwNly-Ty9oybwQQ</code>，提取码：<code>4fzf</code><br>因为要反馈给用户上传成功与否，所以需要将上传功能的执行顺序优先于表单的文本数据执行。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--上传界面--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>上传图片<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"upload_pic.jsp"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">name</span>=<span class="string">"form1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">cellpadding</span>=<span class="string">"1"</span> <span class="attr">cellspacing</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"45"</span> <span class="attr">align</span>=<span class="string">"center"</span> <span class="attr">valign</span>=<span class="string">"middle"</span>&gt;</span></span><br><span class="line">                    请选择上传的图片</span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--处理图片 ， 获取上传图图片，然后生成缩略图 --&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"utf-8"</span></span><br><span class="line">     <span class="keyword">import</span>=<span class="string">"java.util.*,java.io.*"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"com.jspsmart.upload.SmartUpload"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"javax.servlet.jsp.tagext.TryCatchFinally"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"javax.imageio.ImageIO"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.awt.image.BufferedImage"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"javax.servlet.*"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"javax.servlet.http.*"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.awt.*"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String path = request.getContextPath();</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">"://"</span> + request.getServerName() + <span class="string">":"</span> + request.getServerPort()</span><br><span class="line">            + path + <span class="string">"/"</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    SmartUpload mySmartUpload = <span class="keyword">new</span> SmartUpload();<span class="comment">//实例SmartUpload对象</span></span><br><span class="line">    <span class="keyword">long</span> file_size_max = <span class="number">4000000</span>;</span><br><span class="line">    String fileName2;<span class="comment">//文件名</span></span><br><span class="line">    String ext;<span class="comment">//文件扩展名</span></span><br><span class="line">    String url = <span class="string">"D:/"</span>;<span class="comment">//应保证在WebRoot目录下有此目录的存在</span></span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    mySmartUpload.initialize(pageContext);</span><br><span class="line">    <span class="comment">//只允许上载此类文件</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//支持上载文件的后缀名</span></span><br><span class="line">        <span class="comment">//mySmartUpload.setAllowedFilesList("jpg,gif");</span></span><br><span class="line">        <span class="comment">//mySmartUpload.setAllowedFilesList("jpg,gif,jpeg,png");</span></span><br><span class="line">        <span class="comment">//不支持指定的后缀</span></span><br><span class="line">        mySmartUpload.setDeniedFilesList(<span class="string">"exe"</span>);</span><br><span class="line">        <span class="comment">//上载文件</span></span><br><span class="line">        mySmartUpload.upload();<span class="comment">//不指定编码的upload()方法</span></span><br><span class="line">        <span class="comment">//mySmartUpload.upload("utf-8");//指定编码的upload()方法</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        out.print(<span class="string">"&lt;script type=\"text/javascript\"&gt;"</span>);</span><br><span class="line">        out.print(<span class="string">"window.alert(\"文件格式不符\");"</span>);</span><br><span class="line">        out.print(<span class="string">"window.location=\"upload.html;\""</span>);</span><br><span class="line">        out.print(<span class="string">"&lt;/script&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        com.jspsmart.upload.File myFile = mySmartUpload.getFiles().getFile(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (myFile.isMissing()) &#123;<span class="comment">//如果没有拿到文件，提示</span></span><br><span class="line">            out.print(<span class="string">"&lt;script type=\"text/javascript\"&gt;"</span>);</span><br><span class="line">            out.print(<span class="string">"window.alert(\"请先选择要上传的文件\");"</span>);</span><br><span class="line">            out.print(<span class="string">"window.location=\"upload.html;\""</span>);</span><br><span class="line">            out.print(<span class="string">"&lt;/script&gt;"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String myFileName = myFile.getFileName();<span class="comment">//取得上载的文件的文件名</span></span><br><span class="line">            ext = myFile.getFileExt();<span class="comment">//取得后缀名</span></span><br><span class="line">            <span class="keyword">if</span> (!(ext.length() &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">                out.println(<span class="string">"**************myFileName的文件名是："</span> + myFileName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> file_size = myFile.getSize();<span class="comment">//取得文件的大小</span></span><br><span class="line">            String saveUrl = <span class="string">""</span>;<span class="comment">//文件保存路径</span></span><br><span class="line">            <span class="keyword">if</span> (file_size &lt; file_size_max) &#123;</span><br><span class="line">                <span class="comment">//更改文件名，取得当前上传时间的毫秒数值</span></span><br><span class="line">                Calendar calendar = Calendar.getInstance();</span><br><span class="line">                String fileName = String.valueOf(calendar.getTimeInMillis());<span class="comment">//设置新的文件名</span></span><br><span class="line">                saveUrl += fileName + <span class="string">"."</span> + ext;</span><br><span class="line">                myFile.saveAs(saveUrl, mySmartUpload.SAVE_PHYSICAL);<span class="comment">//保存文件</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//上传完成，开始生成缩略图</span></span><br><span class="line">                java.io.File file = <span class="keyword">new</span> java.io.File(saveUrl);<span class="comment">//读入刚才上传的文件</span></span><br><span class="line">                out.println(<span class="string">"ext = "</span> + ext);</span><br><span class="line">                String newUrl =  url + fileName + <span class="string">"_min."</span> + ext;<span class="comment">//新的缩略图保存地址</span></span><br><span class="line">                System.out.println(newUrl);</span><br><span class="line">                BufferedImage image=ImageIO.read(file);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> imageWidth=image.getWidth(); <span class="comment">//取出图片额宽度</span></span><br><span class="line">                <span class="keyword">int</span> imageHeight=image.getHeight();<span class="comment">//取出图片的高度</span></span><br><span class="line">                <span class="keyword">int</span> n_w=<span class="number">0</span>; <span class="comment">//缩略图的宽度</span></span><br><span class="line">                <span class="keyword">int</span> n_h=<span class="number">0</span>; <span class="comment">//缩略图的高度</span></span><br><span class="line">                System.out.println(<span class="string">"imageWidth="</span>+imageWidth + <span class="string">";"</span>+<span class="string">"imageHeight="</span>+imageHeight);</span><br><span class="line">                <span class="keyword">float</span> tempDouble;</span><br><span class="line">                <span class="keyword">if</span>(imageHeight &gt; imageWidth)&#123;</span><br><span class="line">                    tempDouble = imageHeight /<span class="number">200</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    tempDouble = imageWidth /<span class="number">200</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                n_w = (<span class="keyword">int</span>) (imageWidth/tempDouble);</span><br><span class="line">                n_h = (<span class="keyword">int</span>) (imageHeight/tempDouble);</span><br><span class="line">                FileOutputStream fos=<span class="keyword">new</span> FileOutputStream(newUrl);</span><br><span class="line">                BufferedImage bi=<span class="keyword">new</span> BufferedImage(n_w,n_h,BufferedImage.TYPE_INT_RGB);</span><br><span class="line">                Graphics g=bi.getGraphics();</span><br><span class="line">                g.drawImage(image,<span class="number">0</span>,<span class="number">0</span>,n_w,n_h,Color.LIGHT_GRAY,<span class="keyword">null</span>);</span><br><span class="line">                g.dispose();</span><br><span class="line">                ImageIO.write(bi,<span class="string">"jpg"</span>,fos);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                out.print(<span class="string">"&lt;script type=\"text/javascript\"&gt;"</span>);</span><br><span class="line">                out.print(<span class="string">"window.alert(\"上传文件大小不能超过\"+(file_size_max/1000)+\"K\");"</span>);</span><br><span class="line">                out.print(<span class="string">"window.location=\"upload.html;\""</span>);</span><br><span class="line">                out.print(<span class="string">"&lt;/script&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;处理上传的图片&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-Cos上传组件-（Cloud-Object-Storage）"><a href="#1-3-Cos上传组件-（Cloud-Object-Storage）" class="headerlink" title="1.3 Cos上传组件 （Cloud Object Storage）"></a>1.3 <code>Cos</code>上传组件 （Cloud Object Storage）</h4><ul>
<li><code>Cos</code>组件是<code>O&#39;Reilly</code>公司开发的一款免费组件。</li>
<li><code>Cos</code>包下载地址：<code>http://www.servlets.com/cos/</code><h5 id="2-3-1-在Cos组件中MultipartRequest类主要负责文件上传的处理"><a href="#2-3-1-在Cos组件中MultipartRequest类主要负责文件上传的处理" class="headerlink" title="2.3.1 在Cos组件中MultipartRequest类主要负责文件上传的处理"></a>2.3.1 在<code>Cos</code>组件中<code>MultipartRequest</code>类主要负责文件上传的处理</h5><blockquote>
<ul>
<li>(1) <code>MultipartRequest</code>有8个构造函数，它们分别是：<blockquote>
<blockquote>
<ul>
<li><code>public MulipartRequest(HttpServletRequest request,String saveDirectory) throws IOException</code></li>
<li><code>public MultipartRequest(HttpServletRequest request,String saveDirectory,int maxPostSize) throws IOException</code></li>
<li><code>public MiltipartRequest(HttpServletRequest request,String saveDirectory,int maxPostSize,FileRenamePolicy policy) throws IOException</code></li>
<li><code>public MultipartRequest(HttpServletRequest request,String saveDirectory,int maxPostSize,String encoding) throws IOException</code></li>
<li><code>public MultipartRequest(HttpServletRequest request,String saveDirectory,int maxPostSize,String encoding,FileRenamePolicy policy) throws IOException</code></li>
<li><code>public MultipartRequest(HttpServletRequest request,String saveDirectory,String encoding) throws IOException</code></li>
<li><code>public MulipartRequest(HttpServletRequest request,String saveDirectory) throws IOException</code></li>
<li><code>public MulipartRequest(HttpServletRequest request,String saveDirectory,int maxPostSize)throws IOException</code></li>
</ul>
</blockquote>
</blockquote>
</li>
<li>(2) <code>MultipartRequest</code>类工具有8中方法：<blockquote>
<blockquote>
<ul>
<li><code>public Enumeration getParameters()</code>: 取得请求参数的名称</li>
<li><code>public String getParameter(String name)</code>: 此方法返回参数为<code>name</code>的值</li>
<li><code>public String[] getParameterValues(String name)</code>：当指定参数具有多个值时，此方法会返回<code>String</code>数组</li>
<li><code>public Enumeration getFileName()</code>：传回所有文件输入类型的名称</li>
<li><code>public String getFilesystemNames(String name)</code>： 用此方法得到上传文件的真正的文件名称，这里的<code>name</code>指文件输入类型的名称</li>
<li><code>public String getContentType(String name)</code>： 此方法得到上传文件的文件类型</li>
<li><code>public File getFile(String name)</code>：此方法得到一个文件对象，代表存储在服务器上的<code>name</code>值</li>
<li><code>public String getOriginalFileName(String name)</code>：返回文件在修改政策有效之前的文件名称。</li>
<li>注意：<code>Cos</code>组件在上传大容量文件时，效率比起前面介绍的自编写<code>JavaBean</code>组件和<code>JspSmart</code>上传组件高。</li>
<li>案例：</li>
</ul>
</blockquote>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--upload.html--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>无标题文档<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--enctype的值很重要，upload.jsp处理上传的JSP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"upload.jsp"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">name</span>=<span class="string">"form1"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file1"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file2"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file3"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"Submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.io.File"</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"com.oreilly.servlet.MultipartRequest"</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.Enumeration"</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">//文件上传后，保存在d:/JavaWebs</span></span><br><span class="line">    String saveDirectory=<span class="string">"d:"</span>+ File.separator+<span class="string">"JavaWebs"</span>;</span><br><span class="line">    <span class="comment">//每个文化最大500M,最多三个文件，所以...</span></span><br><span class="line">    <span class="keyword">int</span> maxPostSize=<span class="number">3</span>*<span class="number">500</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line">    <span class="comment">//response的编码为gd2312，同时采用缺省的文件名冲突解决策略，实现上传</span></span><br><span class="line">    MultipartRequest multi=<span class="keyword">new</span> MultipartRequest(request,saveDirectory,maxPostSize,<span class="string">"UTF-8"</span>);</span><br><span class="line">    <span class="comment">//输出反馈信息</span></span><br><span class="line">    Enumeration files=multi.getFileNames();</span><br><span class="line">    <span class="keyword">while</span> (files.hasMoreElements())&#123;</span><br><span class="line">        System.err.println(<span class="string">"ccc"</span>);</span><br><span class="line">        String name= (String) files.nextElement();</span><br><span class="line">        File f=multi.getFile(name);</span><br><span class="line">        <span class="keyword">if</span>(f!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            String fileName=multi.getFilesystemName(name);</span><br><span class="line">            String lastFileName=saveDirectory+<span class="string">"\\"</span>+fileName;</span><br><span class="line">            out.println(<span class="string">"上传的文件:"</span>+lastFileName);</span><br><span class="line">            out.println(<span class="string">"&lt;hr&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="以上内容大部分都是参考一本书叫做《软件开发-JSP》，感谢作者"><a href="#以上内容大部分都是参考一本书叫做《软件开发-JSP》，感谢作者" class="headerlink" title="以上内容大部分都是参考一本书叫做《软件开发 JSP》，感谢作者!!!!"></a>以上内容大部分都是参考一本书叫做《软件开发 JSP》，感谢作者!!!!</h2>
        
    </section>
</article>


    <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            <a href="/CPWS.github.io/2019/06/28/解决中文乱码/">解决中文乱码</a>
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://CPWS.github.io/page/4/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-06-28T01:47:18.000Z" itemprop="datePublished">2019-06-28</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/CPWS.github.io/tags/解决中文乱码/">解决中文乱码</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h4 id="1-1-熟悉Web应用程序中与编码相关的部分"><a href="#1-1-熟悉Web应用程序中与编码相关的部分" class="headerlink" title="1.1 熟悉Web应用程序中与编码相关的部分"></a>1.1 熟悉Web应用程序中与编码相关的部分</h4><blockquote>
<ul>
<li>JSP编译<blockquote>
<blockquote>
<ul>
<li>指定文件的存储编码,很明显。该设置应该位于文件的开头：<code>&lt;%@page pageEncoding=&quot;UTF-8&quot; %&gt;</code></li>
<li>另外对于一般的class文件，可以在编译的时候指定编码。</li>
</ul>
</blockquote>
</blockquote>
</li>
<li>JSP输出 <blockquote>
<blockquote>
<ul>
<li>指定文件输出到Browser时的使用的编码，该设置也应该设置在文件的开头。<code>&lt;%@page contentType=&quot;text/html;charset=UTF8&quot; %&gt;</code></li>
<li>该设置与<code>response.setCharacterEncoding(&quot;GBK&quot;);</code>等效</li>
</ul>
</blockquote>
</blockquote>
</li>
<li>META设置<blockquote>
<blockquote>
<ul>
<li>指定网页使用的编码，该设置对静态网页尤其有用，因为静态网页无法使用采用JSP的设置而且也无法执行<code>response.setCharacterEncoding(&quot;UTF-8&quot;)</code> ；例如：<br><code>&lt;meta http-equiv=&quot;Content-Type&quot; contentType=&quot;text/html;charset=UTF-8&quot;/&gt;</code></li>
<li>注意：如果同时采用了JSP输出和meta设置两种编码指定方式，那么JSP指定的优先。因为JSP指定的直接体现在Response中。</li>
</ul>
</blockquote>
</blockquote>
</li>
<li>Form设置<blockquote>
<blockquote>
<ul>
<li>当浏览器提交表单时，可以指定相应的编码，例如:<code>&lt;form accept-charset=&quot;UTF-8&quot;&gt;&lt;/form&gt;</code>一般不需要设置，浏览器会直接使用网页的编码</li>
</ul>
</blockquote>
</blockquote>
</li>
</ul>
</blockquote>
<h4 id="1-2-熟悉Web应用程序产生中文乱码的原因"><a href="#1-2-熟悉Web应用程序产生中文乱码的原因" class="headerlink" title="1.2 熟悉Web应用程序产生中文乱码的原因"></a>1.2 熟悉Web应用程序产生中文乱码的原因</h4><blockquote>
<ul>
<li><code>JSP</code>页面被编译成<code>class</code>文件时,如果未指定字符集时,默认使用<code>ISO-8859-1</code>的编码格式，这样中文会出现乱码。</li>
<li>提交表单时如果设定提交方式为<code>Post</code>而没有设置提交的编码的格式，则会以<code>ISO-8859-1</code>方式提交，而接收的<code>JSP</code>却以<code>UTF-8</code>的方式接收，这样也会导致中文乱码。</li>
<li>提交表单时如果设定提交方式为<code>Get</code>而没有设置提交的编码的格式，Tomcat会以GET的默认编码格式ISO8859-1对汉字进行编码，编码后追加到<code>URL</code>，导致接收页面得到的参数为乱码。</li>
</ul>
</blockquote>
<h4 id="1-3-解决中文乱码"><a href="#1-3-解决中文乱码" class="headerlink" title="1.3 解决中文乱码"></a>1.3 解决中文乱码</h4><blockquote>
<ul>
<li>设置文件本身的编码格式。这可以在<code>Eclipse</code>或<code>MyEclipse</code>中进行设置。</li>
<li>在<code>JSP</code>页面中指定字符集，通常页面字符集的设置如下：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span>  %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">"Content-Type"</span> contentType=<span class="string">"text/html;charset=UTF8"</span>/&gt;</span><br><span class="line">        &lt;title&gt;字符集设置联系&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>数据库连接时指定的字符集。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String url=<span class="string">"jdbc:msqyl://localhost:3306/test?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在程序中获取页面数据时使用如下代码</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><ul>
<li>如果需要将中文作为参数传递，需要在传递和接受时进行相应的处理、具体方法如下所示：<blockquote>
<ul>
<li>在传递参数时对参数编码 : <code>&quot;...RearshRes.jsp?keywords=&quot;+java.net.URLEncoder.encode(keywords)</code></li>
<li>然后在接收参数页面中使用如下语句接收 <code>keywords=new String(request.getParameter(&quot;keywords&quot;).getBytes(&quot;ISO-8859-1&quot;))</code></li>
</ul>
</blockquote>
</li>
</ul>

        
    </section>
</article>




<nav class="page-nav">
    <a class="extend prev" rel="prev" href="/CPWS.github.io/page/3/">&laquo; Prev</a><a class="page-number" href="/CPWS.github.io/">1</a><a class="page-number" href="/CPWS.github.io/page/2/">2</a><a class="page-number" href="/CPWS.github.io/page/3/">3</a><span class="page-number current">4</span>
</nav>



            </div>
        </div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?e4027971a230b210f4671f485b33846a";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle();
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp();
            }, 3000);
        }
    });
    </script>
    

</body>
</html>
