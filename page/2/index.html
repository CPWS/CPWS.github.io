<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Prossible&#39;s Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Prossible&#39;s Blog">
<meta property="og:url" content="https://CPWS.github.io/page/2/index.html">
<meta property="og:site_name" content="Prossible&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Prossible&#39;s Blog">
  
    <link rel="alternative" href="/atom.xml" title="Prossible&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  <link rel="stylesheet" href="/CPWS.github.io/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head></html>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://img.mp.itc.cn/q_mini,c_zoom,w_640/upload/20161221/c495640d0fc24a91b9c95dc0d54b6002_th.jpeg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">zhuli</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/CPWS.github.io/archives">所有文章</a></li>
				        
							<li><a href="/CPWS.github.io/">主页</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/CPWS.github.io/tags/Java框架下载路径/" style="font-size: 10px;">Java框架下载路径</a> <a href="/CPWS.github.io/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/CPWS.github.io/tags/redis/" style="font-size: 10px;">redis</a> <a href="/CPWS.github.io/tags/数据库系统概述/" style="font-size: 10px;">数据库系统概述</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">zhuli</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://img.mp.itc.cn/q_mini,c_zoom,w_640/upload/20161221/c495640d0fc24a91b9c95dc0d54b6002_th.jpeg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">zhuli</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/CPWS.github.io/archives">所有文章</a></li>
		        
					<li><a href="/CPWS.github.io/">主页</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-spring4" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/10/23/spring4/" class="article-date">
  	<time datetime="2019-10-23T11:39:01.000Z" itemprop="datePublished">2019-10-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/10/23/spring4/">
        spring4
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Spring框架简介"><a href="#Spring框架简介" class="headerlink" title="Spring框架简介"></a>Spring框架简介</h2><ol>
<li>主要发明者：Rod Johnson</li>
<li>轮子理论推崇者：<blockquote>
<ul>
<li>轮子理论：不用重复发明轮子。</li>
<li>IT行业：直接使用写好的代码。</li>
</ul>
</blockquote>
</li>
<li>Spring框架宗旨：不重新发明技术，让原有技术使用起来更加方便。</li>
<li>Spring的极大核心功能<blockquote>
<ul>
<li>Ioc/DI：控制反转/依赖注入</li>
<li>Aop：面向切面编程</li>
<li>声明式事务</li>
</ul>
</blockquote>
</li>
<li>Spring框架的runtime<blockquote>
<ul>
<li>test:Spring框架提供的测试功能</li>
<li>Core Container容器：核心容器。Spring启动基本的条件<blockquote>
<ul>
<li>Beans：Spring负责创建类对象并管理对象。</li>
<li>Core：核心类库。</li>
<li>Context：上下文参数，获取外部资源或者管理注解。</li>
<li>SpEl：expression.jar</li>
</ul>
</blockquote>
</li>
<li>AOP:实现aop功能需要依赖</li>
<li>Aspects：切面AOP依赖的包</li>
<li>Data Access/Integration：spring封装数据访问层相关内容<blockquote>
<ul>
<li>jdbc：spring对jdbc封装后的代码。</li>
<li>ORM：封装持久层框架的代码；如Hibernate</li>
</ul>
</blockquote>
</li>
<li>transaction：对应spring-tx.jar 声明式事务</li>
<li>WEB：需要spring完成Web相关功能时需要<blockquote>
<ul>
<li>例如：由tomcat加载spring配置文件需要有<code>spring-web</code>包</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ol>
<p><img src="https://i.loli.net/2019/10/23/SrK7vQueOlyMNRT.png" alt="1571831446_1_.png"></p>
<ol start="6">
<li>Spring框架中重要概念：<blockquote>
<ul>
<li>容器(container)：spring当做一个大容器</li>
<li>BeanFactory接口：老版本。<blockquote>
<ul>
<li>新版本中ApplicationContext接口BeanFactory子接口。BeanFactory的功能在ApplicationContext中都有。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>从Spring3开始把Spring框架的功能拆分成多个.jar</li>
</ol>
<hr>
<h2 id="SpringIoc简介："><a href="#SpringIoc简介：" class="headerlink" title="SpringIoc简介："></a>SpringIoc简介：</h2><ol>
<li>中文名称：控制反转</li>
<li>英文名称：（Inversion of Control）</li>
<li>Ioc是什么？<blockquote>
<ul>
<li>Ioc完成的事情是原先由程序主动通过new实例化对象事情，转交给Spring负责。</li>
<li>控制反转中的控制指的是：控制类的对象。</li>
<li>控制反转中的反转指的是：转交给Spring负责。</li>
<li>Ioc最大的作用：<code>解耦</code>。</li>
<li>程序员不需要去管理对象。解除了对象管理和程序员之间的耦合。</li>
</ul>
</blockquote>
</li>
</ol>
<hr>
<h2 id="Spring环境搭建"><a href="#Spring环境搭建" class="headerlink" title="Spring环境搭建"></a>Spring环境搭建</h2><ol>
<li><p>导入jar包</p>
<blockquote>
<ul>
<li>四个核心包+日志包</li>
</ul>
</blockquote>
</li>
<li><p>在src下新建applicationContext.xml</p>
<blockquote>
<ul>
<li>文件名称和路径自定义</li>
<li>记住Spring容器applicationContext，applicationContext配置的信息最终存储到了applicationContext容器中。</li>
<li>Spring配置文件是基于schema<blockquote>
<ul>
<li>Schema文件扩展名.xsd</li>
<li>把Schema理解成Dtd的升级版<blockquote>
<ul>
<li>比dtd具备更好的扩展性。</li>
</ul>
</blockquote>
</li>
<li>每次引入一个xsd配置文件就是一个namespace（xmlns）</li>
<li>配置文件中只需要导入schema即可。<blockquote>
<ul>
<li>通过<code>&lt;/bean&gt;</code>创建对象。</li>
<li>对象是在加载配置文件时被加载。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			id：表示获取到对象标识</span></span><br><span class="line"><span class="comment">			class：创建哪个类的对象</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写测试方法</p>
<blockquote>
<ul>
<li>getBean(“<code>&lt;bean/&gt;</code>属性的id值”,创建的对象类型)。 </li>
<li>getBeanDefinitionNames()：获取bean属性管理的所有对象。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">People people = ac.getBean(<span class="string">"peo"</span>,People.class);</span><br><span class="line">System.out.println(people);</span><br><span class="line">String[] names = ac.getBeanDefinitionNames();</span><br><span class="line"><span class="keyword">for</span> (String string : names) &#123;</span><br><span class="line">    System.out.println(string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="Spring创建对象的三种方式："><a href="#Spring创建对象的三种方式：" class="headerlink" title="Spring创建对象的三种方式："></a>Spring创建对象的三种方式：</h2><ol>
<li><p>通过构造方法创建</p>
<blockquote>
<ul>
<li>无参构造创建：默认情况</li>
<li>有参构造创建：需要明确配置<blockquote>
<ul>
<li>需要在类提供有参构造方法</li>
<li>在<code>applicationContext.xml</code>中设置调用哪个构造方法创建对象。<blockquote>
<ul>
<li>如果设定的条件匹配多个构造方法，执行最后的构造方法。</li>
<li>index：参数的索引，从0开始。</li>
<li>name：参数名。</li>
<li>type：参数类型。</li>
<li>value指定参数的参数值。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        id：表示获取到对象标识</span></span><br><span class="line"><span class="comment">        class：创建哪个类的对象</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ref引用另一个bean；value基本数据类型或String等 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;constructor-arg index="0" value="123"&gt;&lt;/constructor-arg&gt;</span></span><br><span class="line"><span class="comment">        &lt;constructor-arg index="1" value="张三"&gt;&lt;/constructor-arg&gt; --&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">value</span>=<span class="string">"321"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span> <span class="attr">value</span>=<span class="string">"李四"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>实例工厂</p>
<blockquote>
<ul>
<li>工厂设计模式：帮助创建类对象，一个工厂可以生产多个对象。</li>
<li>实例工厂：需要先创建工厂，才能生产对象。</li>
<li>实现步骤：<blockquote>
<ul>
<li>需要有一个实例工厂模式</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdaib.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PeopleFactory2</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> People <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> People(<span class="number">1</span>,<span class="string">"测试"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在applicationContext.xml配置并创建bean对象。</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 实例工厂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.PeopleFactory2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo1"</span> <span class="attr">factory-bean</span>=<span class="string">"factory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>静态工厂<blockquote>
<ul>
<li>不需要创建工厂，快速创建对象</li>
<li>实现步骤：<blockquote>
<ul>
<li>编写一个静态工厂（在方法上加上一个static）</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdaib.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PeopleFactory2</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> People <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> People(<span class="number">1</span>,<span class="string">"测试"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<blockquote>
<ul>
<li>在applicationContext.xml进行配置</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 静态工厂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo2"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.PeopleFactory2"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="如何给Bean的属性赋值（注入）"><a href="#如何给Bean的属性赋值（注入）" class="headerlink" title="如何给Bean的属性赋值（注入）"></a>如何给Bean的属性赋值（注入）</h2><ol>
<li>通过构造方法设置值</li>
<li>设置注入(setter方法)<blockquote>
<ul>
<li>如果属性是基本数据类型或String类型</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"555"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"张三"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>等效于</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>345<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>lisi<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果属性是<code>Set&lt;?&gt;</code>时</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>567<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>lisi<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sets"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果对象是List&lt;?&gt;集合</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>567<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>lisi<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lists"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>如果list集合中只有一个值</code></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果属性是数组时</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>567<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>lisi<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"strs"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>如果数组中只有一个值</code></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"strs"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果属性是map</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maps"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"3"</span> <span class="attr">value</span>=<span class="string">"4"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果属性是Properties时</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"key1"</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"key2"</span>&gt;</span>value2<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="DI"><a href="#DI" class="headerlink" title="DI"></a>DI</h2><ol>
<li>DI：中文名称：依赖注入</li>
<li>DI: 英文名称：Dependency Injection</li>
<li>DI是什么？<blockquote>
<ul>
<li>DI和IOC是一样的</li>
<li>当一个类(A)中需要依赖另一个类(B)对象时，把B赋值给A的过程就叫注入。</li>
</ul>
</blockquote>
</li>
<li>代码体现<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"peo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.People"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"desk"</span> <span class="attr">ref</span>=<span class="string">"desk"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"desk"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.Desk"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"price"</span> <span class="attr">value</span>=<span class="string">"12.3"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="使用Spring简化Mybatis"><a href="#使用Spring简化Mybatis" class="headerlink" title="使用Spring简化Mybatis"></a>使用Spring简化Mybatis</h2><ol>
<li>导入jar包：导入Mybatis所有的jar包和spring基本包，spring-jdbc,spring-tx,spring-aop,spring整合mybatis的包等。</li>
</ol>
<p><img src="https://i.loli.net/2019/10/25/M4rlQG2dq3REzPH.png" alt="spring-mybatis.png"></p>
<ol start="2">
<li><p>编写spring配置文件：applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        数据源封装类 </span></span><br><span class="line"><span class="comment">        数据源：获取数据库连接</span></span><br><span class="line"><span class="comment">        spring-jdbc.jar</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC&amp;amp;characterEncoding=UTF8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 依赖注入 创建SqlSessionFactory对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接信息来源与DataSource --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 扫描器 相当Mybatis中Mappers标签下的package标签，扫描com.gdaib.mapper包后会给对应接口创建对象  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定要扫描哪个包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.gdaib.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 和factory产生关系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"factory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 由spring来管理实现类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"airportService"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.pojo.impl.AirportServiceImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"airportMapper"</span> <span class="attr">ref</span>=<span class="string">"airportMapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写代码</p>
<blockquote>
<ul>
<li>正常编写pojo</li>
<li>编写Mapper包下时必须使用接口绑定方案或者注解方法(必须有接口)</li>
<li>正常编写Service接口和Service接口的实现类<blockquote>
<ul>
<li>需要在Service实现类中声明Mapper接口对象，并生成getter和setter方法。</li>
</ul>
</blockquote>
</li>
<li>spring无法管理Servlet</li>
</ul>
</blockquote>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2></li>
<li><p>AOP：中文名称：面向切面编程</p>
</li>
<li><p>AOP: 英文名称：Aspect Oriented Programming</p>
</li>
<li><p>正常程序执行流程都是纵向执行流程。</p>
<blockquote>
<ul>
<li>又叫面向切面编程，在原有纵向执行流程中添加横切面。</li>
<li>不需要修改原有程序代码（体现出程序高扩展性）<blockquote>
<ul>
<li>高扩展性</li>
<li>原有功能相当于释放了部分逻辑，让职责更加明确。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li><p>面向切面编程是什么？</p>
<blockquote>
<ul>
<li>在程序原有纵向执行流程中，针对某一个某一些方法添加通知，形成横切面的过程就叫做面向切面编程。</li>
</ul>
</blockquote>
</li>
<li><p>常用概念</p>
<blockquote>
<ul>
<li>原有功能：切点：pointcut</li>
<li>前置通知：在切点之前执行的功能：before advice</li>
<li>后置通知：在切点之后执行的功能：after advice</li>
<li>如果切点执行过程中出现异常，会触发异常通知。throwable advice</li>
<li>所有功能的总称叫做切面</li>
<li>织入：把切面嵌入到原有功能的过程叫做织入。</li>
</ul>
</blockquote>
</li>
<li><p>Spring提供了2中AOP方式</p>
<blockquote>
<ul>
<li>Schema-based<blockquote>
<ul>
<li>每个通知都需要实现接口或类。</li>
<li>配置spring文件时在<code>&lt;aop:config&gt;</code>配置</li>
</ul>
</blockquote>
</li>
<li>AspectJ<blockquote>
<ul>
<li>每个通知不需要实现类或接口</li>
<li>配置spring配置文件是在<code>&lt;aop:config&gt;</code>的字标签<code>&lt;aop:aspect&gt;</code>中配置。</li>
</ul>
</blockquote>
</li>
<li>schema-based实现步骤：<blockquote>
<ul>
<li>导入jar包</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ol>
<p><img src="https://i.loli.net/2019/10/25/micsfUBRbygqHpv.png" alt="aop.png"></p>
<blockquote>
<blockquote>
<ul>
<li>新建通知类：前置通知类和后置通知类</li>
<li>arg0：切点方法对象 Method对象</li>
<li>arg1：切点方法参数</li>
<li>arg2：切点在哪个对象中</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdaib.advise;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.MethodBeforeAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeforeAdvice</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method arg0, Object[] arg1, Object arg2)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>arg0:切点方法返回值</li>
<li>arg1：切点方法对象</li>
<li>arg2：切点方法参数</li>
<li>arg4：切点方法所在类的对象</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdaib.advise;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.AfterReturningAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAfterAdvice</span> <span class="keyword">implements</span> <span class="title">AfterReturningAdvice</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object arg0, Method arg1, Object[] arg2, Object arg3)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.println(<span class="string">"执行后置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>配置spring配置文件<blockquote>
<ul>
<li>引入aop命名空间</li>
<li>配置通知类<code>&lt;bean/&gt;</code></li>
<li>配置通知 <code>&lt;aop:advisor&gt;</code></li>
<li><code>*</code>：通配符，匹配任意方法名，任意类名，任意一级包名</li>
<li><code>(..)</code>：如果希望匹配任意方法参数</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置通知类对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mybefore"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.advise.MyBeforeAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myafter"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.advise.MyAfterAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加切面功能 Schema-based--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切点 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.gdaib.test.Demo.demo2())"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加前置通知 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"mybefore"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加后置通知 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myafter"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置demo,测试时使用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.test.Demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>测试</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"demo1"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"demo2"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"demo3"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//AOP 扩展</span></span><br><span class="line">		<span class="comment">//IOC 解耦</span></span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		Demo demo=ac.getBean(<span class="string">"demo"</span>,Demo.class);</span><br><span class="line">		demo.demo1();</span><br><span class="line">		demo.demo2();</span><br><span class="line">		demo.demo3();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>运行结果</li>
</ul>
</blockquote>
</blockquote>
<p><img src="https://i.loli.net/2019/10/25/yY4eWH5TEpXAGI1.png" alt="aop-result.png"></p>
<h2 id="配置异常通知的步骤：（AspectJ）"><a href="#配置异常通知的步骤：（AspectJ）" class="headerlink" title="配置异常通知的步骤：（AspectJ）"></a>配置异常通知的步骤：（AspectJ）</h2><ol>
<li>只有当切点报异常才能出发异常通知.</li>
<li>在spring中有<code>AspectJ</code>方式提供了异常通知的方法。<blockquote>
<ul>
<li>如果希望通过<code>Schema-based</code>实现需要按照特定的要求自己编写方法</li>
</ul>
</blockquote>
</li>
<li>实现步骤：<blockquote>
<ul>
<li>新建一个类，在类中写任意名称的方法</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Myexception</span> <span class="keyword">implements</span> <span class="title">ThrowsAdvice</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myexcetion</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"异常捕获通知:"</span>+e.getMessage());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在spring配置文件中配置 <blockquote>
<ul>
<li><code>&lt;aop:aspect&gt;</code>的ref属性表示：方法在哪个类中</li>
<li><code>&lt;aop:xxx&gt;</code>表示什么通知</li>
<li>method:表示调用哪个方法</li>
<li>throwing：异常对象名，必须和通知方法中参数名相同（可以不再通知方法中添加任何参数）</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"my"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.advise.Myexception"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"my"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.gdaib.test.Demo.demo1())"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"myexcetion"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span> <span class="attr">throwing</span>=<span class="string">"e"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.test.Demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="使用Schema-base方式实现异常通知"><a href="#使用Schema-base方式实现异常通知" class="headerlink" title="使用Schema-base方式实现异常通知"></a>使用<code>Schema-base</code>方式实现异常通知</h2><ol>
<li><p>新建一个类实现<code>ThrowAdvice</code>接口</p>
<blockquote>
<ul>
<li>必须自己写方法，且必须叫afterThrowing</li>
<li>有两种参数方式,必须一个或四个</li>
<li>throwing值必须和方法参数名一致.</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdaib.advise;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.ThrowsAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThrow</span> <span class="keyword">implements</span> <span class="title">ThrowsAdvice</span></span>&#123;</span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(ArithmeticException ex)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">	       System.out.println(<span class="string">"异常通知Schema-based"</span>);</span><br><span class="line">	  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在spring的applicationContext.xml中进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mythrow"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.advise.MyThrow"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.gdaib.test.Demo.demo1())"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"mythrow"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"mythrow"</span> <span class="attr">throwing</span>=<span class="string">"ex"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.test.Demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="环绕通知-schema-base"><a href="#环绕通知-schema-base" class="headerlink" title="环绕通知(schema-base)"></a>环绕通知(schema-base)</h2><ol>
<li>把前置通知和后置通知都写到一个通知中，成为环绕通知。</li>
<li>实现步骤：<blockquote>
<ul>
<li>新建一个类实现<code>MethodInterceptor</code>接口，并重写invoke方法</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 环绕通知(schema-base)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyArround</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation arg0)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"环绕-前置"</span>);</span><br><span class="line">		Object result = arg0.proceed(); <span class="comment">//放行，调用切点方式</span></span><br><span class="line">		System.out.println(<span class="string">"环绕-后置"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在spring中配置applicationContext.xml文件</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myarround"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.advise.MyArround"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.gdaib.test.Demo.demo1())"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myarround"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.test.Demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ApsectJ方式实现"><a href="#ApsectJ方式实现" class="headerlink" title="ApsectJ方式实现"></a>ApsectJ方式实现</h2><ol>
<li><p>新建类，不用实现任何方法</p>
<blockquote>
<ul>
<li>类中的方法任意定义</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdvice</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(String name,<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">		System.out.println(name+<span class="string">" "</span>+age);	</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"后置通知1"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myaftering</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"后置通知2"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mythrow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"异常通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myaround</span><span class="params">(ProceedingJoinPoint p)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行环绕通知"</span>);</span><br><span class="line">		System.out.println(<span class="string">"环绕前置"</span>);</span><br><span class="line">		Object result = p.proceed();</span><br><span class="line">		System.out.println(<span class="string">"环绕后置"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Spring配置文件</p>
<blockquote>
<ul>
<li><code>&lt;aop:after&gt;</code>：后置通知，是否出现异常都执行</li>
<li><code>&lt;aop:after-returning/&gt;</code>：后置通知，只有当切点正确执行时执行。</li>
<li><code>&lt;aop:after&gt;</code>、<code>&lt;aop:after-returning&gt;</code>、<code>&lt;aop:after-throwing&gt;</code>执行顺序和配置顺序有关。</li>
<li>execution()括号不能加上参数</li>
<li>中间使用and不能使用&amp;&amp; 有spring把and解析成&amp;&amp;</li>
<li>args括号里的名称是自定义。顺序和demo1(参数，参数)对应</li>
<li><code>&lt;aop:before&gt;</code>;arg-names=“名称”，名称来源于expression=””中arg()，名称必须一样。</li>
<li>args()有几个参数，arg-names里面必须有几个。</li>
<li>arg-names里面名称必须和通知方法参数名对应。</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.test.Demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myadvice"</span> <span class="attr">class</span>=<span class="string">"com.gdaib.advise.MyAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myadvice"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.gdaib.test.Demo.demo1(String,int)) and args(name,age))"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span> <span class="attr">arg-names</span>=<span class="string">"name,age"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 下面两者的区别在于after不管方法出不出异常都会执行，而后者只能在方法执行正常时才执行 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;aop:after method="after" pointcut-ref="mypoint"/&gt;</span></span><br><span class="line"><span class="comment">        &lt;aop:after-returning method="myaftering" pointcut-ref="mypoint"/&gt;</span></span><br><span class="line"><span class="comment">        &lt;aop:after-throwing method="mythrow" pointcut-ref="mypoint"/&gt;</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        &lt;aop:around method="myaround" pointcut-ref="mypoint"/&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="使用注解-基于Aspect"><a href="#使用注解-基于Aspect" class="headerlink" title="使用注解(基于Aspect)"></a>使用注解(基于Aspect)</h2><ol>
<li>Spring不会自动去寻找注解，必须告诉Spring哪些包下的类可能有注解。<blockquote>
<ul>
<li>引入xmlns:context。</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.gdaib.advise,com.gdaib.test"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li><code>@Component</code>：<blockquote>
<ul>
<li>相当于<code>&lt;bean/&gt;</code></li>
<li>如果没有参数，把类名首字母变小写，相当于<code>&lt;bean id=&quot;&quot;/&gt;</code></li>
<li><code>@Component(“自定义名称”)</code></li>
</ul>
</blockquote>
</li>
</ul>
<ol start="3">
<li>实现步骤</li>
</ol>
<ul>
<li>在Spring配置文件中设置注解在哪些包中</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 如果有多个，使用逗号隔开 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.gdaib.advise,com.gdaib.test"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span>	</span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    true:使用CGLIB动态代理</span></span><br><span class="line"><span class="comment">    false：使用JDK动态代理</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在Demo类中添加@Component,在指定方法上添加切点即<code>@Pointcut</code>注解</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="comment">//添加切点</span></span><br><span class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* com.gdaib.test.Demo.demo1())"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">//int i=5/0;</span></span><br><span class="line">		System.out.println(<span class="string">"demo1"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在通知类类中配置<blockquote>
<ul>
<li>@Component：表明该类被Spring管理</li>
<li>@Aspect:表明该切面使用AspectJ</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdvice</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"com.gdaib.test.Demo.demo1()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mybefore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//添加后置通知</span></span><br><span class="line">	<span class="comment">/*@After("com.gdaib.test.Demo.demo1()")</span></span><br><span class="line"><span class="comment">	public void myafter() &#123;</span></span><br><span class="line"><span class="comment">		System.out.println("后置通知");</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">	<span class="meta">@AfterThrowing</span>(<span class="string">"com.gdaib.test.Demo.demo1()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mythrow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"通知异常"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//环绕通知</span></span><br><span class="line">	<span class="meta">@Around</span>(<span class="string">"com.gdaib.test.Demo.demo1()"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myarround</span><span class="params">(ProceedingJoinPoint p)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"环绕-前"</span>);</span><br><span class="line">		Object result=p.proceed();</span><br><span class="line">		System.out.println(<span class="string">"环绕-后"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代理设计模式"><a href="#代理设计模式" class="headerlink" title="代理设计模式"></a>代理设计模式</h3><ol>
<li>设计模式：前人总结的一套解决待定问题的代码;</li>
<li>代理设计模式优点：<blockquote>
<ul>
<li>保护真实对象。</li>
<li>让真实对象职责更明确。</li>
<li>扩展。</li>
</ul>
</blockquote>
</li>
<li>代理设计模式<blockquote>
<ul>
<li>真实对象</li>
<li>代理对象</li>
<li>抽象对象（抽象功能）</li>
</ul>
</blockquote>
<h3 id="静态代理设计模式"><a href="#静态代理设计模式" class="headerlink" title="静态代理设计模式"></a>静态代理设计模式</h3></li>
<li>由代理对象代理真实对象的功能。<blockquote>
<ul>
<li>自己编写代理类.</li>
<li>每个代理的功能需要单独编写。</li>
</ul>
</blockquote>
</li>
<li>静态代理设计模式的缺点：<blockquote>
<ul>
<li>当代理功能比较多时，代理类就得代理多个方法。</li>
<li>总结：静态代理模式代码的可重用性差。</li>
</ul>
</blockquote>
<h3 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h3></li>
<li>为了解决静态代理频繁编写代理功能的缺点。</li>
<li>分类：<blockquote>
<ul>
<li>JDK提供的</li>
<li>CGLIB</li>
</ul>
</blockquote>
<h3 id="JDK动态代理"><a href="#JDK动态代理" class="headerlink" title="JDK动态代理"></a>JDK动态代理</h3></li>
<li>和CGLIB动态代理的比较<blockquote>
<ul>
<li>JDK自带,不需要导入第三方jar包</li>
<li>缺点：真实对象必须实现接口;利用反射机制，效率不高;</li>
</ul>
</blockquote>
<h3 id="CGLIB动态代理"><a href="#CGLIB动态代理" class="headerlink" title="CGLIB动态代理"></a>CGLIB动态代理</h3></li>
<li>优点：基于字节码操作，生成真实对象的子类。<blockquote>
<ul>
<li>效率比JDK动态代理高</li>
<li>不需要实现接口</li>
</ul>
</blockquote>
</li>
<li>缺点，需要导入jar包. </li>
<li>使用SpringAOP时，只要出现Proxy和真实对象转换异常<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    true:使用CGLIB动态代理</span></span><br><span class="line"><span class="comment">    false：使用JDK动态代理</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="自动驻入"><a href="#自动驻入" class="headerlink" title="自动驻入"></a>自动驻入</h3><ul>
<li>在spring配置文件中对象名和<code>ref=&quot;id&quot;</code>id名相同时使用自动注入，可以不配置property</li>
<li>两种配置方法 <blockquote>
<ul>
<li>在<code>&lt;bean&gt;</code>中通过<code>autowire=&quot;&quot;</code>配置，只对<code>&lt;bean&gt;</code>生效。</li>
<li>在<code>&lt;beans&gt;</code>中通过<code>default-autowire=&quot;&quot;</code>配置，表当当前文件中所有<code>&lt;bean&gt;</code>都是全局配置内容。</li>
</ul>
</blockquote>
</li>
<li>autowire可取值<blockquote>
<ul>
<li>default:默认值，根据全局<code>default-autowire=&quot;&quot;</code>值。默认全局和局部都没有配置情况下。相当于no.</li>
<li>no：默认全局和局部都没有配置情况下。</li>
<li>byName：通过名称自动注入，在spring容器中找类id</li>
<li>byType：根据类型注入。<blockquote>
<ul>
<li>Spring容器中不可以出现两个相同类型的<code>&lt;bean/&gt;</code></li>
</ul>
</blockquote>
</li>
<li>construtor:根据构造方法注入<blockquote>
<ul>
<li>提供对应参数的构造方法(构造方法参数中包含注入对象那个)</li>
<li>底层使用byName，构造方法参数名和其他<code>&lt;bean&gt;</code>的id相同。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="spring中加载properties文件"><a href="#spring中加载properties文件" class="headerlink" title="spring中加载properties文件"></a>spring中加载properties文件</h3></li>
</ul>
<ol>
<li><p>在src下新建xxx.properties文件</p>
</li>
<li><p>在spring的配置文件中添加<code>xmlns:context</code>，在下面添加</p>
<blockquote>
<ul>
<li>如果需要加载多个配置文件，需要用逗号隔开</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加属性配置文件记载，并且在<code>&lt;beans&gt;</code>中开启自动注入注意的地方</p>
<blockquote>
<ul>
<li>sqlSessionFactoryBean中的id不能叫sqlSessionFactory</li>
<li>修改:把原来通过ref引用替换成value赋值，自动注入只能影响ref，不能影响value赋值</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置扫描器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.gdaib.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;property name="sqlSessionFactory" ref="factory"&gt;&lt;/property&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"factory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在被spring管理的类中通过<code>@value(&quot;${key}&quot;)</code>取出properties中的值</p>
<blockquote>
<ul>
<li>添加注解扫描</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 扫描注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在类中添加<blockquote>
<ul>
<li>key和变量名可以不相同</li>
<li>变量类型任意，只要保证key对应点的value能转换成这个类型就可以。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;key&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String test;</span><br></pre></td></tr></table></figure>

<h3 id="scope属性"><a href="#scope属性" class="headerlink" title="scope属性"></a>scope属性</h3><ol>
<li><code>&lt;bean&gt;</code>的属性</li>
<li>作用：控制对象有效范围（单例，多例等）</li>
<li><code>&lt;bean/&gt;</code> 标签对应的对象都是单例</li>
<li>scope可取值<blockquote>
<ul>
<li>singleton：默认值，单例</li>
<li>prototype:多例，每次获取重新实例化</li>
<li>request:每次请求重新实例化</li>
<li>session：每个会话对象内，对象是单例的。</li>
<li>application：每个application范围内，对象是单例的。</li>
<li>global session spring推出的一个对象，依赖于<code>spring-webmvc-portlet</code>，类似于session</li>
</ul>
</blockquote>
<h3 id="单例设计模式"><a href="#单例设计模式" class="headerlink" title="单例设计模式"></a>单例设计模式</h3></li>
<li>作用：在应用程序中保证最多只有一个实例</li>
<li>好处：<blockquote>
<ul>
<li>提升运行效率。</li>
<li>实现数据共享.实例：application对象</li>
</ul>
</blockquote>
</li>
<li>懒汉式<blockquote>
<ul>
<li>对象只有被调用，才会去创建对象</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdaib.singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SingleTon singleTon;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 方法名和类型相同</span></span><br><span class="line"><span class="comment">	 * 无返回值</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 其他类不能实例化这个类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 实例方法，实例方法必须通过对象调用</span></span><br><span class="line"><span class="comment">	 * 设置方法为静态方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(singleTon==<span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">//多线程访问下，可能出现线程安全</span></span><br><span class="line">			<span class="keyword">synchronized</span> (SingleTon.class) &#123;</span><br><span class="line">				<span class="keyword">if</span>(singleTon==<span class="keyword">null</span>) &#123;</span><br><span class="line">					singleTon=<span class="keyword">new</span> SingleTon();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> singleTon;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>由于添加了锁，所以导致执行效率较低。</li>
</ul>
<ol start="4">
<li>饿汉式：解决了懒汉式中多线程可能出现多个对象和执行效率低的情况</li>
</ol>
<ul>
<li>在类被加载时就被实例化</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gdaib.singleton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SingleTon singleTon=<span class="keyword">new</span> SingleTon();</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> singleTon;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h3><ol>
<li>编程式事务<blockquote>
<ul>
<li>由程序员编写事务控制代码。</li>
<li>OpenSessionInView编程式事务。</li>
</ul>
</blockquote>
</li>
<li>声明式事务：<blockquote>
<ul>
<li>事务控制代码已由spring写好，程序员只需要声明出哪些方法需要进行事务控制和如何进行事务回滚。</li>
</ul>
</blockquote>
</li>
<li>声明式事务都是针对于ServiceImpl类的方法下</li>
<li>事务管理器基于通知（advice）的。</li>
<li>在spring中配置声明式事务<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 获取数据源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC&amp;amp;characterEncoding=utf8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring-jdbc.jar --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置声明式事务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"txManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 哪些方法需要事务控制 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方法以ins开头事务管理 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"ins*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"del*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"upd*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切点范围设置大一点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.gdaib.service.impl.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mypoint"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="声明式事务属性解释"><a href="#声明式事务属性解释" class="headerlink" title="声明式事务属性解释"></a>声明式事务属性解释</h3><ol>
<li>name=””:哪些方法需要事务控制，支持通配符配置</li>
<li>readonly=”boolean”：是否是只读事务<blockquote>
<ul>
<li>如果为true，告诉数据库此事务为只读事务。数据库优化，会对性能有一定的提升，所以只要是查询的方法，建议使用此属性值.</li>
<li>如果为false(默认值)：事务需要提交的事务，建议新增，删除，修改</li>
</ul>
</blockquote>
</li>
<li>propagation：控制事务传播行为。<blockquote>
<ul>
<li>当一个具有事务控制的方法被另一个有事务控制的方法调用后，需要如何管理事务。（新建事务？在事务中执行？把事务挂起？报异常）</li>
<li>REQUIRED:如果当前有事务，就在事务中执行，如果当前没有事务，则新建一个事务。</li>
<li>SUPPORTS:如果当前有事务就在事务中执行，如果当前没有事务，就在非事务状态下执行。</li>
<li>MANDATORY：必须在事务内部执行，如果当前有事务，就在事务中执行，如果没有事务就报错。</li>
<li>REQUIRES_NEW:必须在事务中执行，如果当前没有事务，则新建事务，如果当前有事务，把当前事务挂起。</li>
<li>NOT_SUPPORTED:必须在非事务下执行，如果当前没有事务，正常执行，如果当前有事务，把当前事务挂起。</li>
<li>NEVER：必须在非事务状态下执行，如果当前没有事务，则正常执行，如果当前有事务，则报错。</li>
<li>NESTED：必须在事务状态下执行，如果没有事务，新建事务，如果当前有事务，创建一个嵌套事务。</li>
</ul>
</blockquote>
</li>
<li>isolation=””：事务隔离级别<blockquote>
<ul>
<li>在多线程和并发访问下如何保证访问到的数据具有完整性。</li>
<li>脏读：一个事务（A）读取到另一个事务(B)中未提交的数据，另一个事务中数据可能进行了改变，此时A事务读取的数据可能和数据库中的数据不一致的，此时认为数据是脏数据，读取脏数据过程叫做脏读。</li>
<li>不可重复读<blockquote>
<ul>
<li>主要针对的是某行数据（行中某列）</li>
<li>主要针对的操作是修改。</li>
<li>两个读取在通一个事务内。</li>
<li>当事务A第一次读取事务后，事务B对事务A读取的数据进行修改，事务A中再次读取的数据和之前读取的数据不一致，这个过程就叫做不可重复读。</li>
</ul>
</blockquote>
</li>
<li>幻读：<blockquote>
<ul>
<li>主要针对的操作是新增和删除</li>
<li>两次事务的结果</li>
<li>事务A按照特定条件查询出结果，事务B新增了一条符合条件的数据，事务A查询的数据和数据库中的数据不一致的，事务A好像出现了幻觉，这种情况称为幻读。</li>
</ul>
</blockquote>
</li>
<li>isolation的可能取值及作用：<blockquote>
<ul>
<li>DEFAULT：默认值，由底层数据库自动判断应该使用什么隔离级别。</li>
<li>READ_UNCOMMITTED：可以读取未提交事务，可能出现脏读、不可重复读、幻读，但是效率最高。</li>
<li>READ_COMMITTED:只能读取其他事务已经提交的数据，可以防止脏读，可能出现不可重复读和幻读。</li>
<li>REPEATABLE_READ：读取的数据被添加锁，防止其他事务修改此数据，可以防止不可重复读、脏读，可能出现幻读。</li>
<li>REPEATABLE_READ：排队操作，对整个表添加锁，一个事务在操作数据时，另一事物等待事务操作完成后才能操作这个表。这个操作，是最安全也是效率最低的。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="事务回滚"><a href="#事务回滚" class="headerlink" title="事务回滚"></a>事务回滚</h3></li>
<li>rollback-for=”类异常的全限定路径”<blockquote>
<ul>
<li>当出现什么异常时需要进行事务回滚。 </li>
<li>建议：给定该属性值。手动抛异常时一定要给定该属性值，即<code>throw new Exception()</code></li>
</ul>
</blockquote>
</li>
<li>no-rollback-for=””<blockquote>
<ul>
<li>当出现什么异常时不回滚事务。</li>
</ul>
</blockquote>
<h3 id="Spring常用注解"><a href="#Spring常用注解" class="headerlink" title="Spring常用注解"></a>Spring常用注解</h3></li>
<li><code>@Component</code>：创建类对象，相当于配置<code>&lt;bean/&gt;</code></li>
<li><code>@Service</code>与<code>@Component</code>功能相同，<code>@Service</code>写在<code>ServiceImpl</code>上。</li>
<li><code>@Repository</code>与<code>@Component</code>功能相同,该注解通常写在数据访问层上。</li>
<li><code>@Controller</code>与<code>@Component</code>功能相同，该注解通常写在控制器上。</li>
<li><code>@Resource</code>：Java中的注解；默认按照byName,建议把对象名称和属性名称写一样，如果没有名称对象，按照byType注入；不需要编写get和set方法。</li>
<li><code>@Autowired</code>：Spring框架中的注解；默认按照byType注入。</li>
<li><code>@Value</code>获取properties文件中的内容</li>
<li><code>@Pointcut</code>：定义切点。</li>
<li><code>@Aspect()</code>：定义切面类</li>
<li><code>@Before()</code>：定义前置通知</li>
<li><code>@After()</code>：定义后置通知</li>
<li><code>@AfterReturning()</code>：定义后置通知，必须切点正确执行</li>
<li><code>@Arround()</code>：环绕通知。<h3 id="ajax复习"><a href="#ajax复习" class="headerlink" title="ajax复习"></a><code>ajax</code>复习</h3></li>
<li>$.ajax</li>
<li>$.get、$.post</li>
<li>$.getJson</li>
<li>$.getScript</li>
<li>ObjectMapper mapper=new ObjectMapper(); mapper.writeValueAsString(对象);把对象转化为JSON格式字符串。</li>
</ol>
<h4 id="Spring源码下载地址-https-github-com-spring-projects-spring-framework-tags-after-v4-2-5-RELEASE"><a href="#Spring源码下载地址-https-github-com-spring-projects-spring-framework-tags-after-v4-2-5-RELEASE" class="headerlink" title="Spring源码下载地址:https://github.com/spring-projects/spring-framework/tags?after=v4.2.5.RELEASE"></a>Spring源码下载地址:<code>https://github.com/spring-projects/spring-framework/tags?after=v4.2.5.RELEASE</code></h4><h4 id="Spring框架下载地址：https-repo-spring-io-release-org-springframework-spring"><a href="#Spring框架下载地址：https-repo-spring-io-release-org-springframework-spring" class="headerlink" title="Spring框架下载地址：https://repo.spring.io/release/org/springframework/spring/"></a>Spring框架下载地址：<code>https://repo.spring.io/release/org/springframework/spring/</code></h4><h4 id="Spring与Mybatis整合的jar包：https-blog-csdn-net-qiangqiang816-article-details-81541188"><a href="#Spring与Mybatis整合的jar包：https-blog-csdn-net-qiangqiang816-article-details-81541188" class="headerlink" title="Spring与Mybatis整合的jar包：https://blog.csdn.net/qiangqiang816/article/details/81541188"></a>Spring与Mybatis整合的jar包：<code>https://blog.csdn.net/qiangqiang816/article/details/81541188</code></h4><h4 id="Maven地址：https-mvnrepository-com"><a href="#Maven地址：https-mvnrepository-com" class="headerlink" title="Maven地址：https://mvnrepository.com/"></a>Maven地址：<code>https://mvnrepository.com/</code></h4>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-SSM" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/10/18/SSM/" class="article-date">
  	<time datetime="2019-10-18T08:03:37.000Z" itemprop="datePublished">2019-10-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/10/18/SSM/">
        SSM
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第2章-Java设计模式"><a href="#第2章-Java设计模式" class="headerlink" title="第2章 Java设计模式"></a>第2章 Java设计模式</h2><h3 id="Java反射技术"><a href="#Java反射技术" class="headerlink" title="Java反射技术"></a>Java反射技术</h3><ul>
<li><code>Java</code>反射技术应用很广泛，它能够配置：类的完全限定名、方法和参数，完成对象的初始化，甚至反射某些方法。这样就可以大大增加Java的可配置性，<code>SpringIoC</code>的基本原理也是如此，当然<code>SpringIoc</code>的代码要复杂很多。</li>
<li>Java的反射内容繁多，包括对象构建、反射方法，、注解、参数、接口等。<blockquote>
<ul>
<li>对象的构建：包括有参的构建方法和无参数的构建方法。</li>
<li>在Java中，放射是通过包<code>jacva.lang.reflect.*</code>来实现的。</li>
</ul>
</blockquote>
</li>
<li>通过反射构建对象<blockquote>
<ul>
<li>反射的优点是：只要配置就可以生成对象，可以解除耦合度，比较灵活。</li>
<li>反射的缺点是：运行速度比较慢。</li>
<li>案例实现：带无参数构造方法的实现：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> *  反射</span></span><br><span class="line"><span class="comment"> *  带有无参的构造方法 + 反射方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectServiceImpl</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		System.err.println(<span class="string">"hello:"</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 通过反射获取当前对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReflectServiceImpl <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ReflectServiceImpl object=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * 给类加载器注册一个类 ReflectServiceImpl的全限定名，然后通过调用newInstance()方法初始化一个对象</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			object=(ReflectServiceImpl) Class.forName(<span class="string">"com.zhuchuli.demo.ReflectServiceImpl"</span>).getConstructor().newInstance();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> object;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ReflectServiceImpl.getInstance().sayHello(<span class="string">"张三"</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>案例实现：带有有参数构造方法的实现</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.demo;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> *  反射</span></span><br><span class="line"><span class="comment"> *  带有有参的构造方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectServiceImpl2</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ReflectServiceImpl2</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.err.println(<span class="string">"hello:"</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 通过反射获取当前对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReflectServiceImpl2 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ReflectServiceImpl2 object=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * 给类加载器注册一个类 ReflectServiceImpl的全限定名，然后通过调用newInstance()方法初始化一个对象</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			object=(ReflectServiceImpl2) Class.forName(<span class="string">"com.zhuchuli.demo.ReflectServiceImpl2"</span>).getConstructor(String.class).newInstance(<span class="string">"李四"</span>);</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> object;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ReflectServiceImpl2.getInstance().sayHello();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>反射方法<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> *  反射</span></span><br><span class="line"><span class="comment"> *  带有无参的构造方法 + 反射方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectServiceImpl</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		System.err.println(<span class="string">"hello:"</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 通过反射获取当前对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReflectServiceImpl <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ReflectServiceImpl object=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * 给类加载器注册一个类 ReflectServiceImpl的全限定名，然后通过调用newInstance()方法初始化一个对象</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			object=(ReflectServiceImpl) Class.forName(<span class="string">"com.zhuchuli.demo.ReflectServiceImpl"</span>).getConstructor().newInstance();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> object;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">reflectMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Object returnObj=<span class="keyword">null</span>;</span><br><span class="line">		ReflectServiceImpl target=<span class="keyword">new</span> ReflectServiceImpl();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Method method=ReflectServiceImpl.class.getMethod(<span class="string">"sayHello"</span>, String.class);</span><br><span class="line">			method.invoke(target, <span class="string">"王五"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> returnObj;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ReflectServiceImpl.getInstance().reflectMethod();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="动态代理模式和责任链模式"><a href="#动态代理模式和责任链模式" class="headerlink" title="动态代理模式和责任链模式"></a>动态代理模式和责任链模式</h3><ul>
<li><p>动态代理的意义在于生成一个占位（又称代理对象），来代理真实对象，从而控制真实对象的访问。</p>
</li>
<li><p>代理的作用：就是在访问真实对象之前或者之后加入一些对象的逻辑，或者根据其他规则控制是否使用真实对象。</p>
</li>
<li><p>代理必须分为两个步骤：</p>
<blockquote>
<ul>
<li>代理对象和真实对象建立代理关系。</li>
<li>实现代理对象的代理逻辑方法。 </li>
</ul>
</blockquote>
</li>
<li><p>JDK的动态代理</p>
<blockquote>
<ul>
<li>JDK的动态代理是<code>java.lang.reflect.*</code>包提供的方式，它必须借助于一个接口才能产生代理对象，所以先定义接口。</li>
</ul>
</blockquote>
</li>
<li><p>CGLIB动态代理</p>
<blockquote>
<ul>
<li>它的优势在于不需要提供接口，只要一个非抽象类即能实现动态代理。</li>
</ul>
</blockquote>
</li>
<li><p>拦截器：</p>
<blockquote>
<ul>
<li>由于动态代理一般比较难理解，程序设计者会设计一个拦截器接口供开发者使用。开发者只需要知道拦截器接口的方法、含义和作用即可，不需要知道动态代理是怎么实现的。用JDK动态代理来实现一个拦截器逻辑，为此先定义拦截器接口Interceptor。</li>
</ul>
</blockquote>
</li>
<li><p>责任链模式：</p>
<blockquote>
<ul>
<li>上一点提到了设计者往往会使用拦截器去代替动态代理，然后将拦截器的接口提供给开发者，从而简化了开发者的开发难度，但是拦截器有很多个。</li>
<li>当一个对象在一条链上被多个拦截器处理时，我们把这样的设计模式成为责任链模式，它用于一个对象在多个角色中传递的场景。</li>
<li>责任链的优点在于我们可以在传递链上加入新的拦截器，增加拦截逻辑，其缺点是会增加代理和反射，而代理和反射的性能不高。</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="观察者（Observer）模式"><a href="#观察者（Observer）模式" class="headerlink" title="观察者（Observer）模式"></a>观察者（Observer）模式</h3><ul>
<li>观察者模式又称为发布订阅模式，是对象的行为模式。观察者定义了一种一对多的依赖关系，让多个对象观察者同时监听被观察者的状态，当被观察者的状态发生该改变时，会通知所有的被观察者，并让其自动更新。</li>
<li>概述：</li>
<li>实例：<blockquote>
<ul>
<li>观察者要同时存在观察者和被观察者双方，观察者可以有多个。在Java中，需要去继承<code>java.util.Observable</code>类，从而定义被观察者</li>
<li>有了被观察者对象之后，还需要去编写观察者对象。想要编写观察者对象，还需要去实现<code>java.util.Observer</code>接口的<code>update</code>方法</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="工厂模式和抽象工厂模式"><a href="#工厂模式和抽象工厂模式" class="headerlink" title="工厂模式和抽象工厂模式"></a>工厂模式和抽象工厂模式</h3><h3 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="mybatis-文档study" class="article article-type-mybatis" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/10/14/文档study/" class="article-date">
  	<time datetime="2019-10-14T13:00:14.000Z" itemprop="datePublished">2019-10-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/10/14/文档study/">
        文档study
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Mybatis3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/10/08/Mybatis3/" class="article-date">
  	<time datetime="2019-10-08T11:25:53.000Z" itemprop="datePublished">2019-10-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/10/08/Mybatis3/">
        Mybatis3
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="数据库命令"><a href="#数据库命令" class="headerlink" title="数据库命令"></a>数据库命令</h2><ol>
<li><p>创建数据库并制定编码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">database</span> 数据库名 <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">    列明 类型  约束 auto_increment <span class="keyword">comment</span> <span class="string">'备注'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h2><ol>
<li>项目名：没有要求，不起中文</li>
<li>包：公司域名倒写</li>
<li>持久层：dao,persist,<code>mapper</code></li>
<li>实体层：entity，model，bean，javabean，<code>pojo</code></li>
<li>业务逻辑：service，biz</li>
<li>控制器层：controll,action,<code>servlet</code>,web</li>
<li>过滤器：filter</li>
<li>异常：exception</li>
<li>监听器：listener</li>
<li>注释</li>
<li>类：大驼峰</li>
<li>属性和方法：小驼峰</li>
</ol>
<hr>
<h2 id="MVC开发模式"><a href="#MVC开发模式" class="headerlink" title="MVC开发模式"></a>MVC开发模式</h2><ol>
<li>M:Model 模型，实体类、业务和dao</li>
<li>V:View 视图，JSP</li>
<li>C:Controller 控制器，servlet</li>
<li>MVC应用场景：适合大型项目开发</li>
</ol>
<hr>
<h2 id="jsp-Servlet完成查询和新增"><a href="#jsp-Servlet完成查询和新增" class="headerlink" title="jsp+Servlet完成查询和新增"></a>jsp+Servlet完成查询和新增</h2><h2 id="框架是什么？"><a href="#框架是什么？" class="headerlink" title="框架是什么？"></a>框架是什么？</h2><ol>
<li>框架：软件的半成品。为解决问题制定的一套约束，在提供功能的基础上进行扩充。</li>
<li>框架中一些不能被封装的代码（变量），需要使用框架这新建一个xml文件，在文件中添加变量的内容。<blockquote>
<ul>
<li>需要建立特定位置和特定名称的配置文件.</li>
<li>需要使用xml解析技术和反射技术。</li>
</ul>
</blockquote>
</li>
<li>常用概念：<blockquote>
<ul>
<li>类库:提供的类没有封装一定逻辑。<blockquote>
<ul>
<li>举例：类库就是名言警句，写作文时引入名言警句。</li>
</ul>
</blockquote>
</li>
<li>框架：区别于类库，里面有一定的约束。<blockquote>
<ul>
<li>框架是填空题。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="Mybatis简介"><a href="#Mybatis简介" class="headerlink" title="Mybatis简介"></a>Mybatis简介</h2><blockquote>
<ul>
<li>Mybatis是一个开源免费框架。原名叫iBatis，2010在<code>google code</code>，2013年迁移到<code>github</code></li>
<li>作用：数据访问层框架。<blockquote>
<ul>
<li>底层是对JDBC的封装</li>
</ul>
</blockquote>
</li>
<li><code>mybatis</code>优点之一<blockquote>
<ul>
<li>使用<code>Mybatis</code>不需要编写实现类,只需要编写需要执行的sql命令。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="Mybatis-环境搭建"><a href="#Mybatis-环境搭建" class="headerlink" title="Mybatis 环境搭建"></a>Mybatis 环境搭建</h2></li>
<li>导入jar包</li>
</ol>
<p><img src="https://i.loli.net/2019/10/09/ultwxJpfCjALhr6.png" alt="1570603776_1_.png"></p>
<blockquote>
<ul>
<li>asm.jar：Cglib依赖的包</li>
<li>cglib.jar：动态代理的包</li>
<li>commons-logging.jar、log4j.jar、slf4j.*.jar：日志包</li>
<li>javaassist.jar：字节码解析包</li>
<li>mybatis.jar：mybatis的核心包</li>
</ul>
<ol start="2">
<li>在src下编写全局配置文件（JDBC四个变量）（mybatis.xml）</li>
</ol>
<ul>
<li>没有名称配置和地址要求。</li>
<li>在全局配置文件中引入dtd或schema</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- default引用 environment的id，当前使用的环境--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"default"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 声明可能使用的环境 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"default"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 使用原生JDBC事务 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC&amp;amp;characterEncoding=utf8"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/zhuchuli/mapper/FlowerMapper.xml"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>新建以<code>mapper</code>结尾的包，在包下新建：实体类名+Mapper.xml（FlowerMapper.xml）</p>
<blockquote>
<ul>
<li>文件作用：编写需要执行的sql语句。</li>
<li>把xml文件理解成实现类。</li>
<li>xml文件内容</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace：理解成实现类的完全限定名（报名+类名） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"a.b"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- id:方法名 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- parameterType:定义参数类型 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- resultType:定义结果返回值类型 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 如果方法返回是list，在resultType中写List的泛型，因为Mybatis对jdbc封装，一行一行读取数据 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll"</span> <span class="attr">resultType</span>=<span class="string">"com.zhuchuli.pojo.Flower"</span>&gt;</span></span><br><span class="line">		select * from flower</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试结果（只有单独使用Mybatis时使用，最后SSM整合时下面代码不需要编写）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		InputStream is=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			is = Resources.getResourceAsStream(<span class="string">"mybatis.xml"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//使用工厂设计模式</span></span><br><span class="line">		SqlSessionFactory factory=<span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line">		<span class="comment">//生产SqlSession </span></span><br><span class="line">		SqlSession session=factory.openSession();</span><br><span class="line">		List&lt;Flower&gt; list=session.selectList(<span class="string">"a.b.selAll"</span>);</span><br><span class="line">		<span class="keyword">for</span> (Flower flower : list) &#123;</span><br><span class="line">			System.out.println(flower.toString());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//释放资源</span></span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>注意：当表列名与Java的属性名称不一致时，在进行数据库查询时可以指定通过起别名来实现。</li>
</ul>
</blockquote>
<h2 id="环境搭建讲解"><a href="#环境搭建讲解" class="headerlink" title="环境搭建讲解"></a>环境搭建讲解</h2><ol>
<li>全局配置文件讲解<blockquote>
<ul>
<li><code>&lt;transactionManager&gt;</code>： <code>type</code>属性可取值<blockquote>
<ul>
<li><code>JDBC</code>：事务管理使用<code>JDBC</code>原生事务管理方式。</li>
<li><code>MANAGED</code>：把事务管理转交给其他容器。原生<code>JDBC</code>事务<code>setAutoMapping(false)</code></li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li><code>&lt;dataSource&gt;</code> : <code>type</code>属性可取值<blockquote>
<ul>
<li><code>UNPOOLED</code>：不使用数据库连接池，和直接使用JDBC一样。</li>
<li><code>POOLED</code>：使用数据库连接池</li>
<li><code>JNDI</code>（Java语言调用其他语言）：Java命令目录接口技术。</li>
</ul>
</blockquote>
<h2 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h2></li>
<li>在内存中开辟一块空间，存放多个数据库连接对象</li>
<li>JDBC Tomcat Pool:直接由tomcat产生数据库连接池</li>
<li>图示:</li>
</ol>
<p><img src="https://i.loli.net/2019/10/09/edzYJMxDN5CbiXZ.png" alt="1570617915_1_.png"></p>
<ol start="4">
<li>使用数据库连接池的目的：<blockquote>
<ul>
<li>在高频率访问数据库时，使用数据库连接池可以降低服务器系统压力，提升程序运行效率。</li>
<li>小项目不适用数据库连接池</li>
</ul>
</blockquote>
</li>
<li>实现JDBC Tomcat Pool的步骤：<blockquote>
<ul>
<li>在META-INF包下添加Context.xml文件</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Resource</span></span></span><br><span class="line"><span class="tag">        <span class="attr">driverClassName</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">url</span>=<span class="string">"jdbc:mysql://localhost:3306/ssm"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">username</span>=<span class="string">"root"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">password</span>=<span class="string">"123456"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">maxActive</span>=<span class="string">"50"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">maxIdle</span>=<span class="string">"20"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"test"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">auth</span>=<span class="string">"Container"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">maxWait</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"javax.sql.DataSource"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>把项目发布到tomcat中，数据库连接池就产生了.</li>
<li>可以使用Java的JNDI获取数据库连接池对象:<blockquote>
<ul>
<li>Context：上下文接口，Context.xml文件对象类型</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Context ctx=<span class="keyword">new</span> InitialContext();</span><br><span class="line">DataSource ds=ctx.lookup(<span class="string">"java:comp/env/test"</span>);</span><br><span class="line">Connection conn=ds.getConnection();</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>当关闭数据库连接池对象时，把连接对象归还给数据库连接池，把状态改为idle状态。</li>
</ul>
</blockquote>
<h2 id="三种查询方式"><a href="#三种查询方式" class="headerlink" title="三种查询方式"></a>三种查询方式</h2><ol>
<li><p>selectList()：返回值List&lt;resultType属性控制&gt; ,适合于查询结果都需要遍历的需求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Flower&gt; list=session.selectList(<span class="string">"a.b.selAll"</span>);</span><br><span class="line"><span class="keyword">for</span> (Flower flower : list) &#123;</span><br><span class="line">    System.out.println(flower.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>selectOne()：返回Object，适用于返回结果只是变量或一行数据时</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count=session.selectOne(<span class="string">"a.b.selById"</span>);</span><br><span class="line">System.out.println(count);</span><br></pre></td></tr></table></figure>
</li>
<li><p>selectMap()返回值Map，适用于需求需要在查询结果中通过某列的值取到这行数据的值的需求。</p>
<blockquote>
<ul>
<li>Map&lt;Object,Object&gt;：第一个Object的数据类型受到selectMap()第二参数影响，第二个Object的数据类型受到&lt;restultType属性值&gt;的控制。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Object,Object&gt; map=session.selectMap(<span class="string">"a.b.c"</span>, <span class="string">"name"</span>);</span><br><span class="line">System.out.println(map);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Log4j复习"><a href="#Log4j复习" class="headerlink" title="Log4j复习"></a>Log4j复习</h2><ol>
<li>由<code>apache</code>提出的开源免费日志处理的类库。</li>
<li>为什么需要日志：<blockquote>
<ul>
<li>在项目中编写 <code>system.out.println();</code>输出到控制台，当项目发布到tomcat后，没有控制台（在命令行能看见），不容易观察一些输出结果。</li>
<li>log4j的作用：不仅能把内容输出到控制台，还能把内容输出到文件中。便于观察结果。</li>
</ul>
</blockquote>
</li>
<li>使用步骤：<blockquote>
<ul>
<li>导入jar包</li>
<li>在src下新建log4j.properties(路径和名称都不允许改变)</li>
<li>ConversionPattern：写表达式</li>
<li>log4j.appender.LOGFILE.File：写文件输出路径以及名称（日志文件的扩展名为<code>.log</code>）</li>
</ul>
</blockquote>
</li>
<li>Log4j输出级别：<blockquote>
<ul>
<li>Fatal(指明错误) &gt; error(错误) &gt; warm(警告) &gt; info(普通信息) &gt; debug(调试信息)</li>
<li>在<code>log4j.properties</code>第一行控制输出级别。</li>
<li>log4j.rootCategory=INFO</li>
</ul>
</blockquote>
</li>
<li>Log4j输出目的地<blockquote>
<ul>
<li>log4j.rootCategory=<code>CONSOLE</code>,<code>LOGFILE</code></li>
</ul>
</blockquote>
</li>
<li>pattern常用表达式<blockquote>
<ul>
<li>%C 输出类名</li>
<li>%d 输出时间</li>
<li>%L 输出行号</li>
<li>%m 输出日志信息</li>
<li>%n 换行</li>
</ul>
</blockquote>
<h2 id="lt-settings-gt-标签"><a href="#lt-settings-gt-标签" class="headerlink" title="&lt;settings&gt;标签"></a><code>&lt;settings&gt;</code>标签</h2><blockquote>
<ul>
<li>在<code>mybatis</code>全局配置文件中<code>&lt;settings&gt;</code>标签控制<code>mybatis</code>全局开关。</li>
<li>在<code>mybatis.xml</code>中开启log4j<blockquote>
<ul>
<li>必须保证有<code>jar</code>包</li>
<li>在src目录下要有<code>log4j.properties</code>文件</li>
<li>在mybatis.xml配置文件中添加如下代码</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Mybatis开启日志功能 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"LOG4J"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>log4j中可以指定内容的日志（控制某个局部内容的日志级别）<blockquote>
<ul>
<li>命名级别（包级别）：<mapper>namespace属性中除了最后一个类名<blockquote>
<ul>
<li>先在总体级别调成error不输出无用信息。</li>
<li>在该配置文件中为特定包名设置输出级别为debug。</li>
<li>例如： <code>namespace</code>=<code>&quot;com.zhuchuli.mapper.PeopleMapper&quot;</code>其中包级别为<code>com.zhuchuli.mapper</code>，需要在<code>log4j.properties</code>配置文件中配置如下代码：<code>log4j.rootCategory=ERROR, CONSOLE , LOGFILE</code>;<code>log4j.logger.com.zhuchuli.mapper=DEBUG</code></li>
<li>目的：输出主要的日志信息。</li>
</ul>
</blockquote>
</mapper></li>
<li>类级别：与上面包级别差不多，此处不再赘述。</li>
<li>方法级别：与上面包级别差不多，此处不再赘述。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="parameterType-属性"><a href="#parameterType-属性" class="headerlink" title="parameterType 属性"></a>parameterType 属性</h2><ol>
<li><p>在XxxMapper.xml中<select></select>等标签的<code>parameterType</code>可以控制参数类型。</p>
</li>
<li><p>SqlSession的selectList()和selectOne()的第二个参数和selectMap()的第三个参数都表示方法的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">People people=session.selectOne(<span class="string">"a.b.selById"</span>,<span class="number">2</span>);</span><br><span class="line">System.out.println(people);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>mapper.xml</code>文件中通过<code>#{}</code>获取参数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selById"</span> <span class="attr">resultType</span>=<span class="string">"com.zhuchuli.pojo.People"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">	select * from people where id=#&#123;0&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>parameterType指定参数类型</li>
<li>#{}获取参数值，使用索引，从0开始，#{0}表示第一个参数。</li>
<li>如果只有一个参数(基本数据类型或String)，mybatis对#{}里面的内容没有要求，只要写内容即可。</li>
<li>如果参数是对象 #{属性名}</li>
<li>如果参数时msap #{key}</li>
<li>如果想要传递多个参数，可以使用map结构或对象</li>
</ul>
<ol start="4">
<li>#{}与${}的区别：</li>
</ol>
<ul>
<li>#{}获取参数的内容支持 索引获取，param1获取指定位置参数，并且SQL使用?占位符。</li>
<li>${}字符串拼接不使用?，默认找${内容}的get/set方法，如果写数字，就是一个数字。</li>
<li>如果在xml文件中出现”&lt;”,”&gt;”，双引号等特殊字符时，可以使用xml文件转义标签（XML自身）：<code>&lt;![CDATA[内容]]&gt;</code></li>
</ul>
</blockquote>
<h2 id="mybatis-实现mysql分页查询"><a href="#mybatis-实现mysql分页查询" class="headerlink" title="mybatis 实现mysql分页查询"></a>mybatis 实现mysql分页查询</h2><blockquote>
<ul>
<li>？不允许在关键字前后进行数学运算，需要在代码中计算完成后传递到mapper.xml中</li>
<li>在java代码中运算</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> pageSize=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">int</span> pageNumber=<span class="number">3</span>;</span><br><span class="line"><span class="comment">//如果希望传递多个参数，可以使用map或者对象</span></span><br><span class="line">Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">map.put(<span class="string">"pageSize"</span>,pageSize);</span><br><span class="line">map.put(<span class="string">"pageNumber"</span>,(pageSize-<span class="number">1</span>)*pageNumber);</span><br><span class="line">List&lt;People&gt; people=session.selectList(<span class="string">"a.b.page"</span>,map);</span><br><span class="line">System.out.println(people);</span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在mapper.xml文件中代码</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"page"</span> <span class="attr">resultType</span>=<span class="string">"com.zhuchuli.pojo.People"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">	select * from people limit #&#123;pageSize&#125;,#&#123;pageNumber&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h2><blockquote>
<ul>
<li>系统内置别名：把类型全小写</li>
<li>给某个类起别名： alias=”自定义”<blockquote>
<ul>
<li>mybatis.xml配置文件</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tyeAliases</span> <span class="attr">type</span>=<span class="string">"com.zhuchuli.pojo.People"</span> <span class="attr">alias</span>=<span class="string">"peo"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>mapper.xml</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"page"</span> <span class="attr">resultType</span>=<span class="string">"peo"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">	select * from people limit #&#123;pageStart&#125;,#&#123;pageSize&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>直接给某个包下所有类起别名， 别名为类名，区分大小写。<blockquote>
<ul>
<li>mybatis.xml配置</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.zhuchu.pojo"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>mapper.xml通过类名引用。</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"page"</span> <span class="attr">resultType</span>=<span class="string">"People"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">	select * from people limit #&#123;pageStart&#125;,#&#123;pageSize&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="MyBatis实现新增"><a href="#MyBatis实现新增" class="headerlink" title="MyBatis实现新增"></a>MyBatis实现新增</h3><ol>
<li>概念复习<blockquote>
<ul>
<li>功能：从应用程序角度出发，软件具有哪些功能。</li>
<li>事务: 从数据库角度出发，完成业务时需要执行的SQL集合，统称一个事务。</li>
<li>业务: 完成功能时的逻辑。对应Service中一个方法</li>
<li>事务回滚：如果在一个事务中某个sql执行事务，希望回归到事务的原点，保证数据库数据的完整性。</li>
</ul>
</blockquote>
</li>
<li>在Mybatis中默认关闭了JDBC自动提交的功能。<blockquote>
<ul>
<li>每一个SqlSession默认都是不自动提交事务。</li>
<li>session.commit()提交事务。 </li>
<li>openSession(true)：自动提交，setAutoCommit(true);</li>
</ul>
</blockquote>
</li>
<li>mybatis底层是JDBC的封装<blockquote>
<ul>
<li>JDBC中<code>executeUpdate()</code>执行新增，删除，修改的SQL，返回值int，表示受影响的行数</li>
<li>mybatis中的<insert><delete><update>标签没有resultType属性，认为返回值int</update></delete></insert></li>
</ul>
</blockquote>
</li>
<li>在openSession()时Mybatis会创建SqlSession时同时创建一个Transaction(事务对象)，同时autoCommit为false<blockquote>
<ul>
<li>如果出现异常，应该session.roolback()进行事务回滚。</li>
</ul>
</blockquote>
</li>
<li>使用<insert><delete><update>进行数据库操作时，要添加事务提交处理.<h2 id="Mybatis接口绑定方案及多参数传递"><a href="#Mybatis接口绑定方案及多参数传递" class="headerlink" title="Mybatis接口绑定方案及多参数传递"></a>Mybatis接口绑定方案及多参数传递</h2></update></delete></insert></li>
<li>作用：实现创建一个接口后把mapper.xml由mybatis生成接口的实现类，通常调用接口对象就可以获取mapper.xml中编写的sql。</li>
<li>后面mybatis和spring整合时使用的是这个方案。</li>
<li>实现步骤：<blockquote>
<ul>
<li>创建一个接口<blockquote>
<ul>
<li>接口包名和接口名与mapper.xml中的<mapper>namespace相同。</mapper></li>
<li>接口中的方法名和mapper的id属性值相同。</li>
</ul>
</blockquote>
</li>
<li>在mybatis.xml中使用<package>标签来进行扫描接口和mapper.xml</package></li>
</ul>
</blockquote>
</li>
<li>代码实现步骤<blockquote>
<ul>
<li>在mybatis.xml的<mappers>中使用<package></package></mappers></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.zhuchuli.mapper"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在com.zhuchuli.mapper新建一个接口</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LogMapper</span> </span>&#123;</span><br><span class="line">	<span class="function">List&lt;Log&gt; <span class="title">selAll</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * mybatis把参数转换为map,<span class="doctag">@Param</span>("")当成key,后面的参数值当成value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> accin</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> account</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//List&lt;Log&gt; setByAccInAccount(@Param("accin") String accin,@Param("account") String account);</span></span><br><span class="line">	<span class="function">List&lt;Log&gt; <span class="title">setByAccInAccount</span><span class="params">(String accin,String account)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在com.zhuchuli.mapper新建一个LogMapper.xml文件 </li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zhuchuli.mapper.LogMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll"</span> <span class="attr">resultType</span>=<span class="string">"log"</span>&gt;</span></span><br><span class="line">		select * from log</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 当多参数时，不需要写parameter --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"setByAccInAccount"</span> <span class="attr">resultType</span>=<span class="string">"log"</span>&gt;</span></span><br><span class="line">		select * from log where accin=#&#123;arg0&#125; and accout=#&#123;arg1&#125;</span><br><span class="line">		<span class="comment">&lt;!-- select * from log where accin=#&#123;param1&#125; and accout=#&#123;param2&#125; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>测试</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LogMapper logMapper = session.getMapper(LogMapper.class);</span><br><span class="line">List&lt;Log&gt; list=logMapper.selAll();</span><br><span class="line"><span class="keyword">for</span> (Log log : list) &#123;</span><br><span class="line">	System.out.println(log);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>注意：namespace必须和接口的完全限定路径一致，id值必须与接口中的方法名一致。</li>
<li>如果接口中的方法为多个参数，可以省略parameter</li>
</ul>
<ol start="5">
<li>多参数实现方法</li>
</ol>
<ul>
<li>在接口中声明方法</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Log&gt; <span class="title">setByAccInAccount</span><span class="params">(String accin,String account)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在mapper.xml文件中添加，#{}可以使用[param0,param1,arg0,arg1]</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"setByAccInAccount"</span> <span class="attr">resultType</span>=<span class="string">"log"</span>&gt;</span></span><br><span class="line">	select * from log where accin=#&#123;arg0&#125; and accout=#&#123;arg1&#125;</span><br><span class="line">	<span class="comment">&lt;!-- select * from log where accin=#&#123;param1&#125; and accout=#&#123;param2&#125; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>可以使用注解<blockquote>
<ul>
<li>在接口中声明方法 </li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">	* mybatis把参数转换为map,<span class="doctag">@Param</span>("")当成key,后面的参数值当成value</span></span><br><span class="line"><span class="comment">	* <span class="doctag">@param</span> accin</span></span><br><span class="line"><span class="comment">	* <span class="doctag">@param</span> account</span></span><br><span class="line"><span class="comment">	* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="function">List&lt;Log&gt; <span class="title">setByAccInAccount</span><span class="params">(@Param(<span class="string">"accin"</span>)</span> String accin,@<span class="title">Param</span><span class="params">(<span class="string">"account"</span>)</span> String account)</span>;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在mapper.xml文件中添加。#{}里面的内容为@param(“内容”)参数中的内容</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from log where accin=#&#123;accin&#125; and accout=#&#123;accout&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h2><ul>
<li><p>根据不同的条件需要执行不同的SQl命令，成为动态sql</p>
</li>
<li><p>Nybatis中动态sql在mapper.xml添加逻辑判断等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 当多参数时，不需要写parameter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"setByAccInAccount"</span> <span class="attr">resultType</span>=<span class="string">"log"</span>&gt;</span></span><br><span class="line">	select * from log where 1=1</span><br><span class="line">	<span class="comment">&lt;!-- OGNL表达式，直接写key或对象的属，不需要添加任何特殊字符 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"accin!=null and accin!='' "</span>&gt;</span></span><br><span class="line">		and accin=#&#123;param1&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"accout!=null and accout!=''"</span>&gt;</span></span><br><span class="line">		and accout=#&#123;param2&#125;		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><where>
>* 当编写where标签时，如果内容中第一个是and，去掉第一个and。
>* 如果where中有内容会生成where，如果没有内容不会生成where关键字。
>* 比使用if标签少写了1=1
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"setByAccInAccount"</span> <span class="attr">resultType</span>=<span class="string">"log"</span>&gt;</span></span><br><span class="line">	select * from log</span><br><span class="line">	<span class="comment">&lt;!-- OGNL表达式，直接写key或对象的属，不需要添加任何特殊字符 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"accin!=null and accin!='' "</span>&gt;</span></span><br><span class="line">			and accin=#&#123;param1&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"accout!=null and accout!=''"</span>&gt;</span></span><br><span class="line">			and accout=#&#123;param2&#125;		</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</where></li>
<li><p><choose><when><otherwise></otherwise></when></choose></p>
<blockquote>
<ul>
<li>只要有一个成立，其他的都不会执行。</li>
<li>代码示例:如果accin和accout都不是Null或不是””，生成的sql中只有where accin=?</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"setByAccInAccount"</span> <span class="attr">resultType</span>=<span class="string">"log"</span>&gt;</span></span><br><span class="line">	select * from log</span><br><span class="line">	<span class="comment">&lt;!-- OGNL表达式，直接写key或对象的属，不需要添加任何特殊字符 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"accin!=null and accin!=''"</span>&gt;</span></span><br><span class="line">				and accin=#&#123;param1&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"accout!=null and accout!=''"</span>&gt;</span></span><br><span class="line">				and accout=#&#123;param2&#125;	</span><br><span class="line">			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><set>标签：用在修改SQL中set从句</set></p>
<blockquote>
<ul>
<li>作用：去掉最后一个逗号</li>
<li>如果<set>里面有内容生成set关键字，没有则不生成</set></li>
<li>代码示例 : id=#{id} 防止<set>中没有内容。</set></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"upd"</span> <span class="attr">parameterType</span>=<span class="string">"log"</span>&gt;</span></span><br><span class="line">	update log </span><br><span class="line">	<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">		id=#&#123;id&#125;,</span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"accIn!=null and accIn!=''"</span>&gt;</span></span><br><span class="line">			accin=#&#123;accIn&#125;,</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"accOut!=null and accOut!=''"</span>&gt;</span></span><br><span class="line">			accout=#&#123;occOut&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><trim> 
>* prefix 在前面添加内容
>* prefixOverrides：去掉前面内容
>* suffix：在后面添加内容
>* suffixOverrides 去掉后面内容
>* 执行顺序：先去掉内容再添加内容</trim></li>
<li><p><bind> 实现模糊查询 </bind></p>
<blockquote>
<ul>
<li>作用：给参数重新赋值</li>
<li>场景：模糊查询，在原内容前后添加内容</li>
</ul>
</blockquote>
</li>
<li><p><foreach>标签</foreach></p>
<blockquote>
<ul>
<li>循环参数内容，还具备在内容前后添加内容，还具备加分隔符功能</li>
<li>使用场景：in查询中，批量新增中(mybatis中foreach效率较低)</li>
<li>示例<blockquote>
<ul>
<li>collection=””要遍历的集合 </li>
<li>item:迭代变量，#{迭代变量名获取内容}</li>
<li>open 循环后左侧要添加的内容</li>
<li>close 循环后右侧要添加的内容</li>
<li>separator 每次循环时，元素之间的分隔符</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selIn"</span> <span class="attr">parameterType</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">	select * from log where id in </span><br><span class="line">	<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"abc"</span> <span class="attr">close</span>=<span class="string">""</span> <span class="attr">open</span>=<span class="string">""</span> &gt;</span> </span><br><span class="line">		#&#123;abc&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>如果希望批量新增，sql命令</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">log</span> <span class="keyword">values</span>(<span class="keyword">default</span>,<span class="number">1</span>,<span class="number">2</span>),(<span class="keyword">default</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>openSession()必须指定 ExecutorType.BATCH</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session=factory.openSession(ExecutorType.BATCH);</span><br></pre></td></tr></table></figure>

<ul>
<li><sql> <include><blockquote>
<ul>
<li>某些sql片段，如果希望复用，可以使用<sql>定义这个片段</sql></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">	id,accin,accout,money</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

</include></sql></li>
</ul>
<blockquote>
<ul>
<li>在<code>&lt;select&gt;</code>、<code>&lt;delete&gt;</code>、<code>&lt;update&gt;</code>、<code>&lt;insert&gt;</code>中使用<include>标签引用</include></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"mysql"</span>&gt;</span> from log</span><br></pre></td></tr></table></figure>

<h2 id="ThreadLocal-OpenSessionInView"><a href="#ThreadLocal-OpenSessionInView" class="headerlink" title="ThreadLocal+OpenSessionInView"></a>ThreadLocal+OpenSessionInView</h2><ul>
<li>线程容器，给线程绑定一个Object内容，后只要线程不变，可以随时取出。</li>
<li>改变内容，无法取出内容<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		 ThreadLocal&lt;Integer&gt; threadLocal=<span class="keyword">new</span> ThreadLocal&lt;Integer&gt;();</span><br><span class="line">		threadLocal.set(<span class="number">13</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(()-&gt; &#123;</span><br><span class="line">			threadLocal.set(<span class="number">23</span>);</span><br><span class="line">			System.out.println(Thread.currentThread().getName()+<span class="string">"---&gt;"</span>+threadLocal.get());</span><br><span class="line">		&#125;).start();</span><br><span class="line">		</span><br><span class="line">		System.out.println(Thread.currentThread().getName()+<span class="string">"---&gt;"</span>+threadLocal.get());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><ol>
<li>应用程序和数据库交互的过程是一个相对耗时的过程。</li>
<li>缓存存在的意义：让应用程序减少对数据库的访问，提升程序运行效率。</li>
<li>Mybatis中默认SqlSession缓存开启<blockquote>
<ul>
<li>同一个<code>SqlSession</code>对象调用同一个<code>&lt;select&gt;</code>时，只有第一次访问数据库，第一次之后把查询结果缓存到SqlSession缓存区(内存)中。</li>
<li>缓存的对象是statement对象。（简单记忆：必须是用一个<code>&lt;select&gt;</code>）<blockquote>
<ul>
<li>在mybatis时一个<code>&lt;select&gt;</code>对应一个Statement对象.</li>
</ul>
</blockquote>
</li>
<li>有效范围必须是同一个SqlSession对象</li>
</ul>
</blockquote>
</li>
<li>缓存流程<blockquote>
<ul>
<li>先去缓存区中找是否存在statement。</li>
<li>返回结果。</li>
<li>如果没有缓存statement对象，去数据库获取数据。</li>
<li>数据库返回查询结果.</li>
<li>把查询结果放到对应的缓存区中。</li>
</ul>
</blockquote>
</li>
<li>SqlSessionFactory缓存<blockquote>
<ul>
<li>二级缓存</li>
<li>有效范围：同一个factory内哪个SqlSession都可以获取。</li>
<li>什么时候使用二级缓存：<blockquote>
<ul>
<li>当数据频繁被使用，很少被修改</li>
</ul>
</blockquote>
</li>
<li>使用二级缓存的步骤，在mapper.xml文件中添加 <code>&lt;cache readOnly=&quot;true&quot;&gt;&lt;/cache&gt;</code><blockquote>
<ul>
<li>如果不写 <code>readOnly=&quot;true&quot;</code>,需要把实体类实例化</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>当SqlSession对象close()时或commit()时会把SqlSession缓存的数据刷到SqlSessionFactory缓存区中。<h2 id="多表查询分类"><a href="#多表查询分类" class="headerlink" title="多表查询分类"></a>多表查询分类</h2></li>
<li>Mybatis实现多表查询方式：<blockquote>
<ul>
<li>业务装备：对两个表编写单表查询语句，在业务(Service)把查询的两个结果进行关联.</li>
<li>使用auto mapping特性，在实现两个表联合查询时通过别名完成映射</li>
<li>使用<code>Mybatis</code>的<code>&lt;resultMap&gt;</code>标签进行实现。</li>
</ul>
</blockquote>
</li>
<li>多表查询时，类中包含另一类的对象的分类<blockquote>
<ul>
<li>单个对象</li>
<li>多个对象</li>
</ul>
</blockquote>
<h2 id="lt-resultMap-gt-标签"><a href="#lt-resultMap-gt-标签" class="headerlink" title="&lt;resultMap&gt;标签"></a><code>&lt;resultMap&gt;</code>标签</h2><blockquote>
<ul>
<li>该标签写在mapper.xml中，由程序员控制sql查询结果与实体类的映射关系。<blockquote>
<ul>
<li>默认Mybatis使用auto mapping特性.</li>
</ul>
</blockquote>
</li>
<li>使用<code>&lt;resultMap&gt;</code>标签时，<code>&lt;select&gt;</code>标签不写<code>resultType</code>属性，而是使用resultMap属性引用<code>&lt;resultMap&gt;</code>标签</li>
</ul>
</blockquote>
</li>
<li>使用resultMap实现单表映射关系<blockquote>
<ul>
<li>实体类</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id1;</span><br><span class="line">	<span class="keyword">private</span> String name1;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId1</span><span class="params">(<span class="keyword">int</span> id1)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id1 = id1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName1</span><span class="params">(String name1)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name1 = name1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Teacher [id1="</span> + id1 + <span class="string">", name1="</span> + name1 + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>TeacherMap.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zhuchuli.mapper.TeacherMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"teacher"</span> <span class="attr">id</span>=<span class="string">"mymap"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 主键使用id标签配置映射关系--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id1"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 其它使用result标签配置映射关系 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name1"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll"</span> <span class="attr">resultMap</span>=<span class="string">"mymap"</span>&gt;</span></span><br><span class="line">		select * from teacher</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>数据库设计</li>
</ul>
</blockquote>
<p><img src="https://i.loli.net/2019/10/13/i4OBHXfMobshU2a.png" alt="1570948979_1_.png"></p>
<h2 id="使用resultMap实现关联单个对象-N-1方式"><a href="#使用resultMap实现关联单个对象-N-1方式" class="headerlink" title="使用resultMap实现关联单个对象(N+1方式)"></a>使用<code>resultMap</code>实现关联单个对象(N+1方式)</h2><ol>
<li>N+1查询方式：先查询出某个表的全部信息，根据这个表的信息查询另一个表的信息。</li>
<li>与业务转配的区别：<blockquote>
<ul>
<li>在service里面写代码，由mybatis完成转配</li>
</ul>
</blockquote>
</li>
<li>实现步骤<blockquote>
<ul>
<li>在Student实现类中包含一个Teacher对象</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> tid;</span><br><span class="line">	<span class="keyword">private</span> Teacher teacher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在TeacherMapper中提供一个查询：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selById"</span> <span class="attr">resultType</span>=<span class="string">"teacher"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">	select * from teacher where id = #&#123;0&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在StudentMapper中使用：<blockquote>
<ul>
<li><code>&lt;association&gt;</code>装配一个对象时使用。</li>
<li>property：对象在类中的属性名。</li>
<li>select：通过哪个查询查询这个对象的信息。</li>
<li>column：把当前表的哪个列值最为参数传递给另一个查询。</li>
<li>大前提是使用N+1方式时，如果列名和属性名相同可以不配置，使用Auto mapping特性，但是Mybatis默认只给列装配一次。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zhuchuli.mapper.StudentMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"student"</span> <span class="attr">id</span>=<span class="string">"stuMap"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"age"</span> <span class="attr">column</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"tid"</span> <span class="attr">column</span>=<span class="string">"tid"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 如果关联一个对象 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">select</span>=<span class="string">"com.zhuchuli.mapper.TeacherMapper.selById"</span> <span class="attr">column</span>=<span class="string">"tid"</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll"</span> <span class="attr">resultMap</span>=<span class="string">"stuMap"</span>&gt;</span></span><br><span class="line">		select * from student</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>可以将上面简化为：</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zhuchuli.mapper.StudentMapper"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"student"</span> <span class="attr">id</span>=<span class="string">"stuMap"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"tid"</span> <span class="attr">column</span>=<span class="string">"tid"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 如果关联一个对象 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">select</span>=<span class="string">"com.zhuchuli.mapper.TeacherMapper.selById"</span> <span class="attr">column</span>=<span class="string">"tid"</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll"</span> <span class="attr">resultMap</span>=<span class="string">"stuMap"</span>&gt;</span></span><br><span class="line">		select * from student</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用-lt-resultMap-gt-查询关联集合对象（N-1）"><a href="#使用-lt-resultMap-gt-查询关联集合对象（N-1）" class="headerlink" title="使用&lt;resultMap&gt;查询关联集合对象（N+1）"></a>使用<code>&lt;resultMap&gt;</code>查询关联集合对象（N+1）</h2><ol>
<li><p>在Teacher中添加<code>List&lt;Student&gt;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Student&gt; list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在StudentMapper.xml中添加通过tid查询</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selByTid"</span> <span class="attr">resultType</span>=<span class="string">"student"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">	select * from student where tid = #&#123;0&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在TeacherMapper.xml中添加查询全部</p>
<blockquote>
<ul>
<li><code>&lt;collection&gt;</code>当属性是集合类型时使用的标签</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zhuchuli.mapper.TeacherMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"teacher"</span> <span class="attr">id</span>=<span class="string">"mymap"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"list"</span> <span class="attr">ofType</span>=<span class="string">"student"</span> <span class="attr">select</span>=<span class="string">"com.zhuchuli.mapper.StudentMapper.selByTid"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll"</span> <span class="attr">resultMap</span>=<span class="string">"mymap"</span>&gt;</span></span><br><span class="line">		select * from teacher</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="使用-lt-resultMap-gt-实现加载集合数据（联合查询方式）"><a href="#使用-lt-resultMap-gt-实现加载集合数据（联合查询方式）" class="headerlink" title="使用&lt;resultMap&gt;实现加载集合数据（联合查询方式）"></a>使用<code>&lt;resultMap&gt;</code>实现加载集合数据（联合查询方式）</h2><blockquote>
<ul>
<li>在TeacherMapper.xml添加<blockquote>
<ul>
<li>mybatis可以通过主键判断对象是否被加载过</li>
<li>不需要担心重复创建Teacher</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"teacher"</span> <span class="attr">id</span>=<span class="string">"mymap1"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"tid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tname"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"list"</span> <span class="attr">ofType</span>=<span class="string">"student"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"sid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sname"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tid"</span> <span class="attr">property</span>=<span class="string">"tid"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll1"</span> <span class="attr">resultMap</span>=<span class="string">"mymap1"</span>&gt;</span></span><br><span class="line">	select t.id tid,t.name tname,s.id sid,s.name sname,age,tid from teacher t left join student s on t.id = s.tid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="AutoMapping-结合别名实现多表查询"><a href="#AutoMapping-结合别名实现多表查询" class="headerlink" title="AutoMapping 结合别名实现多表查询"></a>AutoMapping 结合别名实现多表查询</h2><blockquote>
<ul>
<li>只能使用多表联合查询</li>
<li>查询出的列名与属性名必须相同</li>
<li>实现方式：<blockquote>
<ul>
<li><code>.</code>在sql是关键字，两侧添加反单引号</li>
</ul>
</blockquote>
</li>
<li>这个方法只适合对象的查询，不适合list集合的查询</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zhuchuli.mapper.StudentMapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selAll"</span> <span class="attr">resultType</span>=<span class="string">"student"</span>&gt;</span></span><br><span class="line">		select t.id `teacher.id`,t.name `teacher.name`,s.id id,s.name name,age,tid from  student s left join teacher t on t.id = s.tid</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Mybatis 注解</li>
</ul>
<ol>
<li><p>注解：就是为了简化配置文件</p>
</li>
<li><p>Mybatis的注解简化Mapper.xml文件</p>
<blockquote>
<blockquote>
<ul>
<li>如果涉及动态SQL依然使用mapper.xml</li>
</ul>
</blockquote>
</blockquote>
</li>
<li><p>mapper.xml和注解可以共存。</p>
</li>
<li><p>使用注解时mybatis.xml中<code>&lt;mapper&gt;</code>的使用:</p>
<blockquote>
<ul>
<li><code>&lt;package/&gt;</code></li>
<li><code>&lt;mapper class=&quot;&quot;&gt;</code></li>
</ul>
</blockquote>
</li>
<li><p>实现查询、修改、新增、删除等功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(<span class="string">"select * from teacher"</span>)</span><br><span class="line">	<span class="function">List&lt;Teacher&gt; <span class="title">selAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Insert</span>(<span class="string">"insert into teacher(id,name) values(default,#&#123;name&#125;)"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insTeacher</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Update</span>(<span class="string">"update teacher set name=#&#123;name&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">updTeacher</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Delete</span>(<span class="string">"delete from teacher where id=#&#123;0&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">delTeacher</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Results</span>(value =&#123;</span><br><span class="line">			<span class="meta">@Result</span>(id=<span class="keyword">true</span>,property=<span class="string">"id"</span>,column=<span class="string">"id"</span>),</span><br><span class="line">			<span class="meta">@Result</span>(property=<span class="string">"name"</span>,column=<span class="string">"name"</span>),</span><br><span class="line">			<span class="meta">@Result</span>(property=<span class="string">"list"</span>,column=<span class="string">"id"</span>,many=<span class="meta">@Many</span>(select=<span class="string">"com.zhuchuli.mapper.StudentMapper.selById"</span>))</span><br><span class="line">			&#125;)</span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select * from teacher"</span>)</span><br><span class="line">	<span class="function">List&lt;Teacher&gt; <span class="title">selTeacher</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><blockquote>
<ul>
<li>@Results()：相当于<code>&lt;resultMap&gt;</code></li>
<li>@result()：相当于<code>&lt;id/&gt;或&lt;result/&gt;</code></li>
<li>@Result(id=true)：相当于<code>&lt;id/&gt;</code></li>
<li>@Many：相当于<code>&lt;collection/&gt;</code></li>
<li>@One：相当于<code>&lt;association/&gt;</code></li>
</ul>
</blockquote>
<h2 id="Mybatis运行原理"><a href="#Mybatis运行原理" class="headerlink" title="Mybatis运行原理"></a>Mybatis运行原理</h2></li>
</ol>
<ul>
<li>运行过程中可能遇到的类：<blockquote>
<ul>
<li>Resources：Mybatis中IO流的工具类。<blockquote>
<ul>
<li>作用：负责加载配置文件</li>
</ul>
</blockquote>
</li>
<li>SqlSessionFactoryBuilder()：构造器<blockquote>
<ul>
<li>作用：创建SqlSessionFactory接口的实现类</li>
</ul>
</blockquote>
</li>
<li>XMLConfigBuilder：Mybatis全局配置文件内容构造器类<blockquote>
<ul>
<li>负责读取流内容并转换为Java代码</li>
</ul>
</blockquote>
</li>
<li>Configuration 封装了全局配置文件所有配置信息。<blockquote>
<ul>
<li>全局配置文件内容都存在该对象中。</li>
</ul>
</blockquote>
</li>
<li>DefaultSqlSessionFactory是SqlSessionFactory接口的实现类。</li>
<li>Transaction 事务类<blockquote>
<ul>
<li>每一个SqlSession都会带一个Transaction对象</li>
</ul>
</blockquote>
</li>
<li>TransactionFactory 事务工厂<blockquote>
<ul>
<li>负责创建Transaction对象</li>
</ul>
</blockquote>
</li>
<li>Executor Mybatis执行器<blockquote>
<ul>
<li>作用：负责执行SQL语句</li>
<li>相当于JDBC中的statement对象（或PreperedStatement或CallableStatement）</li>
<li>默认的执行器SimpleExecutor</li>
<li>批量操作：BatchExecutor</li>
<li>通过openSession(参数控制)</li>
</ul>
</blockquote>
</li>
<li>DefaultSqlSession是SqlSession接口的实现类</li>
<li>ExceptionFactory：Mybatis中错误异常工厂</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="Spring全家桶"><a href="#Spring全家桶" class="headerlink" title="Spring全家桶"></a>Spring全家桶</h2><blockquote>
<ul>
<li>SpringData</li>
<li>SpringCloud</li>
<li>SpringBoot</li>
<li>SpringSession</li>
</ul>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Hibernate4" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/10/07/Hibernate4/" class="article-date">
  	<time datetime="2019-10-07T02:16:21.000Z" itemprop="datePublished">2019-10-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/10/07/Hibernate4/">
        Hibernate4
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第一讲-Hibernate简介"><a href="#第一讲-Hibernate简介" class="headerlink" title="第一讲 Hibernate简介"></a>第一讲 <code>Hibernate</code>简介</h2><hr>
<ul>
<li><code>Hibernate</code>是一个轻量级、<code>ORM</code>的框架。完成数据的持久化。是对<code>jdbc</code>的封装，简化<code>jdbc</code>操作。使用<code>Hibernate</code>后，不需要编写<code>Sql</code>语句，是一个全自动的持久化框架。使用<code>Hibernate</code>后，可以跨数据库平台。提高开发效率。</li>
<li>持久化：就是数据从瞬时状态变为持久状态的过程。</li>
<li><code>ORM</code>：<code>Object Relational Mapping</code>，对象关系映射.使得操作关系可以像操作对象一样方便。<br><img src="https://i.loli.net/2019/09/21/qpvZhDCb1Su94N7.png" alt="Hibernate_orm.PNG">  </li>
<li>结构体系<br><img src="https://i.loli.net/2019/09/21/9UW7MrbPX5Jofv4.png" alt="结构体系.PNG"></li>
</ul>
<hr>
<h2 id="第二讲-helloworld"><a href="#第二讲-helloworld" class="headerlink" title="第二讲 helloworld"></a>第二讲 <code>helloworld</code></h2><ul>
<li>使用<code>hibernate</code>进行<code>helloworld</code>程序开发，步骤：</li>
</ul>
<ol>
<li><p>新建<code>Java</code>项目</p>
</li>
<li><p>导入<code>hibernate</code> jar包</p>
</li>
<li><p>新建数据库表</p>
</li>
<li><p>新建<code>pojo</code>对象</p>
</li>
<li><p>编写<code>User.hbm.xml</code> </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zhuchuli.vo.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 主键映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 主键生成策略 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>src</code>包下新建<code>hibernate.cfg.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/hibernate4?serverTimezone=UTC<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定数据库的方言 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhuchuli/vo/User.hbm.xml"</span>/&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.boot.registry.StandardServiceRegistryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.service.ServiceRegistry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiberatorTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1.读取hibrator.cfg.xml配置文件</span></span><br><span class="line">		Configuration cfg=<span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//2.创建服务注册</span></span><br><span class="line">		ServiceRegistry registery=<span class="keyword">new</span> StandardServiceRegistryBuilder()</span><br><span class="line">									.applySettings(cfg.getProperties())</span><br><span class="line">									.build();</span><br><span class="line">		<span class="comment">//3.新建sessionFactory对象</span></span><br><span class="line">		SessionFactory factory=cfg.buildSessionFactory(registery);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4.创建session对象</span></span><br><span class="line">		Session session=factory.openSession();</span><br><span class="line">		<span class="comment">//5.获取数据</span></span><br><span class="line">		User user=(User) session.get(User.class,<span class="number">1</span>);</span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="comment">//6.释放资源</span></span><br><span class="line">		session.close();</span><br><span class="line">		factory.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="第三讲-配置文件讲解"><a href="#第三讲-配置文件讲解" class="headerlink" title="第三讲 配置文件讲解"></a>第三讲 配置文件讲解</h2><ul>
<li><p><code>hibernate.cfg.xml</code>是<code>hibernate</code>的主配置文件,<code>Configuration</code>读取的也是该对象。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			数据库连接信息</span></span><br><span class="line"><span class="comment">			根据不同的数据库，要配置不同参数信息。</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/hibernate4?serverTimezone=UTC<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 通用配置 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定数据库的方言 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 打印sql语句 --&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 格式化sql语句 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 映射文件信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zhuchuli/vo/User.hbm.xml"</span>/&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>映射文件：<code>Xxx-hbm.xml</code></p>
<blockquote>
<ul>
<li>非关系型数据库：<code>MongoDB</code>、<code>HBase</code>、<code>redis</code></li>
<li>《组成原理》《编译原理》</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- package用于指定类所在的包，如果不指定，那么在指定class的name时，需要指定完全限定名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		class指定类的映射信息</span></span><br><span class="line"><span class="comment">		name指定类，如果没有指定package时需要使用完全限定名</span></span><br><span class="line"><span class="comment">		table指定类对应的数据库的数据表名，如果不指定，默认和类型相同。</span></span><br><span class="line"><span class="comment">		schema:指定模式</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span> <span class="attr">schema</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			主键映射</span></span><br><span class="line"><span class="comment">			在hibernate中，类所对应的表必须要有主键</span></span><br><span class="line"><span class="comment">			name:为类所的属性名</span></span><br><span class="line"><span class="comment">			column:是属性名所对应的表的字段名称，类型是属性的类型</span></span><br><span class="line"><span class="comment">			column默认很属性名一致，类型默认和属性的类型一致。</span></span><br><span class="line"><span class="comment">			length 指定长度</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">				主键生成策略</span></span><br><span class="line"><span class="comment">				</span></span><br><span class="line"><span class="comment">				Oracle数据库 自增生成策略</span></span><br><span class="line"><span class="comment">				 &lt;generator class="sequence"&gt;</span></span><br><span class="line"><span class="comment">				 	&lt;param name="sequence"&gt;user_seq&lt;/param&gt;</span></span><br><span class="line"><span class="comment">				 &lt;/generator&gt;</span></span><br><span class="line"><span class="comment">				 UUID：生成的字符串唯一</span></span><br><span class="line"><span class="comment">				 hilo：使用一个高/低位算法高效生成long，short或int类型的标识符</span></span><br><span class="line"><span class="comment">				 assign:自己输入主键</span></span><br><span class="line"><span class="comment">				 forign：</span></span><br><span class="line"><span class="comment">				 </span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- property 指定属性的映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="第四讲-工具类及hibernate-crud操作"><a href="#第四讲-工具类及hibernate-crud操作" class="headerlink" title="第四讲 工具类及hibernate crud操作"></a>第四讲 工具类及hibernate crud操作</h2><ul>
<li><p>工具类Util</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.boot.registry.StandardServiceRegistryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.service.ServiceRegistry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtil</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Configuration cfg=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ServiceRegistry registery=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SessionFactory factory=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Session&gt; sessionLocal=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		cfg=<span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		registery=<span class="keyword">new</span> StandardServiceRegistryBuilder()</span><br><span class="line">				 .applySettings(cfg.getProperties())</span><br><span class="line">				 .build();</span><br><span class="line">		<span class="comment">/***</span></span><br><span class="line"><span class="comment">		 * sessionFactory是一个重量级对象，在一个应用中只需一个即可。是一个</span></span><br><span class="line"><span class="comment">		 * 进程级别对象，可以在集群中使用。</span></span><br><span class="line"><span class="comment">		 * 操作完后一般不会释放资源。</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		factory=cfg.buildSessionFactory(registery);</span><br><span class="line">		sessionLocal=<span class="keyword">new</span> ThreadLocal&lt;Session&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( sessionLocal.get()!=<span class="keyword">null</span> &amp;&amp; !sessionLocal.get().isOpen()) &#123;</span><br><span class="line">			sessionLocal.set(<span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(sessionLocal.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">			sessionLocal.set(factory.openSession());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sessionLocal.get();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//释放资源</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(sessionLocal.get()!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			sessionLocal.get().close();</span><br><span class="line">			sessionLocal.set(<span class="keyword">null</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>crud操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.hibernate.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.util.HibernateUtil;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//删除 先查后删除。</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session=<span class="keyword">null</span>;</span><br><span class="line">		Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session= HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx= session.beginTransaction();</span><br><span class="line">			User user=(User) session.get(User.class, <span class="number">4</span>);</span><br><span class="line">			<span class="comment">//删除</span></span><br><span class="line">			session.delete(user);</span><br><span class="line">			<span class="comment">//提交事务</span></span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				tx.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			HibernateUtil.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//修改数据 先查在修改最后再删除</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session=<span class="keyword">null</span>;</span><br><span class="line">		Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session= HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx= session.beginTransaction();</span><br><span class="line">			User user=(User) session.get(User.class, <span class="number">4</span>);</span><br><span class="line">			System.out.println(user);</span><br><span class="line">			user.setName(<span class="string">"小六六"</span>);</span><br><span class="line">			<span class="comment">//修改</span></span><br><span class="line">			session.save(user);</span><br><span class="line">			<span class="comment">//提交事务</span></span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				tx.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			HibernateUtil.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//增加数据</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session=<span class="keyword">null</span>;</span><br><span class="line">		Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session= HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx= session.beginTransaction();</span><br><span class="line">			<span class="comment">/* 下面两句话等同上面一句话</span></span><br><span class="line"><span class="comment">			Transaction tx=session.getTransaction();</span></span><br><span class="line"><span class="comment">			tx.begin();</span></span><br><span class="line"><span class="comment">			*/</span></span><br><span class="line">			User user = <span class="keyword">new</span> User();</span><br><span class="line">			user.setName(<span class="string">"刘德华"</span>);</span><br><span class="line">			user.setAge(<span class="number">53</span>);</span><br><span class="line">			<span class="comment">//保存数据</span></span><br><span class="line">			session.save(user);</span><br><span class="line">			<span class="comment">//提交事务</span></span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				tx.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			HibernateUtil.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="第五讲"><a href="#第五讲" class="headerlink" title="第五讲"></a>第五讲</h2><ul>
<li>软件工程步骤：<blockquote>
<ul>
<li>需要分析、概要分析、详细分析、编程、测试、发布</li>
</ul>
</blockquote>
</li>
<li>测试:<blockquote>
<ul>
<li>黑盒测试：工人测试。</li>
<li>白盒测试：Junit，需要编码实现</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.util.HibernateUtil;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Session session=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session = HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx = session.beginTransaction();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		HibernateUtil.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			User user = <span class="keyword">new</span> User();</span><br><span class="line">			user.setName(<span class="string">"张学友"</span>);</span><br><span class="line">			user.setAge(<span class="number">53</span>);</span><br><span class="line">			<span class="comment">//保存数据</span></span><br><span class="line">			session.save(user);</span><br><span class="line">			<span class="comment">//提交事务</span></span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				tx.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="第六讲-对象生命周期"><a href="#第六讲-对象生命周期" class="headerlink" title="第六讲 对象生命周期"></a>第六讲 对象生命周期</h2><ol>
<li>对象生命周期图</li>
</ol>
<p><img src="https://i.loli.net/2019/10/07/SprYIvAjzEs85cl.png" alt="对象生命周期.png"></p>
<ol start="2">
<li>两种路线<blockquote>
<ul>
<li><code>new</code> —&gt; 瞬时状态 —&gt; save() —&gt; 持久状态 —&gt; close() —&gt; 游离状态。 </li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试对象生命周期：第一条线路</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSession1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	User user=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//user处于瞬时状态</span></span><br><span class="line">		user = <span class="keyword">new</span> User();</span><br><span class="line">		user.setName(<span class="string">"kkk"</span>);</span><br><span class="line">		user.setAge(<span class="number">40</span>);</span><br><span class="line">		<span class="comment">//user处于持久状态</span></span><br><span class="line">		<span class="comment">//对象处于持久状态时被session管理</span></span><br><span class="line">		session.save(user);</span><br><span class="line">		<span class="comment">//对象处于持久状态时，提交事务前会将session中对象与数据库中的记录进行脏数据检查，如果不一致则进行数据同步。</span></span><br><span class="line">		<span class="comment">//user.setAge(23);//此时会自动调用update()</span></span><br><span class="line">		<span class="comment">//提交事务</span></span><br><span class="line">		tx.commit();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="keyword">if</span>(tx!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			tx.rollback();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//请除指定对象 ----&gt; session不再管理user</span></span><br><span class="line">	<span class="comment">//user此时处于游离状态，可能会把垃圾回收站回收。</span></span><br><span class="line">	session.evict(user);</span><br><span class="line">	<span class="comment">//close关闭session</span></span><br><span class="line">	session.close();</span><br><span class="line">	<span class="comment">//clear清楚session所有对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>Get —&gt; 持久状态 —&gt; clear —&gt; 游离状态 —&gt; update() —&gt; 持久状态 –&gt; delete() —&gt; 瞬时状态</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试对象生命周期：第二条线路</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSession2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	User user=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//user对象被session管理，处于持久状态</span></span><br><span class="line">		user=(User) session.get(User.class, <span class="number">1</span>);</span><br><span class="line">		<span class="comment">//调用clear后，session不在管理user，user处理游离状态</span></span><br><span class="line">		session.clear();</span><br><span class="line">		user.setName(<span class="string">"ddd"</span>);<span class="comment">//此时处于游离状态，所有数据库的数据不会发生改变</span></span><br><span class="line">		session.update(user);<span class="comment">//重回持久状态,user对象被session管理.</span></span><br><span class="line">		session.delete(user);<span class="comment">//删除后user对象处于瞬时状态。</span></span><br><span class="line">		tx.commit();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>总结</p>
<blockquote>
<ul>
<li>瞬时状态 session没有，数据库没有</li>
<li>持久状态 session有，数据库有,在该状态下会进行脏数据的读取</li>
<li>游离状态 session没有，数据库有</li>
</ul>
</blockquote>
<h2 id="第七讲-hibernate与struts2框架的整合"><a href="#第七讲-hibernate与struts2框架的整合" class="headerlink" title="第七讲 hibernate与struts2框架的整合"></a>第七讲 hibernate与struts2框架的整合</h2><h2 id="第八讲-关联映射之单向多对一"><a href="#第八讲-关联映射之单向多对一" class="headerlink" title="第八讲 关联映射之单向多对一"></a>第八讲 关联映射之单向多对一</h2></li>
<li><p><code>SchemaExport</code>工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">* 将对象信息 转换为 关系信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Configuration cfg=<span class="keyword">new</span> Configuration().configure();</span><br><span class="line">	<span class="comment">//使得hibernate映射信息转化为ddl(数据库定义语言)</span></span><br><span class="line">	SchemaExport se = <span class="keyword">new</span> SchemaExport(cfg);</span><br><span class="line">	<span class="comment">//第一参数：是否打印ddl语句</span></span><br><span class="line">	<span class="comment">//第二个参数：是否将ddl到数据库执行</span></span><br><span class="line">	se.create(<span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通用配置实现hbm to ddl</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	hbm2ddl.auto：该属性用于配置 是否将映射信息转换为关系信息</span></span><br><span class="line"><span class="comment">	create：每次执行都会删除表再创建表</span></span><br><span class="line"><span class="comment">	update：先检查数据库中表是否存在，如果不存在则先创建表，通常使用update</span></span><br><span class="line"><span class="comment">	create-drop：</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hbm2ddl.auto"</span>&gt;</span>create<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>类与类之间的关系</p>
<blockquote>
<ul>
<li>依赖 –&gt; 关联 –&gt; 组合 –&gt; 聚合</li>
</ul>
</blockquote>
</li>
<li><p>学生和班级的信息是一个多对一的关系</p>
<blockquote>
<ul>
<li>表结构<br><img src="https://i.loli.net/2019/10/07/lYKRpMnGDsXT3Fr.png" alt="关联.PNG"></li>
<li>类结构：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 学生类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 朱楚利</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="comment">//学生所对应的班级</span></span><br><span class="line">	<span class="keyword">private</span> Cluss cluss;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Cluss <span class="title">getCluss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cluss;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCluss</span><span class="params">(Cluss cluss)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cluss = cluss;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 班级类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 朱楚利</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cluss</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> address;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.address = address;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>映射文件<blockquote>
<ul>
<li>班级映射文件:Cluss_hbm.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Cluss"</span> <span class="attr">table</span>=<span class="string">"t_class"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="OpenSessionInView"><a href="#OpenSessionInView" class="headerlink" title="OpenSessionInView"></a>OpenSessionInView</h2><h2 id="组合主键"><a href="#组合主键" class="headerlink" title="组合主键"></a>组合主键</h2><ol>
<li>学生管理系统中，成绩表的主键组合主键。</li>
</ol>
<ul>
<li>表结构</li>
</ul>
<p><img src="https://i.loli.net/2019/10/19/JaA41MCwrGsQyDE.png" alt="组合主键.PNG"></p>
<ul>
<li>组合主键在Hibernate中类的结构有3种<blockquote>
<ul>
<li>类结构1：Result.java</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> stuId;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> subId;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> score;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStuId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stuId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuId</span><span class="params">(<span class="keyword">int</span> stuId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.stuId = stuId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSubId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> subId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubId</span><span class="params">(<span class="keyword">int</span> subId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.subId = subId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">double</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>类的结构2 ResultPK.java、Result.java</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultPK</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> stuId;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> subId;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStuId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stuId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuId</span><span class="params">(<span class="keyword">int</span> stuId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.stuId = stuId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSubId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> subId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubId</span><span class="params">(<span class="keyword">int</span> subId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.subId = subId;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 如果组合主键的字段是类的属性时，该类必须实现Serializable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> score;</span><br><span class="line">	<span class="keyword">private</span> ResultPK id;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ResultPK <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(ResultPK id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">double</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>类的结构3<blockquote>
<ul>
<li>Student、Subject是一个单独的类，需要把它们配置成Result的成员变量。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 如果组合主键的字段是类的属性时，该类必须实现Serializable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Student student;</span><br><span class="line">	<span class="keyword">private</span> Subject subject;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> score;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> student;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudent</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.student = student;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Subject <span class="title">getSubject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> subject;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubject</span><span class="params">(Subject subject)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.subject = subject;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> score;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">double</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>映射文件<blockquote>
<ul>
<li>类结构1 相匹配的映射文件： Result.hbm.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Result"</span> <span class="attr">table</span>=<span class="string">"t_result"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 组合主键映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">composite-id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key-property</span> <span class="attr">name</span>=<span class="string">"stuId"</span>&gt;</span><span class="tag">&lt;/<span class="name">key-property</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key-property</span> <span class="attr">name</span>=<span class="string">"subId"</span>&gt;</span><span class="tag">&lt;/<span class="name">key-property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">composite-id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- property 指定属性的映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"score"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>类结构2 相匹配的映射文件： Result.hbm.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Result"</span> <span class="attr">table</span>=<span class="string">"t_result"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 组合主键映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">composite-id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">class</span>=<span class="string">"ResultPK"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key-property</span> <span class="attr">name</span>=<span class="string">"stuId"</span>&gt;</span><span class="tag">&lt;/<span class="name">key-property</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key-property</span> <span class="attr">name</span>=<span class="string">"subId"</span>&gt;</span><span class="tag">&lt;/<span class="name">key-property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">composite-id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- property 指定属性的映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"score"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>类结构3 相匹配的映射文件： Result.hbm.xml、Student.hbml.xml、Subject.hbm.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- package用于指定类所在的包，如果不指定，那么在指定class的name时，需要指定完全限定名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Result"</span> <span class="attr">table</span>=<span class="string">"t_result"</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 组合主键映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">composite-id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key-many-to-one</span> <span class="attr">name</span>=<span class="string">"student"</span> <span class="attr">column</span>=<span class="string">"stuId"</span>&gt;</span><span class="tag">&lt;/<span class="name">key-many-to-one</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key-many-to-one</span> <span class="attr">name</span>=<span class="string">"subject"</span> <span class="attr">column</span>=<span class="string">"subId"</span>&gt;</span><span class="tag">&lt;/<span class="name">key-many-to-one</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">composite-id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- property 指定属性的映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"score"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Student"</span> <span class="attr">table</span>=<span class="string">"t_student"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- package用于指定类所在的包，如果不指定，那么在指定class的name时，需要指定完全限定名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Subject"</span> <span class="attr">table</span>=<span class="string">"t_subject"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试<blockquote>
<ul>
<li>类结构1、类结构2、类结构3测试</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Session session=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session = HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx = session.beginTransaction();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		HibernateUtil.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 将对象信息 转换为 关系信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Configuration cfg=<span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//使得hibernate映射信息转化为ddl(数据库定义语言)</span></span><br><span class="line">		SchemaExport se = <span class="keyword">new</span> SchemaExport(cfg);</span><br><span class="line">		<span class="comment">//第一参数：是否打印ddl语句</span></span><br><span class="line">		<span class="comment">//第二个参数：是否将ddl到数据库执行</span></span><br><span class="line">		se.create(<span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Result r=<span class="keyword">new</span> Result();</span><br><span class="line">			r.setStuId(<span class="number">1</span>);</span><br><span class="line">			r.setSubId(<span class="number">1</span>);</span><br><span class="line">			r.setScore(<span class="number">70</span>);</span><br><span class="line">			session.save(r);</span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>)tx.rollback();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Result r=<span class="keyword">new</span> Result();</span><br><span class="line">		r.setStuId(<span class="number">1</span>);</span><br><span class="line">		r.setSubId(<span class="number">1</span>);</span><br><span class="line">		Result r1=(Result) session.get(Result.class,r);</span><br><span class="line">		System.out.println(r1.getScore());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Session session=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session = HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx = session.beginTransaction();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		HibernateUtil.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 将对象信息 转换为 关系信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Configuration cfg=<span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//使得hibernate映射信息转化为ddl(数据库定义语言)</span></span><br><span class="line">		SchemaExport se = <span class="keyword">new</span> SchemaExport(cfg);</span><br><span class="line">		<span class="comment">//第一参数：是否打印ddl语句</span></span><br><span class="line">		<span class="comment">//第二个参数：是否将ddl到数据库执行</span></span><br><span class="line">		se.create(<span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ResultPK pk=<span class="keyword">new</span> ResultPK();</span><br><span class="line">			pk.setStuId(<span class="number">1</span>);</span><br><span class="line">			pk.setSubId(<span class="number">1</span>);</span><br><span class="line">			Result r=<span class="keyword">new</span> Result();</span><br><span class="line">			r.setId(pk);</span><br><span class="line">			r.setScore(<span class="number">70</span>);</span><br><span class="line">			session.save(r);</span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>)tx.rollback();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ResultPK pk=<span class="keyword">new</span> ResultPK();</span><br><span class="line">		pk.setStuId(<span class="number">1</span>);</span><br><span class="line">		pk.setSubId(<span class="number">1</span>);</span><br><span class="line">		Result r1=(Result) session.get(Result.class,pk);</span><br><span class="line">		System.out.println(r1.getScore());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Session session=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session = HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx = session.beginTransaction();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		HibernateUtil.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 将对象信息 转换为 关系信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Configuration cfg=<span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//使得hibernate映射信息转化为ddl(数据库定义语言)</span></span><br><span class="line">		SchemaExport se = <span class="keyword">new</span> SchemaExport(cfg);</span><br><span class="line">		<span class="comment">//第一参数：是否打印ddl语句</span></span><br><span class="line">		<span class="comment">//第二个参数：是否将ddl到数据库执行</span></span><br><span class="line">		se.create(<span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Student student=(Student) session.get(Student.class, <span class="number">1</span>);</span><br><span class="line">			Subject subject=(Subject) session.get(Subject.class, <span class="number">1</span>);</span><br><span class="line">			Result result=<span class="keyword">new</span> Result();</span><br><span class="line">			result.setStudent(student);</span><br><span class="line">			result.setSubject(subject);</span><br><span class="line">			result.setScore(<span class="number">80</span>);</span><br><span class="line">			session.save(result);</span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>)tx.rollback();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Student student=(Student) session.get(Student.class, <span class="number">1</span>);</span><br><span class="line">		Subject subject=(Subject) session.get(Subject.class, <span class="number">1</span>);</span><br><span class="line">		Result result=<span class="keyword">new</span> Result();</span><br><span class="line">		result.setStudent(student);</span><br><span class="line">		result.setSubject(subject);</span><br><span class="line">		Result r1=(Result) session.get(Result.class,result);</span><br><span class="line">		System.out.println(r1.getScore());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="有序集合映射（List）"><a href="#有序集合映射（List）" class="headerlink" title="有序集合映射（List）"></a>有序集合映射（List）</h2><ul>
<li>有序集合映射 表结构</li>
<li>indx为有序值：idx</li>
</ul>
<p><img src="https://i.loli.net/2019/10/19/EmYNkBMwO348GoK.png" alt="list.PNG"></p>
<ul>
<li>类结构<blockquote>
<ul>
<li>Cluss.java</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cluss</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Student&gt; students=<span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudents</span><span class="params">(List&lt;Student&gt; students)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.students = students;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> address;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.address = address;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>Student.java</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sex = sex;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>映射文件<blockquote>
<ul>
<li>Cluss.hbm.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Cluss"</span> <span class="attr">table</span>=<span class="string">"t_class"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span> <span class="attr">name</span>=<span class="string">"students"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"cluss_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 有序列 顺序有hibernate来维护 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">list-index</span> <span class="attr">base</span>=<span class="string">"1"</span>  <span class="attr">column</span>=<span class="string">"idx"</span>&gt;</span><span class="tag">&lt;/<span class="name">list-index</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Student"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>Student.hbm.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- package用于指定类所在的包，如果不指定，那么在指定class的name时，需要指定完全限定名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.zhuchuli.vo"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Student"</span> <span class="attr">table</span>=<span class="string">"t_student"</span> <span class="attr">schema</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- property 指定属性的映射 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sex"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Session session=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Transaction tx=<span class="keyword">null</span>;</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取Session对象</span></span><br><span class="line">			session = HibernateUtil.getSession();</span><br><span class="line">			<span class="comment">//获取事务并且开启事务</span></span><br><span class="line">			tx = session.beginTransaction();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		HibernateUtil.close();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 将对象信息 转换为 关系信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Configuration cfg=<span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//使得hibernate映射信息转化为ddl(数据库定义语言)</span></span><br><span class="line">		SchemaExport se = <span class="keyword">new</span> SchemaExport(cfg);</span><br><span class="line">		<span class="comment">//第一参数：是否打印ddl语句</span></span><br><span class="line">		<span class="comment">//第二个参数：是否将ddl到数据库执行</span></span><br><span class="line">		se.create(<span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Student s1=<span class="keyword">new</span> Student();</span><br><span class="line">			s1.setName(<span class="string">"张三"</span>);</span><br><span class="line">			s1.setAge(<span class="number">23</span>);</span><br><span class="line">			s1.setSex(<span class="string">"男"</span>);</span><br><span class="line">			Student s2=<span class="keyword">new</span> Student();</span><br><span class="line">			s2.setName(<span class="string">"李四"</span>);</span><br><span class="line">			s2.setAge(<span class="number">21</span>);</span><br><span class="line">			s2.setSex(<span class="string">"男"</span>);</span><br><span class="line">			Student s3=<span class="keyword">new</span> Student();</span><br><span class="line">			s3.setName(<span class="string">"王小蒙"</span>);</span><br><span class="line">			s3.setAge(<span class="number">20</span>);</span><br><span class="line">			s3.setSex(<span class="string">"女"</span>);</span><br><span class="line">			session.save(s1);</span><br><span class="line">			session.save(s2);</span><br><span class="line">			session.save(s3);</span><br><span class="line">			Cluss c1=<span class="keyword">new</span> Cluss();</span><br><span class="line">			c1.setName(<span class="string">"D-201"</span>);</span><br><span class="line">			c1.setAddress(<span class="string">"d-201"</span>);</span><br><span class="line">			Cluss c2=<span class="keyword">new</span> Cluss();</span><br><span class="line">			c2.setName(<span class="string">"C-201"</span>);</span><br><span class="line">			c2.setAddress(<span class="string">"c-201"</span>);</span><br><span class="line">			c1.getStudents().add(s1);</span><br><span class="line">			c1.getStudents().add(s3);</span><br><span class="line">			c2.getStudents().add(s2);</span><br><span class="line">			session.save(c1);</span><br><span class="line">			session.save(c2);</span><br><span class="line">			tx.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">if</span>(tx!=<span class="keyword">null</span>)tx.rollback();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Cluss c1=(Cluss) session.get(Cluss.class,<span class="number">1</span>);</span><br><span class="line">		System.out.println(c1.getName() + <span class="string">"\t"</span> +c1.getAddress());</span><br><span class="line">		System.out.println(<span class="string">"------------------------------"</span>);</span><br><span class="line">		<span class="keyword">for</span> (Student s : c1.getStudents()) &#123;</span><br><span class="line">			System.out.println(s.getName() + <span class="string">"\t"</span> + s.getSex() + <span class="string">"\t"</span> + s.getAge());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="cascade-和-inverse"><a href="#cascade-和-inverse" class="headerlink" title="cascade 和 inverse"></a>cascade 和 inverse</h2><ol>
<li>cascade 级联:操作一个对象时，可以附带操作关联对象<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"card"</span> <span class="attr">column</span>=<span class="string">"card_id"</span>  <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在many-to-one中 将级联设置为save-update，意味着在保存多的一端数据时，会检查关联对象，如果关联对象没有保存或更新，那么级联会将关联对象保存和更新.如果cascase值为delete，那么会级联将关联对象删除，如果有多个记录关联同一个级联对象时会报错，不建议设置为delete，如果值为all,所有相关动作都会级联，建议在many-to-one时设置save-update.</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"students"</span>  <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"cluss_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Student"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在one-to-many中，如果cascase是save-update，会级联保存多的一端数据，前提要在一的一端设置关联对象，但是会多出n条update语句，所以不建议在一的一端设置为save-update，如果cascase值为delete，会级联会删除多的一端的数据。一般情况下不会设置delete，在企业中，删除大多数为虚拟删除。</li>
</ul>
</blockquote>
<ol start="2">
<li>invers：反e转，表示控制关系（外健）由谁来管理。多的一方默认是管理（外健）的，一的一方默认也是管理关系的。但是一的一方可以设置inverse=true，让另一方来控制关系，有一的一方控制关系，那么在管理关系会发出update语句。invserse控制是谁来管理关系。cascade控制如何级联操作。</li>
</ol>
<h2 id="hql"><a href="#hql" class="headerlink" title="hql"></a>hql</h2><ol>
<li>HQL:hibernate query language:hibernate的查询语句，是一种完全面向对象的查询语言。编写Hql语句 和 sql几乎相同 ，关键字都一样，不区分大小写，hql查询的是类，不是表，字段写属性名，而不是表中字段名</li>
</ol>
<h2 id="Criteria查询"><a href="#Criteria查询" class="headerlink" title="Criteria查询"></a>Criteria查询</h2><ol>
<li>完全面向对象查询</li>
</ol>
<h2 id="本地sql"><a href="#本地sql" class="headerlink" title="本地sql"></a>本地sql</h2><ol>
<li>Hibernate支持跨数据平台，导致一些数据库特有的功能Hibernate不支持。所以Hibernate提供了解决方法，那就是使用本地sql进行查询 –hibernate支持使用sql进行。</li>
</ol>
<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><ol>
<li>过滤器：处理具有“显性(visibility)”规则的数据</li>
<li>使用Hibernate filter。 Hibernate filter是全局有效的、具有名字、可以带参数的过滤器， 对于某个特定的Hibernate session您可以选择是否启用（或禁用）某个过滤器。 </li>
<li>使用步骤<blockquote>
<ul>
<li>定义过滤器</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 过滤器的定义 name是过滤器的名称 全局唯一 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-def</span> <span class="attr">name</span>=<span class="string">"userFilter"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 过滤器可以携带参数，需要指定参数的名称和类型 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-param</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">type</span>=<span class="string">"int"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-def</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在类的映射文件中引用过滤器</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用过滤器时 需要指定名称和条件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">name</span>=<span class="string">"userFilter"</span> <span class="attr">condition</span>=<span class="string">"age&gt;:age"</span>&gt;</span><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在类中的应用</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">	* 过滤器的使用</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	session.enableFilter(<span class="string">"userFilter"</span>).setParameter(<span class="string">"age"</span>,<span class="number">20</span>);</span><br><span class="line">	List&lt;User&gt; users=session.createQuery(<span class="string">"from User"</span>).list();</span><br><span class="line">	<span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">		System.out.println(user.getName() + <span class="string">"\t"</span> + user.getAge());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="加载策略和抓取策略"><a href="#加载策略和抓取策略" class="headerlink" title="加载策略和抓取策略"></a>加载策略和抓取策略</h2><ol>
<li><p>加载策略指hibernate如何查询数据，加载策略有两种方式：一种是即时架加载，一种是延迟加载。</p>
</li>
<li><p>即时加载策略是指调用方法立即到数据库查询。</p>
</li>
<li><p>get方法：是属于即时加载策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	*  get()是属于及时加载，获取数据时，如果不存在返回null</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	User user=(User)session.get(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>List()方法也属性即时加载策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	* 测试List：该方法也是及时加载</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	List&lt;User&gt; users=session.createQuery(<span class="string">"from User"</span>).list();</span><br><span class="line">	System.out.println(<span class="string">"----------------"</span>);</span><br><span class="line">	System.out.println(users.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>即时记载在需要立即使用数据时使用。— 响应速度比较快。</li>
</ul>
<ol start="5">
<li>延迟加载又称为懒加载  —&gt; 懒加载可以提供系统使用率，在调用方法时不会立即到数据库查询数据，只有真正使用到数据时才去数据库查询。</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">* load：延迟加载或懒加载</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoad</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//load方法查询数据 如果数据不存在将会抛出异常</span></span><br><span class="line">	User user=(User)session.load(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getId());</span><br><span class="line">	System.out.println(<span class="string">"------------"</span>);</span><br><span class="line">	System.out.println(user.getName());<span class="comment">//到数据库查询</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>懒加载：在关联查询中也可以使用懒加载；<blockquote>
<ul>
<li>Many-to-one:</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"cluss"</span> <span class="attr">column</span>=<span class="string">"cluss_id"</span>  <span class="attr">lazy</span>=<span class="string">"proxy"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<blockquote>
<ul>
<li>Lazy的值默认是proxy，是懒加载模式</li>
<li>no-proxy:也是懒加载模式,只是加载对象不使用代理。</li>
<li>lazy=”false”时采用即时加载。</li>
<li>set</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"students"</span> <span class="attr">lazy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"cluss_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"Student"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>lazy=”true”默认，采用懒加载</li>
<li>Lazy=”false”：采用即时加载，一次将关联对象查询出来。</li>
<li>Lazy=”extra”：聪明的懒加载模式，如果只是查询关联对象的大小时，只会查询个数，不会查询数据。</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li>Class：查询对象默认是lazy=true</li>
<li>property默认是lazy=false</li>
</ul>
</blockquote>
<ol start="7">
<li>抓取策略：指查询数据时，采用什么样的sql语句来查询。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"cluss"</span> <span class="attr">column</span>=<span class="string">"cluss_id"</span>  <span class="attr">lazy</span>=<span class="string">"proxy"</span> <span class="attr">fetch</span>=<span class="string">"select"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>Select采用的是select语句查询数据，默认采用select，在这种抓取策略下lazy才有意义。</li>
<li>Join抓取，采用的额join语句查询数据，一次将关联数据查出，lazy没有意义了。</li>
</ul>
</blockquote>
<h2 id="一级缓存、二级缓存和查询缓存"><a href="#一级缓存、二级缓存和查询缓存" class="headerlink" title="一级缓存、二级缓存和查询缓存"></a>一级缓存、二级缓存和查询缓存</h2><ol>
<li>缓存：提高执行效率。</li>
<li>hibernate提供了3类缓存：一级缓存，二级缓存，查询缓存。</li>
<li>一级缓存又称为session缓存,是线程级别的缓存。生命周期比较短。<blockquote>
<ul>
<li>get()方法获取，先检查缓存中是否有该数据，如果有直接使用，如果没有那么从数据库中查询，并写入缓存。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  get()属于一级缓存</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	User user=(User)session.get(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">	System.out.println(<span class="string">"---------------"</span>);</span><br><span class="line">	user=(User)session.get(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>load()方法获取数据，先检查缓存中是否有该数据，如果有直接使用，如果没有那么从数据库中查询，并写入缓存。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  load()也属于一级缓存</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	User user=(User)session.load(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">	System.out.println(<span class="string">"---------------"</span>);</span><br><span class="line">	user=(User)session.load(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>List()方法，直接从数据库中获取，获取后将数据存入到缓存中</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	*  load()也属于一级缓存</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	List&lt;User&gt; users=session.createQuery(<span class="string">"from User"</span>).list();</span><br><span class="line">	System.out.println(<span class="string">"----------------"</span>);</span><br><span class="line">	User user=(User)session.load(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">	System.out.println(<span class="string">"----------------"</span>);</span><br><span class="line">	users=session.createQuery(<span class="string">"from User"</span>).list();</span><br><span class="line">	</span><br><span class="line">	System.out.println(users.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>iterate()方法，属于懒加载模式，先获取数据的id，如果使用数据再根据id查询数据，是一种延迟加载方式。Iterate方法获取数据时会先插件缓存，如果有直接使用，如果没有再去数据库查询，然后再把查询结果写入到缓存中。</li>
<li>1 和 N+1 问题：<code>1</code>是指<code>list</code>方法通过一条sql语句将所有的数据查询出来，而iterate方法通过n+1条sql语句将数据查询。他们的不同在于加载数据的方式不同。</li>
<li>缓存的管理：一般情况下不用管理一级缓存，如果在进行批量处理时需要管理缓存。清理缓存可以使用：evict清除指定对象，clear清空缓存，flush刷新缓存数据，close关闭缓存。</li>
</ul>
</blockquote>
<ol start="4">
<li>二级缓存又称为SessionFactory缓存，是进程级别的，生命周期比较长，并且可以在集群中使用。缓存的数据比较多，当需要清理缓存使用相关算法进行清理。比如：LRU和FIFO等。Hibernate二级缓存采用第三方插件来实现。</li>
<li>二级缓存使用步骤：<blockquote>
<ul>
<li>新建项目</li>
<li>导入jar包</li>
<li>添加ehcache.xml配置文件到src下</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	maxElementsInMemory：最多缓存元素的个数</span></span><br><span class="line"><span class="comment">	eternal：是否永久缓存</span></span><br><span class="line"><span class="comment">	timeToIdleSeconds 空闲时间</span></span><br><span class="line"><span class="comment">	timeToLiveSeconds 存活时间</span></span><br><span class="line"><span class="comment">	overflowToDisk 是否溢出到磁盘</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">	<span class="attr">maxElementsInMemory</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">timeToIdleSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">timeToLiveSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">overflowToDisk</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">	/&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在hibernate.cfg.xml开启二级缓存</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启二级缓存 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cache.use_second_level_cache"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cache.provider_class"</span>&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cache.region.factory_class"</span>&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在映射文件中添加<code>&lt;cache/&gt;</code>标签</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span> <span class="attr">schema</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">usage</span>=<span class="string">"read-only"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>测试：使用二级缓存时，说明在关闭session时还能继续查到数据。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	*  get()是属于及时加载，获取数据时，如果不存在返回null</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	User user=(User)session.get(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">	System.out.println(<span class="string">"---------------"</span>);</span><br><span class="line">	session=HibernateUtil.getSession();</span><br><span class="line">	user=(User)session.get(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查询缓存：在二级缓存的基础上使用，<blockquote>
<ul>
<li>开启查询缓存 hibernate.cfg.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启查询缓存 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cache.use_query_cache"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<ul>
<li>在查询数据时，设置查询缓存有效 <code>setCacheable(true)</code></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	List&lt;User&gt; users=session.createQuery(<span class="string">"from User"</span>)</span><br><span class="line">			.setCacheable(<span class="keyword">true</span>)</span><br><span class="line">			.list();</span><br><span class="line">	System.out.println(<span class="string">"----------------"</span>);</span><br><span class="line">	User user=(User)session.load(User.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(user.getName());</span><br><span class="line">	System.out.println(<span class="string">"----------------"</span>);</span><br><span class="line">	users=session.createQuery(<span class="string">"from User"</span>).setCacheable(<span class="keyword">true</span>).list();</span><br><span class="line">	</span><br><span class="line">	System.out.println(users.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h2><ol>
<li>从低到高: 读取未提交，读取已提交，可重复读，序列化</li>
<li>我们一般采用读取已提交，配合各种并发访问控制策略来达到事务控制的目的。</li>
</ol>
<h2 id="锁机制"><a href="#锁机制" class="headerlink" title="锁机制"></a>锁机制</h2><ol>
<li>乐观锁和悲观锁</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-深入使用struts2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/09/29/深入使用struts2/" class="article-date">
  	<time datetime="2019-09-29T11:17:18.000Z" itemprop="datePublished">2019-09-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/09/29/深入使用struts2/">
        深入使用struts2
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="详解Struts2的类型转换"><a href="#详解Struts2的类型转换" class="headerlink" title="详解Struts2的类型转换"></a>详解Struts2的类型转换</h2><h3 id="Strut2内建的类型转换器"><a href="#Strut2内建的类型转换器" class="headerlink" title="Strut2内建的类型转换器"></a>Strut2内建的类型转换器</h3><ul>
<li>对于大部分常用类型，开发者无须理会类型转换，<code>Struts2</code>可以完成大多数常用的类型转换。这是常用的类型转换是通过<code>Struts2</code>内建的类型转化器完成的，<code>Struts2</code>已经内建了字符串类型与如下类型之间相互转换的转换器。</li>
</ul>
<ol>
<li><code>boolean</code>和<code>Boolean</code>：完成字符串和布尔值之间的转换。</li>
<li><code>char</code>和<code>Character</code>：完成字符串和字符之间的转换。</li>
<li><code>int</code>和<code>Integer</code>：完成字符串和整型值之间的转换。</li>
<li><code>long</code>和<code>Long</code>：完成字符串和长整型值之间的转换。</li>
<li><code>float</code>和<code>Float</code>：完成字符串和单精度浮点之间的转换。</li>
<li><code>double</code>和<code>Double</code>：完成字符串和双精度浮点之间的转换。</li>
<li><code>Date</code>：完成字符串和日期类型之间的转换，日期格式使用用户请求所在<code>Locale</code>的<code>SHORT</code>格式。 </li>
<li>数据：在默认情况下，数组元素是字符串，如果用户提供了自定义的类型转换器，也可以是其他复合类型的转换器。</li>
<li>集合：在默认情况下，假定集合元素类型为<code>String</code>，并创建一个新的<code>ArrayList</code>封装所有的字符串。<h3 id="基于OGNL的类型转换"><a href="#基于OGNL的类型转换" class="headerlink" title="基于OGNL的类型转换"></a>基于<code>OGNL</code>的类型转换</h3></li>
</ol>
<ul>
<li><p>借助于内置的类型转换器，<code>Struts2</code>可以完成字符串和基本类型之间的转换。除此之外，借助于<code>OGNL</code>表达式，<code>Struts2</code>允许以另一种简单的方法将请求参数转换成复合类型。</p>
</li>
<li><p>不仅如此，还可以直接将请求参数转换成<code>Collection</code>集合。</p>
<h3 id="指定集合元素的类型"><a href="#指定集合元素的类型" class="headerlink" title="指定集合元素的类型"></a>指定集合元素的类型</h3></li>
<li><p>使用集合时都使用了泛型，这种泛型可以让<code>Struts2</code>了解集合元素的类型，<code>Struts2</code>就可以通过反射来创建对应类的对象，并将这些对象加入到<code>List</code>中。</p>
</li>
<li><p>如果不使用泛型的话，这时得通过局部类型转换文件来指定集合元素的类型。</p>
</li>
<li><p>局部类型转换文件文件名应该为：<code>actionName-convention.properties</code></p>
</li>
<li><p>类型转换文件应该与<code>Action</code>存放在相同的位置。</p>
</li>
<li><p>为了指定<code>List</code>集合里元素的类型，需要指定两个部分</p>
<blockquote>
<ul>
<li>List集合属性名称</li>
<li>List集合里元素的类型</li>
</ul>
</blockquote>
</li>
<li><p>提示：为了让Struts2了解集合中元素的类型，可以使用如下两种方式：</p>
<blockquote>
<ul>
<li>通过为集合指定泛型。</li>
<li>通过在<code>Action</code>的局部类型转换文件中指定集合元素的类型。</li>
</ul>
</blockquote>
<h3 id="自定义类型转换器"><a href="#自定义类型转换器" class="headerlink" title="自定义类型转换器"></a>自定义类型转换器</h3></li>
<li><p>大部分时候，使用<code>Struts2</code>提供的类型转换器，以及基于<code>OGNL</code>的类型转换机制,就能满足大部分类型转换的需求。但在某些特殊的情况下，例如需要把一个字符串转换成一个复合对象，这时候就需要使用到类型转换器。</p>
</li>
<li><p><code>Struts2</code>的类型转换器实际上依然是基于<code>OGNL</code>框架的，在<code>OGNL</code>项目中有一个<code>TypeConverter</code>接口，这个接口就是自定义类型转换器要实现的接口。该接口的定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//OGNL提供的类型转换器接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TypeConverter</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">converterValue</span><span class="params">(Map context,Object target,Member member,String propertyName,Object value,Class toType)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现类型转换器必须实现上面的<code>TypeConverter</code>接口，不过上面接口里面的方法太过复杂，所有<code>OGNL</code>项目还为该接口提供了一个实现类：<code>DefultTypeConverter</code>，通常采用扩展该方法来实现自定义类型转换器。实现类型转换器需要重写<code>DefaultTypeConverter</code>类的<code>converterValue</code>方法。</p>
</li>
<li><p><code>converterValue</code>方法：为了实现该方法的双向转换，程序需要通过判断<code>toType</code>的类型即可判断转换的方向。</p>
<h3 id="注册类型转换器"><a href="#注册类型转换器" class="headerlink" title="注册类型转换器"></a>注册类型转换器</h3></li>
<li><p>自定义类型转换器完成之后，必须在<code>web</code>应用中注册该类型转换器，<code>Struts2</code>才可以正常使用该类型转换器。</p>
</li>
<li><p><code>Struts2</code>支持如下三种类型转换器</p>
<blockquote>
<ul>
<li>注册局部类型转换器：<code>ActionName-conversion.properties</code></li>
<li>注册全局类型转换器：<code>xwork-conversion.properties</code></li>
<li>使用<code>JDK1.5</code>的注解来注册类型转换器：通过注解方法来注册类型转换器。</li>
</ul>
</blockquote>
</li>
<li><p>局部转换器只对指定的<code>Action</code>的执行属性有效，全局转换器指对指定类型的全部属性有效。</p>
<h3 id="基于Struts2的类型转换器"><a href="#基于Struts2的类型转换器" class="headerlink" title="基于Struts2的类型转换器"></a>基于<code>Struts2</code>的类型转换器</h3></li>
<li><p><code>Struts2</code>提供了<code>StrutsTypeConverter</code>抽象类，实际上它是<code>DefaultTypeConverter</code>的子类，实现该抽象类，需要实现两个方法<code>convertFromString()</code>和<code>convertToString()</code>。第一个方法是将字符串类型转换成复合类型时调用，第二方法是将复合类型转换为字符串类型的调用。</p>
</li>
<li><p>注册该方法的方式与上面三种方法一样。</p>
<h3 id="处理set集合"><a href="#处理set集合" class="headerlink" title="处理set集合"></a>处理set集合</h3></li>
<li><p>由于<code>set</code>集合元素是无序状态，所以<code>Struts2</code>无法准确将字符串转换为<code>set</code>集合，也无法准确读取<code>set</code>集合元素。</p>
</li>
<li><p>如果想要实现处理<code>set</code>集合，就需要为集合里每个元素添加一个标识属性。</p>
</li>
<li><p><code>Struts2</code>允许使用局部类型转换文件来指定<code>Set</code>集合元素的标识属性，在局部类型转换文件中增加如下一行代码即可指定<code>Set</code>集合标识属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KeyProperty_&lt;SetPropName&gt; = &lt;KeyPropName&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>jsp</code>页面中访问<code>set</code>元素的方式：<code>&lt;SetPropName&gt;(&#39;&lt;indexPropValue&gt;&#39;)</code></p>
<h3 id="类型转换中的错误处理"><a href="#类型转换中的错误处理" class="headerlink" title="类型转换中的错误处理"></a>类型转换中的错误处理</h3></li>
<li><p>实际上，表现层数据设计两个处理：类型转换和数据校验。</p>
</li>
<li><p>可以进行有效的类型转换是基础，只有当数据完成有效数据转换后，下一步才去进行数据校验。</p>
</li>
<li><p><code>Struts2</code>中类型转换的错误处理流程</p>
</li>
</ul>
<p><img src="https://i.loli.net/2019/10/02/61rFQTAGaekqKE5.png" alt="1569982729_1_.png"></p>
<ul>
<li>当<code>conversionError</code>拦截器对异常进行处理后，系统会跳到名为<code>input</code>的逻辑视图名。</li>
<li>处理类型转换错误<blockquote>
<ul>
<li>为了让<code>struts2</code>的类型转换机制生效，必须让<code>Action</code>实现<code>ActionSupport</code>基类，因为<code>ActionSupport</code>基类负责收集异常信息，并将他们封装到<code>FieldError</code>对象，添加到<code>ActionContext</code>中。</li>
<li>在jsp页面中使用<code>&lt;s:fielderror&gt;</code>输出异常信息。</li>
</ul>
</blockquote>
</li>
</ul>
<hr>
<h2 id="使用Struts2的输入校验"><a href="#使用Struts2的输入校验" class="headerlink" title="使用Struts2的输入校验"></a>使用Struts2的输入校验</h2><ul>
<li>输入校验分为客户端校验和服务器端校验，客户端校验主要是过滤正常用户的误操作，主要由<code>JavaScript</code>代码完成；服务器端校验是整个应用阻止非法数据的最后防线，主要通过在应用编程中实现。</li>
<li><code>Struts2</code>的输入校验即包括服务器端的校验，也包括客户端的校验。<h3 id="编写校验规则文件"><a href="#编写校验规则文件" class="headerlink" title="编写校验规则文件"></a>编写校验规则文件</h3></li>
<li><code>Struts2</code>提供了基于框架的输入校验，在这种输入校验下，所有的输入校验只需要编写简单的配置文件，<code>Struts2</code>的验证框架将会负责服务器端校验和客户端校验.</li>
<li>输入校验的配置文件的文件名：<code>ActionName-validation.xml</code>。</li>
<li>该文件的配置：<blockquote>
<ul>
<li>&lt;validtors../&gt;:该配置文件的根元素。</li>
<li>&lt;field-validator../&gt;：字段校验配置风格。</li>
<li>&lt;validator ../&gt;：非字段校验配置风格。</li>
</ul>
</blockquote>
</li>
<li>当输入校验失败后，Struts2会自动返回名为<code>input</code>的逻辑视图名。</li>
<li>案例实现：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   &lt;!--registerForm.jsp--&gt;</span><br><span class="line">&lt;h2&gt;请输入您的注册信息&lt;/h2&gt;</span><br><span class="line">&lt;s:fielderror/&gt;</span><br><span class="line">&lt;s:form action=<span class="string">"register"</span>&gt;</span><br><span class="line">	&lt;s:textarea name="name" label="用户名"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">	&lt;s:textarea name="pass" label="密码"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">	&lt;s:textarea name="age" label="年龄"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">	&lt;s:textarea name="birth" label="生日"&gt;&lt;/s:textarea&gt;</span><br><span class="line">	&lt;s:submit value="注册"&gt;&lt;/s:submit&gt;</span><br><span class="line">&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Register Action</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="comment">//定义四个成员变量封装请求参数</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="comment">//此处省略了getter和setter方法</span></span><br><span class="line">    <span class="comment">//处理方采用ActionSupport中的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--校验配置文件 RegisetAction-validation.xml--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定校验配置文件的dtd信息 --&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE validators PUBLIC</span></span><br><span class="line"><span class="meta">  		"-//Apache Struts//XWork Validator 1.0.3//EN"</span></span><br><span class="line"><span class="meta">  		"http://struts.apache.org/dtds/xwork-validator-1.0.3.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 校验文件根元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的name属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>必须输入用户名<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>您输入的用户只能是字母或数字，且长度必须在4-25位之间<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的pass属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"pass"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>必须输入密码<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>您输入的密码只能是字母或数字，且长度必须在4-25位之间<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 指定age必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>年纪必须在1到150之间的整数<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定birth必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"birth"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"date"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 下面指定日期字符串时，必须使用Locale的日期格式 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2050-20-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>生日必须在$&#123;min&#125;到s&#123;max&#125;之间<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--struts.xml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"register"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.RegisterAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/show.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/WEB-INF/content/registerForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--show.jsp--&gt;</span><br><span class="line">用户名：&lt;s:property value=<span class="string">"name"</span>/&gt;&lt;br/&gt;</span><br><span class="line">密    码：&lt;s:property value=<span class="string">"pass"</span>/&gt;&lt;br/&gt;</span><br><span class="line">年    龄：&lt;s:property value=<span class="string">"age"</span>/&gt;&lt;br/&gt;</span><br><span class="line">生    日：&lt;s:property value=<span class="string">"birth"</span>/&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：上面案例的校验配置文件与Action类放在同一个包下面。</li>
<li>从上面可以看出，这种校验方式的可用性很高，只要在配置文件中配置校验规则，即可完成数据校验，无须用户书写任何的数据校验代码。<h3 id="国家化提示信息"><a href="#国家化提示信息" class="headerlink" title="国家化提示信息"></a>国家化提示信息</h3></li>
<li>在上面的数据校验中，所有的提示信息都是通过硬编码的方式写在配置文件中，这种方式显然不利于程序国际化。</li>
<li>使用国际化资源文件案例：<blockquote>
<ul>
<li>数据校验配置文件：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--输入校验配置文件--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定校验配置文件的dtd信息 --&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE validators PUBLIC</span></span><br><span class="line"><span class="meta">  		"-//Apache Struts//XWork Validator 1.0.3//EN"</span></span><br><span class="line"><span class="meta">  		"http://struts.apache.org/dtds/xwork-validator-1.0.3.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 校验文件根元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的name属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--  &lt;message&gt;必须输入用户名&lt;/message&gt;--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.required"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 采用国际化资源文件配置提示信息 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.regex"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的pass属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"pass"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;message&gt;必须输入密码&lt;/message&gt; --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.required"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.regex"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 指定age必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"age.range"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定birth必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"birth"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"date"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 下面指定日期字符串时，必须使用Locale的日期格式 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2050-20-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"birth.range"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>国际资源文件：<code>RegisterAction_zh_CN.properties</code></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name.required=您必须输入用户名！</span><br><span class="line">name.regex=您输入的用户只能是字母或数字，且长度必须在4-25位之间</span><br><span class="line">pass.required=必须输入密码</span><br><span class="line">pass.regex=您输入的密码只能是字母或数字，且长度必须在4-25位之间</span><br><span class="line">age.range=年纪必须在$&#123;min&#125;和$&#123;max&#125;之间的整数</span><br><span class="line">birth.range=生日必须在$&#123;min&#125;和$&#123;max&#125;之间</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>其它代码与上面一样。</li>
</ul>
<ul>
<li>从上面可以看出：<code>&lt;message../&gt;</code>没有直接给出提示信息，而是添加一个<code>key</code>属性，用它来指定国际资源文件。</li>
</ul>
</blockquote>
<h3 id="使用客户端校验"><a href="#使用客户端校验" class="headerlink" title="使用客户端校验"></a>使用客户端校验</h3><ul>
<li>在<code>Struts2</code>应用中使用客户端校验非常简单，只需要改变人如下两个地方即可。<blockquote>
<ul>
<li>将输入页面的表单标签改为使用<code>Struts2</code>标签来生成表单。</li>
<li>为该<code>&lt;s:form&gt;</code>元素增加<code>validate=&quot;true&quot;</code></li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;请输入您的注册信息&lt;/h2&gt;</span><br><span class="line">	&lt;s:fielderror/&gt; </span><br><span class="line">	&lt;s:form action=<span class="string">"register"</span> validate=<span class="string">"true"</span>&gt;</span><br><span class="line">		&lt;s:textarea name="name" label="用户名"&gt;&lt;/s:textarea&gt;</span><br><span class="line">	</span><br><span class="line">		&lt;s:textarea name="pass" label="密码"&gt;&lt;/s:textarea&gt;</span><br><span class="line">	</span><br><span class="line">		&lt;s:textarea name="age" label="年龄"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">		&lt;s:textarea name="birth" label="生日"&gt;&lt;/s:textarea&gt;</span><br><span class="line">		&lt;s:submit value="注册"&gt;&lt;/s:submit&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="字段校验器配置风格"><a href="#字段校验器配置风格" class="headerlink" title="字段校验器配置风格"></a>字段校验器配置风格</h3><ul>
<li><p><code>Struts2</code>提供了两种方式来配置校验规则，字段校验风格和非字段校验风格。</p>
</li>
<li><p>字段校验风格是以字段为优先的配置方式</p>
</li>
<li><p>非字段校验风格是以校验器为优先的配置方式</p>
</li>
<li><p>字段校验器风格配置文件</p>
<blockquote>
<ul>
<li>&lt;field ../&gt;：校验规则文件的基本组成单位。</li>
<li>&lt;field-validator ../&gt;：指定一个校验规则。</li>
<li><param ..>：用于指定该校验器的参数。</li>
<li>&lt;message ../&gt;：确定失败后的提示信息。</li>
</ul>
</blockquote>
<h3 id="非字段校验配置风格"><a href="#非字段校验配置风格" class="headerlink" title="非字段校验配置风格"></a>非字段校验配置风格</h3></li>
<li><p>对于非字段校验配置风格，这是一种以校验器为优先的配置方式</p>
</li>
<li><p>文件格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定校验配置文件的dtd信息 --&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE validators PUBLIC</span></span><br><span class="line"><span class="meta">  		"-//Apache Struts//XWork Validator 1.0.3//EN"</span></span><br><span class="line"><span class="meta">  		"http://struts.apache.org/dtds/xwork-validator-1.0.3.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 校验文件根元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 非字段校验配置风格 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定必填字符串的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器name属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>name<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出name.required的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.required"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--使用该校验器校验name属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>name<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出name.regex的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.regex"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定必填字符串的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器pass属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>pass<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出pass.required的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.required"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--使用该校验器校验name属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>pass<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出pass.regex的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.regex"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定整数的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器name属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>age<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置指定整数的范围 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--  年纪必须在1到150之间的整数--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"age.range"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定整数的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"date"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器name属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>birth<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 下面指定日期字符串时，必须使用Locale的日期格式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2050-20-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 生日必须在$&#123;min&#125;到$&#123;max&#125;之间 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"birth.range"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>非字段校验器配置风格的配置文件</p>
<blockquote>
<ul>
<li>&lt;validator ../&gt;:定义一个校验规则</li>
<li>&lt;validator type=”” ../&gt;：用于指定校验器名称。</li>
<li><param ..> 功能与字段校验规则一样。</li>
<li><message>：功能与字段校验规则一样。</message></li>
<li><param fieldname ..>：用于指定需要被校验的`Action`的属性。
</li>
</ul>
</blockquote>
<h3 id="短路校验器"><a href="#短路校验器" class="headerlink" title="短路校验器"></a>短路校验器</h3></li>
<li><p><code>short-circuit</code>：在<code>&lt;field-validator ../&gt;</code>元素上添加该属性实现短路验证器。</p>
<h3 id="校验文件的搜索规则"><a href="#校验文件的搜索规则" class="headerlink" title="校验文件的搜索规则"></a>校验文件的搜索规则</h3></li>
<li><p>如果一个<code>Action</code>中可能包含多个处理逻辑，<code>Struts2</code>中允许为不同的处理逻辑提供不同的校验规则。</p>
</li>
<li><p>校验规则名字：<code>&lt;Action Name&gt; - &lt;ActionAliasName&gt; - validation.xml</code>；<code>ActionAliasName</code>为<code>struts.xml</code>配置文件Action的`name``值。</p>
</li>
<li><p>如果一个处理逻辑，例如登录请求处理逻辑，既有<code>LoginAction-volidator.xml</code>校验规则，又有<code>LoginAction-loginPro-volidator.xml</code>的校验规则，则该处理逻辑的校验规则为这两个校验规则的总和。</p>
</li>
<li><p>此处之外，还有另外一种情形：如果系统包含两个<code>Action</code>处理类：<code>BaseAction</code>和<code>RegisterAction</code>，<code>RegisterAction</code>继承了<code>BaseAction</code>,则<code>registerAction</code>的校验规则是<code>RegisterAction-validation.xml</code>和<code>BaseAction-validation.xml</code>这两个规则文件的总和。</p>
</li>
<li><p>假设系统中有两个<code>Action</code>：<code>BaseAction</code>和<code>RegisterAction</code>，则系统搜索规则文件的顺序如下：</p>
<blockquote>
<ul>
<li><code>BaseAction-validation.xml</code></li>
<li><code>BaseAction-别名-validation.xml</code></li>
<li><code>RegisterAction-validation.xml</code></li>
<li><code>RegisterAction-别名-validation.xml</code></li>
</ul>
</blockquote>
</li>
<li><p>如果上面的<code>RegisterAction</code>继承了<code>BaseAction</code>，那么<code>RegisterAction</code>的校验规则是上面四个校验规则文件的总和。</p>
</li>
<li><p>注意：<code>Struts2</code>校验规则文件是从上到下搜索的，实际用的校验规则是所有校验规则的总和。如果校验规则有冲突时，则后面文件中的校验规则取胜。</p>
<h3 id="校验顺序和短路"><a href="#校验顺序和短路" class="headerlink" title="校验顺序和短路"></a>校验顺序和短路</h3></li>
<li><p>校验器的执行顺序有如下原则：</p>
<blockquote>
<ul>
<li>所有非字段风格的校验器优先于字段风格的校验器。</li>
<li>所有的非字段风格的校验器，排在前面的会先执行。</li>
<li>所有的字段风格的校验器，排在前面的会先执行。</li>
</ul>
</blockquote>
</li>
<li><p>校验器短路的原则如下：</p>
<blockquote>
<ul>
<li>所有非字段校验器是最优先执行，如果某个非字段校验器校验失败了，则该字段上所有的校验器都不会获得校验的机会。</li>
<li>非字段校验器的校验失败，不会阻止其他非字段校验器的执行。</li>
<li>如果一个字段校验器校验失败后，则该字段下且排在该校验失败的校验器之后的其他校验器不会获得校验的机会。</li>
</ul>
</blockquote>
</li>
<li><p>如果应用中所需要的校验规则非常复杂，用户可以两个选择，开发自己的校验器，或者重写<code>Action</code>中的<code>validate</code>方法。</p>
<h3 id="内建校验器"><a href="#内建校验器" class="headerlink" title="内建校验器"></a>内建校验器</h3></li>
<li><p>注册一个校验器，通过一个<code>&lt;validator../&gt;</code>元素即可注册一个校验器，<code>name</code>属性指定校验器名称，<code>class</code>指定校验器的实现类。</p>
</li>
<li><p>如果开发者开发了一个自己的校验器，则可以通过添加一个<code>validators.xml</code>文件来注册校验器。</p>
</li>
<li><p>注意：如果<code>Struts2</code>系统在<code>src</code>路径下找到一个<code>validators.xml</code>文件，则不会加载系统默认的<code>default.xml</code>文件。如果开发者开发自己的校验器时，要把<code>default.xml</code>文件里的内容全部复制到<code>validators.xml</code>文件中。</p>
</li>
<li><p>必填校验器(<code>name=required</code>):要求指定的字段必须有值（非空）。</p>
<blockquote>
<ul>
<li>必填校验器可以接受如下参数：<blockquote>
<ul>
<li><code>fieldName</code>:该参数用于指定校验的<code>Action</code>属性名，如果采用字段校验器风格，则无需指定该参数</li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"required"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"required"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>必填字符串校验器（<code>requiredstring</code>）:该校验器要求字段值必须非空且长度大于0，即该字符串不能是””.<blockquote>
<ul>
<li>必填字符串校验器可以接受如下参数：<blockquote>
<ul>
<li>fieldName:该属性指定校验的<code>Action</code>属性名，如果采用字段校验器配置风格，则无须指定该属性</li>
<li>trim:是否在校验前截断被校验属性值前后的空白，该属性是可选的，默认为<code>true</code></li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格来配置必填字符串校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格来配置必填字符串校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>整数校验器（<code>int</code>）:整数校验器包括<code>int</code>、<code>short</code>、<code>long</code>，该校验器要求字段的整数值必须在指定的范围内.<blockquote>
<ul>
<li>该校验器可以接受如下参数:<blockquote>
<ul>
<li>fieldName:该属性指定校验的<code>Action</code>属性名，如果采用字段校验器配置风格，则无须指定该属性</li>
<li>min：指定该属性的最小值，该参数可选，如果没有指定，则不检查最小值。</li>
<li>max：指定该属性的最大值，该参数可选，如果没有指定，则不检查最大值。</li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格来配置整数校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>age<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格来配置整数校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>日期校验器（<code>date</code>）:，该校验器要求字段的日期值必须在指定的范围内.<blockquote>
<ul>
<li>该校验器可以接受如下参数:<blockquote>
<ul>
<li>fieldName:该属性指定校验的<code>Action</code>属性名，如果采用字段校验器配置风格，则无须指定该属性</li>
<li>min：指定该属性的最小值，该参数可选，如果没有指定，则不检查最小值。</li>
<li>max：指定该属性的最大值，该参数可选，如果没有指定，则不检查最大值。</li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格来配置日期校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>birth<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2020-02-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格来配置日期校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"birth"</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2020-02-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>表达式校验器（<code>expression</code>）：它是一个非字段校验器，不可在字段校验配置风格中使用。</li>
<li>字段表达式验证器（<code>fieldexpression</code>）：它要求指定字段满足一个逻辑表达式。</li>
<li>邮箱地址校验器（<code>email</code>）：它要求检查的字段如果不为空，则必须满足的邮箱地址。</li>
<li>网址校验器（<code>url</code>）：它要求被检查的字符如果非空，则必须满足合法的<code>url</code>地址。</li>
<li><code>Visitor</code>校验器：主要用于检测Action里的复合属性。</li>
<li>转换器校验（<code>conversion</code>）：主要用于被检验字段在类型转换过程中是否出现错误。</li>
<li>字符串长度校验器（<code>stringlength</code>）：它要求被校验字段的长度必须在指定范围内，否则校验失败。</li>
<li>正则表达式校验器（<code>regex</code>）：它用于检查被校验字符是否匹配一个正则表达式。<h3 id="基于注册的输入校验"><a href="#基于注册的输入校验" class="headerlink" title="基于注册的输入校验"></a>基于注册的输入校验</h3></li>
<li>案例实现：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterAction02</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//定义User类型的成员变量用于封装请求参数</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//使用注解指定必填，正则表达式两个校验器</span></span><br><span class="line">	<span class="meta">@RequiredStringValidator</span>(key=<span class="string">"name.required"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="meta">@RegexFieldValidator</span>(regex=<span class="string">"\\w&#123;4,25&#125;"</span>,key=<span class="string">"name.regex"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pass;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//使用注解指定必填，正则表达式两个校验器</span></span><br><span class="line">	<span class="meta">@RequiredStringValidator</span>(key=<span class="string">"pass.required"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="meta">@RegexFieldValidator</span>(regex=<span class="string">"\\w&#123;4,25&#125;"</span>,key=<span class="string">"pass.regex"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPass</span><span class="params">(String pass)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pass = pass;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@IntRangeFieldValidator</span>(message=<span class="string">""</span>,key=<span class="string">"age.range"</span>,min=<span class="string">"1"</span>,max=<span class="string">"150"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birth;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@DateRangeFieldValidator</span>(message=<span class="string">""</span>,key=<span class="string">"birth.range"</span>,min=<span class="string">"1900/01/01"</span>,max=<span class="string">"2050/02/21"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="手动完成输入校验"><a href="#手动完成输入校验" class="headerlink" title="手动完成输入校验"></a>手动完成输入校验</h3><ul>
<li>重写<code>validate()</code>方法</li>
<li>重写<code>validateXxx()</code>方法</li>
</ul>
<hr>
<h2 id="使用Struts2控制文件上传"><a href="#使用Struts2控制文件上传" class="headerlink" title="使用Struts2控制文件上传"></a>使用Struts2控制文件上传</h2><h3 id="Struts2的文件上传"><a href="#Struts2的文件上传" class="headerlink" title="Struts2的文件上传"></a><code>Struts2</code>的文件上传</h3><ul>
<li>实现步骤:<blockquote>
<ul>
<li>实现文件上传的<code>Action</code></li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:form action=<span class="string">"upload"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">		&lt;s:textfield name="title" label="文件标题"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:file name="upload" label="选择文件"&gt;&lt;/s:file&gt;</span><br><span class="line">		&lt;s:submit value="上传"&gt;&lt;/s:submit&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="comment">//封装文件标题请求参数的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String title;</span><br><span class="line">	<span class="comment">//封装上传文件域的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> File upload;</span><br><span class="line">	<span class="comment">//封装上传文件类型的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String uploadContentType;</span><br><span class="line">	<span class="comment">//封装上传文件名的属性</span></span><br><span class="line">	<span class="keyword">private</span> String uploadFileName;</span><br><span class="line">	<span class="comment">//直接在`struts.xml`文件中配置的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String savePath;</span><br><span class="line">	<span class="comment">//接收`struts.xml`文件配置值的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSavePath</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.savePath=value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//获取上传文件的保存位置</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSavePath</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ServletActionContext.getServletContext().getRealPath(savePath);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> title;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.title = title;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> File <span class="title">getUpload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> upload;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpload</span><span class="params">(File upload)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.upload = upload;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUploadContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> uploadContentType;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUploadContentType</span><span class="params">(String uploadContentType)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.uploadContentType = uploadContentType;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUploadFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> uploadFileName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUploadFileName</span><span class="params">(String uploadFileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.uploadFileName = uploadFileName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//以服务器的文件保存地址和原文件建立上传文件输出流</span></span><br><span class="line">		FileOutputStream fos=<span class="keyword">new</span> FileOutputStream(getSavePath()+<span class="string">"\\"</span>+getUploadFileName());</span><br><span class="line">		FileInputStream fis=<span class="keyword">new</span> FileInputStream(getUpload());</span><br><span class="line">		<span class="keyword">byte</span>[] buffer=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((len=fis.read(buffer))!=-<span class="number">1</span>) &#123;</span><br><span class="line">			fos.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">		&#125;</span><br><span class="line">		fos.flush();</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>配置文件上传的<code>Action</code></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"GBK"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置處理文件上傳的Action --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.UploadAction"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 動態設置Action的属性值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"savePath"</span>&gt;</span>/uploadFiles<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/succ.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="手动实现文件过滤"><a href="#手动实现文件过滤" class="headerlink" title="手动实现文件过滤"></a>手动实现文件过滤</h3><ul>
<li>如果需要手动实现文件过滤，可按如下步骤进行：<blockquote>
<ul>
<li>在Action中定义一个专门用于过滤文件的方法，该方法的方法名是任意的，该方法的逻辑就是判断上传文件的类型是否为允许类型。例如增加<code>filterTypes()</code>方法,方法代码如下：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">filterTypes</span><span class="params">(String[] types)</span> </span>&#123;</span><br><span class="line">    System.out.println(types);</span><br><span class="line">    <span class="comment">//获取允许上传的所有文件类型</span></span><br><span class="line">    String fileType=getUploadContentType();</span><br><span class="line">    <span class="keyword">for</span>(String type:types) &#123;</span><br><span class="line">        <span class="keyword">if</span>(type.equals(fileType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>上面的方法判断了上传文件的文件类型是否在允许上传的文件类型列表中。为了让程序可以动态设置允许上传的文件类型，为该action增加一个<code>allowTypes</code>属性，该属性的值列出了所有允许上传的文件类型。为了可以在<code>struts.xml</code>文件中配置<code>allowTypes</code>属性的值，必须在<code>Action</code>类中提供如下代码:</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义该action允许上传的文件类型</span></span><br><span class="line"><span class="keyword">private</span> String allowTypes;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAllowTypes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> allowTypes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAllowTypes</span><span class="params">(String allowTypes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.allowTypes = allowTypes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>利用<code>Struts2</code>的数据校验来判断用户输入的文件是否符合要求。如果不符合要求，接下来将错误提示信息添加到<code>FieldError</code>中。该<code>Action</code>中添加的<code>validate()</code>代码如下：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行输入校验</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将允许上传的文件类型的字符串以英文逗号(,)</span></span><br><span class="line">    <span class="comment">//分解成字符串数字从而判断当前文件类型是否允许上传</span></span><br><span class="line">    String filterResult=filterTypes(getAllowTypes().split(<span class="string">","</span>));</span><br><span class="line">    <span class="keyword">if</span>(filterResult!=<span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        addFieldError(<span class="string">"upload"</span>, <span class="string">"您要上传的文件类型不符合！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在Struts.xml配置文件的配置如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.UploadAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 動態設置Action的属性值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"savePath"</span>&gt;</span>/uploadFiles<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置允许上传的文件类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"allowTypes"</span>&gt;</span>image/png,image/gif<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/WEB-INF/content/uploadForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/succ.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>为了在页面显示错误提示信息，可以在该页面添加如下代码：</li>
</ul>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:fielderror/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="拦截器实现文件过滤"><a href="#拦截器实现文件过滤" class="headerlink" title="拦截器实现文件过滤"></a>拦截器实现文件过滤</h3><ul>
<li>配置文件如下：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.UploadAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置fileUpload拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"fileUpload"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置允许上传的文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"allowTypes"</span>&gt;</span>image/png,image/gif<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置允许上传的文件的大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"maximumSize"</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统默认的拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 動態設置Action的属性值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"savePath"</span>&gt;</span>/uploadFiles<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置允许上传的文件类型 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/WEB-INF/content/uploadForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/succ.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="输出错误提示信息"><a href="#输出错误提示信息" class="headerlink" title="输出错误提示信息"></a>输出错误提示信息</h3><ul>
<li>…<h3 id="文件上传的常量配置"><a href="#文件上传的常量配置" class="headerlink" title="文件上传的常量配置"></a>文件上传的常量配置</h3></li>
<li>…</li>
</ul>
<hr>
<h2 id="使用Struts2控制文件下载"><a href="#使用Struts2控制文件下载" class="headerlink" title="使用Struts2控制文件下载"></a>使用Struts2控制文件下载</h2><h3 id="实现文件下载的Action"><a href="#实现文件下载的Action" class="headerlink" title="实现文件下载的Action"></a>实现文件下载的<code>Action</code></h3><ul>
<li><p>实现文件下载的<code>Action</code>与普通的<code>Action</code>没有太大的区别，，仅仅需要提供一个返回<code>InputStream</code>流的方法，该输入流代表了被下载文件的入口。该<code>Action</code>类的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileDownloadAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="comment">//该成员变量可以在配置文件中动态指定该值</span></span><br><span class="line">	<span class="keyword">private</span> String inputPath;</span><br><span class="line">	<span class="comment">//inputName的setter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInputPath</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.inputPath = value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	定义一个返回InputStream的方法，</span></span><br><span class="line"><span class="comment">	该方法将作为被下载文件的入口，</span></span><br><span class="line"><span class="comment">	且需要配置stream类型结果时指定inputName参数，</span></span><br><span class="line"><span class="comment">	inputName参数的值就是方法去掉get前缀、首字母小写的字符串</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getTargetFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">// ServletContext提供getResourceAsStream()方法</span></span><br><span class="line">		<span class="comment">// 返回指定文件对应的输入流</span></span><br><span class="line">		<span class="keyword">return</span> ServletActionContext.getServletContext().getResourceAsStream(inputPath);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>一旦定义了该<code>Action</code>就可以实现文件下载。</p>
<h3 id="配置Action"><a href="#配置Action" class="headerlink" title="配置Action"></a>配置Action</h3></li>
<li><p>配置文件下载的<code>Action</code>与配置普通的<code>Action</code>并没有太大的不同，关键是要配置一个类型为<code>stream</code>的结果，该<code>Stream</code>的结果将使用文件下载作为响应。</p>
</li>
<li><p><code>Stream</code>结果类型的逻辑视图是返回客户端一个输入流，因此无需指定<code>location</code>属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"down"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.FileDownloadAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定被下载资源的位置 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputPath"</span>&gt;</span>/WEB-INF/img/56efbc0d6b66e.jpg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>image/jpg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定由getTargetFile()方法返回被下载文件的InputStream --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>targetFile<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载的文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>filename="demo.jpg"<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的缓冲大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"bufferSize"</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="下载前的权限控制"><a href="#下载前的权限控制" class="headerlink" title="下载前的权限控制"></a>下载前的权限控制</h3><blockquote>
<ul>
<li>案例</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorityDownAction</span> <span class="keyword">implements</span> <span class="title">Action</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String inputPath;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInputPath</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.inputPath=value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getTargetFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ServletActionContext.getServletContext().getResourceAsStream(inputPath);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得ActionContext实例</span></span><br><span class="line">		ActionContext ctx=ActionContext.getContext();</span><br><span class="line">		<span class="comment">//通过ActionContext访问用户的HttpSession</span></span><br><span class="line">		Map session=ctx.getSession();</span><br><span class="line">		String user=(String) session.get(<span class="string">"user"</span>);</span><br><span class="line">		<span class="comment">//判断Session里的user是否通过检查</span></span><br><span class="line">		<span class="keyword">if</span>(user!=<span class="keyword">null</span>&amp;&amp;user.equals(<span class="string">"crazyit.org"</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		ctx.put(<span class="string">"tip"</span>, <span class="string">"您还没有登录"</span>);</span><br><span class="line">		<span class="keyword">return</span> LOGIN;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"download2"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.AuthorityDownAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义被下载文件的物理资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputPath"</span>&gt;</span>/WEB-INF/images/wjc_logo.zip<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>application/zip<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定由getTargetFile()方法返回被下载文件的InputStream --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>targetFile<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>filename="wjc_logo.zip"<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的缓冲大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"bufferSize"</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义一个名为login的结果 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span>/WEB-INF/content/loginForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/struts2Down.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="详解Struts2的拦截器机制"><a href="#详解Struts2的拦截器机制" class="headerlink" title="详解Struts2的拦截器机制"></a>详解Struts2的拦截器机制</h2><h3 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h3><ul>
<li><p>定义拦截器使用<code>&lt;interceptor../&gt;</code>元素来定义，定义拦截器的简答的格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过指定拦截器名和拦截器实现类来定义拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"拦截器名"</span> <span class="attr">class</span>=<span class="string">"拦截器实现类"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果还需要在配置拦截器是传入拦截器参数，需要在<code>&lt;interceptor../&gt;</code>元素中使用<code>&lt;param ../&gt;</code>子元素即可。下面是它配置的简单格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过指定拦截器名和拦截器实现类来定义拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"拦截器名"</span> <span class="attr">class</span>=<span class="string">"拦截器实现类"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--下面的元素可以出现0次，或者是无限次--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--name属性指定参数名，中间值指定的该参数名对象的参数值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>还可以把多个拦截器连在一起组成拦截器栈，定于拦截器栈可以使用<code>&lt;interceptor-stack ../&gt;</code>元素，拦截器栈是由多个拦截器组成的，因此需要在该元素中使用<code>&lt;interceptor-ref ../&gt;</code>元素来定义多个拦截器引用，即该拦截器栈由多个<code>&lt;inteceptor-ref../&gt;</code>元素指定的拦截器组成。配置拦截器栈的语法格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈名"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器2"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>因为拦截器栈与拦截器在功能上完全统一，因此可能出现，拦截器里也可能包含其他拦截器栈。因此，可能出现如下配置片段：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器2"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器3"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>系统为拦截器指定参数有两种时机。</p>
<blockquote>
<ul>
<li>定义拦截器时指定参数值：这种参数值将作为拦截器参数的默认参数值。</li>
<li>使用拦截器时指定参数值：在配置Action时为拦截器参数指定值。</li>
</ul>
</blockquote>
</li>
<li><p>通过为<code>&lt;interceptor-ref&gt;</code>元素增加<code>&lt;param../&gt;</code>子元素，就可以在拦截器使用时为参数指定值。因此可能出现以下片段</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器2"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器3"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器的配置语法"><a href="#使用拦截器的配置语法" class="headerlink" title="使用拦截器的配置语法"></a>使用拦截器的配置语法</h3><ul>
<li>下面是在Action中定义拦截器的配置实例：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义全部拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义第一个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"lee.SimpleInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义第二个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"later"</span> <span class="attr">class</span>=<span class="string">"lee.LaterInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用系统默认的拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用第一个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用第二个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"later"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--为该Action指定拦截器参数，该参数会覆盖默认值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>动态参数<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="配置默认拦截器"><a href="#配置默认拦截器" class="headerlink" title="配置默认拦截器"></a>配置默认拦截器</h3><ul>
<li>配置默认拦截器使用<code>&lt;default-interceptor-ref&gt;</code>元素，该元素作为<code>package</code>的子元素,为该包下的所有<code>Action</code>配置默认拦截器。</li>
<li>下面配置默认拦截器的配置示例：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">namespace</span>=<span class="string">""</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义拦截器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义拦截器栈--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置该包下的默认拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器名或拦截器栈名"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">..</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器类"><a href="#使用拦截器类" class="headerlink" title="使用拦截器类"></a>使用拦截器类</h3><ul>
<li><p>如果用户想要开发自己的拦截器，需要实现<code>com.opensymphony.xwork2.interceptor.Interceptor</code>接口.</p>
</li>
<li><p>该接口的类定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Interceptor</span></span>&#123;</span><br><span class="line">    <span class="comment">//销毁该拦截器之前的回调方法</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//初始化该拦截器的回调方法</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//拦截器实现拦截的逻辑方法</span></span><br><span class="line">    <span class="function">String <span class="title">interceptor</span><span class="params">(ActionInvocation innovation)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>下面实现一个简单的拦截器示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//简单拦截器的名字</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">super</span>.init();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">super</span>.destroy();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得被拦截的Action实例</span></span><br><span class="line">		LoginAction action=(LoginAction) invocation.getAction();</span><br><span class="line">		<span class="comment">//打印开始执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"开始执行登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="comment">//取得开始执行Action的事件</span></span><br><span class="line">		<span class="keyword">long</span> start =System.currentTimeMillis();</span><br><span class="line">		<span class="comment">//执行该烂机器的最后一个拦截器</span></span><br><span class="line">		String result=invocation.invoke();</span><br><span class="line">		<span class="comment">//打印结束执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"介绍登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="keyword">long</span> end=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"执行时间"</span>+(end-start)+<span class="string">"ms"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器"><a href="#使用拦截器" class="headerlink" title="使用拦截器"></a>使用拦截器</h3><ul>
<li>使用拦截器需要两个步骤：<blockquote>
<ul>
<li>通过<code>&lt;interceptor&gt;</code>元素来定义拦截器</li>
<li>通过<code>&lt;interceptor-ref&gt;</code>元素来使用拦截器</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 应用所需的拦截器需要在该元素下配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.SimpleInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>简单拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/eeor.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统的默认拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>改名后的拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="拦截方法的拦截器"><a href="#拦截方法的拦截器" class="headerlink" title="拦截方法的拦截器"></a>拦截方法的拦截器</h3><ul>
<li>方法过滤的拦截器方法的示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 拦截器方法的拦截器，应该继承MethodFilterInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilterInterceptor</span> <span class="keyword">extends</span> <span class="title">MethodFilterInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//简单拦截器的名字</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> String <span class="title">doIntercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得被拦截的Action实例</span></span><br><span class="line">		LoginAction action=(LoginAction) invocation.getAction();</span><br><span class="line">		<span class="comment">//打印开始执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"开始执行登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="comment">//取得开始执行Action的事件</span></span><br><span class="line">		<span class="keyword">long</span> start =System.currentTimeMillis();</span><br><span class="line">		<span class="comment">//执行该烂机器的最后一个拦截器</span></span><br><span class="line">		String result=invocation.invoke();</span><br><span class="line">		<span class="comment">//打印结束执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"介绍登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="keyword">long</span> end=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"执行时间"</span>+(end-start)+<span class="string">"ms"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 应用所需的拦截器需要在该元素下配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.MyFilterInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>拦截器方法拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/eeor.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统的默认拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>改名后的拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定execute方法不需要被拦截 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"excludeMethods"</span>&gt;</span>execute<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>Struts2</code>中提供了方法过滤的拦截器有如下几个</p>
<blockquote>
<ul>
<li><code>TokenInterceptor</code>、<code>TokenSessionStoreInterceptor</code>、<code>DefaultWorkflowInterceptor</code>、<code>ValidationInterceptor</code></li>
</ul>
</blockquote>
<h3 id="拦截器的执行顺序"><a href="#拦截器的执行顺序" class="headerlink" title="拦截器的执行顺序"></a>拦截器的执行顺序</h3></li>
<li><p>在<code>Action</code>的控制方法执行之前，位于拦截器链前面的拦截器将先发生作用，在<code>Action</code>控制方法执行之后，为于拦截器链前面的拦截器将后发生作用。</p>
<h3 id="拦截结果的监听器"><a href="#拦截结果的监听器" class="headerlink" title="拦截结果的监听器"></a>拦截结果的监听器</h3></li>
<li><p>拦截结果的监听器代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPreResultListener</span> <span class="keyword">implements</span> <span class="title">PreResultListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//定义在处理result之前的行为。</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeResult</span><span class="params">(ActionInvocation invocation, String resultCode)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//打印出执行结果</span></span><br><span class="line">		System.out.println(<span class="string">"返回的逻辑视图名："</span>+resultCode);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在拦截器中手动注册拦截结果监听器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeResultInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//将一个拦截结果的监听器注册给该监听器</span></span><br><span class="line">		invocation.addPreResultListener(<span class="keyword">new</span> MyPreResultListener());</span><br><span class="line">		System.out.println(<span class="string">"execute方法执行之前的拦截..."</span>);</span><br><span class="line">		String result=invocation.invoke();</span><br><span class="line">		System.out.println(<span class="string">"execute方法执行之后拦截..."</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>值得注意的是，虽然<code>beforeResule()</code>方法中也可获得<code>ActionInvocation</code>实例，但千万不可通过该实例再次调用<code>invoke()</code>方法，如果再次调用<code>invoke()</code>方法，将会再次执行<code>Action</code>处理，<code>Action</code>处理后紧跟<code>beforeResule()</code>方法……这样会陷入死循环。</p>
<h3 id="覆盖拦截器栈里特定拦截器的参数"><a href="#覆盖拦截器栈里特定拦截器的参数" class="headerlink" title="覆盖拦截器栈里特定拦截器的参数"></a>覆盖拦截器栈里特定拦截器的参数</h3></li>
<li><p>如果需要覆盖拦截器栈里特定拦截器的参数，则在定义<code>&lt;param&gt;</code>元素的<code>name</code>属性时使用：<code>&lt;拦截器名&gt;.&lt;参数名&gt;</code></p>
</li>
<li><p>代码示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.BeforeResultInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>简单拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"second"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.SecondInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>第一个<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"second"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>第二个<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/eeor.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统的默认拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 覆盖指定拦截器的指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"second.name"</span>&gt;</span>改名后的拦截结果监听器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器完成权限控制"><a href="#使用拦截器完成权限控制" class="headerlink" title="使用拦截器完成权限控制"></a>使用拦截器完成权限控制</h3><ul>
<li>登录权限案例实现:</li>
</ul>
<ol>
<li><p>拦截代码的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//权限检查拦截器继承 AbstractInterceptor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorityInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//拦截Action处理的拦截方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得请求相关的ActionContext实例</span></span><br><span class="line">		ActionContext ctx=invocation.getInvocationContext();</span><br><span class="line">		Map session=ctx.getSession();</span><br><span class="line">		<span class="comment">//取出session里的user属性</span></span><br><span class="line">		String user=(String) session.get(<span class="string">"user"</span>);</span><br><span class="line">		<span class="comment">//如果没有登录，或者登录的用户名不是crazyit.org，都返回登录</span></span><br><span class="line">		<span class="keyword">if</span>(user!=<span class="keyword">null</span> &amp;&amp; user.equals(<span class="string">"crazyit.org"</span>)) &#123;</span><br><span class="line">			invocation.invoke();</span><br><span class="line">		&#125;</span><br><span class="line">		ctx.put(<span class="string">"tip"</span>,<span class="string">"您还没有登录"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件中进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用户拦截器定义在该元素下 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义了一个名为authority的拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"authority"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.AuthorityInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 定义全局Result --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当返回login视图名时，转入loginForm.jsp页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span>/WEB-INF/content/loginForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content//error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 定义一个名为viewBook的Action，其实现类为ActionSupport --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"viewBook"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 返回success视图名时，转入viewBook.jsp页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/viewBook.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 应用自定义拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"authority"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="使用Struts2的ajax支持"><a href="#使用Struts2的ajax支持" class="headerlink" title="使用Struts2的ajax支持"></a>使用Struts2的ajax支持</h2><h3 id="使用Stream类型的Result实现Ajax"><a href="#使用Stream类型的Result实现Ajax" class="headerlink" title="使用Stream类型的Result实现Ajax"></a>使用Stream类型的Result实现Ajax</h3><ul>
<li>案例实现<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;使用JSON插件&lt;/title&gt;</span><br><span class="line">&lt;script type="text/javascript" src="$&#123;pageContext.request.contextPath&#125;/jquery-3.2.1.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form id=<span class="string">"loginForm"</span>&gt;</span><br><span class="line">		&lt;s:textfield name="user" label="用户名"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:textfield name="pass" label="密码"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td colspan=<span class="string">"2"</span>&gt;</span><br><span class="line">				&lt;input id=<span class="string">"loginBn"</span> type=<span class="string">"button"</span> value=<span class="string">"提交"</span>/&gt;	</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">	&lt;div id="show" style="display:none"&gt;&lt;/div&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		$(<span class="string">"#loginBn"</span>).click(function()&#123;</span><br><span class="line"></span><br><span class="line">			$.get(<span class="string">"login"</span>,$(<span class="string">"#loginForm"</span>).serializeArray(),</span><br><span class="line">				function(data,statusText)&#123;</span><br><span class="line">					</span><br><span class="line">					$(<span class="string">"#show"</span>).height(<span class="number">80</span>)</span><br><span class="line">							.width(<span class="number">230</span>)</span><br><span class="line">							.css(<span class="string">"border"</span>,<span class="string">"1px solid black"</span>)</span><br><span class="line">							.css(<span class="string">"border-radius"</span>,<span class="string">"15px"</span>)</span><br><span class="line">							.css(<span class="string">"background-color"</span>,<span class="string">"#efef99"</span>)</span><br><span class="line">							.css(<span class="string">"color"</span>,<span class="string">"#ff0000"</span>)</span><br><span class="line">							.css(<span class="string">"padding"</span>,<span class="string">"20px"</span>)</span><br><span class="line">							.empty();</span><br><span class="line">					$(<span class="string">"#show"</span>).append(<span class="string">"登录结果："</span>+data+<span class="string">"&lt;br/&gt;"</span>);</span><br><span class="line">					$(<span class="string">"#show"</span>).show(<span class="number">600</span>);</span><br><span class="line">				&#125;,<span class="string">"html"</span>		</span><br><span class="line">			)</span><br><span class="line">		&#125;)</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">implements</span> <span class="title">Action</span></span>&#123;</span><br><span class="line">	<span class="comment">//封装请求参数的两个成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="comment">//封装输出结果二进制流</span></span><br><span class="line">	<span class="keyword">private</span> InputStream inputStream;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.inputStream;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//此处省略了setter和getter</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//判断用户名和密码，生成响应</span></span><br><span class="line">		inputStream=(getUser().equals(<span class="string">"crazyit.org"</span>) &amp;&amp; getPass().equals(<span class="string">"leegang"</span>))?</span><br><span class="line">				<span class="keyword">new</span> ByteArrayInputStream(<span class="string">"恭喜你！登录成功"</span>.getBytes(<span class="string">"UTF-8"</span>)):<span class="keyword">new</span> ByteArrayInputStream(<span class="string">"对不起，用户名，密码不匹配。"</span>.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定stream生成的响应数据的类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定由getResult()返回输出结果的InputStream --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>result<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>除此之外，<code>Strust2</code>还提供了一个<code>JSON</code>插件，通过该插件可以更简单的完成<code>Ajax</code>。</p>
<h3 id="JSON的基本知识"><a href="#JSON的基本知识" class="headerlink" title="JSON的基本知识"></a>JSON的基本知识</h3></li>
<li><p>JSON主要有如下两种格式：</p>
<blockquote>
<ul>
<li>key-value</li>
<li>有序集合</li>
</ul>
</blockquote>
</li>
<li><p>在Javascript中主要有两种JSON语法，一种用于创建对象，另一种用于创建数组。</p>
</li>
<li><p>使用JSON语法创建对象</p>
<blockquote>
<ul>
<li>语法格式如下：</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object=&#123;</span><br><span class="line">    propertyName1:propertyValue1,</span><br><span class="line">    propertyName2:propertyValue2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,sex</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name=name;</span><br><span class="line">    <span class="keyword">this</span>.sex=sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p=<span class="keyword">new</span> Person(<span class="string">"kk"</span>,<span class="string">"man"</span>);</span><br><span class="line">alert(p.name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2=&#123;<span class="string">"name"</span>:<span class="string">"yeeku"</span>,<span class="string">"age"</span>:<span class="number">12</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(p2.age)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p3=&#123;</span><br><span class="line">    name:<span class="string">"yeeku"</span>,</span><br><span class="line">    sex:<span class="string">"man"</span>,</span><br><span class="line">    son:&#123;</span><br><span class="line">        name:<span class="string">'nono'</span>,</span><br><span class="line">        grade:<span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    info:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"姓名："</span>+<span class="keyword">this</span>.son.name+<span class="string">" 年龄："</span>+<span class="keyword">this</span>.son.grade)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">p3.info();</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用JSON语法创建数组</p>
<blockquote>
<ul>
<li>使用教程如下</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建数组 方式1</span></span><br><span class="line"><span class="keyword">var</span> a=<span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">a[<span class="number">0</span>]=<span class="string">'yeeku'</span>;</span><br><span class="line">a[<span class="number">1</span>]=<span class="string">'man'</span>;</span><br><span class="line">alert(a[<span class="number">0</span>])</span><br><span class="line"><span class="comment">//创建数组 方式2</span></span><br><span class="line"><span class="keyword">var</span> b=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">"yeeku"</span>,<span class="string">"man"</span>);</span><br><span class="line">alert(b[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">//创建数组 方式3</span></span><br><span class="line"><span class="keyword">var</span> c=[<span class="string">'yeeu'</span>,<span class="string">'name'</span>];</span><br><span class="line">alert(c[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>使用JSON创建数组的语法格式:<code>arr=[value1,value2]</code></li>
</ul>
</blockquote>
<h3 id="实现Action逻辑"><a href="#实现Action逻辑" class="headerlink" title="实现Action逻辑"></a>实现Action逻辑</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.json.annotations.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONExample</span> </span>&#123;</span><br><span class="line">	<span class="comment">//模拟处理结果的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>[] ints= &#123;<span class="number">10</span>,<span class="number">20</span>&#125;;</span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,String&gt; map=<span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">	<span class="keyword">private</span> String customName=<span class="string">"顾客"</span>;</span><br><span class="line">	<span class="comment">//封装请求参数的三个成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String field1;</span><br><span class="line">	<span class="comment">//`transient`修饰的成员变量不会被序列化</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">transient</span> String field2;</span><br><span class="line">	<span class="comment">//没有getter和setter方法的成员变量不会被序列化</span></span><br><span class="line">	<span class="keyword">private</span> String field3;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span></span>&#123;</span><br><span class="line">		map.put(<span class="string">"name"</span>, <span class="string">"疯狂Java讲义"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//使用注解来改变该成员变量序列化后的名字</span></span><br><span class="line">	<span class="meta">@JSON</span>(name=<span class="string">"newName"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map <span class="title">getMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.map;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// customName的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomName</span><span class="params">(String customName)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.customName = customName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCustomName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.customName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// field1的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setField1</span><span class="params">(String field1)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.field1 = field1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getField1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.field1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// field2的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setField2</span><span class="params">(String field2)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.field2 = field2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getField2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.field2;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// field3的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setField3</span><span class="params">(String field3)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.field3 = field3;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getField3</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.field3;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JSON插件与json类型的Result"><a href="#JSON插件与json类型的Result" class="headerlink" title="JSON插件与json类型的Result"></a>JSON插件与json类型的Result</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"JSONExample"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.JSONExample"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"json"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置类型的json的Result --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为该Result指定参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"noCache"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置只序列Action的map属性 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  param name="root"&gt;map&lt;/param --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现JSP页面"><a href="#实现JSP页面" class="headerlink" title="实现JSP页面"></a>实现JSP页面</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;使用JSON插件&lt;/title&gt;</span><br><span class="line">&lt;script type="text/javascript" src="$&#123;pageContext.request.contextPath&#125;/jquery-3.2.1.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form id=<span class="string">"form1"</span>&gt;</span><br><span class="line">		&lt;s:textfield name=<span class="string">"field1"</span> label=<span class="string">"Field 1"</span>/&gt;</span><br><span class="line">		&lt;s:textfield name=<span class="string">"field2"</span> label=<span class="string">"Field 2"</span>/&gt;</span><br><span class="line">		&lt;s:textfield name=<span class="string">"field3"</span> label=<span class="string">"Field 3"</span>/&gt;</span><br><span class="line">		&lt;tr&gt;&lt;td colspan=<span class="string">"2"</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">"button"</span> value=<span class="string">"提交"</span> onclick=<span class="string">"gotClick();"</span>/&gt;</span><br><span class="line">		&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">	&lt;div id="show"&gt;&lt;/div&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="function">function <span class="title">gotClick</span><span class="params">()</span></span>&#123;</span><br><span class="line">			console.log(<span class="number">1</span>)</span><br><span class="line">			$(<span class="string">"#show"</span>).hide();</span><br><span class="line">			<span class="comment">// 指定向JSONExample发送请求，将id为form1的表单所包含的表单控件转换为请求参数</span></span><br><span class="line">			$.post(<span class="string">"JSONExample"</span> , $(<span class="string">"#form1"</span>).serializeArray() , </span><br><span class="line">				<span class="comment">// 指定回调函数</span></span><br><span class="line">				function(data , statusText)</span><br><span class="line">				&#123;</span><br><span class="line">					console.log(data)</span><br><span class="line">					console.log(statusText)</span><br><span class="line">					$(<span class="string">"#show"</span>).height(<span class="number">120</span>)</span><br><span class="line">						.width(<span class="number">340</span>)</span><br><span class="line">						.css(<span class="string">"border"</span> , <span class="string">"1px solid black"</span>)</span><br><span class="line">						.css(<span class="string">"border-radius"</span> , <span class="string">"15px"</span>)</span><br><span class="line">						.css(<span class="string">"background-color"</span> , <span class="string">"#efef99"</span>)</span><br><span class="line">						.css(<span class="string">"color"</span> , <span class="string">"#ff0000"</span>)</span><br><span class="line">						.css(<span class="string">"padding"</span> , <span class="string">"20px"</span>)</span><br><span class="line">						.empty();</span><br><span class="line">					<span class="comment">// 遍历JavaScript对象的各属性</span></span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">var</span> propName in data)</span><br><span class="line">					&#123;</span><br><span class="line">					</span><br><span class="line">						$(<span class="string">"#show"</span>).append(propName + <span class="string">"--&gt;"</span></span><br><span class="line">							+ data[propName] + <span class="string">"&lt;br /&gt;"</span>);</span><br><span class="line">					&#125;</span><br><span class="line">					$(<span class="string">"#show"</span>).show(<span class="number">600</span>);</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="comment">// 指定服务器响应为JSON数据</span></span><br><span class="line">				<span class="string">"json"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Java邮箱接口" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/09/25/Java邮箱接口/" class="article-date">
  	<time datetime="2019-09-25T07:52:14.000Z" itemprop="datePublished">2019-09-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/09/25/Java邮箱接口/">
        Java邮箱接口
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="邮箱的相关标准"><a href="#邮箱的相关标准" class="headerlink" title="邮箱的相关标准"></a>邮箱的相关标准</h2><ol>
<li>常见的邮件协议<blockquote>
<ul>
<li>SMTP（Simple Mail Transfer Protocol）：即简单邮箱传输协议，它是一组用于源地址到目的地址传送邮件的规则，由它来控制信息的中转方式。</li>
<li>POP3（Post Office Protocol - Version 3）: 即邮局协议版本 3，用于接收电子邮件的标准协议。</li>
<li></li>
</ul>
</blockquote>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Struts2-5" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/09/17/Struts2-5/" class="article-date">
  	<time datetime="2019-09-17T08:17:50.000Z" itemprop="datePublished">2019-09-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/09/17/Struts2-5/">
        Struts2.5
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Struts2的下载和安装"><a href="#Struts2的下载和安装" class="headerlink" title="Struts2的下载和安装"></a>Struts2的下载和安装</h2><hr>
<h3 id="为Web应用增加的Struts支持"><a href="#为Web应用增加的Struts支持" class="headerlink" title="为Web应用增加的Struts支持"></a>为<code>Web</code>应用增加的<code>Struts</code>支持</h3><ul>
<li>下载和安装Struts2的步骤如下:</li>
</ul>
<ol>
<li><p>登录<code>https://struts.apache.org/download.cgi#struts2520</code>站点，下载Struts2的最新包2.5.20。 </p>
</li>
<li><p>进入<code>Struts2</code>的解压目录的<code>lib</code>目录下，将一些相关的<code>jar</code>包导入到<code>Web</code>用于的<code>/web-inf/lib</code>路径下。<br><img src="https://i.loli.net/2019/09/19/LfxoSuNEtpTCB1q.png" alt="1568710052_1_.png"></p>
</li>
<li><p>编写<code>Web</code>应用的<code>web.xml</code>配置文件，配置<code>Struts2</code>的核心<code>Filter</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Struts_studyByBook01<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 定义Struts2的核心Filter --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 让Strut2 的核心标签库Filter拦截所有的请求 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将<code>Struts2</code>解压目录下的<code>apps</code>目录下的<code>struts2-rest-showcase.war</code>压缩包的<code>struts.xml</code>配置文件复制到<code>web</code>应用的<code>src</code>目录下。并将该配置文件修改为如下格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  Overwrite Convention --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Uncomment the lines below to use Jackson XML bindings instead of the XStream library to handle XML serialisations --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"crazyit"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h3 id="在Eclipse使用Struts2"><a href="#在Eclipse使用Struts2" class="headerlink" title="在Eclipse使用Struts2"></a>在<code>Eclipse</code>使用<code>Struts2</code></h3><ol>
<li>首先创建一个<code>Dynamic Web Project</code>,也就是创建一个动态<code>web</code>项目。</li>
<li>在项目的<code>/webcontent/WEB-INF/lib</code>导入一些响相应的<code>jar</code>包。类型参考上面第2点。</li>
<li>打开<code>/webcontent/WEB-INF/web.xml</code>，编译该文件，并在其中定义<code>Struts2</code>核心的<code>Filter</code>。</li>
<li>在项目的<code>src</code>目录下定义一个<code>struts.xml</code>配置文件，其内容参考上面第四点。</li>
<li>至此，该<code>Web</code>应用完全具备了<code>Struts2</code>框架的支持。</li>
</ol>
<hr>
<h3 id="增加登录处理"><a href="#增加登录处理" class="headerlink" title="增加登录处理"></a>增加登录处理</h3><ol>
<li><p>创建一个<code>Strut2Demo</code>的动态<code>web</code>项目，并且按上面的步骤依次导入相关的<code>jar</code>包、配置<code>web.xml</code>、配置<code>struts.xml</code>。 </p>
</li>
<li><p>在<code>/webcontent/WEB-INF/content/</code>下添加一个名为<code>loginForm</code>的<code>JSP</code>页面,该页面的代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;&lt;s:text name="loginPage"&gt;&lt;/s:text&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form action=<span class="string">"login"</span>&gt;</span><br><span class="line">		&lt;s:textfield name="username" key="user"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:textfield name="password" key="pass"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:submit key="login"&gt;&lt;/s:submit&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>除此之外，还要添加一个<code>welcome.jsp</code>和<code>error.jsp</code>作为登录成功，登录失败的提示页面，它们的代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;&lt;s:text name="succPage"/&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!--成功界面--&gt;</span><br><span class="line">	&lt;s:text name=<span class="string">"succTip"</span>&gt;</span><br><span class="line">		&lt;s:param&gt;$&#123;sessionScope.user&#125;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:text&gt;&lt;br/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt; </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;&lt;s:text name="errorPage"/&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!--失败界面--&gt;</span><br><span class="line">	&lt;s:text name=<span class="string">"failTip"</span>/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>配置<code>Struts.xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  Overwrite Convention --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定全局国际化资源文件 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.custom.i18n.resources"</span> <span class="attr">value</span>=<span class="string">"mess"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Uncomment the lines below to use Jackson XML bindings instead of the XStream library to handle XML serialisations --&gt;</span></span><br><span class="line">   	<span class="comment">&lt;!-- 所有的Action定义都应方法package包下 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"loginForm"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>由于上面已经指定了国际化资源，所以在<code>src</code>目录还应该提供一个名为<code>mess_zh_CN.properties</code>的文件，其内容为：</p>
<blockquote>
<ul>
<li>loginPage=登录页面</li>
<li>errorPage=错误页面</li>
<li>succPage=成功页面</li>
<li>failTip=对不起，您不能登录！</li>
<li>succTip=欢迎，{0}，您已经登录！</li>
<li>user=用户名</li>
<li>pass=密码</li>
<li>login=登录</li>
</ul>
</blockquote>
</li>
<li><p>把项目部署到<code>Tomcat</code>服务器，并在浏览器的地址栏上输入 <code>http://localhost:8080/Strust2Demo/LoginForm</code>，将会看到登录界面。</p>
</li>
<li><p>在<code>Eclipse</code>工具创建一个<code>Java</code>类，该Java类的类名为<code>LoginAction</code>，代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//定义封装请求参数的username和password成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//定义处理用户请求的execute方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(getUsername() + <span class="string">"--&gt;"</span> + getPassword());</span><br><span class="line">		<span class="comment">//当username为crazyit.org,password为leegang时即登录成功</span></span><br><span class="line">		<span class="keyword">if</span>(getUsername().equals(<span class="string">"crazyit.org"</span>) &amp;&amp; getPassword().equals(<span class="string">"leegang"</span>)) &#123;</span><br><span class="line">			<span class="comment">//采用解耦的方法获取session对象</span></span><br><span class="line">			ActionContext.getContext().getSession().put(<span class="string">"user"</span>,getUsername());</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>struts.xml</code>中添加一个<code>name=&quot;login&quot;&lt;action.../&gt;</code>代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义三个逻辑视图和物理资源之间进行映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>至此，整个<code>Struts2</code>的应用已经创建完成，再次重启服务器，然后先访问<code>loginForm</code>，并在该页面输入用户名和密码进行登录，如果为<code>crazyit.org</code>、<code>leegang</code>，则跳转到<code>welcome.jsp</code>页面，否则则跳转到<code>error.jsp</code>。</p>
</li>
</ol>
<hr>
<h2 id="Struts2的流程"><a href="#Struts2的流程" class="headerlink" title="Struts2的流程"></a><code>Struts2</code>的流程</h2><hr>
<h3 id="Struts2应用的开发步骤"><a href="#Struts2应用的开发步骤" class="headerlink" title="Struts2应用的开发步骤"></a>Struts2应用的开发步骤</h3><ol>
<li>在<code>web.xml</code>文件中定义核心的<code>Filter</code>来拦截用户请求。</li>
<li>如果需要以<code>POST</code>的方式提交请求，则定义包含表单数据的<code>JSP</code>页面。如果仅仅是以<code>GET</code>方法发送请求，则无需通过这一步。</li>
<li>定义处理用户请求的<code>Action</code>类。</li>
<li>配置<code>Action</code></li>
<li>配置处理结果和物理视图资源之间的对应关系。</li>
<li>编写视图资源。如果<code>Action</code>需要将一些数据传给视图资源，则可以借助于<code>OGNL</code>表达式。</li>
</ol>
<ul>
<li>经过上面6个步骤，基本完成一个<code>Struts2</code>的处理流程的开发，也就是可以执行一次完整的<code>请求--&gt;响应</code>过程。</li>
</ul>
<hr>
<h3 id="Struts2的运行流程"><a href="#Struts2的运行流程" class="headerlink" title="Struts2的运行流程"></a>Struts2的运行流程</h3><hr>
<h2 id="Struts2的常规配置"><a href="#Struts2的常规配置" class="headerlink" title="Struts2的常规配置"></a>Struts2的常规配置</h2><ul>
<li>虽然<code>Struts2</code>提供了<code>Convention</code>插件来管理<code>Action</code>，结果映射，但对于大部分实际开发来说还会考虑使用<code>XML</code>配置文件来管理<code>Struts2</code>的配置信息。</li>
<li><code>Struts2</code>的默认配置文件名为<code>struts.xml</code>，该文件放在<code>web</code>应用的类加载器路径下，通常就是方法<code>WEB-INF/classes</code>路径下。</li>
<li><code>struts.xml</code>配置文件的最大作用就是配置<code>Action</code>与请求之间的对应关系，并配置逻辑视图名与物理视图资源的对应关系，除此之外，<code>struts.xml</code>文件还有一些额外的配置，例如<code>Bean</code>配置，配置常量以及导入其他配置文件等。</li>
</ul>
<hr>
<h3 id="常量配置"><a href="#常量配置" class="headerlink" title="常量配置"></a>常量配置</h3><ul>
<li><p><code>Strut2</code>还提供了<code>struts.properties</code>文件来管理常量</p>
</li>
<li><p><code>struts.properties</code>是一个标准的<code>properties</code>文件，该文件包含了系列<code>key-value</code>，每个<code>key</code>对应一个<code>Struts2</code>常量，该<code>key</code>对应的<code>value</code>值就是一个<code>Struts2</code>常量值。</p>
</li>
<li><p><code>Struts2</code>配置常量总共有三种方式：</p>
<ul>
<li>通过<code>struts.properties</code>文件</li>
<li>通过<code>struts.xml</code>文件</li>
<li>通过<code>web.xml</code>文件</li>
</ul>
</li>
<li><p>如下<code>struts.xml</code>配置片段在<code>struts.xml</code>文件中配置一个常量，该常量即可代替<code>struts.properties</code>文件中<code>struts2</code>配置属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.5.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  Overwrite Convention --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定全局国际化资源文件 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.custom.i18n.resources"</span> <span class="attr">value</span>=<span class="string">"mess"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Uncomment the lines below to use Jackson XML bindings instead of the XStream library to handle XML serialisations --&gt;</span></span><br><span class="line">   	<span class="comment">&lt;!-- 所有的Action定义都应方法package包下 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"loginForm"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">        	<span class="comment">&lt;!-- 定义三个逻辑视图和物理资源之间进行映射 --&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>web.xml</code>配置文件中配置常量</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>struts.custom.i18n.resources<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>mess<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 让Strut2 的核心标签库Filter拦截所有的请求 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="包含其他配置文件"><a href="#包含其他配置文件" class="headerlink" title="包含其他配置文件"></a>包含其他配置文件</h3><ul>
<li><p>下面的<code>struts.xml</code>文件就通过<code>&lt;include ../&gt;</code>手动导入一个配置文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"struts-part1.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>被包含的配置文件应该也包含<code>dtd</code>信息和<code>struts</code>根元素等信息，且该配置文件也应该放在<code>WEB-INF/classes/</code>路径下。</p>
</li>
</ul>
<hr>
<h2 id="实现Action"><a href="#实现Action" class="headerlink" title="实现Action"></a>实现Action</h2><ul>
<li><p><code>Action</code>类默认处理用户请求的方法：<code>execute</code>方法。</p>
<h3 id="Action接口和ActionSupport基类"><a href="#Action接口和ActionSupport基类" class="headerlink" title="Action接口和ActionSupport基类"></a><code>Action</code>接口和<code>ActionSupport</code>基类</h3></li>
<li><p>下面是一个标准的<code>Action</code>接口代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.opensymphony.xwork2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Action</span> </span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"success"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NONE = <span class="string">"none"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ERROR = <span class="string">"error"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INPUT = <span class="string">"input"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOGIN = <span class="string">"login"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>下面是<code>ActionSupport</code>实现类的片段代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment"> * distributed with this work for additional information</span></span><br><span class="line"><span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment"> * to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment"> * "License"); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment"> * with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment"> * software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment"> * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment"> * KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment"> * specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment"> * under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> com.opensymphony.xwork2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.inject.Container;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.inject.Inject;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.ValidationAware;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.StrutsConstants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Provides a default implementation for the most common actions.</span></span><br><span class="line"><span class="comment"> * See the documentation for all the interfaces this class implements for more detailed information.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">Action</span>, <span class="title">Validateable</span>, <span class="title">ValidationAware</span>, <span class="title">TextProvider</span>, <span class="title">LocaleProvider</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LogManager.getLogger(ActionSupport.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ValidationAwareSupport validationAware = <span class="keyword">new</span> ValidationAwareSupport();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> TextProvider textProvider;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> LocaleProvider localeProvider;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Container container;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActionErrors</span><span class="params">(Collection&lt;String&gt; errorMessages)</span> </span>&#123;</span><br><span class="line">        validationAware.setActionErrors(errorMessages);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;String&gt; <span class="title">getActionErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> validationAware.getActionErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActionMessages</span><span class="params">(Collection&lt;String&gt; messages)</span> </span>&#123;</span><br><span class="line">        validationAware.setActionMessages(messages);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;String&gt; <span class="title">getActionMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> validationAware.getActionMessages();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFieldErrors</span><span class="params">(Map&lt;String, List&lt;String&gt;&gt; errorMap)</span> </span>&#123;</span><br><span class="line">        validationAware.setFieldErrors(errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, List&lt;String&gt;&gt; getFieldErrors() &#123;</span><br><span class="line">        <span class="keyword">return</span> validationAware.getFieldErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">getLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getLocaleProvider().getLocale();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidLocaleString</span><span class="params">(String localeStr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getLocaleProvider().isValidLocaleString(localeStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidLocale</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getLocaleProvider().isValidLocale(locale);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String aTextName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(aTextName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String aTextName, String defaultValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(aTextName, defaultValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String aTextName, String defaultValue, String obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(aTextName, defaultValue, obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String aTextName, List&lt;?&gt; args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(aTextName, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String key, String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(key, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String aTextName, String defaultValue, List&lt;?&gt; args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(aTextName, defaultValue, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String key, String defaultValue, String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(key, defaultValue, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String key, String defaultValue, List&lt;?&gt; args, ValueStack stack)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(key, defaultValue, args, stack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">(String key, String defaultValue, String[] args, ValueStack stack)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getText(key, defaultValue, args, stack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Dedicated method to support I10N and conversion errors</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key message which contains formatting string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expr that should be formatted</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> formatted expr with format specified by key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFormatted</span><span class="params">(String key, String expr)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; conversionErrors = ActionContext.getContext().getConversionErrors();</span><br><span class="line">        <span class="keyword">if</span> (conversionErrors.containsKey(expr)) &#123;</span><br><span class="line">            String[] vals = (String[]) conversionErrors.get(expr);</span><br><span class="line">            <span class="keyword">return</span> vals[<span class="number">0</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> ValueStack valueStack = ActionContext.getContext().getValueStack();</span><br><span class="line">            <span class="keyword">final</span> Object val = valueStack.findValue(expr);</span><br><span class="line">            <span class="keyword">return</span> getText(key, Arrays.asList(val));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResourceBundle <span class="title">getTexts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getTexts();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResourceBundle <span class="title">getTexts</span><span class="params">(String aBundleName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getTextProvider().getTexts(aBundleName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addActionError</span><span class="params">(String anErrorMessage)</span> </span>&#123;</span><br><span class="line">        validationAware.addActionError(anErrorMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addActionMessage</span><span class="params">(String aMessage)</span> </span>&#123;</span><br><span class="line">        validationAware.addActionMessage(aMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFieldError</span><span class="params">(String fieldName, String errorMessage)</span> </span>&#123;</span><br><span class="line">        validationAware.addFieldError(fieldName, errorMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">input</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INPUT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A default implementation that does nothing an returns "success".</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Subclasses should override this method to provide their business logic.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * See also &#123;<span class="doctag">@link</span> com.opensymphony.xwork2.Action#execute()&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> returns &#123;<span class="doctag">@link</span> #SUCCESS&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception can be thrown by subclasses.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasActionErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> validationAware.hasActionErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasActionMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> validationAware.hasActionMessages();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> validationAware.hasErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasFieldErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> validationAware.hasFieldErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Clears field errors. Useful for Continuations and other situations</span></span><br><span class="line"><span class="comment">     * where you might want to clear parts of the state on the same action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearFieldErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        validationAware.clearFieldErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Clears action errors. Useful for Continuations and other situations</span></span><br><span class="line"><span class="comment">     * where you might want to clear parts of the state on the same action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearActionErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        validationAware.clearActionErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Clears messages. Useful for Continuations and other situations</span></span><br><span class="line"><span class="comment">     * where you might want to clear parts of the state on the same action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        validationAware.clearMessages();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Clears all errors. Useful for Continuations and other situations</span></span><br><span class="line"><span class="comment">     * where you might want to clear parts of the state on the same action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        validationAware.clearErrors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Clears all errors and messages. Useful for Continuations and other situations</span></span><br><span class="line"><span class="comment">     * where you might want to clear parts of the state on the same action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearErrorsAndMessages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        validationAware.clearErrorsAndMessages();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A default implementation that validates nothing.</span></span><br><span class="line"><span class="comment">     * Subclasses should override this method to provide validations.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;!-- START SNIPPET: pause-method --&gt;</span></span><br><span class="line"><span class="comment">     * Stops the action invocation immediately (by throwing a PauseException) and causes the action invocation to return</span></span><br><span class="line"><span class="comment">     * the specified result, such as &#123;<span class="doctag">@link</span> #SUCCESS&#125;, &#123;<span class="doctag">@link</span> #INPUT&#125;, etc.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The next time this action is invoked (and using the same continuation ID), the method will resume immediately</span></span><br><span class="line"><span class="comment">     * after where this method was called, with the entire call stack in the execute method restored.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Note: this method can &lt;b&gt;only&lt;/b&gt; be called within the &#123;<span class="doctag">@link</span> #execute()&#125; method.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;!-- END SNIPPET: pause-method --&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result the result to return - the same type of return value in the &#123;<span class="doctag">@link</span> #execute()&#125; method.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If called first time it will create &#123;<span class="doctag">@link</span> com.opensymphony.xwork2.TextProviderFactory&#125;,</span></span><br><span class="line"><span class="comment">     * inject dependency (if &#123;<span class="doctag">@link</span> com.opensymphony.xwork2.inject.Container&#125; is accesible) into in,</span></span><br><span class="line"><span class="comment">     * then will create new &#123;<span class="doctag">@link</span> com.opensymphony.xwork2.TextProvider&#125; and store it in a field</span></span><br><span class="line"><span class="comment">     * for future references and at the returns reference to that field</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> reference to field with TextProvider</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> TextProvider <span class="title">getTextProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (textProvider == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Container container = getContainer();</span><br><span class="line">            TextProviderFactory tpf = container.getInstance(TextProviderFactory.class);</span><br><span class="line">            textProvider = tpf.createInstance(getClass());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> textProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> LocaleProvider <span class="title">getLocaleProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (localeProvider == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Container container = getContainer();</span><br><span class="line">            LocaleProviderFactory localeProviderFactory = container.getInstance(LocaleProviderFactory.class);</span><br><span class="line">            localeProvider = localeProviderFactory.createLocaleProvider();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> localeProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">TODO:</span> This a temporary solution, maybe we should consider stop injecting container into beans</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Container <span class="title">getContainer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (container == <span class="keyword">null</span>) &#123;</span><br><span class="line">            container = ActionContext.getContext().getContainer();</span><br><span class="line">            <span class="keyword">if</span> (container != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">boolean</span> devMode = Boolean.parseBoolean(container.getInstance(String.class, StrutsConstants.STRUTS_DEVMODE));</span><br><span class="line">                <span class="keyword">if</span> (devMode) &#123;</span><br><span class="line">                    LOG.warn(<span class="string">"Container is null, action was created manually? Fallback to ActionContext"</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    LOG.debug(<span class="string">"Container is null, action was created manually? Fallback to ActionContext"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                LOG.warn(<span class="string">"Container is null, action was created out of ActionContext scope?!?"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContainer</span><span class="params">(Container container)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.container = container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="Action访问ServletAPI"><a href="#Action访问ServletAPI" class="headerlink" title="Action访问ServletAPI"></a>Action访问ServletAPI</h3><ul>
<li><code>Struts2</code>还提供了一个<code>ActionContext</code>类，<code>Struts2</code>通过该类来访问<code>ServletAPI</code>。下面是<code>ActionContext</code>类中包含的几个常用方法：</li>
</ul>
<ol>
<li><code>Object get(Object ley)</code>：该方法类似于调用<code>HtppServletRequest</code>的<code>getAttribute(String name)</code></li>
<li><code>Map getApplication()</code>：返回一个<code>Map</code>对象，该对象模拟了该应用的<code>ServletContext</code>实例.</li>
<li><code>static ActionContext getContext()</code>：静态方法，获取系统的<code>ActionContext</code>实例。</li>
<li><code>Map getParameters()</code>：获取所有的请求参数。类似于调用<code>HttpServletRequest</code>对象的<code>getParametermap（）</code>方法。</li>
<li><code>Map getSession()</code>：返回一个<code>Map</code>对象，该<code>Map</code>对象模拟了<code>HttpSession</code>的实例。</li>
<li><code>void setApplication(Map application)</code>：直接传入一个<code>Map</code>实例，将该<code>Map</code>实例里的<code>key-value</code>转换成<code>application</code>的属性名和属性值。</li>
<li><code>void setSession(Map session)</code>：直接传入一个<code>Map</code>实例，将该<code>Map</code>实例里的<code>key-value</code>转换成<code>session</code>的属性名和属性值。</li>
</ol>
<ul>
<li>通过案例示范在<code>rquest</code>、<code>session</code>、<code>application</code>范围设置属性值<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span> <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Struts_studyByBook01<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 定义Struts2的核心Filter --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 让Strut2 的核心标签库Filter拦截所有的请求 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>Struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;&lt;s:text name="loginPage"&gt;&lt;/s:text&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form action=<span class="string">"login"</span>&gt;</span><br><span class="line">		&lt;s:textfield name="username" key="user"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:textfield name="password" key="pass"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:submit key="login"&gt;&lt;/s:submit&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;&lt;s:text name="succPage"/&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	本站访问的次数：$&#123;applicationScope.counter&#125;&lt;br&gt;</span><br><span class="line">	$&#123;sessionScope.user&#125;，您已登录成功！</span><br><span class="line">	$&#123;requestScope.tip&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">	pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt; </span><br><span class="line">	&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;&lt;s:text name="errorPage"/&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	$&#123;sessionScope.user&#125;,$&#123;requestScope.tip&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">implements</span> <span class="title">Action</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ActionContext ctx=ActionContext.getContext();</span><br><span class="line">		<span class="comment">//通过ActionContext访问application范围内的属性</span></span><br><span class="line">		Integer counter=(Integer) ctx.getApplication().get(<span class="string">"counter"</span>);</span><br><span class="line">		<span class="keyword">if</span>(counter == <span class="keyword">null</span>) &#123;</span><br><span class="line">			counter=<span class="number">1</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			counter = counter+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//通过ActionContext设置application范围的属性</span></span><br><span class="line">		ctx.getApplication().put(<span class="string">"counter"</span>,counter);</span><br><span class="line">		<span class="comment">//通过ActionContext设置Session范围内的属性</span></span><br><span class="line">		ctx.getSession().put(<span class="string">"user"</span>,getUsername());</span><br><span class="line">		<span class="keyword">if</span>(getUsername().equals(<span class="string">"crazyit"</span>) &amp;&amp; getPassword().equals(<span class="string">"leegang"</span>)) &#123;</span><br><span class="line">			<span class="comment">//通过ActionContext设置request范围内的属性</span></span><br><span class="line">			ctx.put(<span class="string">"tip"</span>, <span class="string">"服务器提示，你已经成功登录"</span>);</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//通过ActionContext设置request范围内的属性</span></span><br><span class="line">		ctx.put(<span class="string">"tip"</span>, <span class="string">"服务器提示，登录失败"</span>);</span><br><span class="line">		<span class="keyword">return</span> ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment"> * distributed with this work for additional information</span></span><br><span class="line"><span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment"> * to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment"> * "License"); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment"> * with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment"> * software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment"> * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment"> * KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment"> * specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment"> * under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 下面指定struts2配置文件的dtd信息 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.5.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!--  Overwrite Convention --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定全局国际化资源文件 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.custom.i18n.resources"</span> <span class="attr">value</span>=<span class="string">"mess"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Uncomment the lines below to use Jackson XML bindings instead of the XStream library to handle XML serialisations --&gt;</span></span><br><span class="line">   	<span class="comment">&lt;!-- 所有的Action定义都应方法package包下 --&gt;</span></span><br><span class="line">   	<span class="comment">&lt;!-- package元素是struts2配置文件的核心，该元素可以出现0次或者无限次 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"loginForm"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">       		<span class="comment">&lt;!-- 处理结果返回为error,则对应于 /WEB-INF/content/error.jsp视图资源 --&gt;</span></span><br><span class="line">       		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span> /WEB-INF/content/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       		<span class="comment">&lt;!-- 处理结果返回为success,则对应于 /WEB-INF/content/welcome.jsp视图资源 --&gt;</span></span><br><span class="line">       		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span> /WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>mess_zh_CN.properties</code>的文件，其内容为：</p>
<blockquote>
<ul>
<li>loginPage=登录页面</li>
<li>errorPage=错误页面</li>
<li>succPage=成功页面</li>
<li>failTip=对不起，您不能登录！</li>
<li>succTip=欢迎，{0}，您已经登录！</li>
<li>user=用户名</li>
<li>pass=密码</li>
<li>login=登录</li>
</ul>
</blockquote>
<ul>
<li>从以上案列可以看出，<code>Struts2</code>的<code>Action</code>设计非常优秀，它既可以与<code>ServletAPI</code>解耦，也可以脱离<code>Web</code>容器运行，也可以脱离<code>Web</code>容器测试，又可以用简单的方式来操作<code>request</code>、<code>session</code>、<code>application</code>范围内的属性。</li>
</ul>
<hr>
<h3 id="Action直接访问ServletAPI"><a href="#Action直接访问ServletAPI" class="headerlink" title="Action直接访问ServletAPI"></a><code>Action</code>直接访问<code>ServletAPI</code></h3><ul>
<li>虽然<code>struts2</code>提供了<code>ActionContext</code>来访问<code>ServletAPI</code>，但是这种访问毕竟不是直接获得<code>Servlet API</code>实例。为了在<code>Action</code>中直接访问<code>ServletAPI</code>，<code>Struts2</code>还提供如下几个接口：<br><code>ServletContextAware</code>：实现该接口的<code>Action</code>可以直接访问<code>Web</code>应用的<code>ServletContext</code>实例。<br><code>ServletRequestAware</code>：实现该接口的<code>Action</code>可以直接访问<code>Web</code>应用的<code>HttpServletRequest</code>实例。<br><code>ServletResponseAware</code>：实现该接口的<code>Action</code>可以直接访问<code>Web</code>应用的<code>HttpServletResponse</code>实例。</li>
<li>案列：以<code>ServletResponseAware</code>为例,如何在<code>Action</code>中访问<code>HttpServletResponse</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.interceptor.ServletResponseAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 解耦方式 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction02</span> <span class="keyword">implements</span> <span class="title">Action</span>,<span class="title">ServletResponseAware</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> HttpServletResponse response;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//重写ServletResponseAware接口必须实现的方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletResponse</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">this</span>.response=response;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"---- LoginAction2---"</span>);</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		ActionContext ctx=ActionContext.getContext();</span><br><span class="line">		<span class="comment">//通过ActionContext访问application范围内的属性</span></span><br><span class="line">		Integer counter=(Integer) ctx.getApplication().get(<span class="string">"counter"</span>);</span><br><span class="line">		<span class="keyword">if</span>(counter == <span class="keyword">null</span>) &#123;</span><br><span class="line">			counter=<span class="number">1</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			counter = counter+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//通过ActionContext设置application范围的属性</span></span><br><span class="line">		ctx.getApplication().put(<span class="string">"counter"</span>, counter);</span><br><span class="line">		<span class="comment">// 通过ActionContext设置Session范围内的属性</span></span><br><span class="line">		ctx.getSession().put(<span class="string">"user"</span>, getUsername());</span><br><span class="line">		<span class="keyword">if</span> (getUsername().equals(<span class="string">"crazyit"</span>) &amp;&amp; getPassword().equals(<span class="string">"leegang"</span>)) &#123;</span><br><span class="line">			<span class="comment">//通过Response添加cookie</span></span><br><span class="line">			Cookie c=<span class="keyword">new</span> Cookie(<span class="string">"user"</span>, getUsername());</span><br><span class="line">			c.setMaxAge(<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">			response.addCookie(c);</span><br><span class="line">			<span class="comment">//通过ActionContext设置request范围的属性</span></span><br><span class="line">			ctx.put(<span class="string">"tip"</span>, <span class="string">"服务器提示，你已经成功登录"</span>);</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 通过ActionContext设置request范围内的属性</span></span><br><span class="line">		ctx.put(<span class="string">"tip"</span>, <span class="string">"服务器提示，登录失败"</span>);</span><br><span class="line">		<span class="keyword">return</span> ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;&lt;s:text name="succPage"/&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	本站访问的次数：$&#123;applicationScope.counter&#125;&lt;br&gt;</span><br><span class="line">	&lt;!-- $&#123;sessionScope.user&#125; --&gt;$&#123;user&#125;，您已登录成功！</span><br><span class="line">	$&#123;requestScope.tip&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ServletActionContext访问ServletAPI"><a href="#ServletActionContext访问ServletAPI" class="headerlink" title="ServletActionContext访问ServletAPI"></a><code>ServletActionContext</code>访问<code>ServletAPI</code></h3><ul>
<li>除此之外，为了能直接访问<code>ServletAPI</code>，<code>Struts2</code>还提供了一个<code>ServletActionContext</code>工具类。该类包含如下几个静态方法：</li>
</ul>
<ol>
<li><code>static PageContext getPageContext()</code>：取得<code>web</code>应用的<code>pageContext</code>对象。</li>
<li><code>static HttpServletRequest getRequest()</code>：取得<code>web</code>应用的<code>request</code>对象。</li>
<li><code>static HttpServletResponse getResponse()</code>：取得<code>web</code>应用的<code>response</code>对象。</li>
<li><code>static ServletContext getServletContext()</code>：取得<code>web</code>应用的<code>ServletContext</code>对象。</li>
</ol>
<ul>
<li>案列，以<code>static HttpServletResponse getResponse()</code>为例，获取<code>response</code>实例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.interceptor.ServletResponseAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 解耦方式 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction03</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> HttpServletResponse response;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"---- LoginAction2---"</span>);</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		ActionContext ctx=ActionContext.getContext();</span><br><span class="line">		<span class="comment">//通过ActionContext访问application范围内的属性</span></span><br><span class="line">		Integer counter=(Integer) ctx.getApplication().get(<span class="string">"counter"</span>);</span><br><span class="line">		<span class="keyword">if</span>(counter == <span class="keyword">null</span>) &#123;</span><br><span class="line">			counter=<span class="number">1</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			counter = counter+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//通过ActionContext设置application范围的属性</span></span><br><span class="line">		ctx.getApplication().put(<span class="string">"counter"</span>, counter);</span><br><span class="line">		<span class="comment">// 通过ActionContext设置Session范围内的属性</span></span><br><span class="line">		ctx.getSession().put(<span class="string">"user"</span>, getUsername());</span><br><span class="line">		<span class="keyword">if</span> (getUsername().equals(<span class="string">"crazyit"</span>) &amp;&amp; getPassword().equals(<span class="string">"leegang"</span>)) &#123;</span><br><span class="line">			<span class="comment">//通过Response添加cookie</span></span><br><span class="line">			Cookie c=<span class="keyword">new</span> Cookie(<span class="string">"user"</span>, getUsername());</span><br><span class="line">			c.setMaxAge(<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">			ServletActionContext().getResponse().addCookie(c);</span><br><span class="line">			<span class="comment">//通过ActionContext设置request范围的属性</span></span><br><span class="line">			ctx.put(<span class="string">"tip"</span>, <span class="string">"服务器提示，你已经成功登录"</span>);</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 通过ActionContext设置request范围内的属性</span></span><br><span class="line">		ctx.put(<span class="string">"tip"</span>, <span class="string">"服务器提示，登录失败"</span>);</span><br><span class="line">		<span class="keyword">return</span> ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h2 id="配置Action"><a href="#配置Action" class="headerlink" title="配置Action"></a>配置<code>Action</code></h2><blockquote>
<ul>
<li>实现了<code>Action</code>处理类之后，就可以在<code>struts.xml</code>文件中配置该<code>Action</code>了。配置<code>Action</code>就是让<code>Struts2</code>知道哪个<code>Action</code>处理哪个请求，也就是完成用户请求和<code>Action</code>之间的对应关系。</li>
</ul>
</blockquote>
<hr>
<h3 id="包和命名空间"><a href="#包和命名空间" class="headerlink" title="包和命名空间"></a>包和命名空间</h3><ul>
<li>定义<code>&lt;package ../&gt;</code>元素时可以指定如下几个元素：</li>
</ul>
<ol>
<li><code>name</code>：必须元素，该属性指定该包的名字，该名字是该包被其他包引用的<code>key</code>；</li>
<li><code>extends</code>：可选属性，该属性指定该包继承其他包。继承其他包，可以继承其他包中的<code>Action</code>定义、拦截器定义等。</li>
<li><code>namespace</code>：可选元素。该属性定义该包的命名空间。</li>
<li><code>abstract</code>：可选元素。它指定该包是否为抽象包。抽象包不能包含<code>Action</code>定义。</li>
</ol>
<hr>
<h3 id="Action的基本配置"><a href="#Action的基本配置" class="headerlink" title="Action的基本配置"></a><code>Action</code>的基本配置</h3><ul>
<li>定义<code>&lt;action ../ &gt;</code>元素时可以指定如下几个元素：</li>
</ul>
<ol>
<li><code>name</code>：必须元素，该属性定义该action的名字，也定义了处理该请求的<code>url</code></li>
<li><code>class</code>：非必须元素。用于指定action的实现类，如果没有定义该属性，系统则默认使用<code>ActionSupport</code>作为处理类。</li>
<li><code>method</code>：非必须元素。该属性用于指定处理类中的业务处理方法的方法名，如果没有定义该属性，系统则默认使用<code>execute</code>。</li>
</ol>
<ul>
<li>配置<code>Action</code>时应该配置逻辑视图名与物理视图名之间的对应关系，而配置他们之间的映射关系，是通过<code>&lt;result ../&gt;</code>元素来完成。</li>
</ul>
<hr>
<h3 id="使用Action的动态方法调用"><a href="#使用Action的动态方法调用" class="headerlink" title="使用Action的动态方法调用"></a>使用<code>Action</code>的动态方法调用</h3><blockquote>
<ul>
<li>动态方法调用采用如下方式:<code>ActionName!method.action</code>，其中<code>actionName</code>指定的是要提交到哪个<code>Action</code>，<code>method</code>指定的是交给哪个方法调用。</li>
<li>案列实现：<blockquote>
<ul>
<li>登录注册界面</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;&lt;s:text name="loginPage"&gt;&lt;/s:text&gt;&lt;/title&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="function">function <span class="title">regist</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//获得第1个表单页面</span></span><br><span class="line">		targetForm=document.forms[<span class="number">0</span>];</span><br><span class="line">		targetForm.action=<span class="string">"login02!regist"</span></span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"login02"</span>&gt;</span><br><span class="line">		用户名：&lt;input name=<span class="string">"username"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		密    码：&lt;input name=<span class="string">"password"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		&lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>/&gt;&lt;input type=<span class="string">"submit"</span> value=<span class="string">"注册"</span> onclick=<span class="string">"regist();"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>业务处理类</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginRegisterAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="comment">//封装用户请求参数的两个成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="comment">//封装处理结果的tip成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String tip;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTip</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> tip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTip</span><span class="params">(String tip)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.tip = tip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Action包含的注册控制逻辑</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">regist</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------regist------"</span>);</span><br><span class="line">		ActionContext.getContext().getSession().put(<span class="string">"user"</span>, getUsername());</span><br><span class="line">		setTip(<span class="string">"恭喜您,"</span>+getUsername()+<span class="string">"，您已经注册成功"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Action包含的登录业务逻辑</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------login------"</span>);</span><br><span class="line">		<span class="keyword">if</span>(getUsername().equals(<span class="string">"crazyit.org"</span>) &amp;&amp; getPassword().equals(<span class="string">"leegang"</span>)) &#123;</span><br><span class="line">			ActionContext.getContext().getSession().put(<span class="string">"user"</span>, getUsername());</span><br><span class="line">			setTip(<span class="string">"欢迎,"</span>+getUsername()+<span class="string">"，您已经登录成功"</span>);</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>配置文件</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 下面指定struts2配置文件的dtd信息 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.5.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定全局国际化资源文件 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.custom.i18n.resources"</span> <span class="attr">value</span>=<span class="string">"mess"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"loginForm"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login02"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginRegisterAction"</span>&gt;</span></span><br><span class="line">       		<span class="comment">&lt;!-- 处理结果返回为error,则对应于 /WEB-INF/content/error.jsp视图资源 --&gt;</span></span><br><span class="line">       		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span> /WEB-INF/content/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       		<span class="comment">&lt;!-- 处理结果返回为success,则对应于 /WEB-INF/content/welcome.jsp视图资源 --&gt;</span></span><br><span class="line">       		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span> /WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">       		<span class="tag">&lt;<span class="name">allowed-methods</span>&gt;</span>regist<span class="tag">&lt;/<span class="name">allowed-methods</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>成功页面</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;&lt;s:text name="succPage"/&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;!-- 本站访问的次数：$&#123;applicationScope.counter&#125;&lt;br&gt; --&gt;</span><br><span class="line">	&lt;!-- $&#123;sessionScope.user&#125; --&gt;$&#123;user&#125;，您已登录成功！</span><br><span class="line">	$&#123;sessionScope.tip&#125;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>结果</li>
</ul>
</blockquote>
</blockquote>
<p><img src="https://i.loli.net/2019/09/21/YPtVnDedqMWkEJ7.png" alt="1569052703_1_.png"></p>
<hr>
<h3 id="指定Method属性及其通配符"><a href="#指定Method属性及其通配符" class="headerlink" title="指定Method属性及其通配符"></a>指定<code>Method</code>属性及其通配符</h3><ul>
<li>在配置<code>&lt;action ../&gt;</code>元素时，允许在指定<code>name</code>使用模式字符串，接下来在<code>method</code>，<code>class</code>，以及<code>&lt;result../&gt;</code>子元素中使用<code>{N}</code>的形式来表示前面第N个所匹配的字符串。</li>
<li>在<code>Action</code>的<code>name</code>属性中使用模式通配符后，可以用一个<code>&lt;action../&gt;</code>代替多个逻辑<code>Action</code>。</li>
<li>注意：因为除非请求的<code>URL</code>与<code>action</code>与<code>name</code>属性绝对相同，否则将按先后顺序来决定由哪个<code>action</code>来处理用户请求。因此应该讲<code>name=&quot;*&quot;</code>的<code>Action</code>配置放在最后，否则，<code>Struts2</code>将使用该<code>Action</code>来处理所有希望使用模式字符串匹配的请求。</li>
</ul>
<hr>
<h3 id="配置默认的Action与配置默认的处理类"><a href="#配置默认的Action与配置默认的处理类" class="headerlink" title="配置默认的Action与配置默认的处理类"></a>配置默认的<code>Action</code>与配置默认的处理类</h3><ul>
<li>默认<code>Action</code>：<code>&lt;default-action-ref name=&quot;ActionName&quot; /&gt;</code></li>
<li>默认处理类：<code>&lt;default-class-ref name=&quot;className&quot; /&gt;</code></li>
</ul>
<hr>
<h2 id="配置处理结果"><a href="#配置处理结果" class="headerlink" title="配置处理结果"></a>配置处理结果</h2><hr>
<h3 id="理解处理结果"><a href="#理解处理结果" class="headerlink" title="理解处理结果"></a>理解处理结果</h3><ul>
<li>Action处理完用户的请求后，并未把请求直接转发给任何具体的视图资源，而是返回一个逻辑视图（逻辑视图就是一个简单的字符串），Struts2框架收到这个逻辑视图，，把请求转发到具体的物理视图资源，然后把处理结果展示给用户看。</li>
</ul>
<hr>
<h3 id="配置结果"><a href="#配置结果" class="headerlink" title="配置结果"></a>配置结果</h3><ul>
<li><code>Struts2</code>框架在<code>struts.xml</code>文件中使用<code>&lt;result../&gt;</code>元素来配置结果。</li>
<li>配置<code>&lt;result ../&gt;</code>元素时需要指定如下两个属性:<ul>
<li><code>name</code>：该属性指定所配置的逻辑视图名。</li>
<li><code>type</code>：该属性指定结果类型。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Struts2支持的结果类型"><a href="#Struts2支持的结果类型" class="headerlink" title="Struts2支持的结果类型"></a><code>Struts2</code>支持的结果类型</h3><ul>
<li><code>plainText</code>结果类型：将实际的视图资源的源代码显示到客户端浏览器上。</li>
<li>案例:<blockquote>
<ul>
<li><code>Action</code>实现类 </li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//用于封装请求的username</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="comment">//username属性的getter和setter</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li><code>struts.xml</code>配置文件</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.5.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"loginForm"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 指定Result的类型为PlainText --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"plainText"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 指定实际的视图资源 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"location"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 指定使用指定字符串来处理页面代码 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"charSet"</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>结果页面</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;欢迎页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:property value=<span class="string">"username"</span>/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>效果图：</li>
</ul>
</blockquote>
<p><img src="https://i.loli.net/2019/09/22/uBra3fH8XPh9cUJ.png" alt="1569121660_1_.png"></p>
<blockquote>
<ul>
<li>使用<code>plainText</code>结果类型可以指定如下两个参数<blockquote>
<ul>
<li>location：指定实际的视图资源。</li>
<li>charSet：指定输出页面是所使用的的字符集。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<ul>
<li><code>redirect</code>结果类型:<blockquote>
<ul>
<li>使用该属性之后，会丢失所有的请求参数，请求属性，当然也丢失了action的处理结果。</li>
<li>案例：将上面的配置文件修改一下</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"loginForm"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 指定Result的类型为PlainText --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span></span><br><span class="line">			    /welcome.jsp</span><br><span class="line">			<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>配置一个<code>redirect</code>结果类型时，可以为其指定如下两个参数<blockquote>
<ul>
<li>location：该<code>Action</code>指定Action处理完用户请求后跳转的地址。</li>
<li>parse：该参数指定是否允许<code>location</code>参数值中使用表达式,默认值为 true;</li>
</ul>
</blockquote>
</li>
</ul>
<ul>
<li><code>redirectAction</code>结果类型</li>
</ul>
<ul>
<li><code>redirectAction</code>实现在一个<code>Action</code>处理结束时，直接将请求重定向到里一个<code>Action</code>。</li>
<li>配置<code>redirectAction</code>结果类型时，可以指定如下两个参数:<blockquote>
<ul>
<li><code>actionName</code>：该参数指定重定向的<code>Action</code>名。</li>
<li><code>namespache</code>：该参数指定需要重定向的<code>Action</code>所在的命名空间。</li>
</ul>
</blockquote>
</li>
<li><code>redirect</code>与<code>redirectAction</code>，这两种结果都会产生新的请求，区别在于前者重定向的是实际视频的资源，后者重向定的是另一个<code>Action</code>，两种结果类型都会丢失前一个<code>Action</code>的请求参数，请求属性以及处理的结果。</li>
</ul>
</blockquote>
<hr>
<h3 id="动态结果"><a href="#动态结果" class="headerlink" title="动态结果"></a>动态结果</h3><ul>
<li>动态结果的含义是指在指定实际视图资源使用了表达式语法。<h3 id="Action属性值决定物理视图资源"><a href="#Action属性值决定物理视图资源" class="headerlink" title="Action属性值决定物理视图资源"></a><code>Action</code>属性值决定物理视图资源</h3></li>
<li>配置<code>&lt;result ../&gt;</code>元素时，不仅可以使用<code>${N}</code>表达式来指定实际视图资源，还可以使用${属性名}方法来指定物理视图资源。</li>
<li>案例<blockquote>
<ul>
<li>业务处理类：MyAction.java</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> String target;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTarget</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> target;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTarget</span><span class="params">(String target)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.target = target;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		addActionMessage(<span class="string">"恭喜您，您已经成功转向!"</span>);</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>配置文件 struts.xml</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.custom.i18n.resources"</span> <span class="attr">value</span>=<span class="string">"mess"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"shop"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">    	</span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"myAction"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.MyAction"</span>&gt;</span></span><br><span class="line">       		 <span class="comment">&lt;!-- 配置结果集时，采用OGNL表达式来指定实际视图资源 --&gt;</span></span><br><span class="line">       	 	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/$&#123;target&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>JSP页面 ok.jsp</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">   </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;转向页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"myAction"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">		转入的目标页面：&lt;input type=<span class="string">"text"</span> name=<span class="string">"target"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		&lt;input type=<span class="string">"submit"</span> value=<span class="string">"转入"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>成功页面:welcome.jsp</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;成功页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:actionmessage/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="全局结果"><a href="#全局结果" class="headerlink" title="全局结果"></a>全局结果</h3><ul>
<li>配置全局结果可以采用<code>&lt;global-result ../&gt;</code>标签完成。全局结果集多所有的<code>Action</code>有效。<h3 id="使用PreResultListener"><a href="#使用PreResultListener" class="headerlink" title="使用PreResultListener"></a>使用<code>PreResultListener</code></h3></li>
<li><code>PreResultListener</code>是一个监听器接口，它可以在<code>Action</code>完成处理控制后，系统转入实际的物理视图之间被回调。</li>
<li>添加<code>PreResultListener</code>监听器通过<code>Invocation</code>的<code>addPreResultListener()</code>方法完成。</li>
<li>案例，在之前的项目中添加如下代码即可：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.PreResultListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginRegisterAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//封装用户请求参数的两个成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="comment">//封装处理结果的tip成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String tip;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTip</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> tip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTip</span><span class="params">(String tip)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.tip = tip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Action包含的注册控制逻辑</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">regist</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------regist------"</span>);</span><br><span class="line">		ActionContext.getContext().getSession().put(<span class="string">"user"</span>, getUsername());</span><br><span class="line">		setTip(<span class="string">"恭喜您,"</span>+getUsername()+<span class="string">"，您已经注册成功"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Action包含的登录业务逻辑</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------login------"</span>);</span><br><span class="line">		<span class="comment">//添加PreResultListener接口监听器</span></span><br><span class="line">		ActionInvocation invocation=ActionContext.getContext().getActionInvocation();</span><br><span class="line">		invocation.addPreResultListener(<span class="keyword">new</span> PreResultListener() &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeResult</span><span class="params">(ActionInvocation invocation, String resultCode)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">				System.out.println(<span class="string">"返回的逻辑视图名字为："</span>+resultCode);</span><br><span class="line">				<span class="comment">//在返回Result之前加入一个额外的数据</span></span><br><span class="line">				invocation.getInvocationContext().put(<span class="string">"extra"</span>, <span class="keyword">new</span> java.util.Date()+<span class="string">"由"</span>+resultCode+<span class="string">"逻辑视图名转入"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(getUsername().equals(<span class="string">"crazyit.org"</span>) &amp;&amp; getPassword().equals(<span class="string">"leegang"</span>)) &#123;</span><br><span class="line">			ActionContext.getContext().getSession().put(<span class="string">"user"</span>, getUsername());</span><br><span class="line">			setTip(<span class="string">"欢迎,"</span>+getUsername()+<span class="string">"，您已经登录成功"</span>);</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h2 id="配置Struts2的异常处理"><a href="#配置Struts2的异常处理" class="headerlink" title="配置Struts2的异常处理"></a>配置<code>Struts2</code>的异常处理</h2><h3 id="Struts2的异常处理机制"><a href="#Struts2的异常处理机制" class="headerlink" title="Struts2的异常处理机制"></a><code>Struts2</code>的异常处理机制</h3><ul>
<li>为了使用<code>Struts2</code>的异常处理机制，必须打开<code>Struts2</code>的异常映射功能,开启异常映射功能需要一个拦截器。下面是<code>struts-default.xml</code>文件中开启异常映射功能的配置文件。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"exception"</span> <span class="attr">class</span>=<span class="string">"com.opensymphony.xwork2.interceptor.ExceptionMappingInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Struts2默认的拦截器栈--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceprot-stack</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"exception"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="声明式异常捕获"><a href="#声明式异常捕获" class="headerlink" title="声明式异常捕获"></a>声明式异常捕获</h3><ul>
<li><code>Struts2</code>的异常处理机制是通过在<code>struts.xml</code>文件中配置<code>&lt;exception-mapping ../&gt;</code>元素完成的。配置该文件时，需要指定如下两个属性：<blockquote>
<ul>
<li><code>exception</code>：此属性指定该异常映射所映射所设置的异常类型。</li>
<li><code>result</code>：此属性指定<code>Action</code>出现异常时，系统返回<code>result</code>属性值对应的逻辑视图名。</li>
</ul>
</blockquote>
</li>
<li>根据<code>&lt;exception-mapping&gt;</code>出现位置的不同，异常映射又可以分为如下两种：<blockquote>
<ul>
<li>局部异常映射：将<code>&lt;exception-mapping&gt;</code>作为<code>Action</code>的子元素配置。</li>
<li>全局异常映射：将<code>&lt;exception-mapping&gt;</code>作为<code>&lt;global-exception-mappings&gt;</code>的子元素配置。</li>
</ul>
</blockquote>
</li>
<li>案例<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(msg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//封装请求参数的username和password</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> String tip;</span><br><span class="line">	...</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"exception"</span>);</span><br><span class="line">		<span class="keyword">if</span>(getUsername().equalsIgnoreCase(<span class="string">"user"</span>)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"自定义异常"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(getUsername().equalsIgnoreCase(<span class="string">"sql"</span>)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> java.sql.SQLException(<span class="string">"用户名不能为sql"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(getUsername().equals(<span class="string">"crazyit.org"</span>) &amp;&amp; getPassword().equals(<span class="string">"leegang"</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 配置全局结果集 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"sql"</span>&gt;</span>/WEB-INF/content/exception.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"root"</span>&gt;</span>/WEB-INF/content/exception.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置全局异常映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">global-exception-mappings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exception-mapping</span> <span class="attr">result</span>=<span class="string">"sql"</span> <span class="attr">exception</span>=<span class="string">"java.sql.SQLException"</span>&gt;</span><span class="tag">&lt;/<span class="name">exception-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exception-mapping</span> <span class="attr">result</span>=<span class="string">"root"</span> <span class="attr">exception</span>=<span class="string">"java.lang.Exception"</span>&gt;</span><span class="tag">&lt;/<span class="name">exception-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">global-exception-mappings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction02"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 处理结果返回为error,则对应于 /WEB-INF/content/error.jsp视图资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span> /WEB-INF/content/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理结果返回为success,则对应于 /WEB-INF/content/welcome.jsp视图资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span> /WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login02"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.exception.LoginAction"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 定义局部异常映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exception-mapping</span> <span class="attr">result</span>=<span class="string">"my"</span> <span class="attr">exception</span>=<span class="string">"org.crazyit.app.exception.MyException"</span>&gt;</span><span class="tag">&lt;/<span class="name">exception-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"my"</span>&gt;</span>/my.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理结果返回为error,则对应于 /WEB-INF/content/error.jsp视图资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span> /WEB-INF/content/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理结果返回为success,则对应于 /WEB-INF/content/welcome.jsp视图资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span> /WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">allowed-methods</span>&gt;</span>regist<span class="tag">&lt;/<span class="name">allowed-methods</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="输出异常信息"><a href="#输出异常信息" class="headerlink" title="输出异常信息"></a>输出异常信息</h3><ul>
<li>为了在异常页面中显示异常信息，可以使用<code>Struts2</code>的如下标签来输出异常信息<blockquote>
<ul>
<li><code>&lt;s:property value=&quot;exception&quot;/&gt;</code>：输出异常对象本身。</li>
<li><code>&lt;s:property value=&quot;exceptionStack&quot;/&gt;</code>：输出异常堆本身。</li>
</ul>
</blockquote>
</li>
<li>还可以使用<code>&lt;s:property value=&quot;exception.message&quot;/&gt;</code>来输出异常<code>message</code>信息。</li>
</ul>
<hr>
<h2 id="Convention插件与约定支持"><a href="#Convention插件与约定支持" class="headerlink" title="Convention插件与约定支持"></a><code>Convention</code>插件与<code>约定</code>支持</h2><h3 id="Action的搜索和映射约定"><a href="#Action的搜索和映射约定" class="headerlink" title="Action的搜索和映射约定"></a>Action的搜索和映射约定</h3><ul>
<li><code>convention</code>会把如下两种<code>Java</code>类当成<code>Action</code>类。<blockquote>
<ul>
<li>所有实现了<code>com.opensymphony.xwork2.Action</code>的<code>Java</code>类</li>
<li>所有类名以<code>Action</code>结尾的<code>Java</code>类。</li>
</ul>
</blockquote>
<h3 id="按约定映射Result"><a href="#按约定映射Result" class="headerlink" title="按约定映射Result"></a>按约定映射Result</h3><h3 id="Action链的约定"><a href="#Action链的约定" class="headerlink" title="Action链的约定"></a>Action链的约定</h3><h3 id="自动重加载映射"><a href="#自动重加载映射" class="headerlink" title="自动重加载映射"></a>自动重加载映射</h3></li>
<li><code>Convention</code>完全支持自动重载映射，只要为<code>Struts2</code>配置如下两个常量即可<blockquote>
<ul>
<li>配置<code>Struts2</code>处于开发者模式：<code>&lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot;&gt;&lt;/constant&gt;</code></li>
<li>配置<code>Convention</code>插件自动重加载映射：<code>&lt;constant name=&quot;struts.convention.classes.reloaad&quot; value=&quot;true&quot;&gt;&lt;/constant&gt;</code></li>
</ul>
</blockquote>
<h3 id="Convention插件的相关常量"><a href="#Convention插件的相关常量" class="headerlink" title="Convention插件的相关常量"></a>Convention插件的相关常量</h3><h3 id="Convention插件的相关注解"><a href="#Convention插件的相关注解" class="headerlink" title="Convention插件的相关注解"></a>Convention插件的相关注解</h3></li>
</ul>
<hr>
<h2 id="使用Struts2的国际化"><a href="#使用Struts2的国际化" class="headerlink" title="使用Struts2的国际化"></a>使用Struts2的国际化</h2><ol>
<li>Struts2的国际化可以按照如下步骤进行：<blockquote>
<ul>
<li>让系统加载国际化资源文件。加载国家化资源文件有两种方式:<blockquote>
<ul>
<li>自动加载：Action范围的国际化资源文件，包范围的国家化资源文件由系统自动加载。</li>
<li>手动加载：JSP范围的国际化资源文件、全局范围的国际化资源文件，分别使用标签、配置常量的方式来手动加载。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>输出国际化。Struts2输出国家化的消息同样有两种方式：<blockquote>
<blockquote>
<ul>
<li>在视图页面上输出国家化消息，需要使用Struts2的标签库。</li>
<li>在<code>Action</code>类中输出国际化消息，需要使用<code>ActionSupport</code>的<code>getText()</code>方法来完成。</li>
</ul>
</blockquote>
</blockquote>
<h3 id="视图页面的国际化"><a href="#视图页面的国际化" class="headerlink" title="视图页面的国际化"></a>视图页面的国际化</h3></li>
</ol>
<ul>
<li>在Jsp页面中指定国际化资源需要借助Struts2的另外一个标签：<code>&lt;s:i18n&gt;</code></li>
<li>案例实现:<blockquote>
<ul>
<li>定义两个国际化资源文件，其路径分别为：<code>/JSPResources/src/viewResources/loginForm_en_US</code>与<code>/JSPResources/src/viewResources/loginForm_zh_CN.properties</code></li>
<li>两个包的内容分别为：</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># loginForm_en_US.properties</span><br><span class="line">loginPage=JSP Message:Login Page</span><br><span class="line">user=JSP Message:User Name</span><br><span class="line">pass=JSP Message:User Pass</span><br><span class="line">login=JSP Message:Login</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># loginForm_zh_CN.properties</span><br><span class="line">loginPage=JSP Message:Login Page</span><br><span class="line">user=JSP Message:User Name</span><br><span class="line">pass=JSP Message:User Pass</span><br><span class="line">login=JSP Message:Login</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>定义一个JSP页面，并在其中使用国际化资源文件，其路径为：<code>/JSPResources/WebContent/WEB-INF/content/success.jsp</code></li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;!-- 加载baseName为viewResource包下的baseName为loginForm的国际化资源文件 --&gt;</span><br><span class="line">&lt;s:i18n name=<span class="string">"viewResources.loginForm"</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">		&lt;!-- 使用text标签来输出国际化信息 --&gt;</span><br><span class="line">		&lt;title&gt;&lt;s:text name="loginPage"&gt;&lt;/s:text&gt;&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;s:form action=<span class="string">"login"</span>&gt;</span><br><span class="line">			&lt;!-- 在表单页面中，使用key属性来输出国际化信息 --&gt;</span><br><span class="line">			&lt;s:textfield name=<span class="string">"username"</span> key=<span class="string">"user"</span> /&gt;</span><br><span class="line">			&lt;s:textfield name=<span class="string">"password"</span> key=<span class="string">"pass"</span> /&gt;</span><br><span class="line">			&lt;s:submit key=<span class="string">"login"</span>/&gt;</span><br><span class="line">		&lt;/s:form&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;/s:i18n&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>定义配置文件<code>struts.xml</code>来访问页面</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.5.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"shop"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">    	</span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">       	 	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>启动服务器，在页面查看效果. </li>
</ul>
</blockquote>
<p><img src="https://i.loli.net/2019/09/26/6F3WfxAaLRvb9Xu.png" alt="效果图.PNG"></p>
<h3 id="Action的国际化"><a href="#Action的国际化" class="headerlink" title="Action的国际化"></a>Action的国际化</h3><ul>
<li>为<code>Action</code>单独指定国际化资源文件的方法是：在<code>Action</code>类文件所在的路径下建立多个文件名为<code>ActionName_language_country.properties</code>.</li>
<li><code>Struts2</code>的国际资源文件是由系统自动加载。</li>
</ul>
<h3 id="使用包范围的国际化资源"><a href="#使用包范围的国际化资源" class="headerlink" title="使用包范围的国际化资源"></a>使用包范围的国际化资源</h3><ul>
<li>包范围的国际化资源可以被该包下的所有Action使用。</li>
<li>包范围的国际化资源文件的文件名：<code>package_&lt;language&gt;_&lt;country&gt;.properties</code><h3 id="使用全局国际化资源"><a href="#使用全局国际化资源" class="headerlink" title="使用全局国际化资源"></a>使用全局国际化资源</h3></li>
<li>不管是在<code>struts.xml</code>文件中配置常量，还是在<code>struts.properties</code>文件中配置常量，只需要配置<code>struts.custom.i18n.resources</code>常量即可加载全局国际化资源文件。<h3 id="输出带占位符的国际化消息"><a href="#输出带占位符的国际化消息" class="headerlink" title="输出带占位符的国际化消息"></a>输出带占位符的国际化消息</h3></li>
<li>国际化消息可能包含占位符，这些占位符必须使用参数来填充。<h3 id="加载资源文件的顺序"><a href="#加载资源文件的顺序" class="headerlink" title="加载资源文件的顺序"></a>加载资源文件的顺序</h3></li>
</ul>
<hr>
<h2 id="使用Struts2的标签库"><a href="#使用Struts2的标签库" class="headerlink" title="使用Struts2的标签库"></a>使用<code>Struts2</code>的标签库</h2><h3 id="Struts2标签库概述"><a href="#Struts2标签库概述" class="headerlink" title="Struts2标签库概述"></a>Struts2标签库概述</h3><ul>
<li><code>Struts2</code>的标签都定义在<code>URI</code>为<code>/struts-tags</code>的空间下。</li>
<li>从大范围上看，可以将<code>Struts2</code>标签分成如下两类：<blockquote>
<ul>
<li><code>UI</code>(<code>User Interface</code>，用户界面)标签：主要用于生成<code>HTML</code>元素的标签。</li>
<li>非<code>UI</code>标签：主要用于数据访问、逻辑控制等的标签。   </li>
</ul>
</blockquote>
</li>
<li>对于<code>UI</code>标签，可以分为如下两类：<blockquote>
<ul>
<li>标签标签：主要用于生成<code>HTML</code>页面的<code>form</code>元素，以及普通表单元素的标签。</li>
<li>非表单标签：主要用于生成页面上的树、<code>Tab</code>页等标签。</li>
</ul>
</blockquote>
</li>
<li>对于非<code>UI</code>标签，也可以分为如下两类：<blockquote>
<ul>
<li>流程控制标签：主要包含用于生成分支、循环等流程控制的标签。</li>
<li>数据访问标签：主要包含用于输出<code>ValueStack</code>中的值，完成国际化等功能的标签。</li>
</ul>
</blockquote>
</li>
</ul>
<p><img src="https://i.loli.net/2019/09/27/RZOMBSxdKJ7rDv2.png" alt="struts2_tag.png"></p>
<h3 id="使用Struts2标签"><a href="#使用Struts2标签" class="headerlink" title="使用Struts2标签"></a>使用Struts2标签</h3><ul>
<li><code>Struts2</code>的标签库定义文件存放在<code>struts2-core.2.5.20.jar</code>包下的<code>struts-tags.tld</code>文件</li>
<li>在<code>JSP</code>页面中使用<code>Struts2</code>标签的步骤<blockquote>
<ul>
<li>在<code>JSP</code>页面中导入<code>Struts2</code>的标签库，例如：<code>&lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot; %&gt;</code>；其中<code>prefix</code>指定标签的前缀，<code>uri</code>指定使用哪个核心标签库。</li>
<li>在<code>JSP</code>页面中使用相关标签：例如：<code>&lt;s:text name=&quot;hello&quot;/&gt;</code> 。</li>
</ul>
</blockquote>
<h3 id="Struts2的OGNL表达式语言"><a href="#Struts2的OGNL表达式语言" class="headerlink" title="Struts2的OGNL表达式语言"></a><code>Struts2</code>的<code>OGNL</code>表达式语言</h3></li>
<li>OGNL(Object-Graph Navigation Language：图像导航语言)</li>
<li>OGNL,如果需要访问的对象属于根对象，则可以直接访问该属性，如果不是则需要使用一个前缀<code>#</code></li>
<li>开发中，可以在页面中添加<code>&lt;s:debug/&gt;</code>标签，来查看属性是为<code>value stack</code>还是<code>stack context</code><h3 id="OGNL中的集合操作"><a href="#OGNL中的集合操作" class="headerlink" title="OGNL中的集合操作"></a>OGNL中的集合操作</h3></li>
<li>很多时候，可能需要一个集合对象（例如<code>List</code>对象，或者<code>Map</code>对象），使用<code>OGNL</code>表达式可以直接创建集合对象。</li>
<li>直接创建<code>List</code>集合的语法：{e1,e2,e3}</li>
<li>直接创建<code>Map</code>集合的语法：#{key1:value1,key2:value2}</li>
<li>对于集合，<code>OGNL</code>提供了两个运算符：<code>in</code>和<code>not in</code></li>
<li>除此之外，OGNL还允许通过某个规则取得集合的子集。取得集合的子集时有如下三个操作：<blockquote>
<ul>
<li><code>?</code>: 取出所有符合选择逻辑的元素。</li>
<li><code>^</code>: 取出符合选择逻辑的第一个元素。</li>
<li><code>$</code>: 取出符合选择逻辑的最后一个元素。</li>
</ul>
</blockquote>
<h3 id="访问静态成员"><a href="#访问静态成员" class="headerlink" title="访问静态成员"></a>访问静态成员</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.ognl.allowStaticMethodAccess"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">访问静态方法：&lt;s:property value=<span class="string">"@org.crazyit.struts2.action.DemoAction@s()"</span>/&gt;&lt;br&gt;</span><br><span class="line">访问静态属性：&lt;s:property value=<span class="string">"@org.crazyit.struts2.action.DemoAction@str"</span>/&gt;&lt;br&gt;</span><br><span class="line">生成一个伪随机数:&lt;s:property value=<span class="string">"@java.lang.Math@random()"</span>/&gt;&lt;br&gt;</span><br><span class="line">圆周率的值:&lt;s:property value=<span class="string">"@java.lang.Math@PI"</span>/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a><code>Lambda</code>表达式</h3><ul>
<li>Lambda表达式支持:<code>&lt;s:property value=&quot;#fib =: [#this == 0?0:#this==1?1:#fib(#this-2)+#fib(#this-1)],#fib(11)&quot;/&gt;</code><h3 id="控制标签"><a href="#控制标签" class="headerlink" title="控制标签"></a>控制标签</h3></li>
<li>控制标签有9个</li>
</ul>
<ol>
<li><code>if</code>：用于控制选择输出的标签。</li>
<li><code>elseIf</code>/<code>elseif</code>：与<code>if</code>标签结合使用，用于控制选择输出的标签。</li>
<li><code>else</code>：与<code>if</code>标签结合使用，用于控制选择输出的标签。</li>
<li><code>append</code>：用于将多个集合拼接成一个新的集合。</li>
<li><code>generator</code>：它是一个字符串解析器，用于讲一个字符串解析成一个集合。</li>
<li><code>iterator</code>：这是一个迭代器，用于将集合迭代输出。</li>
<li><code>merge</code>：用于将多个集合合拼成一个新的集合。但与append的拼接方法有所不同。</li>
<li><code>sort</code>：这个标签用于对集合进行排序。</li>
<li><code>subset</code>：这个标签用于截取集合的部分元素，形成新的子集合。</li>
</ol>
<ul>
<li><code>if</code>/<code>elseif</code>/<code>else</code>标签<blockquote>
<ul>
<li>三个标签结合的语法格式如下：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:<span class="keyword">if</span> test=<span class="string">"表达式"</span>&gt;</span><br><span class="line">	标签体</span><br><span class="line">&lt;/s:if&gt;</span><br><span class="line">&lt;s:elseif test=<span class="string">"表达式"</span>&gt;</span><br><span class="line">	标签体</span><br><span class="line">&lt;/s:elseif&gt;</span><br><span class="line">...</span><br><span class="line">&lt;s:<span class="keyword">else</span>&gt;</span><br><span class="line">	标签体</span><br><span class="line">&lt;/s:else&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>案列实现:</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;分支控制&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;!-- 向Stack Context中定义一个属性age,并取值为 <span class="number">29</span> --&gt;</span><br><span class="line">	&lt;s:set var="age" value="29"&gt;&lt;/s:set&gt;</span><br><span class="line">	&lt;!-- 如果Stack Context中的age属性大于<span class="number">60</span> --&gt;</span><br><span class="line">	&lt;s:<span class="keyword">if</span> test=<span class="string">"#age&gt;60"</span>&gt;</span><br><span class="line">		老年人</span><br><span class="line">	&lt;/s:if&gt;</span><br><span class="line">	&lt;!-- 如果Stack Context中的age属性大于<span class="number">35</span> --&gt;</span><br><span class="line">	&lt;s:elseif test=<span class="string">"#age&gt;35"</span>&gt;</span><br><span class="line">		中年人</span><br><span class="line">	&lt;/s:elseif&gt;</span><br><span class="line">	&lt;!-- 如果Stack Context中的age属性大于<span class="number">15</span> --&gt;</span><br><span class="line">	&lt;s:elseif test=<span class="string">"#age&gt;15"</span>&gt;</span><br><span class="line">		青年人</span><br><span class="line">	&lt;/s:elseif&gt;</span><br><span class="line">	&lt;s:<span class="keyword">else</span>&gt;</span><br><span class="line">		少年人</span><br><span class="line">	&lt;/s:else&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>iterator</code>标签</p>
<blockquote>
<ul>
<li>主要用于对集合进行迭代。</li>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;iterator标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"300"</span>&gt;</span><br><span class="line">	</span><br><span class="line">		&lt;s:iterator value=<span class="string">"&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"</span> <span class="keyword">var</span>=<span class="string">"name"</span>&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;th&gt;&lt;s:property value="#st.count"/&gt;&lt;s:property value="name"/&gt;&lt;/th&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">	&lt;!-- 迭代输出list集合 --&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"300"</span>&gt; </span><br><span class="line">		&lt;s:iterator value=<span class="string">"&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"</span> <span class="keyword">var</span>=<span class="string">"name"</span> status=<span class="string">"st"</span>&gt;</span><br><span class="line">			&lt;tr &lt;s:if test="#st.odd"&gt;style="background-color:#bbbbbb" &lt;/s:if&gt;&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;s:property value=<span class="string">"name"</span>/&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">	&lt;!-- 对Map集合进行迭代 --&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"300"</span>&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;th&gt;书名&lt;/th&gt;</span><br><span class="line">			&lt;th&gt;作者&lt;/th&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;s:iterator value=<span class="string">"#&#123;'疯狂java讲义':'李刚','轻量级Java EE企业应用实战':'李刚','疯狂IOS讲义':'李刚'&#125;"</span> <span class="keyword">var</span>=<span class="string">"name"</span> status=<span class="string">"st"</span>&gt;</span><br><span class="line">			&lt;!--根据当前迭代的元素的索引是否为奇数来决定是否使用背景颜色  --&gt;</span><br><span class="line">			&lt;tr &lt;s:if test="#st.odd"&gt;style="background-color:#bbbbbb" &lt;/s:if&gt;&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;!-- 数据Map对象里Entry的key --&gt;</span><br><span class="line">					&lt;s:property value=<span class="string">"key"</span>/&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;</span><br><span class="line">					&lt;!-- 数据Map对象里Entry的value --&gt;</span><br><span class="line">					&lt;s:property value=<span class="string">"value"</span>/&gt;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>append</code>标签</p>
<blockquote>
<ul>
<li><code>append</code>：用于将多个集合拼接成一个新的集合。</li>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;append标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;!-- 使用append标签将两个集合拼接成新的集合，新集合的名字是newList，新集合放入到Stack Context --&gt;</span><br><span class="line">	&lt;s:append <span class="keyword">var</span>=<span class="string">"newList"</span>&gt; </span><br><span class="line">		&lt;s:param value="&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">		&lt;s:param value="&#123;'http://www.baidu.com','cpws.github.io','qqqqyy.github.io'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:append&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"400"</span>&gt;</span><br><span class="line">		&lt;s:iterator value=<span class="string">"#newList"</span> <span class="keyword">var</span>=<span class="string">"name"</span> status=<span class="string">"index"</span>&gt;</span><br><span class="line">			&lt;tr &lt;s:if test="#index.even"&gt;style="background-color:#4dffff"&lt;/s:if&gt;&gt;</span><br><span class="line">				&lt;td&gt;&lt;s:property value="name"/&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">	&lt;!-- 使用append标签将List集合和Map结合拼接成新的集合，新集合的名字是newList，新集合放入到Stack Context --&gt;</span><br><span class="line">	&lt;s:append <span class="keyword">var</span>=<span class="string">"dd"</span>&gt; </span><br><span class="line">		&lt;s:param value="#&#123;'疯狂java讲义':'李刚','轻量级Java EE企业应用实战':'李刚','疯狂IOS讲义':'李刚'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">		&lt;s:param value="#&#123;'http://www.baidu.com','cpws.github.io','qqqqyy.github.io'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:append&gt;</span><br><span class="line">	&lt;!-- 使用迭代器进行迭代 --&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"400"</span>&gt;</span><br><span class="line">		&lt;s:iterator value=<span class="string">"#dd"</span> <span class="keyword">var</span>=<span class="string">"name"</span> status=<span class="string">"st"</span>&gt;</span><br><span class="line">			&lt;tr &lt;s:if test="#st.even"&gt;style="background-color:#4dffff"&lt;/s:if&gt;&gt;</span><br><span class="line">				&lt;td&gt;&lt;s:property value="key"/&gt;&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;&lt;s:property value="value"/&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>generator</code>标签</p>
<blockquote>
<ul>
<li><code>generator</code>：它是一个字符串解析器，用于讲一个字符串解析成一个集合.</li>
</ul>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;generator标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"300"</span>&gt;</span><br><span class="line">		&lt;!-- 使用generator标签将指定字符串解析成iterator集合 --&gt;</span><br><span class="line">		&lt;!-- 在generator标签内，得到的List集合位于valuestack顶端 --&gt;</span><br><span class="line">		&lt;s:generator separator=<span class="string">","</span> val=<span class="string">" '疯狂Java讲义,疯狂Java EE企业应用实战,疯狂IOS讲义' "</span>&gt;</span><br><span class="line">			&lt;!-- 没有指定迭代哪个集合，直接迭代栈顶的集合 --&gt;</span><br><span class="line">			&lt;s:iterator status=<span class="string">"st"</span>&gt;</span><br><span class="line">				&lt;tr &lt;s:if test="#st.odd"&gt;style="background-color:#bbbbbb" &lt;/s:if&gt;&gt;</span><br><span class="line">					&lt;td&gt;&lt;s:property/&gt;&lt;/td&gt;</span><br><span class="line">				&lt;/tr&gt;</span><br><span class="line">			&lt;/s:iterator&gt;</span><br><span class="line">		&lt;/s:generator&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"300"</span>&gt;</span><br><span class="line">		&lt;!-- 使用generator标签将指定字符串解析成iterator集合 指定了count和<span class="keyword">var</span> --&gt;</span><br><span class="line">		&lt;!-- 在generator标签内，得到的List集合位于valuestack顶端 --&gt;</span><br><span class="line">		&lt;s:generator separator=<span class="string">","</span> val=<span class="string">" '疯狂Java讲义,疯狂Java EE企业应用实战,疯狂IOS讲义' "</span> count=<span class="string">"2"</span> <span class="keyword">var</span>=<span class="string">"books"</span>&gt;</span><br><span class="line">			&lt;!-- 没有指定迭代哪个集合，直接迭代栈顶的集合 --&gt;</span><br><span class="line">			&lt;!-- 并且把值存入到 stack context中的books集合 --&gt;</span><br><span class="line">			&lt;s:iterator status=<span class="string">"st"</span>&gt;</span><br><span class="line">				&lt;tr &lt;s:if test="#st.odd"&gt;style="background-color:#bbbbbb" &lt;/s:if&gt;&gt;</span><br><span class="line">					&lt;td&gt;&lt;s:property/&gt;&lt;/td&gt;</span><br><span class="line">				&lt;/tr&gt;</span><br><span class="line">			&lt;/s:iterator&gt;</span><br><span class="line">		&lt;/s:generator&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">	$&#123;requestScope.books&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>注意：如果在标签定义了<code>var</code>属性，则该集合将会被存入到<code>Stack Context</code>中，在该标签外部可以访问该标签，否则，该集合会创建一个临时文件存放在<code>Value Stack</code>，可以直接被访问，但是只能在标签中被使用。 </li>
</ul>
<ul>
<li><code>merge</code>标签</li>
</ul>
<ul>
<li><code>merge</code>：用于将多个集合合拼成一个新的集合。但与append的拼接方法有所不同。</li>
<li>案例实现:</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;merge标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:merge <span class="keyword">var</span>=<span class="string">"newList"</span>&gt;</span><br><span class="line">		&lt;s:param value="&#123;'疯狂Java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">		&lt;s:param value="&#123;'hhtp://www.baidu.com','cpws.github.io'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:merge&gt;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"400"</span>&gt;</span><br><span class="line">		&lt;s:iterator value=<span class="string">"newList"</span> status=<span class="string">"st"</span>&gt;</span><br><span class="line">			&lt;tr &lt;s:if test="#st.odd"&gt;style="background-color:#bbbbbb"&lt;/s:if&gt;&gt;</span><br><span class="line">				&lt;td&gt;&lt;s:property/&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	&lt;/table&gt;	</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>merge</code>标签的效果与<code>append</code>标签一样，只是拼接成新的集合后，两者新集合中的元素顺序不一样而已。</li>
</ul>
<ul>
<li><code>subset</code>标签：这个标签用于截取集合的部分元素，形成新的子集合。</li>
</ul>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.util.SubsetIteratorFilter;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 用户自定义Decider类，实现了SubsetIteratorFilter.Decider接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDecider</span> <span class="keyword">implements</span> <span class="title">SubsetIteratorFilter</span>.<span class="title">Decider</span></span>&#123;</span><br><span class="line">	<span class="comment">//实现Decider接口必须实现decide()方法</span></span><br><span class="line">	<span class="comment">//该方法决定集合中的元素是否被选入自己</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">decide</span><span class="params">(Object element)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		String str=(String) element;</span><br><span class="line">		<span class="comment">//如果集合元素中包含JavaEE子串，即可被选入子集</span></span><br><span class="line">		<span class="keyword">return</span> str.indexOf(<span class="string">"Java EE"</span>) &gt; <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;subset标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;!-- 定义一个Decider Bean --&gt;</span><br><span class="line">	&lt;s:bean name="org.crazyit.app.util.MyDecider" var="mydecider"&gt;&lt;/s:bean&gt;</span><br><span class="line">	&lt;!-- 使用自定义的decider实例来截取目标集合，生成子集 --&gt;</span><br><span class="line">	&lt;!-- 指定<span class="keyword">var</span>属性，将生成的集合放入到page范围中 --&gt;</span><br><span class="line">	&lt;s:subset source=<span class="string">"&#123;'疯狂Java讲义','轻量级Java EE企业应用实战','经典Java EE企业应用实战','疯狂前端开发讲义','疯狂IOS讲义'&#125;"</span> decider=<span class="string">"#mydecider"</span> <span class="keyword">var</span>=<span class="string">"newList"</span>/&gt;</span><br><span class="line">	&lt;!--直接输出 page范围的newList属性 --&gt;</span><br><span class="line">	直接输出 page范围的newList属性:&lt;br&gt;$&#123;pageScope.newList&#125;</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"400"</span>&gt;</span><br><span class="line">		&lt;!-- 使用迭代器来迭代目标集合，因为没有指定value属性值，所有迭代ValueStack栈顶的值 --&gt;</span><br><span class="line">		&lt;s:iterator value=<span class="string">"#attr.newList"</span> status=<span class="string">"st"</span>&gt;</span><br><span class="line">			&lt;tr &lt;s:if test="#st.odd"&gt;style="background-color:#bbbbbb"&lt;/s:if&gt;&gt;</span><br><span class="line">				&lt;td&gt;&lt;s:property/&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>sort</code>标签<blockquote>
<ul>
<li>用于对指定集合元素进行排序</li>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 决定两个元素大小的方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Object o1, Object o2)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//根据元素字符串长度来决定大小</span></span><br><span class="line">		<span class="keyword">return</span> o1.toString().length() - o2.toString().length();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;sort标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;!-- 定义一个Comparator实例 --&gt;</span><br><span class="line">	&lt;s:bean name=<span class="string">"org.crazyit.app.util.MyComparator"</span> <span class="keyword">var</span>=<span class="string">"myComparator"</span>/&gt;</span><br><span class="line">	&lt;!-- 使用自定义的排序规则进行排序 --&gt;</span><br><span class="line">	&lt;s:sort comparator=<span class="string">"#myComparator"</span> source=<span class="string">"&#123;'疯狂Java讲义','轻量级Java EE企业应用实战','经典Java EE企业应用实战','疯狂前端开发讲义','疯狂IOS讲义'&#125;"</span> <span class="keyword">var</span>=<span class="string">"sortedList"</span>/&gt;</span><br><span class="line">	输出page范围的sortedList属性：&lt;br&gt;$&#123;pageScope.sortedList&#125;</span><br><span class="line">	</span><br><span class="line">	&lt;table border=<span class="string">"1"</span> width=<span class="string">"400"</span>&gt;</span><br><span class="line">		&lt;!-- 使用迭代器来迭代目标集合，因为没有指定value属性值，所有迭代ValueStack栈顶的值 --&gt;</span><br><span class="line">		&lt;s:iterator value=<span class="string">"#attr.sortedList"</span> status=<span class="string">"st"</span>&gt;</span><br><span class="line">			&lt;tr &lt;s:if test="#st.odd"&gt;style="background-color:#bbbbbb"&lt;/s:if&gt;&gt;</span><br><span class="line">				&lt;td&gt;&lt;s:property/&gt;&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/s:iterator&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="数据标签"><a href="#数据标签" class="headerlink" title="数据标签"></a>数据标签</h3><ul>
<li>数据标签主要用于提供各种数据访问的功能，包含显示一个<code>Action</code>里的属性，以及生成国际化输出等功能。数据标签主要包含如下几个：</li>
</ul>
<ol>
<li><code>action</code>：该标签用于在JSP页面直接调用一个action，通过指定executeResult参数，还可将该action的处理结果包含到本页面中来。</li>
<li><code>bean</code>：该标签用于创建一个<code>JavaBean</code>实例。如果指定了var属性，则可以将创建的实例放入到Stack Context中.</li>
<li><code>date</code>：用于格式化输出一个日期。</li>
<li><code>debug</code>：用于在页面上生成一个调试链接，当点击该链接时，可以看到Stack Context和ValueStack中的内容。</li>
<li><code>i18n</code>：用于指定国际化资源文件的baseName。</li>
<li><code>include</code>：用于在JSP页面中包含其他的JSP或Servlet资源。</li>
<li><code>param</code>：用于设置一个参数，通常是用作bean标签、URL标签的字标签。</li>
<li><code>push</code>：用于将某个值放入到<code>ValueStack</code>的栈顶。 </li>
<li><code>set</code>：用于设置一个新变量，并可以将新变量放入到指定的范围内。</li>
<li><code>text</code>：用于输出国际化信息。</li>
<li><code>url</code>：用于生成一个URL地址。</li>
<li><code>property</code>：用于输出某个值，包括输出valueStack,Stack Context和Action Context中的值。</li>
</ol>
<ul>
<li><code>action</code>标签：该标签用于在JSP页面直接调用一个action<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;action标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	下面调用第一个Action，并将结果包含到本页面&lt;br&gt;</span><br><span class="line">	&lt;s:action name=<span class="string">"tag1"</span>  executeResult=<span class="string">"true"</span>/&gt;&lt;hr&gt;</span><br><span class="line">	下面调用第二个Action，并将结果包含到本页面&lt;br&gt;</span><br><span class="line">	但阻止本页面请求参数传入Action。&lt;br&gt;</span><br><span class="line">	&lt;s:action name=<span class="string">"tag2"</span>  executeResult=<span class="string">"true"</span> ignoreContextParams=<span class="string">"true"</span>/&gt;&lt;hr&gt;</span><br><span class="line">	下面调用第三个Action，并不将结果包含到本页面&lt;br&gt;</span><br><span class="line">	&lt;s:action name=<span class="string">"tag2"</span>  executeResult=<span class="string">"true"</span> ignoreContextParams=<span class="string">"false"</span>/&gt;</span><br><span class="line">	本页面是否可访问：&lt;s:property value=<span class="string">"author"</span>/&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TagAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//封装用户请求参数的author成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String author;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAuthor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> author;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthor</span><span class="params">(String author)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.author = author;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//定义第一个处理逻辑</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"done"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//定义第二个处理逻辑</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		ActionContext.getContext().put(<span class="string">"author"</span>, getAuthor());</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"done"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.5.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- 定义第一个Action，使用TagAction的execute方法作为控制处理逻辑 --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"tag1"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.TagAction"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"done"</span>&gt;</span>/WEB-INF/content/succ.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 定义第二个Action，使用TagAction的login方法作为控制处理逻辑 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"tag2"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.TagAction"</span> <span class="attr">method</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"done"</span>&gt;</span>/WEB-INF/content/loginSucc.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>bean</code>：该标签用于创建一个<code>JavaBean</code>实例<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;bean标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;!-- 使用bean标签创建一个Person实例 --&gt;</span><br><span class="line">	&lt;s:bean name=<span class="string">"org.crazyit.app.dto.Person"</span> &gt;</span><br><span class="line">		&lt;!-- 使用param标签为Person类的实例传入参数 --&gt;</span><br><span class="line">		&lt;s:param name=<span class="string">"name"</span> value=<span class="string">"'yeeku'"</span>/&gt;</span><br><span class="line">		&lt;s:param name=<span class="string">"age"</span> value=<span class="string">"23"</span>/&gt;</span><br><span class="line">		&lt;s:param name=<span class="string">"aaa"</span> value=<span class="string">"10"</span>/&gt;</span><br><span class="line">		&lt;!-- 因为在bean标签体内，Person实例位于ValueStack栈顶，故可以直接访问Person实例 --&gt;</span><br><span class="line">		&lt;!--  </span><br><span class="line">		Person实例的name为：&lt;s:property value=<span class="string">"name"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		Person实例的age为：&lt;s:property value=<span class="string">"age"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		Person实例的aaa为：&lt;s:property value=<span class="string">"aaa"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		--&gt;</span><br><span class="line">	&lt;/s:bean&gt;</span><br><span class="line">	&lt;s:bean name=<span class="string">"org.crazyit.app.dto.Person"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">		&lt;s:param name=<span class="string">"name"</span> value=<span class="string">"'yeeku'"</span>/&gt;</span><br><span class="line">		&lt;s:param name=<span class="string">"age"</span> value=<span class="string">"23"</span>/&gt;</span><br><span class="line">		&lt;s:param name=<span class="string">"aaa"</span> value=<span class="string">"10"</span>/&gt;</span><br><span class="line">	&lt;/s:bean&gt;</span><br><span class="line">	&lt;!-- 根据JavaBean实例的<span class="keyword">var</span>属性来获取JavaBean实例 --&gt;</span><br><span class="line">	Person实例的name为：&lt;s:property value=<span class="string">"#p.name"</span>/&gt;&lt;br/&gt;</span><br><span class="line">	Person实例的age为：&lt;s:property value=<span class="string">"#p.age"</span>/&gt;&lt;br/&gt;</span><br><span class="line">	Person实例的aaa为：&lt;s:property value=<span class="string">"#p.aaa"</span>/&gt;&lt;br/&gt;</span><br><span class="line">	$&#123;requestScope.p&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> aaa;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">int</span> aaa)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">		<span class="keyword">this</span>.aaa = aaa;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//省略getter和setter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>date</code>：用于格式化输出一个日期</p>
<blockquote>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:bean <span class="keyword">var</span>=<span class="string">"now"</span> name=<span class="string">"java.util.Date"</span>/&gt;</span><br><span class="line">	nice=<span class="keyword">false</span>，且指定format=<span class="string">"dd/MM/YYYY"</span>&lt;br/&gt;</span><br><span class="line">	&lt;s:date name=<span class="string">"#now"</span> format=<span class="string">"dd/MM/YYYY"</span> nice=<span class="string">"false"</span>/&gt;&lt;hr/&gt;</span><br><span class="line">	nice=<span class="keyword">true</span>，且指定format=<span class="string">"dd/MM/YYYY"</span>&lt;br/&gt;</span><br><span class="line">	&lt;s:date name=<span class="string">"#now"</span> format=<span class="string">"dd/MM/YYYY"</span> nice=<span class="string">"true"</span>/&gt;&lt;hr/&gt;</span><br><span class="line">	指定nice=<span class="string">"true"</span>&lt;br/&gt;</span><br><span class="line">	&lt;s:date name=<span class="string">"#now"</span>  nice=<span class="string">"true"</span>/&gt;&lt;hr/&gt;</span><br><span class="line">	指定nice=<span class="string">"false"</span>，且没有指定formate属性&lt;br/&gt;</span><br><span class="line">	&lt;s:date name=<span class="string">"#now"</span>  nice=<span class="string">"false"</span>/&gt;&lt;hr/&gt;</span><br><span class="line">	指定nice=<span class="string">"false"</span>，且没有指定formate属性，但指定<span class="keyword">var</span>属性&lt;br/&gt;</span><br><span class="line">	&lt;s:date name=<span class="string">"#now"</span> nice=<span class="string">"false"</span> <span class="keyword">var</span>=<span class="string">"abc"</span>/&gt;&lt;hr/&gt;</span><br><span class="line">	$&#123;requestScope.abc&#125;	&lt;s:property value=<span class="string">"#abc"</span>/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>debug</code>：用于在页面上生成一个调试链接.</p>
<blockquote>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:debug/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>include</code>：用于在JSP页面中包含其他的JSP或Servlet资源。</p>
<blockquote>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;include标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h2&gt;使用s:include标签来包含目标页面&lt;/h2&gt;</span><br><span class="line">&lt;!-- 使用include标签来包含其他页面 --&gt;</span><br><span class="line">&lt;s:include value=<span class="string">"include-file.jsp"</span>/&gt;</span><br><span class="line">&lt;!-- 使用include标签来包含其他页面，并且传入参数 --&gt;</span><br><span class="line">&lt;s:include value=<span class="string">"include-file.jsp"</span>&gt;</span><br><span class="line">	&lt;s:param name=<span class="string">"author"</span> value=<span class="string">"'yeeku'"</span>/&gt;</span><br><span class="line">&lt;/s:include&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h3&gt;被包含的页面&lt;/h3&gt;</span><br><span class="line">	author的参数值：$&#123;param.author&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>param</code>标签：主要用于为其他标签提供参数。</p>
</li>
<li><p><code>push</code>标签：<code>push</code>标签用于将某个值放到<code>ValueStack</code>的栈顶。</p>
<blockquote>
<ul>
<li>案例实现:</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h2&gt;使用s:push标签将某个值放入到Value Stack&lt;/h2&gt;</span><br><span class="line">	&lt;!-- 使用bean标签来创建一个JavaBean实例，指定<span class="keyword">var</span>属性，并且将其值放到<span class="keyword">var</span>属性中 --&gt;</span><br><span class="line">	&lt;s:bean name=<span class="string">"org.crazyit.app.dto.Person"</span>  <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">		&lt;s:param name="name" value="'ok'"&gt;&lt;/s:param&gt;</span><br><span class="line">		&lt;s:param name="age" value="18"&gt;&lt;/s:param&gt;</span><br><span class="line">		&lt;s:param name="aaa" value="12"&gt;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:bean&gt;</span><br><span class="line">	&lt;!-- 将Stack Context中的p对象放入到ValueStack --&gt;</span><br><span class="line">	&lt;s:push value=<span class="string">"#p"</span>&gt;</span><br><span class="line">		ValueStack栈顶对象的name属性：&lt;s:property value=<span class="string">"name"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		ValueStack栈顶对象的age属性：&lt;s:property value=<span class="string">"age"</span>/&gt;&lt;br/&gt;</span><br><span class="line">		ValueStack栈顶对象的aaa属性：&lt;s:property value=<span class="string">"aaa"</span>/&gt;&lt;br/&gt;</span><br><span class="line">	&lt;/s:push&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>set</code>标签：用于将某个值放入到指定的范围中。</p>
<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;set标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h2&gt;使用s:set设置一个新变量&lt;/h2&gt;</span><br><span class="line">	&lt;!-- 使用s:bean标签定义一个JavaBean实例 --&gt;</span><br><span class="line">	&lt;s:bean name=<span class="string">"org.crazyit.app.dto.Person"</span> <span class="keyword">var</span>=<span class="string">"p"</span>&gt;</span><br><span class="line">		&lt;s:param name="name" value="'ok'"&gt;&lt;/s:param&gt;</span><br><span class="line">		&lt;s:param name="age" value="18"&gt;&lt;/s:param&gt;</span><br><span class="line">		&lt;s:param name="aaa" value="12"&gt;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:bean&gt;</span><br><span class="line">	将Stack Context中的p值放入到默认范围（action）内。&lt;br/&gt;</span><br><span class="line">	&lt;s:set value=<span class="string">"#p"</span> <span class="keyword">var</span>=<span class="string">"xxx"</span> /&gt;</span><br><span class="line">	Stack Context内xxx对象的name属性：&lt;s:property value=<span class="string">"#xxx.name"</span>/&gt;&lt;br/&gt;</span><br><span class="line">	Stack Context内xxx对象的age属性：&lt;s:property value=<span class="string">"#xxx.age"</span>/&gt;&lt;br/&gt;</span><br><span class="line">	Stack Context内xxx对象的aaa属性：&lt;s:property value=<span class="string">"#xxx.aaa"</span>/&gt;&lt;br/&gt;</span><br><span class="line">	request范围的xxx对象的name属性：$&#123;requestScope.xxx.name&#125;&lt;br/&gt;</span><br><span class="line">	request范围的xxx对象的age属性：$&#123;requestScope.xxx.age&#125;&lt;br/&gt;</span><br><span class="line">	request范围的xxx对象的aaa属性：$&#123;requestScope.xxx.aaa&#125;&lt;hr/&gt;</span><br><span class="line">	将Stack Context中的p值放入application范围内。&lt;br/&gt;</span><br><span class="line">	&lt;s:set value=<span class="string">"#p"</span> <span class="keyword">var</span>=<span class="string">"yyy"</span> scope=<span class="string">"application"</span>/&gt;</span><br><span class="line">	application范围的yyy对象的name属性：$&#123;applicationScope.yyy.name&#125;&lt;br/&gt;</span><br><span class="line">	application范围的yyy对象的age属性：$&#123;applicationScope.yyy.age&#125;&lt;br/&gt;</span><br><span class="line">	application范围的yyy对象的aaa属性：$&#123;applicationScope.yyy.aaa&#125;&lt;hr/&gt;</span><br><span class="line">	将Stack Context中的p值放入session范围内。&lt;br/&gt;</span><br><span class="line">	&lt;s:set value=<span class="string">"#p"</span> <span class="keyword">var</span>=<span class="string">"zzz"</span> scope=<span class="string">"session"</span>/&gt;</span><br><span class="line">	session范围的zzz对象的name属性：$&#123;sessionScope.zzz.name&#125;&lt;br/&gt;</span><br><span class="line">	session范围的zzz对象的age属性：$&#123;sessionScope.zzz.age&#125;&lt;br/&gt;</span><br><span class="line">	session范围的zzz对象的aaa属性：$&#123;sessionScope.zzz.aaa&#125;&lt;hr/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>url</code>标签：用于生成一个url地址。\</p>
<blockquote>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;url标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h2&gt;s：url来生成一个URL地址&lt;/h2&gt;</span><br><span class="line">	只指定value属性的形式&lt;br/&gt;</span><br><span class="line">	&lt;s:url value=<span class="string">"editGadget.action"</span>/&gt;&lt;hr/&gt;</span><br><span class="line">	指定action属性，且使用param传入参数的形式&lt;br/&gt;</span><br><span class="line">	&lt;s:url action=<span class="string">"showBooks"</span>&gt;</span><br><span class="line">		&lt;s:param name=<span class="string">"author"</span> value=<span class="string">"'yeeku'"</span>/&gt;</span><br><span class="line">	&lt;/s:url&gt;&lt;hr/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>property</code>标签：输出指定值。</p>
<h3 id="主题和模板"><a href="#主题和模板" class="headerlink" title="主题和模板"></a>主题和模板</h3><h3 id="自定义主题"><a href="#自定义主题" class="headerlink" title="自定义主题"></a>自定义主题</h3><h3 id="表单标签"><a href="#表单标签" class="headerlink" title="表单标签"></a>表单标签</h3></li>
<li><p>所有表单标签处理类都继承了<code>UIBean</code>类，UIBean包含了一些通用属性，这些通用属性分成三种：</p>
</li>
</ul>
<ol>
<li>模板相关属性。</li>
<li>JavaScript相关属性。</li>
<li>通用属性。</li>
</ol>
<ul>
<li>表单标签的<code>name</code>和<code>value</code>属性。</li>
<li>checkboxlist标签:可以一次创建多个复选框。<blockquote>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;checkboxlist标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form&gt;</span><br><span class="line">		&lt;!-- 使用简单的集合来生成多个复选框 --&gt;</span><br><span class="line">		&lt;s:checkboxlist name="a" label="请选择您喜欢的图书" labelposition="top" list="&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"&gt;&lt;/s:checkboxlist&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">			使用简单Map来生成多个复选框</span><br><span class="line">			使用Map的key值作为复选框的value</span><br><span class="line">			使用Map的value值作为复选框的标签</span><br><span class="line">		 --&gt;</span><br><span class="line">		 &lt;s:checkboxlist name="b" label="请选择您想出版的日期：" labelposition="top"  list="#&#123;'疯狂java讲义':'2008年9月','轻量级Java EE企业应用实战':'2008年12月','疯狂IOS讲义':'2014年1月'&#125;" listKey="key" listValueKey="value"&gt;&lt;/s:checkboxlist&gt;</span><br><span class="line">		 &lt;!-- 创建一个JavaBean对象，并将其放入Stack Context中--&gt;</span><br><span class="line">		 &lt;s:bean name="org.crazyit.app.service.BookService" var="bs"&gt;&lt;/s:bean&gt;</span><br><span class="line">		 &lt;!-- </span><br><span class="line">		 	使用集合里放多个JavaBean实例来生成多个复选框</span><br><span class="line">		 	集合name作为标签，集合author作为复选框value </span><br><span class="line">		 --&gt;</span><br><span class="line">		 &lt;s:checkboxlist name="c" label="请选择您喜欢的图书：" labelposition="top" list="#bs.books" listKey="author" listValue="name"&gt;&lt;/s:checkboxlist&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.crazyit.app.dto.Book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> Book[] getBooks() &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Book[] &#123;</span><br><span class="line">			<span class="keyword">new</span> Book(<span class="string">"疯狂Java讲义"</span>,<span class="string">"李刚"</span>),</span><br><span class="line">			<span class="keyword">new</span> Book(<span class="string">"疯狂Java EE企业应用实战"</span>,<span class="string">"李刚"</span>),</span><br><span class="line">			<span class="keyword">new</span> Book(<span class="string">"疯狂ios讲义"</span>,<span class="string">"李刚"</span>),</span><br><span class="line">			<span class="keyword">new</span> Book(<span class="string">"疯狂前端开发讲义"</span>,<span class="string">"李刚"</span>)	</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String author;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(String name, String author)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.author = author;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAuthor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> author;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthor</span><span class="params">(String author)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.author = author;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>radio</code>标签：与<code>checkboxlist</code>的用法和属性完全一样，只是该标签生成的是单选按钮。</p>
<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;radio标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form&gt;</span><br><span class="line">		&lt;!-- 使用简单的集合来生成单选按钮--&gt;</span><br><span class="line">		&lt;s:radio name="a" label="请选择您喜欢的图书" labelposition="top" list="&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"&gt;&lt;/s:radio&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">			使用简单Map来生成多个单选按钮</span><br><span class="line">			使用Map的key值作为单选按钮的value</span><br><span class="line">			使用Map的value值作为单选按钮的标签</span><br><span class="line">		 --&gt;</span><br><span class="line">		 &lt;s:radio name="b" label="请选择您想出版的日期：" labelposition="top"  list="#&#123;'疯狂java讲义':'2008年9月','轻量级Java EE企业应用实战':'2008年12月','疯狂IOS讲义':'2014年1月'&#125;" listKey="key" listValueKey="value"&gt;&lt;/s:radio&gt;</span><br><span class="line">		 &lt;!-- 创建一个JavaBean对象，并将其放入Stack Context中--&gt;</span><br><span class="line">		 &lt;s:bean name="org.crazyit.app.service.BookService" var="bs"&gt;&lt;/s:bean&gt;</span><br><span class="line">		 &lt;!-- </span><br><span class="line">		 	使用集合里放多个JavaBean实例来生成多个单选按钮</span><br><span class="line">		 	集合name作为标签，集合author作为单选按钮value </span><br><span class="line">		 --&gt;</span><br><span class="line">		 &lt;s:radio name="c" label="请选择您喜欢的图书：" labelposition="top" list="#bs.books" listKey="author" listValue="name"&gt;&lt;/s:radio&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>select</code>标签：用于生成一个下拉列表框。</p>
<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;select标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form&gt;</span><br><span class="line">		&lt;!-- 使用简单的集合来生成下拉选择框 --&gt;</span><br><span class="line">		&lt;s:select name=<span class="string">"a"</span> label=<span class="string">"请选择您喜欢的图书"</span> labelposition=<span class="string">"top"</span>  multiple=<span class="string">"true"</span></span><br><span class="line">			list="&#123;'疯狂java讲义','轻量级Java EE企业应用实战','JavaScript:The Definitive Guide'&#125;"&gt;&lt;/s:select&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">			使用简单Map来生成下拉选择框</span><br><span class="line">		 --&gt;</span><br><span class="line">		 &lt;s:select name="b" label="请选择您想出版的日期：" labelposition="top"  list="#&#123;'疯狂java讲义':'2008年9月','轻量级Java EE企业应用实战':'2008年12月','疯狂IOS讲义':'2014年1月'&#125;" listKey="key" listValueKey="value"&gt;&lt;/s:select&gt;</span><br><span class="line">		 &lt;!-- 创建一个JavaBean对象，并将其放入Stack Context中--&gt;</span><br><span class="line">		 &lt;s:bean name="org.crazyit.app.service.BookService" var="bs"&gt;&lt;/s:bean&gt;</span><br><span class="line">		 &lt;!-- </span><br><span class="line">		 	使用集合里放多个JavaBean实例来生成下拉选择框</span><br><span class="line">		 --&gt;</span><br><span class="line">		 &lt;s:select name="c" label="请选择您喜欢的图书：" labelposition="top" multiple="true" list="#bs.books" listKey="author" listValue="name"&gt;&lt;/s:select&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>optgroup</code>标签：用于生成一个下拉列表框的选项组，因此该标签需要在<code>&lt;s:select&gt;</code>中使用。</p>
<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;optgroup标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form&gt;</span><br><span class="line">			&lt;!-- </span><br><span class="line">				使用简单Map为列表框生成选项</span><br><span class="line">			 --&gt;</span><br><span class="line">		 &lt;s:select name=<span class="string">"b"</span> label=<span class="string">"请选择你喜欢的书："</span> size=<span class="string">"7"</span> labelposition=<span class="string">"top"</span>  list=<span class="string">"#&#123;'疯狂java讲义':'李刚','轻量级Java EE企业应用实战':'李刚','疯狂IOS讲义':'李刚'&#125;"</span> listKey=<span class="string">"key"</span> listValueKey=<span class="string">"value"</span>&gt;</span><br><span class="line">		 	&lt;!-- 使用Map对象生成选项组 --&gt;</span><br><span class="line">		 	&lt;s:optgroup label="Rod Johnson" list="#&#123;'Expert One-on-one J2EE Design and Development':'Johnson'&#125;"&gt;&lt;/s:optgroup&gt;</span><br><span class="line">		 	&lt;s:optgroup label="David Flanagan" list="#&#123;'JavaScript :The Definitive Guide':'David'&#125;"&gt;&lt;/s:optgroup&gt;</span><br><span class="line">		 &lt;/s:select&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>head</code>标签：该标签主要用于生成<code>HTML</code>的<code>&lt;head ../&gt;</code>部分。</p>
</li>
<li><p><code>updownselect</code>标签：该标签的用法非常相思雨select标签的使用，区别在于该标签生成的列表框可以上下移动。</p>
<blockquote>
<ul>
<li>案例实现</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;updownselect标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form&gt;</span><br><span class="line">		&lt;!-- 使用简单集合来生成上下移动选项的下拉列表框 --&gt;</span><br><span class="line">		&lt;s:updownselect name=<span class="string">"a"</span> label=<span class="string">"请选择您喜欢的书："</span> labelposition=<span class="string">"top"</span> </span><br><span class="line">			list=<span class="string">"&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"</span></span><br><span class="line">			moveUpLabel="向上移动"&gt;&lt;/s:updownselect&gt;</span><br><span class="line">		&lt;!-- 使用简单Map为列表框生成选项  emptyOption=<span class="string">"true"</span>增加空白选项--&gt;</span><br><span class="line">		&lt;s:updownselect name=<span class="string">"b"</span> label=<span class="string">"请选择您想出版的日期："</span> labelposition=<span class="string">"top"</span> moveDownLabel=<span class="string">"向下移动"</span></span><br><span class="line">			list=<span class="string">"#&#123;'疯狂java讲义':'2008年9月','轻量级Java EE企业应用实战':'2008年12月','疯狂IOS讲义':'2014年1月'&#125;"</span> </span><br><span class="line">			listKey="key" listValueKey="value" emptyOption="true"&gt;&lt;/s:updownselect&gt;</span><br><span class="line">			</span><br><span class="line">		&lt;s:bean name="org.crazyit.app.service.BookService" var="bs"&gt;&lt;/s:bean&gt;</span><br><span class="line">		&lt;s:updownselect name="c" label="请选择您喜欢的图书：" labelposition="top" selectAllLabel="全选" multiple="true" list="#bs.books" listKey="author" listValue="name"&gt;&lt;/s:updownselect&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>doubleselect</code>标签：会生成一个级联列表框。</p>
<blockquote>
<ul>
<li>案例实现1:</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;doubleselect标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form action=<span class="string">"x"</span>&gt;</span><br><span class="line">		&lt;s:doubleselect </span><br><span class="line">			 label=<span class="string">"请选择您喜欢的书"</span> labelposition=<span class="string">"top"</span> name=<span class="string">"author"</span> list=<span class="string">"&#123;'李刚','David'&#125;"</span>	</span><br><span class="line">			 doubleList=<span class="string">"top=='李刚'?&#123;'轻量级Java EE企业级应用实战','疯狂IOS讲义','疯狂Java讲义'&#125;:&#123;'JavaScript:the definitive guide'&#125;"</span>  doubleName=<span class="string">"book"</span>/&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>案例实现2:</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;使用s:doubleselect生成级联列表框&lt;/h3&gt;</span><br><span class="line">&lt;s:set <span class="keyword">var</span>=<span class="string">"bs"</span> value=<span class="string">"#&#123;'李刚':&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;,'Johnson':&#123;'Expert One-on-one J2EE Design and Development'&#125;,'David':&#123;'JavaScript :The Definitive Guide'&#125;&#125;"</span>/&gt;</span><br><span class="line">&lt;s:form action=<span class="string">"x"</span>&gt;</span><br><span class="line">	&lt;s:doubleselect </span><br><span class="line">		 label=<span class="string">"请选择您喜欢的书"</span>  name=<span class="string">"author"</span> list=<span class="string">"#bs.keySet()"</span> size=<span class="string">"3"</span>	</span><br><span class="line">		 doubleList=<span class="string">"#bs[top]"</span> doubleSize=<span class="string">"3"</span>  doubleName=<span class="string">"book"</span>/&gt;</span><br><span class="line">&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>optiontransferselect</code>标签：会生成两个列表选择框，并生成系列按钮控制各选框之间的移动、升降等。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form&gt;</span><br><span class="line">		&lt;!-- 使用简单的集合对象生成可移动的下拉框 --&gt;</span><br><span class="line">		&lt;s:optiontransferselect </span><br><span class="line">			label=<span class="string">"请选择你喜欢的书"</span></span><br><span class="line">			name=<span class="string">"cnbook"</span></span><br><span class="line">			leftTitle=<span class="string">"中文图书"</span></span><br><span class="line">			rightTitle=<span class="string">"外文图书"</span></span><br><span class="line">			list=<span class="string">"&#123;'疯狂java讲义','轻量级Java EE企业应用实战','疯狂IOS讲义'&#125;"</span></span><br><span class="line">			multiple=<span class="string">"true"</span></span><br><span class="line">			addToLeftLabel=<span class="string">"向左移动"</span></span><br><span class="line">			addToRightLabel=<span class="string">"向右移动"</span></span><br><span class="line">			selectAllLabel=<span class="string">"全部选择"</span></span><br><span class="line">			addAllToRightLabel=<span class="string">"全部右移"</span></span><br><span class="line">			addAllToLeftLabel=<span class="string">"全部左移"</span></span><br><span class="line">			headerKey=<span class="string">"cnKey"</span></span><br><span class="line">			headerValue=<span class="string">"--- 选择中文图书 ---"</span></span><br><span class="line">			emptyOption=<span class="string">"true"</span></span><br><span class="line">			doubleList=<span class="string">"&#123;'Expert One-on-one J2EE Design and Development','JavaScript :The Definitive Guide'&#125;"</span>  </span><br><span class="line">			doubleName=<span class="string">"enBook"</span></span><br><span class="line">			doubleHeaderKey=<span class="string">"enKey"</span></span><br><span class="line">			doubleHeaderValue=<span class="string">"--- 选择外文图书 ---"</span></span><br><span class="line">			doubleEmptyOption=<span class="string">"true"</span></span><br><span class="line">			doubleMultiple=<span class="string">"true"</span></span><br><span class="line">			/&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>token</code>标签：防止重复提交表单的标签。</p>
<blockquote>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;token标签&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h3&gt;使用s:token防止重复提交&lt;/h3&gt;</span><br><span class="line">	&lt;s:form action=<span class="string">"pro"</span>&gt;</span><br><span class="line">		&lt;!-- 普通表单域 --&gt;</span><br><span class="line">		&lt;s:textfield name=<span class="string">"book"</span> label=<span class="string">"书名"</span> /&gt;</span><br><span class="line">		&lt;!-- 用于防刷新的token标签 --&gt;</span><br><span class="line">		&lt;s:token/&gt;</span><br><span class="line">		&lt;s:submit value="提交"&gt;&lt;/s:submit&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> String book;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getBook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> book;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBook</span><span class="params">(String book)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.book = book;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//处理用户的业务逻辑</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(getBook());</span><br><span class="line">		<span class="keyword">return</span> NONE;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"</span></span><br><span class="line"><span class="meta">        "http://struts.apache.org/dtds/struts-2.5.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMethodInvocation"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"pro"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.ProAction"</span>&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!-- 使用系统默认的拦截器 --&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!-- 使用防止刷新的拦截器 --&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"token"</span>/&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!-- 定义重复提交的转向视图，该逻辑视图名必须是：invalid.token --&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"invalid.token"</span>&gt;</span>/WEB-INF/content/refresh.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>使用<code>token</code>标签需要注意两点:<blockquote>
<ul>
<li>在页面中添加<code>&lt;s:token/&gt;</code>标签。</li>
<li>在配置文件中添加拦截器并且配置<code>invalid.token</code>结果集</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="非表单标签"><a href="#非表单标签" class="headerlink" title="非表单标签"></a>非表单标签</h3><ul>
<li>非表单标签主要用于显示<code>action</code>里封装的信息。非表单标签主要有如下几个:</li>
</ul>
<ol>
<li><code>actionerror</code>：如果<code>Action</code>实例的<code>getActionErrors()</code>方法不返回<code>null</code>，则该标签负责输出该方法返回的系列错误。</li>
<li><code>actionmessage</code>：如果<code>Action</code>实例的<code>getActionMessages()</code>方法不返回<code>null</code>，则该标签负责输出该方法返回的系列错误。</li>
<li><code>component</code>：使用此标签可以生成一个自定义组件。</li>
<li><code>fielderror</code>：如果<code>Action</code>实例存在表单域的类型转换错误、校验错误，则该标签负责输出错误信息。</li>
</ol>
<ul>
<li><code>actionerror</code>和<code>actionmessage</code>标签</li>
<li><code>component</code>标签：用于创建自定义组件<blockquote>
<ul>
<li>案例实现：</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h2&gt;使用s:component标签&lt;/h2&gt;</span><br><span class="line">	使用默认主题(xHTML)，默认主题目录(template)&lt;br&gt;</span><br><span class="line">	使用mytemplate作为视图组件</span><br><span class="line">	&lt;s:component template=<span class="string">"mytemplate.jsp"</span>&gt;</span><br><span class="line">		&lt;s:param name="list" value="&#123;'疯狂Java讲义','疯狂IOS讲义','轻量级 Java EE企业应用实战'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:component&gt;&lt;hr&gt;</span><br><span class="line">	使用自定义主题，自定义主题目录&lt;br&gt;</span><br><span class="line">	使用myAnotherTemplate.jsp作为视图组件</span><br><span class="line">	&lt;s:component template=<span class="string">"myAnotherTemplate.jsp"</span> templateDir=<span class="string">"myTemplateDir"</span> theme=<span class="string">"myTheme"</span>&gt;</span><br><span class="line">		&lt;s:param name="list" value="&#123;'疯狂Java讲义','疯狂IOS讲义','轻量级 Java EE企业应用实战'&#125;"&gt;&lt;/s:param&gt;</span><br><span class="line">	&lt;/s:component&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Struts2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/09/10/Struts2/" class="article-date">
  	<time datetime="2019-09-10T03:05:26.000Z" itemprop="datePublished">2019-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/09/10/Struts2/">
        Struts2
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Struts2框架学习"><a href="#Struts2框架学习" class="headerlink" title="Struts2框架学习"></a>Struts2框架学习</h2><h3 id="第一讲：回顾"><a href="#第一讲：回顾" class="headerlink" title="第一讲：回顾"></a>第一讲：回顾</h3><ul>
<li>Web开发的进程有两种模式，model1开发模式和model2开发模式。</li>
<li>Model1模式<ul>
<li>优点：执行效率高，开发效率高，适合中小型项目。</li>
<li>缺点：逻辑比较混乱，页面混乱，维护困难，扩展不容易。</li>
</ul>
</li>
<li>Model2<ul>
<li>优点：解耦，将试图层和业务层分离。结构清晰，分工明确，维护方便，适合中大型项目。</li>
<li>缺点：执行效率相对Model1低,代码量大，重复代码比较多。</li>
<li>Model2又称为MVC设计模式。</li>
<li>M:model模型</li>
<li>V:view试图</li>
<li>C：controller控制</li>
</ul>
</li>
<li>使用Servlet的MVC存在一些问题，有重复的代码—通过MVC框架来解决。</li>
<li>Servlet解决了什么问题<ul>
<li>将url映射到一个java类的处理方法上。</li>
<li>接收请求的数据。</li>
<li>如何将处理结果显示到页面。</li>
<li>如何进行页面的跳转。<h3 id="第二讲：框架"><a href="#第二讲：框架" class="headerlink" title="第二讲：框架"></a>第二讲：框架</h3></li>
</ul>
</li>
<li>Java学习路线<ul>
<li>基础语法—-&gt;方法（目的：减少代码，代码重复利用）—-&gt;类（目的：代码复用，OOP：面向对象）—-&gt; jar包（多个类封装为jar包。目的：代码复用）—-&gt; 框架（一个或多个jar包。目的：代码重用）</li>
<li>从中体现最多的思想是：封装</li>
</ul>
</li>
<li>什么是框架？<ul>
<li>framework</li>
<li>框架是模板，模型，模子。</li>
<li>专业语言描述：框架是一个可重用的半成品。</li>
</ul>
</li>
<li>为什么要学框架？<ul>
<li>提高开发效率，降低学习难度。</li>
</ul>
</li>
<li>如何学习框架？    <ul>
<li>框架是别人提供的，那么使用框架时，要遵守框架提供的规。</li>
<li>学习框架就是学习框架的规则。</li>
<li>框架有两个部分组成：可变的部分和不可变的部分。</li>
</ul>
</li>
<li>常见的框架有哪些<ul>
<li>struts2,strut1,spring,hibernate,Mybatis,Shiro,nutz等待。<h3 id="第三讲：Struts入门"><a href="#第三讲：Struts入门" class="headerlink" title="第三讲：Struts入门"></a>第三讲：Struts入门</h3></li>
</ul>
</li>
<li>什么是struts？<ul>
<li>Apache Struts is a free, open-source, MVC framework for creating elegant, modern Java web applications. It favors convention over configuration, is extensible using a plugin architecture, and ships with plugins to support REST, AJAX and JSON. </li>
</ul>
</li>
<li>Struts2是一个开源、免费、轻量级的<code>mvc</code>框架<ul>
<li>轻量级：如果一个框架没有侵入性，就说该框架是轻量级的。</li>
<li>侵入性：如果使用一个框架必须实现框架提供的接口，或者继承框架提供的类。</li>
</ul>
</li>
<li>在Struts2之前是Struts1。Struts1出现很早，市场占有率比较高，所以不支持一些新的试图层展示技术，逐渐被淘汰。Struts2=Struts1+webwork</li>
<li>Struts2是基于请求的mvc框架。</li>
<li>Struts2的目录结构<ul>
<li>apps：应用案例。</li>
<li>docs：文档。</li>
<li>lib：使用的库包。</li>
<li>src：源码。</li>
</ul>
</li>
<li>Struts2的Hello World案例<blockquote>
<blockquote>
<ul>
<li>新建web项目</li>
<li>导入jar包</li>
<li>编写web.xml文件–配置struts2的前端控制器（分发器）</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置struts2的前端控制器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<blockquote>
<ul>
<li>编写业务处理类</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">* struts2的第一个案例</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> 朱楚利</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    * 在Struts2中，所有的业务方法都是public</span></span><br><span class="line"><span class="comment">    * 返回值都为String类，所有的业务方法都没有参数</span></span><br><span class="line"><span class="comment">    * 方法名可以自定义，默认是execute()</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello struts2"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>在src下，添加strut2的配置文件，名称为为struts.xml，该配置文件名不能更改，并进行配置。</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">    "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            配置action</span></span><br><span class="line"><span class="comment">            配置url和处理类的方法进行映射</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"demo.HelloWorld"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span>&gt;</span>/hello.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>编写hello.jsp页面</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">    &lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;hello world struts2&lt;/h1&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>发布项目并进行测试。</li>
</ul>
</blockquote>
</blockquote>
<h3 id="第四讲-配置讲解"><a href="#第四讲-配置讲解" class="headerlink" title="第四讲 配置讲解"></a>第四讲 配置讲解</h3><ul>
<li><p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    配置struts2的前端控制器 </span></span><br><span class="line"><span class="comment">    struts2框架开始工作的入口</span></span><br><span class="line"><span class="comment">    接管请求</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 名称自定义 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Struts2提供的控制器类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>struts2.xml 该配置文件的文件名固定，并且只能放在src目录下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	package 分模块管理</span></span><br><span class="line"><span class="comment">	name属性属性值自定义但是不能重复，在一个项目中是唯一的</span></span><br><span class="line"><span class="comment">	namespace属性命名空间与url请求路径直接相关</span></span><br><span class="line"><span class="comment">	如：“/” 请求为 /hello.action;</span></span><br><span class="line"><span class="comment">	如："/user"，则请求路径为/user/hello.action</span></span><br><span class="line"><span class="comment">	extends 继承 必须直接或间接继承struts-default</span></span><br><span class="line"><span class="comment">	result的请求路径是相对namespace的属性值</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		配置action </span></span><br><span class="line"><span class="comment">		配置url和处理类的方法进行映射</span></span><br><span class="line"><span class="comment">		name为请求名称 不加后缀</span></span><br><span class="line"><span class="comment">		class 处理类的完全限定名称 包名+类名，如果不配置，由默认类来处理</span></span><br><span class="line"><span class="comment">		com.opensymphony.xwork2.ActionSupport</span></span><br><span class="line"><span class="comment">		method指定处理请求的方法，默认是execute()方法</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"demo.HelloWorld"</span> <span class="attr">method</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			result结果集配置</span></span><br><span class="line"><span class="comment">			name 结果集名称，和处理方法的返回之匹配 默认为success，可以自定义。</span></span><br><span class="line"><span class="comment">			Struts2提供了5个返回结果：</span></span><br><span class="line"><span class="comment">				Action.SUCCESS： 执行成功，跳转到下一个试图</span></span><br><span class="line"><span class="comment">				Action.NONE：执行成功，不需要试图展示</span></span><br><span class="line"><span class="comment">				Action.ERRPR:执行失败，显示失败页面</span></span><br><span class="line"><span class="comment">				Action.INPUT：要执行该Action需要更多的输入条件</span></span><br><span class="line"><span class="comment">				Action.LOGIN：需要登陆后才能执行</span></span><br><span class="line"><span class="comment">			type指定响应结果类型</span></span><br><span class="line"><span class="comment">				dispatcher 请求转发，默认使用</span></span><br><span class="line"><span class="comment">				redirect 请求重定向</span></span><br><span class="line"><span class="comment">				redirectAction 重定向到另一个action</span></span><br><span class="line"><span class="comment">			result的值为跳转页面 不加"/"为相对namespace路径，建议使用绝对路径</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">""</span>&gt;</span>/hello.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="第五讲-Struts2的执行流程"><a href="#第五讲-Struts2的执行流程" class="headerlink" title="第五讲 Struts2的执行流程"></a>第五讲 <code>Struts2</code>的执行流程</h3><blockquote>
<ul>
<li>浏览器发起请求 –&gt; 服务器接收请求并交给<code>Struts2</code>的前端控制器 —–&gt; 根据请求的<code>url</code>查看<code>struts.xml</code>中的<code>namespace+actionName</code>是否存在 –&gt; 执行action所对应的类的对应方法 —&gt; 根据方法的执行结果到action的结果集进行匹配 –&gt; 响应结果。</li>
</ul>
<ul>
<li>Struts2</li>
</ul>
</blockquote>
<p><img src="image/1568096603(1).png" alt="avator.png"></p>
<h3 id="第六讲-Struts2的数据处理一"><a href="#第六讲-Struts2的数据处理一" class="headerlink" title="第六讲 Struts2的数据处理一"></a>第六讲 Struts2的数据处理一</h3><blockquote>
<ul>
<li>在struts2中，对表单数据的处理有三种：属性驱动，对象驱动，模型驱动</li>
<li>使用Strut2获取表达数据：只需要表单域数据名称和Action处理类的属性名称一致，并且提供属性的set方法，那么在Action处理类中即可获取表单数据。这种获取数据的方式称为<code>属性驱动</code>。</li>
<li>处理类：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * Struts2数据处理案列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="comment">//登陆处理业务</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+username+<span class="string">";password="</span>+password);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Struts2的数据处理&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"login.action"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">		username:&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>/&gt;&lt;br&gt;</span><br><span class="line">		password:&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>/&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">"button"</span> value=<span class="string">"登录"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN" "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"demo.LoginAction"</span> <span class="attr">method</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果数据需要显示在页面上，那么该数据可以作为处理类的数据，处理方法后该属性有值，并且有该属性的get方法，那么在页面上可以直接通过el表达式获取。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * Struts2数据处理案列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="comment">//登陆处理业务</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+username+<span class="string">";password="</span>+password);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">&lt;title&gt;成功页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;My First Struts Demo&lt;/h1&gt;</span><br><span class="line">	&lt;h3&gt;恭喜$&#123;username&#125;登录成功&lt;h3&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;password&#125;&lt;h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="第七讲-数据处理二"><a href="#第七讲-数据处理二" class="headerlink" title="第七讲 数据处理二"></a>第七讲 数据处理二</h2><blockquote>
<p>IOC：控制反转 </p>
<ul>
<li>对象驱动方式获取属性：（重点）<blockquote>
<ul>
<li>在action的处理类中，属性以对象的形式存在，该属性对象只需声明并为其提供get方法和set方法即可，需要保证该属性对象有无参构造方法。</li>
<li>在表单域中的表单域名称以属性对象.属性对象的属性来命名。 这种方式比较重要</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//User类</span></span><br><span class="line"><span class="keyword">package</span> entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="comment">//如果要提供构造函数，要提供一个无参构造方法</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理类</span></span><br><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * Struts2数据处理案列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei`</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction02</span> </span>&#123;</span><br><span class="line">	<span class="comment">//保证对象要有无参的构造方法 </span></span><br><span class="line">	<span class="keyword">private</span> User user; <span class="comment">//IOC方式</span></span><br><span class="line">	<span class="comment">//登陆处理业务</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+user.getUsername()+<span class="string">"\tpassword="</span>+user.getPassword());</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--显示成功页面--&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">&lt;title&gt;成功页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;My First Struts Demo&lt;/h1&gt;</span><br><span class="line">	&lt;!-- 属性驱动 --&gt;</span><br><span class="line">	&lt;!--&lt;h3&gt;恭喜$&#123;username&#125;登录成功&lt;h3&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;password&#125;&lt;h2&gt;--&gt;</span><br><span class="line">	&lt;!-- 对象驱动 --&gt;</span><br><span class="line">	&lt;h3&gt;恭喜$&#123;user.username&#125;登录成功&lt;h3&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;user.password&#125;&lt;h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;!--登录页面--&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Struts2的数据处理&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"login02.action"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">		username:&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.username"</span>/&gt;&lt;br&gt;</span><br><span class="line">		password:&lt;input type=<span class="string">"password"</span> name=<span class="string">"user.password"</span>/&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">"button"</span> value=<span class="string">"登录"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>模式驱动：在对象驱动中，页面的表单域名称比较复杂，如果对象属性比较多的情况下，代码量比较大。通过模式驱动可以解决这个问题。</li>
<li>模式驱动需要实现ModelDriver接口，并且主动将对象创建好。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理类</span></span><br><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ModelDriven;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * Struts2数据处理案列：模型驱动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction03</span> <span class="keyword">implements</span> <span class="title">ModelDriven</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//保证对象要有无参的构造方法 </span></span><br><span class="line">	<span class="keyword">private</span> User user=<span class="keyword">new</span> User(); <span class="comment">//IOC方式</span></span><br><span class="line">	<span class="comment">//登陆处理业务</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+user.getUsername()+<span class="string">"\tpassword="</span>+user.getPassword());</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--登录页面--&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Struts2的数据处理&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"login02.action"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">		username:&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>/&gt;&lt;br&gt;</span><br><span class="line">		password:&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>/&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">"button"</span> value=<span class="string">"登录"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;!--显示页面--&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">&lt;title&gt;成功页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;My First Struts Demo&lt;/h1&gt;</span><br><span class="line">	&lt;h3&gt;恭喜$&#123;username&#125;登录成功&lt;h3&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;password&#125;&lt;h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="第七讲-数据处理二-1"><a href="#第七讲-数据处理二-1" class="headerlink" title="第七讲 数据处理二"></a>第七讲 数据处理二</h2><blockquote>
<p>IOC：控制反转 </p>
<ul>
<li>对象驱动方式获取属性：（重点）<blockquote>
<ul>
<li>在action的处理类中，属性以对象的形式存在，该属性对象只需声明并为其提供get方法和set方法即可，需要保证该属性对象有无参构造方法。</li>
<li>在表单域中的表单域名称以属性对象.属性对象的属性来命名。 这种方式比较重要</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//User类</span></span><br><span class="line"><span class="keyword">package</span> entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="comment">//如果要提供构造函数，要提供一个无参构造方法</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理类</span></span><br><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * Struts2数据处理案列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction02</span> </span>&#123;</span><br><span class="line">	<span class="comment">//保证对象要有无参的构造方法 </span></span><br><span class="line">	<span class="keyword">private</span> User user; <span class="comment">//IOC方式</span></span><br><span class="line">	<span class="comment">//登陆处理业务</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+user.getUsername()+<span class="string">"\tpassword="</span>+user.getPassword());</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--显示成功页面--&gt;</span><br><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">&lt;title&gt;成功页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;My First Struts Demo&lt;/h1&gt;</span><br><span class="line">	&lt;!-- 属性驱动 --&gt;</span><br><span class="line">	&lt;!--&lt;h3&gt;恭喜$&#123;username&#125;登录成功&lt;h3&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;password&#125;&lt;h2&gt;--&gt;</span><br><span class="line">	&lt;!-- 对象驱动 --&gt;</span><br><span class="line">	&lt;h3&gt;恭喜$&#123;user.username&#125;登录成功&lt;h3&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;user.password&#125;&lt;h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="第八讲-action的几种创建方式"><a href="#第八讲-action的几种创建方式" class="headerlink" title="第八讲 action的几种创建方式"></a>第八讲 action的几种创建方式</h2><blockquote>
<ul>
<li>在<code>Struts2</code>中有三种方式来创建action处理类<blockquote>
<ul>
<li>实现<code>action</code>接口的方式来创建处理类,好处:<blockquote>
<ul>
<li>可以直接使用Action类提供的常量</li>
<li>必须重写默认的处理方法。</li>
<li>这种方法使用比较少。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 通过实现Action接口来创建处理类：好处</span></span><br><span class="line"><span class="comment"> *实现action接口的方式可以使用Action提供的常量</span></span><br><span class="line"><span class="comment"> *必须重写默认处理方法</span></span><br><span class="line"><span class="comment"> *这种方式使用的比较少</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAction</span> <span class="keyword">implements</span> <span class="title">Action</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"action execute"</span>);</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>通过继承<code>ActionSupport</code>类来创建Action的处理类，<code>Strut2</code>推荐使用这种方式。</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 通过继承ActionSupport创建Action处理类：好处</span></span><br><span class="line"><span class="comment"> * 并且ActionSupport类提供了很多其他Struts2的功能。</span></span><br><span class="line"><span class="comment"> * 比如：数据校验，国际化</span></span><br><span class="line"><span class="comment"> * 内部已经提供了默认实现方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAction02</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>无侵入性的实现方式</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 无侵入性的实现方式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello02Action</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"无侵入性的实现方式"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第九讲-Struts2配置讲解2"><a href="#第九讲-Struts2配置讲解2" class="headerlink" title="第九讲 Struts2配置讲解2"></a>第九讲 Struts2配置讲解2</h3><blockquote>
<ul>
<li><code>constant</code>标签</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">&lt;!-- strut2的常量配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 扩展名的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"do,zhangsan,,action"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设置页面字符集，页面解决 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开发模式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.devMode"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>include</code>标签：引入其他的配置文件，在团队开发中使用</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN" "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"struts2/conguration/system.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第十讲-action的优化配置"><a href="#第十讲-action的优化配置" class="headerlink" title="第十讲 action的优化配置"></a>第十讲 action的优化配置</h3><blockquote>
<ul>
<li>在Struts2中，随着业务的增加，<code>action</code>的配置文件会急剧增加，导致了配置文件膨胀的问题。<code>struts2</code>中提供了三种方式来解决这个问题。<blockquote>
<ul>
<li>通过动态方法调用来解决。</li>
<li>通过通配符来解决。</li>
<li>通过注解来解决。 </li>
</ul>
</blockquote>
</li>
<li>传统的action方式，配置文件会变得很庞大</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN" "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"save"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"save"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirectAction"</span>&gt;</span>find<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"delete"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirectAction"</span>&gt;</span>find<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"update"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"update"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirectAction"</span>&gt;</span>find<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"query"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/list.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> </span>&#123;</span><br><span class="line">	<span class="comment">//增加</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//删除</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//修改 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>通过动态方法解决该问题<blockquote>
<ul>
<li>在常量中开启动态方法调用。<code>&lt;constant name=&quot;struts.enable.DynamicMethodInvocation&quot; value=&quot;true&quot;&gt;&lt;/constant&gt;</code></li>
<li>配置<code>action</code>,一个<code>Action</code>处理类，只需配置一次。不需要配置处理方法。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userAction"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span>userAction!query.action<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span>userAction!delete.action<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span>/list.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"delete"</span>&gt;</span>/delete.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>调用处理方法，<code>ActionName!method.action</code>，例如:<code>http://localhost:8080/Struts_study02/userAction!delete.action</code></li>
<li>注意：使用动态方法调用需要不同处理方法的返回值是否一致问题。会配置多个结果集。这种方式不推荐使用，不安全。</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- *表示一个或多个字符 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 占位符&#123;1&#125;表示匹配第一个“*”的内容 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用通配符配置时，需要注意如果有不是通配符的action，先匹配action再匹配通配符--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在实际应用开发中，使用通配符比较常见 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirect"</span>&gt;</span>query<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/list.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>注意如果使用通配符配置，那么需要注意不同处理方法的返回值的问题。</li>
<li>使用注解来解决。</li>
<li>使用注解需要导入<code>struts2-convention-plugin-2.3.37.jar</code>、<code>asm-3.3.jar</code>、<code>asm-commons-3.3.jar</code>、<code>asm-tree-3.3.jar</code></li>
<li>在处理类上填写相关注解</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Action;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Namespace;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.ParentPackage;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.convention.annotation.Result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ParentPackage</span>(value=<span class="string">"struts-default"</span>)</span><br><span class="line"><span class="meta">@Namespace</span>(value=<span class="string">"/"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> </span>&#123;</span><br><span class="line">	<span class="comment">//增加</span></span><br><span class="line">	<span class="meta">@Action</span>(value=<span class="string">"save"</span>,results= &#123;</span><br><span class="line">			<span class="meta">@Result</span>(location=<span class="string">"/list.jsp"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"save"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//删除</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"delete"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//修改 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"update"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//查询</span></span><br><span class="line">	<span class="meta">@Action</span>(value=<span class="string">"query"</span>,results= &#123;</span><br><span class="line">			<span class="meta">@Result</span>(name=<span class="string">"list"</span>,location=<span class="string">"/list.jsp"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"query"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"list"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第十一讲-ThreadLocal和ActionContext"><a href="#第十一讲-ThreadLocal和ActionContext" class="headerlink" title="第十一讲 ThreadLocal和ActionContext"></a>第十一讲 ThreadLocal和ActionContext</h3><blockquote>
<ul>
<li><code>ThreadLocal</code>是一个容器，存放在容器中的数据是线程安全的。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> threadlocal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> ThreadLocal&lt;Integer&gt; th=<span class="keyword">new</span> ThreadLocal&lt;Integer&gt;();</span><br><span class="line">		<span class="comment">//向ThreadLocal中存放数据</span></span><br><span class="line">		th.set(<span class="number">23</span>);</span><br><span class="line">		<span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">			th.set(<span class="number">12</span>);</span><br><span class="line">			System.out.println(<span class="string">"===================="</span>);</span><br><span class="line">			<span class="comment">//获取存放在容器中的数据</span></span><br><span class="line">			System.out.println(<span class="string">"thread--&gt;"</span>+th.get());<span class="comment">//12</span></span><br><span class="line">		&#125;) .start();</span><br><span class="line">		System.out.println(<span class="string">"main --&gt;"</span>+th.get()); <span class="comment">//23</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>ActionContext</code>：是<code>Struts2</code>的上下文对象，它的本质是一个容器，也是一个<code>Map</code>结构的对象。<code>ActionContext</code>贯穿于整个Action生命周期，每次接受请求后都会新建一个<code>ActionContext</code>对象，将<code>ServletAPI</code>中的数据存入到<code>ActionContext</code>中，实现了struts2和Servlet的解耦，使得测试可以不依赖容器。而且<code>ActionContext</code>是线程安全的。由于每次请求都会重新创建<code>ActionContext</code>，导致执行效率比<code>Servlet</code>低。</li>
<li><code>ActionContext</code>有六个对象：<blockquote>
<ul>
<li><code>request</code>：存放的是<code>HttpServletRequest</code>域中的数据。</li>
<li><code>session</code>：存放的是<code>HttpSession</code>域中的数据。</li>
<li><code>application</code>：存放的是<code>ServletContext</code>域中的数据。</li>
<li><code>parameters</code>：存放的是请求参数</li>
<li><code>attr</code>：存放的是<code>request</code>、<code>session</code>、<code>application</code>中的数据。</li>
<li><code>ValueStacke</code>：业务处理类的相关数据。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// helpers to get access to request/session/application scope</span></span><br><span class="line">extraContext.put(<span class="string">"request"</span>, requestMap);</span><br><span class="line">extraContext.put(<span class="string">"session"</span>, sessionMap);</span><br><span class="line">extraContext.put(<span class="string">"application"</span>, applicationMap);</span><br><span class="line">extraContext.put(<span class="string">"parameters"</span>, parameterMap);</span><br><span class="line"></span><br><span class="line">AttributeMap attrMap = <span class="keyword">new</span> AttributeMap(extraContext);</span><br><span class="line">extraContext.put(<span class="string">"attr"</span>, attrMap);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>ServletContext</code>:是一个容器，是一个对象，相当于map。</li>
</ul>
</blockquote>
<h3 id="第十二讲-ognl"><a href="#第十二讲-ognl" class="headerlink" title="第十二讲 ognl"></a>第十二讲 ognl</h3><blockquote>
<ul>
<li><code>ognl</code>：<code>Object graph navigation language</code>，对象导航图语言。</li>
<li>在<code>Struts2</code>中，ognl完成数据设置和类型转换两个功能。</li>
<li>在<code>struts2</code>中是通过<code>ognl</code>来设值和取值的。<code>ActionContext</code>作为<code>ognl</code>的上下文，<code>ValueStack</code>作为<code>ognl</code>的<code>root</code>对象</li>
<li>在<code>struts2</code>中使用<code>ognl</code>表达式获取数据需要使用<code>struts2</code>的标签库，使用<code>struts2</code>的标签库，需要注意一定是通过过滤器后才能解析<code>struts2</code>的标签</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * Struts2数据处理案列：属性驱动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="comment">//登陆处理业务</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+username+<span class="string">";password="</span>+password);</span><br><span class="line">		ActionContext.getContext().getApplication().put(<span class="string">"address"</span>, <span class="string">"北京尚学堂"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=utf-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">&lt;title&gt;成功页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;My First Struts Demo&lt;/h1&gt;</span><br><span class="line">	登录成功，欢迎&lt;s:property value=<span class="string">"username"</span>/&gt;&lt;br&gt;</span><br><span class="line">	&lt;h2&gt;$&#123;password&#125;&lt;h2&gt;</span><br><span class="line">	&lt;h3&gt;&lt;s:property value="#application.address"/&gt;&lt;/h3&gt;</span><br><span class="line">	&lt;h3&gt;&lt;s:property value="#parameters.username"/&gt;&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>ognl获取各种域中的数据如下：<blockquote>
<ul>
<li><code>application</code>：<code>#application.username</code>、<code>#application[&#39;username&#39;]</code>；</li>
<li><code>session</code>：<code>#session.username</code>、<code>#session[&#39;username&#39;]</code>；</li>
<li><code>request</code>：<code>#request.username</code>、<code>#request[&#39;username&#39;]</code>；</li>
<li><code>parameters</code>：<code>#parameters.username</code>、<code>#parameter[&#39;username&#39;]</code>；</li>
<li><code>attr</code>：<code>#attr.username</code>、<code>#attr[&#39;username&#39;]</code>，按pageContext、request、session、application顺序查找。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="第十三讲-ServletAPI"><a href="#第十三讲-ServletAPI" class="headerlink" title="第十三讲 ServletAPI"></a>第十三讲 <code>ServletAPI</code></h3><blockquote>
<ul>
<li>在<code>Struts2</code>的开发中，依然需要使用到<code>ServletAPI</code>，比如用户登录之后，需要将用户信息保存到<code>session</code>中.在<code>Struts2</code>中有两种方式可以获取<code>ServletAPI</code>,一种解耦方式，一种是耦合方式。<blockquote>
<ul>
<li>解耦的实现方式</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> </span>&#123;</span><br><span class="line">	<span class="comment">//保证对象要有无参的构造方法</span></span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+user.getUsername()+<span class="string">"\tpassword="</span>+user.getPassword());</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"possible"</span>.equals(user.getUsername()) &amp;&amp; <span class="string">"123456"</span>.equals(user.getPassword())) &#123;</span><br><span class="line">			<span class="comment">//用户登录成功，将用户信息写入到session</span></span><br><span class="line">			ActionContext.getContext().getSession().put(<span class="string">"currentUser"</span>, user);</span><br><span class="line">			<span class="comment">//获取request</span></span><br><span class="line">			Map&lt;String,Object&gt; req=(Map&lt;String,Object&gt;)ActionContext.getContext().get(<span class="string">"request"</span>);</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>耦合的方式<blockquote>
<ul>
<li>直接通过<code>ServletContext</code>获取</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"username="</span>+user.getUsername()+<span class="string">"\tpassword="</span>+user.getPassword());</span><br><span class="line">	<span class="keyword">if</span>(<span class="string">"possible"</span>.equals(user.getUsername()) &amp;&amp; <span class="string">"123456"</span>.equals(user.getPassword())) &#123;</span><br><span class="line">		<span class="comment">//直接获取ServletAPI,所以是耦合的方式			</span></span><br><span class="line">		HttpServletRequest req=ServletActionContext.getRequest();</span><br><span class="line">		req.getSession().setAttribute(<span class="string">"currentUser"</span>, user);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>通过<code>ActionContext</code>获取</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+user.getUsername()+<span class="string">"\tpassword="</span>+user.getPassword());</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"possible"</span>.equals(user.getUsername()) &amp;&amp; <span class="string">"123456"</span>.equals(user.getPassword())) &#123;</span><br><span class="line">			<span class="comment">//通过ActionContext方式获取ServletAPI</span></span><br><span class="line">			System.out.println(<span class="string">"通过ActionContext方式获取ServletAPI"</span>);</span><br><span class="line">			HttpServletRequest req=(HttpServletRequest) ActionContext.getContext().get(StrutsStatics.HTTP_REQUEST);</span><br><span class="line">			req.getSession().setAttribute(<span class="string">"currentUser"</span>, user);</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>通过<code>IOC</code>方式直接获取到ServletAPI</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction03</span> <span class="keyword">implements</span> <span class="title">ServletRequestAware</span></span>&#123;</span><br><span class="line">	<span class="comment">//保证对象要有无参的构造方法</span></span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	<span class="keyword">private</span> HttpServletRequest req;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"username="</span>+user.getUsername()+<span class="string">"\tpassword="</span>+user.getPassword());</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"possible"</span>.equals(user.getUsername()) &amp;&amp; <span class="string">"123456"</span>.equals(user.getPassword())) ;</span><br><span class="line">			<span class="comment">//通过IOC方法获取ServletAPI对象</span></span><br><span class="line">			System.out.println(<span class="string">"通过IOC方法获取ServletAPI对象"</span>);</span><br><span class="line">			req.getSession().setAttribute(<span class="string">"currentUser"</span>, user);</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.req=request;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第十四讲-类型转换"><a href="#第十四讲-类型转换" class="headerlink" title="第十四讲 类型转换"></a>第十四讲 类型转换</h3><blockquote>
<ul>
<li>在<code>Struts2</code>中，对常用的数据类型已经自动进行了类型装换工作。但是对于自定义类型，Struts2没法去做类型转换工作。需要自定义类型转换器来实现类型的转换。</li>
<li>类型转换的实现步骤：<blockquote>
<ul>
<li>新建一个类型转换并继承<code>StrutsTypeConverter</code></li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.zhuchuli.pointconverter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.util.StrutsTypeConverter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.zhuchuli.vo.Point;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 自定义类型转换器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PointConverter</span> <span class="keyword">extends</span> <span class="title">StrutsTypeConverter</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将表单提交的数据在这个方法中被转换。</span></span><br><span class="line"><span class="comment">	 * 返回值是目标点对象</span></span><br><span class="line"><span class="comment">     * Converts one or more String values to the specified class.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context the action context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values  the String values to be converted, such as those submitted from an HTML form</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toClass the class to convert to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the converted object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">convertFromString</span><span class="params">(Map context, String[] values, Class toClass)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"将String转化为指定类型"</span>);</span><br><span class="line">		String value=values[<span class="number">0</span>];</span><br><span class="line">		Point point=<span class="keyword">new</span> Point();</span><br><span class="line">		point.setX(Integer.parseInt(value.substring(<span class="number">1</span>,value.indexOf(<span class="string">","</span>))));</span><br><span class="line">		point.setY(Integer.parseInt(value.substring(value.indexOf(<span class="string">","</span>)+<span class="number">1</span>,value.indexOf(<span class="string">")"</span>))));</span><br><span class="line">		<span class="keyword">return</span> point;</span><br><span class="line">	&#125;</span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Converts the specified object to a String.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context the action context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o       the object to be converted</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the converted String</span></span><br><span class="line"><span class="comment">             *   使用ognl表达式获取值会调用该方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">convertToString</span><span class="params">(Map context, Object o)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.println(<span class="string">"将指定的类型转化为String"</span>);</span><br><span class="line">		Point p=(Point) o;</span><br><span class="line">		<span class="keyword">return</span>  <span class="string">"("</span>+p.getX()+<span class="string">","</span>+p.getY()+<span class="string">")"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>在<code>src</code>下添加<code>xwork-conversion.properties</code>配置文件<blockquote>
<ul>
<li><code># be converted type=converter</code> </li>
<li><code>cn.zhuchuli.vo.Point = cn.zhuchuli.pointconverter.PointConverter</code></li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>
<h3 id="第十五讲-数据校验一-（硬编码实现）"><a href="#第十五讲-数据校验一-（硬编码实现）" class="headerlink" title="第十五讲 数据校验一 （硬编码实现）"></a>第十五讲 数据校验一 （硬编码实现）</h3><blockquote>
<ul>
<li>数据校验分为2类，一类是前端的数据校验，一般通过js实现，一类是后端的数据验证。在对一些安全级别较高项目都需要对其进行后台验证。Struts2提供了两种后台校验方法，一种是硬编码实现，一种是校验框架实现。</li>
<li>如果要使用<code>struts2</code>的数据校验功能，<code>action</code>需要继承<code>ActionSupport</code>类。在该类中提供了<code>validate</code>方法，可以将验证规则写在该方法中，只有方法执行通过之后，才会执行业务方法。</li>
<li>实现步骤<blockquote>
<ul>
<li>业务处理类</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 数据校验</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	<span class="comment">//限制validate方法，方法通过执行后执行execute发明方法。</span></span><br><span class="line">	<span class="comment">//默认该方法是通过的。</span></span><br><span class="line">	<span class="comment">//在validate方法中，添加了FieldError或者ActionError那么该方法将执行不能通过，并且返回结果集为INPUT</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"-------validate-------"</span>);</span><br><span class="line">		Pattern p=Pattern.compile(<span class="string">"[\\w]+[A-Za-z0-9]&#123;6,16&#125;"</span>);</span><br><span class="line">		Matcher m=p.matcher(user.getName());</span><br><span class="line">		<span class="keyword">if</span>(!m.find()) &#123;</span><br><span class="line">			<span class="comment">//用户名不合法，添加错误信息</span></span><br><span class="line">			<span class="keyword">this</span>.addFieldError(<span class="string">"user.name"</span>, <span class="string">"用户名不合法"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">super</span>.validate();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------execute---------"</span>);</span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>在配置文件中配置input结果集</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/save.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>在页面中添加struts2的标签库，并且添加错误标签</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"user.action"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">		name:&lt;input type="text" name="user.name"/&gt;&lt;s:fielderror fieldName="user.name"&gt;&lt;/s:fielderror&gt;&lt;br&gt;</span><br><span class="line">		sex:&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.sex"</span>/&gt;&lt;br&gt;</span><br><span class="line">		age:&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.age"</span>/&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>通过上述方法来实现数据校验会有一个问题。一个业务类中有多个业务方法，并且每个业务方法的验证规则可能不一致，但是所有的业务方法都会通过<code>validate</code>。导致功能不能实现。在<code>struts2</code>中，如果一个业务类中有多个业务方法，那么需要为每个业务方法添加自己的验证方法。验证方法的命名规则为<code>validate+业务方法名(首字母大写)</code>。这样执行业务方法时，执行顺序为<code>validateXxxx ---&gt; validate ---&gt; xxxx。</code>这样的话，validate方法中填写的公共的验证方法。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 数据校验</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	<span class="comment">//限制validate方法，方法通过执行后执行execute发明方法。</span></span><br><span class="line">	<span class="comment">//默认该方法是通过的。</span></span><br><span class="line">	<span class="comment">//在validate方法中，添加了FieldError或者ActionError那么该方法将执行不能通过，并且返回结果集为INPUT</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"-------validate-------"</span>);</span><br><span class="line">		Pattern p=Pattern.compile(<span class="string">"[\\w]+[A-Za-z0-9]&#123;6,16&#125;"</span>);</span><br><span class="line">		Matcher m=p.matcher(user.getName());</span><br><span class="line">		<span class="keyword">if</span>(!m.find()) &#123;</span><br><span class="line">			<span class="comment">//用户名不合法，添加错误信息</span></span><br><span class="line">			<span class="keyword">this</span>.addFieldError(<span class="string">"user.name"</span>, <span class="string">"用户名不合法"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">super</span>.validate();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validateExecute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"-------validateExecute-------"</span>);</span><br><span class="line">		Pattern p=Pattern.compile(<span class="string">"[\\w]+[A-Za-z0-9]&#123;6,16&#125;"</span>);</span><br><span class="line">		Matcher m=p.matcher(user.getName());</span><br><span class="line">		<span class="keyword">if</span>(!m.find()) &#123;</span><br><span class="line">			<span class="comment">//用户名不合法，添加错误信息</span></span><br><span class="line">			<span class="keyword">this</span>.addFieldError(<span class="string">"user.name"</span>, <span class="string">"用户名不合法"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">super</span>.validate();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------execute---------"</span>);</span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第十五讲-数据校验二（使用Struts2提供的校验框架实现数据校验）"><a href="#第十五讲-数据校验二（使用Struts2提供的校验框架实现数据校验）" class="headerlink" title="第十五讲 数据校验二（使用Struts2提供的校验框架实现数据校验）"></a>第十五讲 数据校验二（使用Struts2提供的校验框架实现数据校验）</h3><blockquote>
<ul>
<li>实现步骤<blockquote>
<ul>
<li>创建<code>jsp</code>页面</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"user.action"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">		name:&lt;input type="text" name="user.name"/&gt;&lt;s:fielderror fieldName="user.name"&gt;&lt;/s:fielderror&gt;&lt;br&gt;</span><br><span class="line">		sex:&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.sex"</span>/&gt;&lt;br&gt;</span><br><span class="line">		age:&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.age"</span>/&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>创建<code>Action</code>类</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserFormAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------execute---------"</span>);</span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>在<code>Action</code>类所在包下，添加校验规则文件以<code>ActionClassName-validation.xml</code>命名</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE validators PUBLIC </span></span><br><span class="line"><span class="meta">  		"-//Apache Struts//XWork Validator 1.0//EN"</span></span><br><span class="line"><span class="meta">  		"http://struts.apache.org/dtds/xwork-validator-1.0.dtd"&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--field表示对哪个表单域进行验证  --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"user.name"</span>&gt;</span></span><br><span class="line"> 		<span class="comment">&lt;!-- 字段验证器 Struts2默认提供了很多验证器 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">message</span>&gt;</span>你必须输入姓名。<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"stringlength"</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"maxLength"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"minLength"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"> 			<span class="tag">&lt;<span class="name">message</span>&gt;</span>你必须输入姓名在$&#123;maxLength&#125;和$&#123;minLength&#125;之间<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>配置<code>Struts.xml</code>文件</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN" "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--  &lt;action name="point" class="com.zhuchuli.action.PointAction"&gt;</span></span><br><span class="line"><span class="comment">			&lt;result&gt;/success.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">		&lt;/action&gt;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">		&lt;action name="user" class="com.zhuchuli.action.UserAction"&gt;</span></span><br><span class="line"><span class="comment">			&lt;result&gt;/success.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">			&lt;result name="input"&gt;/save.jsp&lt;/result&gt;</span></span><br><span class="line"><span class="comment">		&lt;/action&gt;	--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserFormAction"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/save.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第十七讲-Struts2拦截器"><a href="#第十七讲-Struts2拦截器" class="headerlink" title="第十七讲 Struts2拦截器"></a>第十七讲 Struts2拦截器</h3><blockquote>
<ul>
<li><code>struts2</code>中的所有功能都是由拦截器来实现的。拦截器是<code>Struts2</code>的核心。拦截器和过滤器非常相似，过滤器过滤的是所有的请求，拦截器纸过滤<code>action</code>，并且在<code>struts2</code>中所有的功能都是可插拔的。在<code>struts2</code>中还可以自定义拦截器来实现一些<code>struts2</code>没有提供的功能。在<code>struts2</code>中拦截器的实现是通过代理来实现的。（<code>AOP</code>）在<code>Struts2</code>中拦截器都是单列的，所有的<code>action</code>共享相同的拦截器，所以在拦截器定义常量时要注意线程安全问题。</li>
<li><code>Struts2</code>中提供很多拦截器来实现各种功能，在开发中可以根据不同的应用选择不同的拦截器来实现功能。<code>Struts2</code>提供了一系列默认的拦截器（拦截器栈）来实现功能。</li>
<li>默认拦截器说明<blockquote>
<ul>
<li><code>alias</code>：对于<code>HTTP</code>请求包含的参数设置别名</li>
<li><code>autowiring</code>：将某些J<code>avaBean</code>实例自动绑定到其他<code>Bean</code>对应的属性中。有点类似<code>Spring</code>的自动绑定，在<code>Spring</code>部分会详细说明。</li>
<li><code>Chain</code>：在Web项目开发中，以前使用Struts开发时候经常碰到两个<code>Action</code>互相传递参数或属性的情况。该拦截器就是让前一<code>Action</code>的参数可以在现有<code>Action</code>中使用。</li>
<li><code>conversionError</code>：从<code>ActionContext</code>中将转化类型时候发生的错误添加到<code>Action</code>的值域错误中，在校验时候经常被使用到来显示类型转化错误的信息。</li>
<li><code>cookie</code>：从Struts<code>&lt; xmlnamespace prefix=&quot;ST1&quot; &gt;2.0.7</code>版本开始，可以把<code>cookie</code>注入<code>Action</code>中可设置的名字或值中。</li>
<li><code>createSession</code>：自动创建一个<code>HTTP的Session</code>，尤其是对需要<code>HTTP</code>的<code>Session</code>的拦截器特别有用。比如下面介绍的<code>TokenInterceptor</code>。</li>
<li><code>debugging</code>：用来对在视图间传递的数据进行调试。</li>
<li><code>ExecAndWait</code>：不显式执行<code>Action</code>，在视图上显示给用户的是一个正在等待的页面，但是<code>Action</code>其实是在“背后”正在执行着。该拦截器尤其在对进度条进行开发的时候特别有用。</li>
<li><code>exception</code>：将异常和<code>Action</code>返回的<code>result</code>相映射。</li>
<li><code>fileUpload</code>：支持文件上传功能的拦截器。</li>
<li><code>i18n</code>：支持国际化的拦截器。</li>
<li><code>logger</code>：拥有日志功能的拦截器。</li>
<li><code>modelDriven</code>：<code>Action</code>执行该拦截器时候，可以将<code>getModel</code>方法得到的<code>result</code>值放入值栈中</li>
<li><code>scopedModelDriven</code>：执行该拦截器时候，它可以从一个<code>scope</code>范围检索和存储<code>model</code>值，通过调用<code>setModel</code>方法去设置<code>model</code>值。</li>
<li><code>params</code>：将<code>HTTP</code>请求中包含的参数值设置到<code>Action</code>中。</li>
<li><code>prepare</code>：假如<code>Action</code>继承了<code>Preparable</code>接口，则会调用<code>prepare</code>方法。</li>
<li><code>staticParams</code>：对于在<code>struts.xml</code>文件中<code>Action</code>中设置的参数设置到对应的<code>Action</code>中。</li>
<li><code>scope</code>：在<code>session</code>或者<code>application</code>范围中设置<code>Action</code>的状态</li>
<li><code>servletConfig</code>：该拦截器提供访问包含<code>HttpServletResquest</code>和<code>HttpServletResponse</code>对象的<code>Map</code>的方法。</li>
<li><code>timer</code>：输出<code>Action</code>的执行时间。</li>
<li><code>token</code>：避免重复提交的校验拦截器</li>
<li><code>tokenSession</code>：和<code>token</code>拦截器类似，但它还能存储提交的数据到<code>session</code>里。</li>
<li><code>validation</code>：运行在<code>action-validation.xml</code>(校验章节将介绍)文件中定义的校验规则。</li>
<li><code>workflow</code>：在<code>Action</code>中调用<code>validate</code>校验方法。如果<code>Action</code>有错误则返回到<code>input</code>视图。</li>
<li><code>store</code>：执行校验功能时候，该拦截器提供存储和检索<code>Action</code>的所有错误和正确信息的功能。</li>
<li><code>checkbox</code>：视图中如果有<code>checkbox</code>存在的情况，该拦截器自动将<code>unchecked的checkbox</code>当作一个参数（通常值为“<code>false</code>”）记录下来。这样可以用一个隐藏的表单值来记录所有未提交的<code>checkbox</code>，而且缺省<code>unchecked</code>的<code>checkbox</code>值是布尔类型的，如果视图中<code>checkbox</code>的值设置的不是布尔类型，它就会被覆盖成布尔类型的值。</li>
<li><code>profiling</code>：通过参数来激活或不激活分析检测功能，前提是<code>Web</code>项目是在开发模式下。（涉及到调试和性能检验时使用）</li>
<li><code>roles</code>：进行权限配置的拦截器，如果登录用户拥有相应权限才去执行某一特定Action。</li>
</ul>
</blockquote>
</li>
<li><code>Struts2</code>中的默认拦截器是定义在<code>struts-default.xml</code>中。这些拦截器都是定义在<code>struts-default</code>包下的。所以在使用<code>struts2</code>时定义的<code>package</code>要直接或间接继承<code>struts-default</code></li>
<li>常见内置拦截器的使用，使用内置拦截器是需要引用拦截器。<blockquote>
<ul>
<li><code>Timer</code>拦截器的使用<blockquote>
<ul>
<li>创建<code>action</code>类</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimerAction</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Hello action"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"none"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>在配置文件中进行配置</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN" "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"interceptor"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.TimerAction"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 使用拦截器时，需要在指定的action中引用拦截器 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"timer"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li><code>token</code>拦截器的使用<blockquote>
<ul>
<li>创建<code>Action</code>类</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"add user to database"</span>); </span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>在页面中添加<code>token</code>标签</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;提交页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"interceptor.action"</span> method=<span class="string">"post"</span>&gt; </span><br><span class="line">		&lt;s:token&gt;&lt;/s:token&gt;</span><br><span class="line">		name:&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.name"</span>/&gt;&lt;br&gt;</span><br><span class="line">		age:&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.age"</span>/&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">"submit"</span> value=<span class="string">"save"</span> /&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>在<code>action</code>中引用<code>token</code></li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"save"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.UserAction"</span> <span class="attr">method</span>=<span class="string">"save"</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"token"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"invalid.token"</span>&gt;</span>/invalid.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 使用拦截器时，需要在指定的action中引用拦截器 --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;interceptor-ref name="timer"&gt;&lt;/interceptor-ref&gt; --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 当用户重复提交时，会返回invalid.token结果集 --&gt;</span></span><br><span class="line">			</span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"toSave"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.UserAction"</span> <span class="attr">method</span>=<span class="string">"toSave"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/save.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>编写失效页面。</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;表单不能重复提交&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第十八讲-自定义拦截器"><a href="#第十八讲-自定义拦截器" class="headerlink" title="第十八讲 自定义拦截器"></a>第十八讲 自定义拦截器</h3><blockquote>
<ul>
<li>在开发中，经常会使用到struts2中没有提供的一些功能，这时需要我们自定义拦截器来实现。当引用自定义拦截器后，struts2提供的默认拦截器将不起作用，需要重新引入。</li>
<li>自定义拦截器的实现步骤：<blockquote>
<ul>
<li>定义拦截器</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.myinterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.Interceptor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 自定义拦截器</span></span><br><span class="line"><span class="comment"> * 有两种实现方式</span></span><br><span class="line"><span class="comment"> * 实现Interceptor接口</span></span><br><span class="line"><span class="comment"> * 继承AbstractInterceptor类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//拦截器的主体实现</span></span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 当拦截器的方法被调用执行后，需要调用 invocation.invoke调用下一个拦截器。</span></span><br><span class="line"><span class="comment">	 * 如果没有拦截器，那么执行action中的业务方法。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"-------------------自定义拦截器被执行了o-------------------"</span>);</span><br><span class="line">		<span class="comment">//返回值为结果集</span></span><br><span class="line">		<span class="keyword">return</span> invocation.invoke();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>在<code>package</code>中配置拦截器</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 拦截器的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"MyIntercept"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.MyInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>在使用action中引用拦截器</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"timer"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.TimerAction"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"timer"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 使用自定义拦截器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"MyIntercept"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>登录拦截器的实现</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.myinterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.Interceptor;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 登录拦截器的实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断是否是登录的action，如果是，继续执行</span></span><br><span class="line"><span class="comment">	 * 如果不是 判断session中是否存在用户，</span></span><br><span class="line"><span class="comment">	 * 如果没有，跳转到登录界面</span></span><br><span class="line"><span class="comment">	 * 如果有继续执行</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		String actionName= invocation.getProxy().getActionName();</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"login"</span>.equals(actionName)) &#123;</span><br><span class="line">			<span class="keyword">return</span> invocation.invoke();</span><br><span class="line">		&#125;</span><br><span class="line">		Object currentUser=invocation.getInvocationContext().getSession().get(<span class="string">"currentUser"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(currentUser!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> invocation.invoke();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 拦截器的配置 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"MyIntercept"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.MyInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.LoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置全局结果集 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 当前action结果集找不到，就去找全局结果集，如果再找不到，返回404 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/login.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"timer"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.TimerAction"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"timer"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 使用自定义拦截器 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"MyIntercept"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"save"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.UserAction"</span> <span class="attr">method</span>=<span class="string">"save"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 使用拦截器时，需要在指定的action中引用拦截器 --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;interceptor-ref name="timer"&gt;&lt;/interceptor-ref&gt; --&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 当用户重复提交时，会返回invalid.token结果集 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"token"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"invalid.token"</span>&gt;</span>/invalid.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"toSave"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.UserAction"</span> <span class="attr">method</span>=<span class="string">"toSave"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/save.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.interceptor.UserAction02"</span> <span class="attr">method</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuuli.vo.User02;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction02</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> User02 user;</span><br><span class="line">	<span class="comment">//进行数据校验</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Pattern p=Pattern.compile(<span class="string">"[\\w]+[A-Za-z0-9]&#123;6,16&#125;"</span>);</span><br><span class="line">		Matcher m=p.matcher(user.getPwd());</span><br><span class="line">		<span class="keyword">if</span>(!((user.getName().length()&gt;=<span class="number">4</span>||user.getName().length()&lt;=<span class="number">10</span>)&amp;&amp; m.find())) &#123;</span><br><span class="line">			<span class="comment">//用户名不合法，添加错误信息</span></span><br><span class="line">			<span class="keyword">this</span>.addFieldError(<span class="string">"user.name"</span>, <span class="string">"用户名或密码不合法"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"------login---------"</span>); </span><br><span class="line">		<span class="comment">//ServletActionContext.getRequest().getSession().setAttribute("currentUser", user);</span></span><br><span class="line">		<span class="comment">//采用解耦的方式进行SevletAPI操作</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"possible"</span>.equals(user.getName())&amp;&amp;<span class="string">"123456"</span>.equals(user.getPwd())) &#123;</span><br><span class="line">			ServletActionContext.getContext().getSession().put(<span class="string">"currentUser"</span>, user);</span><br><span class="line">			System.out.println(ServletActionContext.getContext().getSession().get(<span class="string">"currentUser"</span>));</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User02 <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User02 user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuuli.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User02</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String pwd;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPwd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pwd;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPwd</span><span class="params">(String pwd)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;form action=<span class="string">"login.action"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">		用户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"user.name"</span>/&gt;&lt;br&gt;</span><br><span class="line">		密码：&lt;input type=<span class="string">"password"</span> name=<span class="string">"user.pwd"</span>/&gt;&lt;br&gt;</span><br><span class="line">	</span><br><span class="line">		&lt;input type=<span class="string">"submit"</span> value=<span class="string">"登录"</span>/&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第十九讲-拦截器栈和方法拦截器"><a href="#第十九讲-拦截器栈和方法拦截器" class="headerlink" title="第十九讲 拦截器栈和方法拦截器"></a>第十九讲 拦截器栈和方法拦截器</h3><hr>
<blockquote>
<ul>
<li>拦截器栈：就是一组拦截器，放在一个配置中，在拦截器栈中可以引用多个拦截器，在真正需要调用时只需要一个栈即可,方便引用,拦截器中可以引用另外一个拦截器栈,</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 拦截器的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"MyIntercept"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.MyInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.LoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 拦截器栈 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>拦截器栈的引用，与拦截器引用一致，可以将拦截器栈当做拦截器来使用</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>设置默认拦截器栈</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 设置默认拦截器--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;default-action-ref name="myStack"&gt;&lt;/default-action-ref&gt;--&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Struts2定义了默认的拦截器栈是defaultStack，里面有默认的18个拦截器。</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>拦截器拦截的是整个action，action中的所有业务方法都会被拦截。比较粗粒度。有时只需拦截action中某个方法或某几个方法就能实现功能，那么拦截器就会造成效率降低。这时可以通过方法拦截器来解决这个问题。</li>
<li>方法拦截器的实现</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.myinterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.MethodFilterInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 方法拦截器的实现 继承 MethodFilterInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodInterceptor</span> <span class="keyword">extends</span> <span class="title">MethodFilterInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> String <span class="title">doIntercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"方法拦截器被执行"</span>);</span><br><span class="line">		<span class="keyword">return</span> invocation.invoke();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"MyIntercept"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.MyInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.LoginInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"methodInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.myinterceptor.MethodInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span>				<span class="comment">&lt;!-- 拦截器栈 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"loginIntercept"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"methodInterceptor"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 配置哪些方法被拦截 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"includeMethods"</span>&gt;</span>timer,toSave<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 配置哪些方法不被拦截 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"excludeMethods"</span>&gt;</span>timer,toSave<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二十讲-内置拦截器的使用情况。"><a href="#第二十讲-内置拦截器的使用情况。" class="headerlink" title="第二十讲 内置拦截器的使用情况。"></a>第二十讲 内置拦截器的使用情况。</h3><h3 id="第二十一讲-struts-文件上传（使用默认的内置拦截器）"><a href="#第二十一讲-struts-文件上传（使用默认的内置拦截器）" class="headerlink" title="第二十一讲 struts 文件上传（使用默认的内置拦截器）"></a>第二十一讲 struts 文件上传（使用默认的内置拦截器）</h3><blockquote>
<ul>
<li>在大部分应用中都有文件上传的功能。servlet中可以使用第三方插件来实现文件上传：<code>smartfileupload</code>、<code>commons-fileuoload</code> </li>
<li>文件上传步骤<blockquote>
<ul>
<li>添加jsp页面，注意表单提交必须是post提交，并且设置`enctype=”multipart/form-data”</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;文件上传&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"upload.action"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">		文件:&lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span>/&gt;&lt;input type=<span class="string">"submit"</span> value=<span class="string">"上传"</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>添加文件上传处理类</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 文件上传处理类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadAction</span> </span>&#123;</span><br><span class="line">	<span class="comment">//File属性名与表单域相同 类型为File</span></span><br><span class="line">	<span class="keyword">private</span> File file;</span><br><span class="line">	<span class="comment">//上传文件的名称，也是由struts2设置好</span></span><br><span class="line">	<span class="comment">//属性名=表单域名+FileName</span></span><br><span class="line">	<span class="keyword">private</span> String fileFileName;</span><br><span class="line">	<span class="comment">//文件类型 = 表单域名+ContentType</span></span><br><span class="line">	<span class="keyword">private</span> String fileContentType;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//上传文件的业务方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//获取上传文件目录</span></span><br><span class="line">		String path=ServletActionContext.getServletContext().getRealPath(<span class="string">"/upload"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			FileUtils.copyFile(file, <span class="keyword">new</span> File(path,fileFileName));</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> File <span class="title">getFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> file;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFile</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.file = file;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getFileFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fileFileName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileFileName</span><span class="params">(String fileFileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fileFileName = fileFileName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getFileContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fileContentType;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileContentType</span><span class="params">(String fileContentType)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fileContentType = fileContentType;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>添加配置文件</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN" "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 设置文件上传的临时目录 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.multipart.saveDir"</span> <span class="attr">value</span>=<span class="string">"d:/"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 常量设置 --&gt;</span><span class="comment">&lt;!-- 设置上传文件总大小 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.multipart.maxSize"</span> <span class="attr">value</span>=<span class="string">"67388135"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UploadAction"</span> <span class="attr">method</span>=<span class="string">"upload"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"fileupload"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 设置上传单个文件的大小 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"maximumSize"</span>&gt;</span>67388135<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二十二讲-批量文件上传"><a href="#第二十二讲-批量文件上传" class="headerlink" title="第二十二讲 批量文件上传"></a>第二十二讲 批量文件上传</h3><blockquote>
<ul>
<li>批量文件下载<blockquote>
<ul>
<li>Jsp页面</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;文件上传&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">"batch.action"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">		文件<span class="number">1</span>:&lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span>/&gt;&lt;br&gt;文件<span class="number">2</span>:&lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span>/&gt;&lt;br&gt;&lt;input type=<span class="string">"submit"</span> value=<span class="string">"上传"</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&gt;&gt;* 批量下载业务处理方法</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 文件上传处理类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BatchUploadAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//File属性名与表单域相同 类型为File</span></span><br><span class="line">	<span class="keyword">private</span> File file[];</span><br><span class="line">	<span class="comment">//上传文件的名称，也是由struts2设置好</span></span><br><span class="line">	<span class="comment">//属性名=表单域名+FileName</span></span><br><span class="line">	<span class="keyword">private</span> String fileFileName[];</span><br><span class="line">	<span class="comment">//文件类型 = 表单域名+ContentType</span></span><br><span class="line">	<span class="keyword">private</span> String fileContentType[];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//上传文件的业务方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//System.out.println(file+";"+fileFileName);</span></span><br><span class="line">		<span class="comment">//获取上传文件目录</span></span><br><span class="line">		String path=ServletActionContext.getServletContext().getRealPath(<span class="string">"/upload"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;file.length;i++) &#123;</span><br><span class="line">				FileUtils.copyFile(file[i], <span class="keyword">new</span> File(path,fileFileName[i]));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> File[] getFile() &#123;</span><br><span class="line">		<span class="keyword">return</span> file;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFile</span><span class="params">(File[] file)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.file = file;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String[] getFileFileName() &#123;</span><br><span class="line">		<span class="keyword">return</span> fileFileName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileFileName</span><span class="params">(String[] fileFileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fileFileName = fileFileName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String[] getFileContentType() &#123;</span><br><span class="line">		<span class="keyword">return</span> fileContentType;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileContentType</span><span class="params">(String[] fileContentType)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fileContentType = fileContentType;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li><code>struts.xml</code>配置文件</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"batch"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.BatchUploadAction"</span> <span class="attr">method</span>=<span class="string">"upload"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"fileUpload"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"maximumSize"</span>&gt;</span>67388135<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"basicStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二十三讲-文件下载"><a href="#第二十三讲-文件下载" class="headerlink" title="第二十三讲 文件下载"></a>第二十三讲 文件下载</h3><blockquote>
<ul>
<li>文件下载可以通过超链接直接实现，但是通过超链接直接下载的文件不安全。任何用户得到超链接都可以下载，没法权限的控制。浏览器如果能打开文件，那么浏览会直接将文件打开。</li>
<li>通过流的方式来实现文件下载<blockquote>
<ul>
<li>业务处理方法</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 实现文件下载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *高等数学 水以v立方厘米/秒的输的灌入圆锥形水箱.水箱尖点朝下</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadAction</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String fileName;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Download"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getInputStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String path=ServletActionContext.getServletContext().getRealPath(<span class="string">"/download"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(path,fileName));</span><br><span class="line">		&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fileName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>配置文件</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"download"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.DownloadAction"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>attachment;filename=$&#123;fileName&#125;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>jsp页面</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Struts2文件下载&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;a href="download.action?fileName=jiaoben5614.rar"&gt;文件下载&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第二十四讲-ajax"><a href="#第二十四讲-ajax" class="headerlink" title="第二十四讲 ajax"></a>第二十四讲 ajax</h3><blockquote>
<ul>
<li>在<code>Struts2</code>中依然可以使用<code>Servlet</code>中的<code>ajax</code></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.ajax;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AjaxAction</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ajax</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">checkName</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		HttpServletResponse resp=ServletActionContext.getResponse();</span><br><span class="line">		System.out.println(<span class="string">"checkName ---&gt;"</span> + username);</span><br><span class="line">		<span class="keyword">if</span>(<span class="string">"possible"</span>.equals(username)) &#123;</span><br><span class="line">			resp.getWriter().print(<span class="string">"true"</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			resp.getWriter().print(<span class="string">"false"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"none"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Struts2对ajax也提供了异步支持，使用步骤<blockquote>
<ul>
<li>导入相关jar包</li>
<li>编写jsp页面</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;ajax&lt;/title&gt;</span><br><span class="line">	&lt;script type="text/javascript" src="js/jquery-3.2.1.js"&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		$(function()&#123;</span><br><span class="line">			$(<span class="string">"#btn"</span>).click(function()&#123;</span><br><span class="line">				$.post(<span class="string">"list.action"</span>,function(data)&#123;</span><br><span class="line">					console.log(data);</span><br><span class="line">					<span class="keyword">var</span> html=<span class="string">""</span>;</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;data.length;i++)&#123;</span><br><span class="line">						html+=<span class="string">"&lt;tr&gt;&lt;td&gt;"</span>+data[i].id+<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>+data[i].name+<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>+data[i].age+<span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;	</span><br><span class="line">					&#125;</span><br><span class="line">					$(<span class="string">"#content"</span>).html(html);</span><br><span class="line">				&#125;,<span class="string">'json'</span>)</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;button id="btn"&gt;获取数据&lt;/button&gt;</span><br><span class="line">	&lt;table width=<span class="string">"80%"</span> align=<span class="string">"center"</span>&gt;</span><br><span class="line">		&lt;thead&gt;</span><br><span class="line">			&lt;tr&gt;</span><br><span class="line">				&lt;td&gt;编号&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;姓名&lt;/td&gt;</span><br><span class="line">				&lt;td&gt;年龄&lt;/td&gt;</span><br><span class="line">			&lt;/tr&gt;</span><br><span class="line">		&lt;/thead&gt;</span><br><span class="line">		&lt;tbody id=<span class="string">"content"</span>&gt;</span><br><span class="line">			</span><br><span class="line">		&lt;/tbody&gt;</span><br><span class="line">		&lt;tfoot&gt;&lt;/tfoot&gt;</span><br><span class="line">	&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>编写业务处理方法</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.ajax;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonAction</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;User&gt; list;</span><br><span class="line">	<span class="comment">//获取数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		list=<span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">		list.add(<span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"张三"</span>,<span class="number">19</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> User(<span class="number">2</span>,<span class="string">"李四"</span>,<span class="number">20</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> User(<span class="number">3</span>,<span class="string">"possible"</span>,<span class="number">16</span>));</span><br><span class="line">		<span class="keyword">for</span>(User u:list) &#123;</span><br><span class="line">			System.out.println(u.getId()+<span class="string">"--&gt;"</span>+u.getName()+<span class="string">"--&gt;"</span>+u.getAge());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;User&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.list = list;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>配置文件</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN" "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"json-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"checkName"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.ajax.AjaxAction"</span> <span class="attr">method</span>=<span class="string">"checkName"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.ajax.HelloAction"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"list"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.ajax.JsonAction"</span> <span class="attr">method</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"json"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"root"</span>&gt;</span>list<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二十五讲-异常处理"><a href="#第二十五讲-异常处理" class="headerlink" title="第二十五讲 异常处理"></a>第二十五讲 异常处理</h3><blockquote>
<ul>
<li>异常处理在实际的应用开发中必不可少。比如：开发中不能直接将错误信息展示给用户看，需要对其进行处理，给用户一个更友好的提示。<blockquote>
<ul>
<li>异常处理类</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.exception.UserException;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.service.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.service.Userserivce;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Userserivce userService=<span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">	<span class="comment">//try-catch 需要通过异步进行处理ss</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> UserException </span>&#123;</span><br><span class="line">		userService.delete(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>配置文件</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"delete"</span> <span class="attr">class</span>=<span class="string">"com.zhuchuli.action.UserAction"</span> <span class="attr">method</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"userexp"</span>&gt;</span>/exp.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exception-mapping</span> <span class="attr">result</span>=<span class="string">"userexp"</span> <span class="attr">exception</span>=<span class="string">"com.zhuchuli.exception.UserException"</span>&gt;</span><span class="tag">&lt;/<span class="name">exception-mapping</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二十六讲-Struts最新版"><a href="#第二十六讲-Struts最新版" class="headerlink" title="第二十六讲 Struts最新版"></a>第二十六讲 Struts最新版</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Log4j与Junit测试" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/CPWS.github.io/2019/09/09/Log4j与Junit测试/" class="article-date">
  	<time datetime="2019-09-09T08:28:00.000Z" itemprop="datePublished">2019-09-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/CPWS.github.io/2019/09/09/Log4j与Junit测试/">
        Log4j与Junit测试
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Log4j的作用和级别"><a href="#Log4j的作用和级别" class="headerlink" title="Log4j的作用和级别"></a>Log4j的作用和级别</h2><hr>
<ul>
<li>什么是日志<ul>
<li>日志是系统运行过程中的后台输出信息，方便程序员进行系统运行的管控以及Bug查找</li>
</ul>
</li>
<li>什么是<code>Log4j</code><ul>
<li><code>Log4j</code>是一个日志输出插件，专门用来进行日志的管理的。</li>
</ul>
</li>
<li>传统方式获取日志<ul>
<li>使用<code>System.out.println()</code>;</li>
<li>问题：<ul>
<li>日志信息无法保存。</li>
<li>无法显示完整日志信息。</li>
<li>日志的显示没有级别所有日志混杂在一起显示（无法进行日志信息筛选）。</li>
<li>日志显示格式不友好。</li>
</ul>
</li>
<li>解决：使用Log4j</li>
<li>使用Log4j进行日志管理特点:<ul>
<li>日志可以单独保存在文件。</li>
<li>可以获取完整的日志信息。</li>
<li>可以进行日志显示的筛选。</li>
<li>格式友好。</li>
</ul>
</li>
</ul>
</li>
<li>Log4j的使用流程<ul>
<li>导入<code>log4j</code>的jar包</li>
<li>配置<code>Log4j</code>的配置文件</li>
<li><code>log4j</code>的日志级别<ul>
<li><code>FATAL</code> 致命的错误</li>
<li><code>Error</code> 错误级</li>
<li><code>WARM</code> 警告级</li>
<li><code>INFO</code> 信息级</li>
<li><code>DEBUG</code> 调试级</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="日志记录器（Logger）"><a href="#日志记录器（Logger）" class="headerlink" title="日志记录器（Logger）"></a>日志记录器（<code>Logger</code>）</h2><p><code>org.apache.log4j.Logger</code>类实例的作用是用来取代System.ou或者System.err的日志写出器，主要用来输出日志信息。</p>
<ul>
<li>可以通过如下几个方式来获取Logger类的实例<ul>
<li>根据指定名称来获取一个日志记录器的实例：<code>Logger logger=Logger.getLogger(String name);</code></li>
<li>根据指定的类信息中的类名来获取一个日志记录器的实例：<code>Logger logger=Logger.getLogger(Class clazz);</code></li>
</ul>
</li>
<li>获取(<code>Logger</code>)日志实例之后，就可以使用它提供的以下方法来记录日志了：<ul>
<li><code>public void debug(Object msg)</code></li>
<li><code>public void debug(Object msg,Throwable t)</code></li>
<li><code>public void info(Object msg)</code></li>
<li><code>public void info(Object msg,Throwable t)</code></li>
<li><code>public void warn(Object msg)</code></li>
<li><code>public void warn(Object msg,Throwable t)</code></li>
<li><code>public void error(Object msg)</code></li>
<li><code>public void error(Object msg,Throwable t)</code></li>
</ul>
</li>
<li><code>log4j</code>的日志级别<ul>
<li><code>FATAL</code> 致命的错误 对应的level为0 使用方法<code>logger.fatal()</code></li>
<li><code>Error</code> 错误级 对应的level为3 使用方法<code>logger.error()</code></li>
<li><code>WARM</code> 警告级 对应的level为4 使用方法<code>logger.warn()</code></li>
<li><code>INFO</code> 信息级 对应的level为6 使用方法<code>logger.info()</code></li>
<li><code>DEBUG</code> 调试级 对应的level为7 使用方法<code>logger.debug()</code></li>
</ul>
</li>
<li>日志级别的设置是通过在Log4j的配置文件中指定的。</li>
</ul>
<hr>
<h2 id="日志输出目的地（Appender）"><a href="#日志输出目的地（Appender）" class="headerlink" title="日志输出目的地（Appender）"></a>日志输出目的地（<code>Appender</code>）</h2><p><code>Appender</code>的功能是把格式好的日志信息输出到指定的目的地。</p>
<ul>
<li>日志目的地通过<code>Log4j</code>配置文件来指定的。</li>
<li>对于不同的日志目的地，Log4j提供不同的<code>Appender</code>实现类，常用的<code>Appender</code>实现类包括：<ul>
<li>用于控制台的<code>org.apache.log4j.ConsoleAppender</code>。</li>
<li>用于文件的<code>org.apache.log4j.FileAppender</code>。</li>
<li><code>org.apache.log4j.RollingFileAppender</code>–文件到达指定大小时产生一个新的文件。</li>
<li><code>org.apache.log4j.DailyRollingFileAppender</code> – 每天产生一个日志文件。</li>
<li>用于以流格式发送到任意位置的<code>org.apache.log4j.WriterAppender</code>。</li>
<li>用于添加到数据库的<code>org.apache.log4j.jdbc.JDBCAppender</code>。</li>
<li>用于邮件发送的<code>org.apache.log4j.net.SMTPAppender</code>。</li>
</ul>
</li>
<li>通过在配置文件中指定不同的<code>Appender</code>实现类，就可以让日志内容输出到相应的目的地。</li>
</ul>
<hr>
<h2 id="日志格式化器（Layout）"><a href="#日志格式化器（Layout）" class="headerlink" title="日志格式化器（Layout）"></a>日志格式化器（<code>Layout</code>）</h2><p><code>Layout</code>用来把日志信息按指定的格式格式化字符串。而具体的格式是通过log4j的配置文件来配置的。</p>
<ul>
<li><code>Log4j</code>中提供用来格式化输出结果的各种布局实现类，包括：<ul>
<li><code>org.apache.log4j.SimpleLayout</code>：简单输出。此布局的输出中仅包含日志消息的层次，紧跟着“-”，然后是日志消息字符串。</li>
<li><code>org.apache.log4j.PatternLayout</code>：模式布局。可以根据指定的模式字符串来决定消息的输出格式。它是一种最常用的一种格式化字符串。</li>
<li><code>org.apache.log4j.TTCCLayout</code>：日志的格式包含产生的日期，线程，类别等信息。</li>
<li><code>org.apache.log4j.HTMLLayout</code>：以HTML表格形式布局。</li>
<li><code>org.apache.xml.XMLLayout</code>：以XML形式布局。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Log4j的使用"><a href="#Log4j的使用" class="headerlink" title="Log4j的使用"></a>Log4j的使用</h2><ul>
<li><p><code>Log4j</code>的配置文件：“XMl格式的文件”，“Java属性文件:log4j.properties(键=值)”</p>
</li>
<li><p><code>Log4j.properties</code></p>
</li>
<li><p><code>log4j.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE log4j:configuration SYSTEM "log4j.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，你会看到log4j2内部各种详细输出--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--monitorInterval：Log4j能够自动检测修改配置 文件和重新配置本身，设置间隔秒数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"30"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--先定义所有的appender--&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--设置日志目的地类型和日志格式化器--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--这个输出控制台的配置--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--输出日志的格式--&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，这个也挺有用的，适合临时测试用--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">File</span> <span class="attr">name</span>=<span class="string">"log"</span> <span class="attr">fileName</span>=<span class="string">"log/test.log"</span> <span class="attr">append</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d&#123;HH:mm:ss.SSS&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 这个会打印出所有的info及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileInfo"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;sys:user.home&#125;/logs/info.log"</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">filePattern</span>=<span class="string">"$&#123;sys:user.home&#125;/logs/$$&#123;date:yyyy-MM&#125;/info-%d&#123;yyyy-MM-dd&#125;-%i.log"</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>       </span><br><span class="line">             <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"info"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"100 MB"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileWarn"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;sys:user.home&#125;/logs/warn.log"</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">filePattern</span>=<span class="string">"$&#123;sys:user.home&#125;/logs/$$&#123;date:yyyy-MM&#125;/warn-%d&#123;yyyy-MM-dd&#125;-%i.log"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"warn"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"100 MB"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件，这里设置了20 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"20"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileError"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;sys:user.home&#125;/logs/error.log"</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">filePattern</span>=<span class="string">"$&#123;sys:user.home&#125;/logs/$$&#123;date:yyyy-MM&#125;/error-%d&#123;yyyy-MM-dd&#125;-%i.log"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"error"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"100 MB"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--设置根记录器--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置级别--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">"DEBUG"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置目的地--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"File"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--过滤掉spring和mybatis的一些无用的DEBUG信息--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.springframework"</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.mybatis"</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"all"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"RollingFileInfo"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"RollingFileWarn"</span>/&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"RollingFileError"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Log4j</code>在默认的情况下，会首先查找使用<code>log4j.xml</code>的配置，然后再去查找<code>log4j.properties</code>。</p>
</li>
<li><p><code>log4j</code>的配置文件必须放置于项目的类路径（ClassPath）下。</p>
</li>
<li><p>在<code>Java</code>中使用<code>Log4j</code>打印日志信息的步骤如下：</p>
<ul>
<li>得到记录器。<ul>
<li><code>public static Logger logger=Logger.getLogger(String name);</code></li>
<li><code>static Logger logger=Logger.getLogger(Test.class.getName());</code></li>
</ul>
</li>
<li>读取配置文件。<ul>
<li><code>BasicConfigurator.configure();</code> //自动快速的使用默认的log4j环境</li>
<li><code>PropertyConfigurator.configure(String configFileName);</code>//读取使用Java的特性文件编写的配置文件。</li>
</ul>
</li>
<li>插入记录信息。<ul>
<li><code>Logger.debug(Object message);</code><h2 id="Junit单元测试"><a href="#Junit单元测试" class="headerlink" title="Junit单元测试"></a>Junit单元测试</h2><h3 id="Junit-概述"><a href="#Junit-概述" class="headerlink" title="Junit-概述"></a>Junit-概述</h3><h3 id="Junit-环境设置"><a href="#Junit-环境设置" class="headerlink" title="Junit-环境设置"></a>Junit-环境设置</h3><h3 id="Junit-基本用法"><a href="#Junit-基本用法" class="headerlink" title="Junit-基本用法"></a>Junit-基本用法</h3><h3 id="Junit-API"><a href="#Junit-API" class="headerlink" title="Junit-API"></a>Junit-API</h3><h3 id="Junit-编写测试"><a href="#Junit-编写测试" class="headerlink" title="Junit-编写测试"></a>Junit-编写测试</h3><h3 id="Junit-使用断言"><a href="#Junit-使用断言" class="headerlink" title="Junit-使用断言"></a>Junit-使用断言</h3><h3 id="Junit-执行过程"><a href="#Junit-执行过程" class="headerlink" title="Junit-执行过程"></a>Junit-执行过程</h3><h3 id="Junit-执行测试"><a href="#Junit-执行测试" class="headerlink" title="Junit-执行测试"></a>Junit-执行测试</h3><h3 id="Junit-囊括测试"><a href="#Junit-囊括测试" class="headerlink" title="Junit-囊括测试"></a>Junit-囊括测试</h3><h3 id="Junit-忽略测试"><a href="#Junit-忽略测试" class="headerlink" title="Junit-忽略测试"></a>Junit-忽略测试</h3></li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/CPWS.github.io/">&laquo; Prev</a><a class="page-number" href="/CPWS.github.io/">1</a><span class="page-number current">2</span><a class="page-number" href="/CPWS.github.io/page/3/">3</a><a class="extend next" rel="next" href="/CPWS.github.io/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2019 zhuli
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/CPWS.github.io/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/CPWS.github.io/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>