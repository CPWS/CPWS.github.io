<!DOCTYPE html>
<html lang="">
    <!-- title -->




<!-- keywords -->




<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="zhuli">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="zhuli">
    
    <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content>
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>注解与反射 · fi3ework&#39;s Studio</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/CPWS.github.io/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href="/CPWS.github.io/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="/CPWS.github.io/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href="/CPWS.github.io/assets/favicon.ico">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script">
    <link rel="preload" href="/CPWS.github.io/scripts/main.js" as="script">
    <link rel="preload" as="font" href="/CPWS.github.io/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/CPWS.github.io/" >fi3ework&#39;s Studio.</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">注解与反射</a>
            </div>
    </div>
    
    <a class="home-link" href=/CPWS.github.io/>fi3ework's Studio.</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/CPWS.github.io/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            注解与反射
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">6k</span>阅读时长: <span class="post-count reading-time">26 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2019/09/02</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/CPWS.github.io/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/CPWS.github.io/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h2 id="注解入门"><a href="#注解入门" class="headerlink" title="注解入门"></a>注解入门</h2><blockquote>
<ul>
<li>Annotation是JDK5.0开始引入的新技术</li>
<li>Annotation的作用<blockquote>
<ul>
<li>不是程序本身，可以对程序作出解释。</li>
<li>可以被其他程序（比如：编译器等）读取。（注解信息处理流程，是注解和注释的重大区别。如果没有注解信息处理流程，则注解毫无意义）。</li>
</ul>
</blockquote>
</li>
<li>Annotation格式<blockquote>
<ul>
<li>注解是以“@注释名”在代码中存在的，可以添加一些参数值，例如：@SeppressWarnings(value=”unchecked”)。 </li>
</ul>
</blockquote>
</li>
<li>Annotation在哪里使用？<blockquote>
<ul>
<li>可以附加在package，class，method，field等上面，相当于它它们添加了额外的辅助信息，我们可以通过反射机制编程实现对这些数据的访问。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="内置注解"><a href="#内置注解" class="headerlink" title="内置注解"></a>内置注解</h2><blockquote>
<ul>
<li><code>@Override</code>：定义在<code>java.lang.Override</code>中，此注释只适用修饰方法，表示一个方法声明打算重写超类中的另一个方法声明。</li>
<li><code>@Deprecated</code>：定义在<code>java.lang.Deprecated</code>中，此注释可以用于修饰方法、属性、类，表示不鼓励程序员使用这样的元素，通常是因为它很危险吗或存在更好的选择。（一般不建议使用）</li>
<li><code>@SuppressWarnings</code>：用来抑制编译器运行时的警告信息。<blockquote>
<ul>
<li><code>@SuppressWarnings(&quot;unchecked&quot;)</code><br>告诉编译器忽略 unchecked 警告信息，如使用List，ArrayList等未进行参数化产生的警告信息。</li>
<li><code>@SuppressWarnings(&quot;serial&quot;)</code><br>如果编译器出现这样的警告信息：The serializable class WmailCalendar does not declare a static final serialVersionUID field of type long<br>   使用这个注释将警告信息去掉。</li>
<li><code>@SuppressWarnings(&quot;deprecation&quot;)</code><br>如果使用了使用@Deprecated注释的方法，编译器将出现警告信息。<br>   使用这个注释将警告信息去掉。</li>
<li><code>@SuppressWarnings(&quot;unchecked&quot;, &quot;deprecation&quot;)</code><br>告诉编译器同时忽略unchecked和deprecation的警告信息。</li>
<li><code>@SuppressWarnings(value={&quot;unchecked&quot;, &quot;deprecation&quot;})</code><br>等同于@SuppressWarnings(“unchecked”, “deprecation”)   </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="自定义注解、元注解"><a href="#自定义注解、元注解" class="headerlink" title="自定义注解、元注解"></a>自定义注解、元注解</h2><h3 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h3><blockquote>
<ul>
<li>@Target<blockquote>
<ul>
<li>作用：用于描述注解的使用范围</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p>|所修饰的范围|取值ElemnetType|<br>|-|-|-|<br>|package包|PACKAGE|<br>|类、接口、枚举、Annotation类型|TYPE|<br>|类型成员（方法、构造器、成员变量、枚举值）|CONSTRUCTOR：用于描述构造器。<br>FIELD：用于描述域<br>METHOD：用于描述方法|<br>|方法参数和本地变量|LOCAL_VALUE：用于描述局部变量<br>PARANETER：用于描述参数|</p>
<blockquote>
<blockquote>
<ul>
<li>@Target(value=ElementType.Type)</li>
<li>@Retention</li>
<li>作用：表示需要在什么级别保存该注解，用于描述注解的生命周期。</li>
</ul>
</blockquote>
</blockquote>
<table>
<thead>
<tr>
<th>取值 RetentionPolicy</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>SOURCE</td>
<td>在源文件中有效（即源文件保存）</td>
</tr>
<tr>
<td>CLASS</td>
<td>在class文件中有效（即class保留）</td>
</tr>
<tr>
<td>RUNTIME</td>
<td>在运行时有效（即运行时保留）<br>为Runtime可以被反射机制读取</td>
</tr>
</tbody></table>
<ul>
<li>注意：<ul>
<li>注解元素的参数的默认值一般设置为<code>0</code>或<code>空字符窜</code>；</li>
<li>也可能是-1，表示什么也没有</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><code>@Documented</code><blockquote>
<ul>
<li>作用：用于描述其它类型的annotation应该被作为被标注的程序成员的公共API，因此可以被例如javadoc此类的工具文档化。它是一个标记注解，没有成员。</li>
</ul>
</blockquote>
</li>
<li><code>@Inherited</code><blockquote>
<ul>
<li>作用：用于表示某个被标注的类型是被继承的。如果一个使用了@Inherited修饰的annotation类型被用于一个class，则这个annotation将被用于该class的子类</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="反射机制读取注解"><a href="#反射机制读取注解" class="headerlink" title="反射机制读取注解"></a>反射机制读取注解</h2><blockquote>
<ul>
<li>什么是ORM（Object Relationship Mapping）<blockquote>
<ul>
<li>类和表结构对应</li>
<li>属性和字段对应</li>
<li>对象和记录对应</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="使用注解完成类和表结构的映射关系"><a href="#使用注解完成类和表结构的映射关系" class="headerlink" title="使用注解完成类和表结构的映射关系"></a>使用注解完成类和表结构的映射关系</h2><blockquote>
<ul>
<li>学了反射机制后，我们可以定义注解的执行流程读取这些注解，实现更复杂的功能</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Target</span>(value = ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Table &#123;</span><br><span class="line">	<span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(value = ElementType.FIELD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Field &#123;</span><br><span class="line">	<span class="function">String <span class="title">columnName</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">String <span class="title">type</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">length</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"><span class="meta">@Table</span>(<span class="string">"tb_student"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Field</span>(columnName=<span class="string">"id"</span>,type=<span class="string">"int"</span>,length=<span class="number">3</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="meta">@Field</span>(columnName=<span class="string">"sname"</span>,type=<span class="string">"varchar"</span>,length=<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">private</span> String studentName;</span><br><span class="line">	<span class="meta">@Field</span>(columnName=<span class="string">"age"</span>,type=<span class="string">"int"</span>,length=<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStudentName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> studentName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentName</span><span class="params">(String studentName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.studentName = studentName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用反射处理注解信息，模拟处理注解信息的流程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz=Class.forName(<span class="string">"annotation.Student"</span>);</span><br><span class="line">			<span class="comment">//获取类所有有效的注解</span></span><br><span class="line">			Annotation[] annotations=clazz.getAnnotations();</span><br><span class="line">			<span class="keyword">for</span>(Annotation a:annotations) &#123;</span><br><span class="line">				System.out.println(a);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//获取指定的注解</span></span><br><span class="line">			Table table=(Table) clazz.getAnnotation(Table.class);</span><br><span class="line">			System.out.println(table.value());</span><br><span class="line">			<span class="comment">//获取类的属性的注解</span></span><br><span class="line">			Field f=clazz.getDeclaredField(<span class="string">"studentName"</span>).getAnnotation(Field.class);</span><br><span class="line">			System.out.println(f.columnName() + <span class="string">"---&gt;"</span> + f.type() + <span class="string">"---&gt;"</span> + f.length());</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Java的动态性"><a href="#Java的动态性" class="headerlink" title="Java的动态性"></a>Java的动态性</h2><blockquote>
<ul>
<li>动态语言：程序运行时，可以改变程序结果或变量类。</li>
<li>Java可以称为准动态语言。</li>
</ul>
</blockquote>
<h3 id="反射机制-reflection"><a href="#反射机制-reflection" class="headerlink" title="反射机制 reflection"></a>反射机制 reflection</h3><blockquote>
<ul>
<li>指的是可以于运行时加载、探知、使用编译期间完全未知的类。</li>
<li>程序在运行状态中，可以动态加载一个只有名称的类，对于任意一个已加载的类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class c=Class.forName(<span class="string">"包名.类名"</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>加载完类之后，在堆内存中，就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，通过这个镜子可以看到类的结构，所以我们形象的称之为：反射。</li>
<li>Class类的对象如何获取<blockquote>
<ul>
<li>运用getClass()</li>
<li>运用Class.forName()（最常被使用） </li>
<li>运用类.class</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试java.lang.Class对象的获取方式。</span></span><br><span class="line"><span class="comment"> * 测试各种数据类型java.lang.Class对象的获取方式。</span></span><br><span class="line"><span class="comment"> * 1.利用类.class</span></span><br><span class="line"><span class="comment"> * 2.利用类.getClass()</span></span><br><span class="line"><span class="comment"> * 3.利用Class.forName()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String path= <span class="string">"com.zhuchuli.testBean.User"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz = Class.forName(path);</span><br><span class="line">			<span class="comment">//对象是表示或封装一些数据。一个类被加载之后，Jvm会创建一个对应该类的Class对象，类的整个结构信息会放到对象的Class对象中。</span></span><br><span class="line">			<span class="comment">//这个Class对象就像一面镜子一样，通过这个镜子，我们可以看到类的全部信息。</span></span><br><span class="line">			System.out.println(clazz.hashCode());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//获取Class对象的三种方式</span></span><br><span class="line">			Class strClazz=String.class;</span><br><span class="line">			Class strClazz2=path.getClass();</span><br><span class="line">			System.out.println(strClazz==strClazz2);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//基本数据类型</span></span><br><span class="line">			Class intClaszz=<span class="keyword">int</span>.class;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>反射机制的常见作用</li>
</ul>
</blockquote>
<hr>
<blockquote>
<blockquote>
<ul>
<li>动态加载类、动态获取类的信息（属性、方法、构造器）</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 应用反射API，获取类的信息（类的名字、属性、方法、构造器等）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String path= <span class="string">"com.zhuchuli.testBean.User"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz = Class.forName(path);</span><br><span class="line">			<span class="comment">//获取类的名字</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取类名---------------------------------"</span>);</span><br><span class="line">			System.out.println(clazz.getName());<span class="comment">//获得包名+类名 com.zhuchuli.testBean.User</span></span><br><span class="line">			System.out.println(clazz.getSimpleName());<span class="comment">//获得类名 User</span></span><br><span class="line">			System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">			<span class="comment">//获取属性信息</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取属性---------------------------------"</span>);</span><br><span class="line">			<span class="comment">//Field[] fields=clazz.getFields();//只能获取public的属性</span></span><br><span class="line">			Field[] fields=clazz.getDeclaredFields();<span class="comment">//获得所有的field</span></span><br><span class="line">			Field f=clazz.getDeclaredField(<span class="string">"uname"</span>);</span><br><span class="line">			System.out.println(f);</span><br><span class="line">			<span class="keyword">for</span>(Field field:fields) &#123;</span><br><span class="line">				System.out.println(<span class="string">"属性："</span>+field);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">			<span class="comment">//获取方法信息</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取方法---------------------------------"</span>);</span><br><span class="line">			Method[] methods=clazz.getMethods();<span class="comment">//只能获取public修饰的方法</span></span><br><span class="line">			Method[] methodss=clazz.getDeclaredMethods();<span class="comment">//获取所有的方法</span></span><br><span class="line">			Method m01=clazz.getDeclaredMethod(<span class="string">"getUname"</span>, <span class="keyword">null</span>);</span><br><span class="line">			System.out.println(m01);</span><br><span class="line">			Method m02=clazz.getDeclaredMethod(<span class="string">"setUname"</span>, String.class);<span class="comment">//如果方法有参数，则必须指明参数的类型，即参数类型.class</span></span><br><span class="line">			System.out.println(m02);</span><br><span class="line">			<span class="keyword">for</span>(Method method:methodss) &#123;</span><br><span class="line">				System.out.println(<span class="string">"方法："</span>+method);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">			<span class="comment">//获取构造器信息</span></span><br><span class="line">			System.out.println(<span class="string">"---------------------------------通过反射获取构造器---------------------------------"</span>);</span><br><span class="line">			Constructor[] constructors=clazz.getConstructors();<span class="comment">//获取public修饰的构造器</span></span><br><span class="line">            Constructor[] constructorss=clazz.getDeclaredConstructors();</span><br><span class="line">            <span class="keyword">for</span>(Constructor constructor:constructorss) &#123;</span><br><span class="line">            	System.out.println(<span class="string">"构造器："</span>+constructor);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"根据参数类型获取构造器"</span>);</span><br><span class="line">            Constructor c=clazz.getDeclaredConstructor(<span class="keyword">null</span>);</span><br><span class="line">            System.out.println(<span class="string">"构造器："</span>+c);</span><br><span class="line">            Constructor cc=clazz.getConstructor(<span class="keyword">int</span>.class,String.class,<span class="keyword">int</span>.class);</span><br><span class="line">            System.out.println(<span class="string">"构造器："</span>+cc);</span><br><span class="line">            System.out.println(<span class="string">"------------------------------------------------------------------------------"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>动态构造对象</li>
<li>动态调用类和对象的任意方法、构造器</li>
<li>动态调用和处理属性</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 通过反射API动态的操作：构造器，方法和属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//动态操作构造器</span></span><br><span class="line">		String path= <span class="string">"com.zhuchuli.testBean.User"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Class clazz = Class.forName(path);</span><br><span class="line">			<span class="comment">//通过反射API调用构造方法，构造对象</span></span><br><span class="line">			User u=(User) clazz.getConstructor().newInstance();<span class="comment">//其实调用JavaBean的无参数构造器</span></span><br><span class="line">			System.out.println(u);</span><br><span class="line">			</span><br><span class="line">			Constructor&lt;User&gt; c=clazz.getConstructor(<span class="keyword">int</span>.class,String.class,<span class="keyword">int</span>.class);</span><br><span class="line">			User u2=c.newInstance(<span class="number">1001</span>,<span class="string">"lee"</span>,<span class="number">18</span>);</span><br><span class="line">			System.out.println(u2.getId()+<span class="string">"--"</span>+u2.getUname()+<span class="string">"--"</span>+u2.getAge());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//通过反射API调用普通方法</span></span><br><span class="line">			User u3=(User) clazz.getConstructor().newInstance();</span><br><span class="line">			Method method=clazz.getDeclaredMethod(<span class="string">"setUname"</span>, String.class);</span><br><span class="line">			method.invoke(u3, <span class="string">"lee2"</span>);<span class="comment">//类似于u3.setUname="lee2"</span></span><br><span class="line">			System.out.println(u3.getUname());</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//通过反射API调用属性</span></span><br><span class="line">			User u4=(User) clazz.getConstructor().newInstance();</span><br><span class="line">			Field f=clazz.getDeclaredField(<span class="string">"uname"</span>);</span><br><span class="line">			f.setAccessible(<span class="keyword">true</span>);<span class="comment">//这个属性不需要做安全检查，可以直接访问。</span></span><br><span class="line">			f.set(u4, <span class="string">"lee3"</span>);<span class="comment">//通过放射获取属性的值</span></span><br><span class="line">			System.out.println(u4.getUname());</span><br><span class="line">			System.out.println(f.get(u4));<span class="comment">//通过反射读取对象的值</span></span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>获取泛型信息（Generic）<blockquote>
<ul>
<li>Java使用泛型擦除机制来引入泛型。Java中的泛型仅仅是给编译器JavaC使用的，确保数据的安全性和免去强制类型转换的麻烦。但是编译一旦完成，所有和泛型有关的类全部被擦除。</li>
<li>为了通过反射操作这些类型以迎合实际开发的需要，Java新增了PatameterType，GenericArrayType，TypeVariable，和WildCardType几种类型来代表不能被归一到Class类中的类型但是又和原始类型齐名的类型。<blockquote>
<ul>
<li>ParameterizedType:表示一种参数化的类型，比如Collection&lt; String &gt;.</li>
<li>GenericArrayType:表示一种元素类型是参数化类型或者类型变量的数组类型.</li>
<li>TypeVariable:是各种类型变量的公共父接.</li>
<li>WildcardType:代表一种通配符类型表达式，比如？、？ extends Number、？ super Integer。（wildcard是一个单词：就是”通配符“）.</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 通过反射获取泛型信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">(Map&lt;String,User&gt; map,List&lt;User&gt; list)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Demo04 test01()"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;Integer,User&gt; <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Demo01 test02()"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//获取执行方法参数的泛型信息</span></span><br><span class="line">			Method method = Demo04.class.getDeclaredMethod(<span class="string">"test01"</span>, Map.class, List.class);</span><br><span class="line">			Type[] t=method.getGenericParameterTypes();</span><br><span class="line">			<span class="keyword">for</span>(Type paramType:t) &#123;</span><br><span class="line">				System.out.println(<span class="string">"#"</span>+paramType);</span><br><span class="line">				<span class="keyword">if</span>(paramType <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">					<span class="comment">//获取泛型中的具体信息</span></span><br><span class="line">					Type[] genericTypes = ((ParameterizedType) paramType).getActualTypeArguments();</span><br><span class="line">					<span class="keyword">for</span>(Type genericType:genericTypes) &#123;</span><br><span class="line">						System.out.println(<span class="string">"泛型类型："</span> + genericType);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//获取指定方法返回值泛型信息</span></span><br><span class="line">			Method method2=Demo04.class.getDeclaredMethod(<span class="string">"test02"</span>,<span class="keyword">null</span>);</span><br><span class="line">			Type returnType=method2.getGenericReturnType();</span><br><span class="line">			<span class="keyword">if</span>(returnType <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">				<span class="comment">//获取泛型中的具体信息</span></span><br><span class="line">				Type[] genericTypes = ((ParameterizedType) returnType).getActualTypeArguments();</span><br><span class="line">				<span class="keyword">for</span>(Type genericType:genericTypes) &#123;</span><br><span class="line">					System.out.println(<span class="string">"泛型类型："</span> + genericType);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>处理注解：功能与案例代码与上面雷同。</li>
</ul>
</blockquote>
</blockquote>
<hr>
<blockquote>
<ul>
<li>反射机制的性能问题<blockquote>
<ul>
<li>setAccessible<blockquote>
<ul>
<li>启动和禁用访问安全检查的机关，值为true则指示反射的对象在使用时应该取消Java语言访问检查。值为false则指示表明反射的对象应该实施Java语言访问检查。并不是为true就能访问为false就不能访问。</li>
<li>禁止安全检查，可以提高反射的运行速度。</li>
</ul>
</blockquote>
</li>
<li>可以考虑使用：cglib/javaassist字节码操作 </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuchuli.testBean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		User user=<span class="keyword">new</span> User();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">long</span> before=System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++) &#123;</span><br><span class="line">			user.getUname();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> after=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"没有反射，共消耗：&lt;"</span>+(after-before)+<span class="string">"&gt;毫秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		User user=<span class="keyword">new</span> User();</span><br><span class="line">		Method method=Class.forName(<span class="string">"com.zhuchuli.testBean.User"</span>).getDeclaredMethod(<span class="string">"getUname"</span>, <span class="keyword">null</span>);</span><br><span class="line">		<span class="keyword">long</span> before=System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++) &#123;</span><br><span class="line">			method.invoke(user, <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> after=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"加安全检查，共消耗：&lt;"</span>+(after-before)+<span class="string">"&gt;毫秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		User user=<span class="keyword">new</span> User();</span><br><span class="line">		Method method=Class.forName(<span class="string">"com.zhuchuli.testBean.User"</span>).getDeclaredMethod(<span class="string">"getUname"</span>, <span class="keyword">null</span>);</span><br><span class="line">		method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">		<span class="keyword">long</span> before=System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++) &#123;</span><br><span class="line">			method.invoke(user, <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">long</span> after=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"不加安全检查，共消耗：&lt;"</span>+(after-before)+<span class="string">"&gt;毫秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		test01();</span><br><span class="line">		test02();</span><br><span class="line">		test03();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态编译"><a href="#动态编译" class="headerlink" title="动态编译"></a>动态编译</h3><blockquote>
<ul>
<li>Java6.0引入了动态编译机制</li>
<li>动态编译的应用场景<blockquote>
<ul>
<li>可以做一个浏览器端编写java代码，上传服务器编译和运行的在线测评系统。</li>
<li>服务器动态加载某些类文件进行编译。</li>
</ul>
</blockquote>
</li>
<li>动态编译的两种方式<blockquote>
<ul>
<li>通过Runtime调用javac，启动新的进程去操作<blockquote>
<ul>
<li>Runtime run=Runtime.getRuntime();</li>
<li>Process process=run.exec(javac -cp d:/myjava/ HelloWorld.java);</li>
</ul>
</blockquote>
</li>
<li>通过JavaCompiler动态编译</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String str=<span class="string">"public class Hi&#123;public static void main(String[] args[]) &#123;System.out.println(\"Hello Hi haha\");&#125;&#125;"</span>;</span><br><span class="line">		BufferedWriter br=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"d:/MyJava/Hi.java"</span>));</span><br><span class="line">		br.write(str);</span><br><span class="line">		br.flush();</span><br><span class="line">		<span class="comment">//获得系统编译器，如果使用jre（运行环境）则无法获得编译器</span></span><br><span class="line">		JavaCompiler complier=ToolProvider.getSystemJavaCompiler();</span><br><span class="line">		<span class="keyword">int</span> result=complier.run(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>,<span class="string">"d:/MyJava/Hi.java"</span>);</span><br><span class="line">		System.out.println(result==<span class="number">0</span>?<span class="string">"编译成功"</span>:<span class="string">"编译失败"</span>);</span><br><span class="line">		br.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>编译结果</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<p><img src="image/1567512289(1).png" alt="avator.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String str=<span class="string">"public class Hi&#123;public static void main(String[] args) &#123;System.out.println(\"Hello Hi haha\");&#125;&#125;"</span>;</span><br><span class="line">		BufferedWriter bw=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"d:/MyJava/Hi.java"</span>));</span><br><span class="line">		bw.write(str);</span><br><span class="line">		bw.flush();</span><br><span class="line">		<span class="comment">//获得系统编译器，如果使用jre（运行环境）则无法获得编译器</span></span><br><span class="line">		JavaCompiler complier=ToolProvider.getSystemJavaCompiler();</span><br><span class="line">		<span class="keyword">int</span> result=complier.run(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>,<span class="string">"d:/MyJava/Hi.java"</span>);</span><br><span class="line">		System.out.println(result==<span class="number">0</span>?<span class="string">"编译成功"</span>:<span class="string">"编译失败"</span>);</span><br><span class="line">		</span><br><span class="line">		Runtime run=Runtime.getRuntime();</span><br><span class="line">		Process process=run.exec(<span class="string">"java -cp d:/MyJava Hi"</span>);</span><br><span class="line">		BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream()));</span><br><span class="line">		String info=<span class="string">""</span>;</span><br><span class="line">		<span class="keyword">while</span>((info=br.readLine())!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			System.out.println(info);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<ul>
<li>编译结果</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<p><img src="image/1567512221(1).png" alt="avator.png"></p>
<blockquote>
<blockquote>
<ul>
<li>通过反射机制，启动新的线程去执行</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.test;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过反射机制调用执行类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		String str=<span class="string">"public class Hi&#123;public static void main(String[] args) &#123;System.out.println(\"Hello Hi haha\");&#125;&#125;"</span>;</span><br><span class="line">		BufferedWriter bw=<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">"d:/MyJava/Hi.java"</span>));</span><br><span class="line">		bw.write(str);</span><br><span class="line">		bw.flush();</span><br><span class="line">		<span class="comment">//获得系统编译器，如果使用jre（运行环境）则无法获得编译器</span></span><br><span class="line">		JavaCompiler complier=ToolProvider.getSystemJavaCompiler();</span><br><span class="line">		<span class="keyword">int</span> result=complier.run(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>,<span class="string">"d:/MyJava/Hi.java"</span>);</span><br><span class="line">		System.out.println(result==<span class="number">0</span>?<span class="string">"编译成功"</span>:<span class="string">"编译失败"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			URL[] urls=<span class="keyword">new</span> URL[] &#123;<span class="keyword">new</span> URL(<span class="string">"file:/"</span>+<span class="string">"d:/MyJava/"</span>)&#125;;</span><br><span class="line">			URLClassLoader loader=<span class="keyword">new</span> URLClassLoader(urls);</span><br><span class="line">			Class c=loader.loadClass(<span class="string">"Hi"</span>);</span><br><span class="line">			Method m=c.getMethod(<span class="string">"main"</span>, String[].class);</span><br><span class="line">			m.invoke(<span class="keyword">null</span>, (Object)<span class="keyword">new</span> String[] &#123;&#125;);</span><br><span class="line">			<span class="comment">//m.invoke(null,new String[] &#123;"a","b"&#125;);</span></span><br><span class="line">			<span class="comment">//由于可变参数是Java5.0之后才有。上面的代码会被运行成;m.invoke(null,"a","b")，就发生了参数个数不匹配，从而出现错误,因此要加上(Object)转型，避免出现出错;</span></span><br><span class="line">			<span class="comment">//public static void mmm(String[] a,String[] b)</span></span><br><span class="line">			<span class="comment">//public static void main(String[] args);</span></span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<p>编译结果</p>
</blockquote>
</blockquote>
</blockquote>
<p><img src="image/1567513472(1).png" alt="avator.png"></p>
<h3 id="动态执行javascript代码"><a href="#动态执行javascript代码" class="headerlink" title="动态执行javascript代码"></a>动态执行javascript代码</h3><blockquote>
<ul>
<li>Java脚本引擎是从JDK6.0之后添加的新功能</li>
<li>脚本引擎介绍<blockquote>
<ul>
<li>使得Java应用程序可以通过一套固定的接口与各种脚本引擎交互，从而达到在Java平台上调用各种脚本语言的目的。</li>
<li>Java脚本API是连通Java平台和脚本语言的桥梁。</li>
<li>可以把一些复杂异变的业务逻辑交给与脚本语言处理，这又大大提高了开发效率。</li>
</ul>
</blockquote>
</li>
<li>获得脚本引擎<blockquote>
<ul>
<li>ScriptEngineManager sem=new ScriptEngineManager();</li>
<li>ScriptEngine engine=sem.getEngineByName(“javascript”);</li>
</ul>
</blockquote>
</li>
<li>Java脚本API为开发者提供了如下功能：<blockquote>
<ul>
<li>获取脚本程序输入，通过脚本引擎运行脚本并返回运行结果，这是最核心的接口。<blockquote>
<ul>
<li>注意是：接口。Java可以使用各种不同的表现，从而通用的调用js、groovy、python等脚本</li>
<li>js使用了:Rhino，Rhino是一种使用Java语言编写的JavaScript的开源实现，原先是由Mozilla开发，现在被集成进入JDK6.0</li>
</ul>
</blockquote>
</li>
<li>通过脚本引擎的运行上下文在脚本和Java平台间交换数据。</li>
<li>通过Java应用程序调用脚本函数。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.rhino;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.script.Invocable;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试脚本引擎执行JavaScript代码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ScriptException, NoSuchMethodException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取脚本引擎对象</span></span><br><span class="line">		ScriptEngineManager sem=<span class="keyword">new</span> ScriptEngineManager();</span><br><span class="line">		ScriptEngine engine=sem.getEngineByName(<span class="string">"javascript"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//定义变量，存储到引擎上下文中</span></span><br><span class="line">		engine.put(<span class="string">"msg"</span>, <span class="string">"lee is a good student"</span>);</span><br><span class="line">		String str=<span class="string">"var user= &#123;name:'aaa',age:18,schools:['gdaib','dgef']&#125;;"</span>;</span><br><span class="line">		str += <span class="string">"print(user.schools);"</span>;</span><br><span class="line">		<span class="comment">//执行脚本</span></span><br><span class="line">		engine.eval(str);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//修改msg的值</span></span><br><span class="line">		engine.eval(<span class="string">"msg='very happy today'"</span>);</span><br><span class="line">		System.out.println(engine.get(<span class="string">"msg"</span>));</span><br><span class="line">		System.out.println(<span class="string">"--------------------"</span>);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//定义函数</span></span><br><span class="line">		engine.eval(<span class="string">"function add(a,b)&#123;var sum=a+b;return sum;&#125;"</span>);</span><br><span class="line">		<span class="comment">//执行js函数 取得调用接口</span></span><br><span class="line">		Invocable jsInvoke=(Invocable) engine;</span><br><span class="line">		<span class="comment">//执行脚本中定义的方法</span></span><br><span class="line">		Object i=jsInvoke.invokeFunction(<span class="string">"add"</span>, <span class="keyword">new</span> Object[] &#123;<span class="number">10</span>,<span class="number">20</span>&#125;);                                            </span><br><span class="line">		System.out.println(i);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//导入其他java包，使用其他包中的java类</span></span><br><span class="line">		String jsCode=<span class="string">"var list=java.util.Arrays.asList([\"北京尚学堂\",\"北京大学\"]);"</span>;</span><br><span class="line">		engine.eval(jsCode);</span><br><span class="line">		List&lt;String&gt; list2=(List&lt;String&gt;) engine.get(<span class="string">"list"</span>);</span><br><span class="line">		<span class="keyword">for</span>(String temp:list2) &#123;                                                                                      </span><br><span class="line">			System.out.println(temp);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//执行一个JS文件</span></span><br><span class="line">		URL url=Demo01.class.getClassLoader().getResource(<span class="string">"a.js"</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			FileReader fr = <span class="keyword">new</span> FileReader(url.getPath());</span><br><span class="line">			engine.eval(fr);</span><br><span class="line">			fr.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<ul>
<li>运行结果</li>
</ul>
</blockquote>
</blockquote>
<p><img src="image/1567583317(1).png" alt="avator.png"></p>
<h3 id="动态字字节码操作：javaassist"><a href="#动态字字节码操作：javaassist" class="headerlink" title="动态字字节码操作：javaassist"></a>动态字字节码操作：javaassist</h3><blockquote>
<ul>
<li>Java动态性的两种常见实现方式：<blockquote>
<ul>
<li>字节码操作</li>
<li>反射</li>
</ul>
</blockquote>
</li>
<li>运行时操作字节码可以让我们实现如下功能<blockquote>
<ul>
<li>动态生成新的类。</li>
<li>动态改变某个类的结构（添加、删除、修改  新的属性、方法 ）</li>
</ul>
</blockquote>
</li>
<li>优势<blockquote>
<ul>
<li>比反射开销小，性能高。</li>
<li>Javaassist性能高于反射，低于ASM</li>
</ul>
</blockquote>
</li>
<li>常见的字节码操作类库<blockquote>
<ul>
<li>BCEL 基于底层Jvm的操作和指令</li>
<li>ASM 基于底层Jvm的操作和指令</li>
<li>CGLIB 基于ASM实现</li>
<li>Javaassist</li>
</ul>
</blockquote>
</li>
<li>Javaassist库的API详解<blockquote>
<ul>
<li>javaassist的最外层的API和java的反射包中的API颇为类似。</li>
<li>它主要有CtClass,CtMethod，以及CtField几个类组成。用以执行和JDK反射API中java.lang.Class,java.lang.reflection.Method，java.lang.reflection.Field相同的操作。</li>
</ul>
</blockquote>
</li>
<li>JAVAassist库的简单使用。<blockquote>
<ul>
<li>创建一个全新的类</li>
<li>使用XJAD反编译工具，将生成的class文件反编译成Java文件\</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.javaassist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.CannotCompileException;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> javassist.CtField;</span><br><span class="line"><span class="keyword">import</span> javassist.CtMethod;</span><br><span class="line"><span class="keyword">import</span> javassist.NotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试 使用javaassist动态生成一个新类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CannotCompileException, NotFoundException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">//创建一个类池</span></span><br><span class="line">		ClassPool pool=ClassPool.getDefault();</span><br><span class="line">		CtClass cc=pool.makeClass(<span class="string">"com.zhuchuli.bean.Emp"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建属性</span></span><br><span class="line">		CtField f1=CtField.make(<span class="string">"private String ename;"</span>,cc); </span><br><span class="line">		CtField f2=CtField.make(<span class="string">"private int empno;"</span>,cc);</span><br><span class="line">		cc.addField(f1);</span><br><span class="line">		cc.addField(f2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建方法</span></span><br><span class="line">		CtMethod c1=CtMethod.make(<span class="string">"public String getEname()&#123;return ename;&#125; "</span>, cc);</span><br><span class="line">		CtMethod c2=CtMethod.make(<span class="string">"public void setEname(String ename)&#123;this.ename=ename;&#125; "</span>, cc);</span><br><span class="line">		cc.addMethod(c1);</span><br><span class="line">		cc.addMethod(c2);</span><br><span class="line">		CtMethod c3=CtMethod.make(<span class="string">"public int getEmpno()&#123;return empno;&#125; "</span>, cc);</span><br><span class="line">		CtMethod c4=CtMethod.make(<span class="string">"public void setEmpno(int empno)&#123;this.empno=empno;&#125; "</span>, cc);</span><br><span class="line">		cc.addMethod(c3);</span><br><span class="line">		cc.addMethod(c4);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建构造器</span></span><br><span class="line">		CtConstructor constructor=<span class="keyword">new</span> CtConstructor(<span class="keyword">new</span> CtClass[] &#123;pool.get(<span class="string">"java.lang.String"</span>), CtClass.intType&#125;, cc);</span><br><span class="line">		constructor.setBody(<span class="string">"&#123;this.ename=ename;this.empno=empno;&#125;"</span>);</span><br><span class="line">		CtConstructor constructor2=<span class="keyword">new</span> CtConstructor(<span class="keyword">null</span>,cc);</span><br><span class="line">		cc.addConstructor(constructor);</span><br><span class="line">		cc.addConstructor(constructor2);</span><br><span class="line">		</span><br><span class="line">		cc.writeFile(<span class="string">"d:/MyJava/Emp.java"</span>);<span class="comment">//将创建的这一类存放到指定位置上</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Javaassist的AIP使用</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuchuli.javaassist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtMethod;</span><br><span class="line"><span class="keyword">import</span> javassist.Modifier;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 测试Javaassist的API</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">	<span class="comment">//处理类的基本用法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPool pool=ClassPool.getDefault();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			CtClass cc = pool.get(<span class="string">"com.zhuchuli.javaassist.Emp"</span>);</span><br><span class="line">			<span class="comment">//将类转换成字节数组</span></span><br><span class="line">			<span class="keyword">byte</span>[] bytes=cc.toBytecode();</span><br><span class="line">			System.out.println(Arrays.toString(bytes));</span><br><span class="line">			System.out.println(cc.getName());<span class="comment">//获取类名</span></span><br><span class="line">			System.out.println(cc.getSuperclass());<span class="comment">//获取父类</span></span><br><span class="line">			System.out.println(cc.getInterfaces());<span class="comment">//获取接口</span></span><br><span class="line">			System.out.println(cc.getSimpleName ());<span class="comment">//获得简要类名</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//处理方法的基本用法 产生新的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ClassPool pool=ClassPool.getDefault();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			CtClass cc = pool.get(<span class="string">"com.zhuchuli.javaassist.Emp"</span>);</span><br><span class="line">     		<span class="comment">//CtMethod method=CtMethod.make("public int add(int a,int b)&#123;System.out.println(\"test02\");return a+b;&#125;", cc);</span></span><br><span class="line">			<span class="comment">//第一个参数为返回值类型,第二个参数为方法名 第三个参数为方法参数 第四个参数为所要加入的对象</span></span><br><span class="line">			CtMethod m=<span class="keyword">new</span> CtMethod(CtClass.intType, <span class="string">"add"</span>, <span class="keyword">new</span> CtClass[] &#123;CtClass.intType,CtClass.intType&#125;,cc);</span><br><span class="line">			<span class="comment">//设置方法的修饰符</span></span><br><span class="line">			m.setModifiers(Modifier.PUBLIC);</span><br><span class="line">			<span class="comment">//设置方法体 $1代表参数位置</span></span><br><span class="line">			m.setBody(<span class="string">"&#123;System.out.println(\"test02\");return $1+$2;&#125;"</span>);</span><br><span class="line">			cc.addMethod(m);</span><br><span class="line">			</span><br><span class="line">			Class&lt;?&gt; clazz=cc.toClass();</span><br><span class="line">			</span><br><span class="line">			Object obj=clazz.getConstructor().newInstance();</span><br><span class="line">			</span><br><span class="line">			Method method=clazz.getDeclaredMethod(<span class="string">"add"</span>, <span class="keyword">int</span>.class,<span class="keyword">int</span>.class);</span><br><span class="line">			Object result=method.invoke(obj, <span class="number">200</span>,<span class="number">300</span>);</span><br><span class="line">			System.out.println(result);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//... 还有注解 构造器 和 属性</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		test01();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JVM运行和类加载全过程"><a href="#JVM运行和类加载全过程" class="headerlink" title="JVM运行和类加载全过程"></a>JVM运行和类加载全过程</h2><blockquote>
<ul>
<li>为什么要研究加载全过程？<blockquote>
<ul>
<li>有助于了解JVM运行过程</li>
<li>更深入了解Java动态性（解耦部署，动态加载），提高程序的灵活性。</li>
</ul>
</blockquote>
</li>
<li>类加载全过程 （如下图所示）<blockquote>
<ul>
<li>加载 </li>
<li>链接 （验证 准备 解析）:将Java类的二进制代码合并到JVM的运行状态之中的过程。</li>
<li>初始化：静态属性或静态方法或静态块只会被初始化一次。</li>
<li>使用</li>
<li>卸载</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p><img src="image/1567642828(1).png" alt="avator.png"></p>
<blockquote>
<ul>
<li>类的主动引用（一定会发生类初始化）<blockquote>
<ul>
<li>new一个类的对象。</li>
<li>调用类的静态成员（除了final常量）和静态方法。</li>
<li>使用java.lang.reflect包的方法对类进行反射调用。</li>
<li>当虚拟机启动，java hello则一定会初始化Hello类，说白了就是先启动main方法所在的类。</li>
<li>当初始化一个类，如果其父类没有被初始化，则会先初始化他的父类。</li>
</ul>
</blockquote>
</li>
<li>类的被动引用<blockquote>
<ul>
<li>当访问一个静态域时，只有真正声明这个域的类才会被初始化。<blockquote>
<ul>
<li>通过子类引用父类的静态变量，不会导致子类初始化。</li>
</ul>
</blockquote>
</li>
<li>通过数组定义类引用，不会触发此类的初始化</li>
<li>引用常量不会触发此类的初始化（常量在编译阶段就存入调用类的常量池中了）。</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="深入类加载器"><a href="#深入类加载器" class="headerlink" title="深入类加载器"></a>深入类加载器</h2><blockquote>
<ul>
<li>类加载器原理<blockquote>
<ul>
<li>类加载器的作用：将class文件字节码内容加载到内存中，并将这些静态数据转换成方法区中的运行时数据结构，在堆中生成一个代表这个类的java.lang.Class对象，作为方法区类数据的访问入口。</li>
<li>类缓存：标准的JavaSE类加载器可以按要求查找类，但一旦某个类被加载到类加载器中，它将维持加载（缓存）一段时间。不过JVM垃圾集成器可以回收这些Class对象。</li>
</ul>
</blockquote>
</li>
<li>类加载器树状结构，双亲委托（代理）机制<blockquote>
<ul>
<li>引导类加载器（bootstrap class loader）</li>
<li>扩展类加载器（extensions class loader）</li>
<li>应用程序类加载器（application clasas loader）</li>
<li>自定义类加载器 </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<p><img src="image/1567659790(1).png" alt="avator.png"></p>
<p><img src="image/1567659996(1).png" alt="avator.png"></p>
<blockquote>
<blockquote>
<ul>
<li>双亲委托机制是为了保证Java核心库的类型安全。（请求  —&gt; 交给父类  —&gt; 交给爷爷辈）</li>
<li>tomcat则与此相反</li>
<li>自定义类加载器（文件、网络、加密）</li>
</ul>
<ul>
<li>注意：同一个类被不同的加载器加载，JVM也会认为他们不是相同的类</li>
</ul>
<ul>
<li>线程上下文类加载器</li>
<li>服务器类加载器原理和OSGI介绍(面向Java的动态模块系统)<blockquote>
<ul>
<li>Eclipse是基于OSGI技术来构建的</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</blockquote>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="https://CPWS.github.io">zhuli</a>
            <p>原文链接：<a href="https://CPWS.github.io/2019/09/02/注解与反射/">https://CPWS.github.io/2019/09/02/注解与反射/</a>
            <p>发表日期：<a href="https://CPWS.github.io/2019/09/02/注解与反射/">September 2nd 2019, 4:08:40 pm</a>
            <p>更新日期：<a href="https://CPWS.github.io/2019/09/02/注解与反射/">September 5th 2019, 7:28:08 pm</a>
            <p>版权声明：本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/CPWS.github.io/2019/09/08/正则表达式/" title= "正则表达式">
                    <div class="nextTitle">正则表达式</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/CPWS.github.io/2019/06/28/文件上传/" title= "文件上传">
                    <div class="prevTitle">文件上传</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:12345@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/fi3ework" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                  
                  <img class="profile-qr" src="/CPWS.github.io/assets/example_qr.png" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#注解入门"><span class="toc-number">1.</span> <span class="toc-text">注解入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内置注解"><span class="toc-number">2.</span> <span class="toc-text">内置注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义注解、元注解"><span class="toc-number">3.</span> <span class="toc-text">自定义注解、元注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#元注解"><span class="toc-number">3.1.</span> <span class="toc-text">元注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反射机制读取注解"><span class="toc-number">4.</span> <span class="toc-text">反射机制读取注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用注解完成类和表结构的映射关系"><span class="toc-number">5.</span> <span class="toc-text">使用注解完成类和表结构的映射关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java的动态性"><span class="toc-number">6.</span> <span class="toc-text">Java的动态性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#反射机制-reflection"><span class="toc-number">6.1.</span> <span class="toc-text">反射机制 reflection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态编译"><span class="toc-number">6.2.</span> <span class="toc-text">动态编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态执行javascript代码"><span class="toc-number">6.3.</span> <span class="toc-text">动态执行javascript代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态字字节码操作：javaassist"><span class="toc-number">6.4.</span> <span class="toc-text">动态字字节码操作：javaassist</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JVM运行和类加载全过程"><span class="toc-number">7.</span> <span class="toc-text">JVM运行和类加载全过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#深入类加载器"><span class="toc-number">8.</span> <span class="toc-text">深入类加载器</span></a></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 20
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/01</span><a class="archive-post-title" href= "/CPWS.github.io/2019/11/01/SSM框架整合-配置文件/" >SSM框架整合-配置文件</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/01</span><a class="archive-post-title" href= "/CPWS.github.io/2019/11/01/Java框架下载路径/" >Java框架下载路径</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/31</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/31/springmvc/" >springmvc</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/31</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/31/maven/" >maven</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/26</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/26/hibernate5/" >hibernate5</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/23</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/23/spring4/" >spring4</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/18</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/18/SSM/" >SSM</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/14</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/14/文档study/" >文档study</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/08</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/08/Mybatis3/" >Mybatis3</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/07</span><a class="archive-post-title" href= "/CPWS.github.io/2019/10/07/Hibernate4/" >Hibernate4</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/29</span><a class="archive-post-title" href= "/CPWS.github.io/2019/09/29/深入使用struts2/" >深入使用struts2</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/25</span><a class="archive-post-title" href= "/CPWS.github.io/2019/09/25/Java邮箱接口/" >Java邮箱接口</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/17</span><a class="archive-post-title" href= "/CPWS.github.io/2019/09/17/Struts2-5/" >Struts2.5</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span><a class="archive-post-title" href= "/CPWS.github.io/2019/09/10/Struts2/" >Struts2</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span><a class="archive-post-title" href= "/CPWS.github.io/2019/09/09/Log4j与Junit测试/" >Log4j与Junit测试</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/08</span><a class="archive-post-title" href= "/CPWS.github.io/2019/09/08/正则表达式/" >正则表达式</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> Invalid date </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span><a class="archive-post-title" href= "/CPWS.github.io/2019/06/27/hello-world/" >Hello World</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/02</span><a class="archive-post-title" href= "/CPWS.github.io/2019/09/02/注解与反射/" >注解与反射</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/28</span><a class="archive-post-title" href= "/CPWS.github.io/2019/06/28/文件上传/" >文件上传</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/28</span><a class="archive-post-title" href= "/CPWS.github.io/2019/06/28/解决中文乱码/" >解决中文乱码</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/CPWS.github.io/",
        author: "zhuli"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/CPWS.github.io/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/CPWS.github.io/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/CPWS.github.io/scripts/share.js" async></script>    
     
    </body>
</html>


