

<!DOCTYPE html>
<html lang>
<!--begin head-->
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<!--begin title-->

<title>
    
    深入使用struts2 |
    
    Prossible&#39;s Blog</title>
<!--end title-->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!--begin mete-->

<meta name="author" content="zhuli">

<!--end mete-->
<!--begin keywords-->
<meta name="keywords" content="深入使用struts2">
<!--end keywords-->
<!--begin rss-->

<link rel="alternate" href="/atom.xml" title="Prossible&#39;s Blog" type="application/atom+xml">

<!--end rss-->
<!--begin favicon-->

<link rel="icon" href="/favicon.ico">

<!--end favicon-->
<!--begin style-->

<!-- stylesheets list from config.yml -->

<link rel="stylesheet" href="/css/hannah.css">


<!--end style-->
</head>
<!--end head-->
<!--begin body-->
<body class="container-fluid">

<!--begin menu-->
<div class="hannah-menu">
    <i class="fh fh-ravelry fa-2x btn fixed-menu animated bounce" id="btn_menu" aria-hidden="true"></i>
    <div class="menu-outer container-fluid hide animated" id="div_menu">
        <div class="row" style="margin-bottom: 5px;">
            
            <div class="col-md-offset-2 col-md-3 col-xs-4 text-center left-social">
                
                <a target="_blank" href="https://github.com/objectyan" title="GitHub"><i class="fh fh-github"></i></a>
                
                <style>
                    .left-social {
                        height: 132px;
                        line-height: 132px;
                        font-size: 66px;
                    }

                    .left-social * {
                        color: #f1ce8e;
                    }

                    @media (max-width: 767px) {
                        .left-social {
                            line-height: 132px;
                            font-size: 33px;
                        }
                    }
                </style>
            </div>
            <!--begin handImg-->
            <div class="col-md-2 col-xs-4 text-center">
                
                <img src="http://img.mp.itc.cn/q_mini,c_zoom,w_640/upload/20161221/c495640d0fc24a91b9c95dc0d54b6002_th.jpeg" alt="Head Image" class="img-circle">
                
            </div>
            <!--end handImg-->
            <div class="col-md-3 col-xs-4 text-center right-social">
                
                <style>
                    .right-social {
                        height: 132px;
                        line-height: 132px;
                        font-size: 66px;
                    }

                    @media (max-width: 767px) {
                        .right-social {
                            line-height: 132px;
                            font-size: 33px;
                        }
                    }

                    .right-social * {
                        color: #f1ce8e;
                    }
                </style>
            </div>
        </div>
        <div class="row">
            <div class="menu-content col-md-8 col-md-push-2 col-xs-12 ">
                <dl class="menu-content-item">
                    <dt class="menu-content-title">
                        <i class="fh fh-bars" aria-hidden="true"></i> Menu
                    </dt>
                    <dd class="menu-content-content">
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/" class="btn btn-block">
                                
                                <i class="fh fh-ravelry"></i>
                                Home
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/categories" class="btn btn-block">
                                
                                <i class="fh fh-cubes"></i>
                                Category
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/tags" class="btn btn-block">
                                
                                <i class="fh fh-tags"></i>
                                Tag
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/archives" class="btn btn-block">
                                
                                <i class="fh fh-archive"></i>
                                Archives
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/about" class="btn btn-block">
                                
                                <i class="fh fh-about"></i>
                                About
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/doc" class="btn btn-block">
                                
                                <i class="fh fh-document"></i>
                                Doc
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/plug" class="btn btn-block">
                                
                                <i class="fh fh-plug"></i>
                                Plug
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/sitemap" class="btn btn-block">
                                
                                <i class="fh fh-sitemap"></i>
                                SiteMap
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/atom.xml" class="btn btn-block">
                                <i class="fh fh-rss" aria-hidden="true"></i> RSS
                            </a>
                        </div>
                    </dd>
                </dl>
            </div>
        </div>
        <div class="row">
            <div class="menu-content col-md-8 col-md-offset-2 col-xs-12 ">
                <dl class="col-md-6 col-xs-6 menu-content-item">
                    <dt class="menu-content-title">
                        <i class="fh fh-cubes" aria-hidden="true"></i> Category
                    </dt>
                    <dd class="menu-content-content animated zoomIn">
                        
                    </dd>
                </dl>
                <dl class="col-md-6 col-xs-6 menu-content-item">
                    <dt class="menu-content-title">
                        <i class="fh fh-tag" aria-hidden="true"></i> Tags
                    </dt>
                    <dd class="menu-content-content animated zoomIn">
                        
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>
<!--end menu-->

<div class="row hannah-body">
    <div class="col-md-8 col-md-push-2 col-xs-12">
        <!--begin breadcrumb-->
        <div class="bread-crumb">
    <ul class="bread-crumb-menu animated rubberBand">
        <li><a href="/CPWS.github.io/"><i class="fh fh-ravelry" aria-hidden="true"></i> Home</a></li>
        
        <li>
            
            <i class="fh fh-newspaper-o" aria-hidden="true"></i>
            
            深入使用struts2
        </li>
        
    </ul>
    <div class="bread-crumb-search">
        <div class="search">
    <i class="fh fh-search icon-search"></i>
    <input placeholder="Search ..." onkeyup="searchFunc(this,event,'/CPWS.github.io/search.xml')" class="input-search animated fadeInRight">
    <div class="search-result animated fadeInRight">
        <a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/10/26/hibernate5/">hibernate5</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/10/23/spring4/">spring4</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/10/18/SSM/">'SSM'</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/10/14/文档study/">文档study'</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/10/08/Mybatis3/">Mybatis3</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/10/07/Hibernate4/">Hibernate4</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/09/29/深入使用struts2/">深入使用struts2</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/09/25/Java邮箱接口/">Java邮箱接口</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/09/17/Struts2-5/">Struts2.5</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/09/10/Struts2/">Struts2</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/09/09/Log4j与Junit测试/">Log4j与Junit测试</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/09/08/正则表达式/">正则表达式</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/09/02/注解与反射/">注解与反射</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/06/28/文件上传/">文件上传</a><a class="animated tada col-lg-12 search-result-item result-link" href="/CPWS.github.io/2019/06/28/解决中文乱码/">解决中文乱码</a>
    </div>
</div>
    </div>
</div>
        <!--end breadcrumb-->
        <article class="post animated rollIn">
    <h1 class="post-title">深入使用struts2</h1>
    <div class="post-subtitle">
        
        <time datetime="2019-09-29T11:17:18.000Z" class="item">
            <i class="fh fh-calendar" aria-hidden="true"></i>&nbsp;&nbsp;2019-09-29
        </time>
        
        
        
    </div>
    
    <h2 id="详解Struts2的类型转换"><a href="#详解Struts2的类型转换" class="headerlink" title="详解Struts2的类型转换"></a>详解Struts2的类型转换</h2><h3 id="Strut2内建的类型转换器"><a href="#Strut2内建的类型转换器" class="headerlink" title="Strut2内建的类型转换器"></a>Strut2内建的类型转换器</h3><ul>
<li>对于大部分常用类型，开发者无须理会类型转换，<code>Struts2</code>可以完成大多数常用的类型转换。这是常用的类型转换是通过<code>Struts2</code>内建的类型转化器完成的，<code>Struts2</code>已经内建了字符串类型与如下类型之间相互转换的转换器。</li>
</ul>
<ol>
<li><code>boolean</code>和<code>Boolean</code>：完成字符串和布尔值之间的转换。</li>
<li><code>char</code>和<code>Character</code>：完成字符串和字符之间的转换。</li>
<li><code>int</code>和<code>Integer</code>：完成字符串和整型值之间的转换。</li>
<li><code>long</code>和<code>Long</code>：完成字符串和长整型值之间的转换。</li>
<li><code>float</code>和<code>Float</code>：完成字符串和单精度浮点之间的转换。</li>
<li><code>double</code>和<code>Double</code>：完成字符串和双精度浮点之间的转换。</li>
<li><code>Date</code>：完成字符串和日期类型之间的转换，日期格式使用用户请求所在<code>Locale</code>的<code>SHORT</code>格式。 </li>
<li>数据：在默认情况下，数组元素是字符串，如果用户提供了自定义的类型转换器，也可以是其他复合类型的转换器。</li>
<li>集合：在默认情况下，假定集合元素类型为<code>String</code>，并创建一个新的<code>ArrayList</code>封装所有的字符串。<h3 id="基于OGNL的类型转换"><a href="#基于OGNL的类型转换" class="headerlink" title="基于OGNL的类型转换"></a>基于<code>OGNL</code>的类型转换</h3></li>
</ol>
<ul>
<li><p>借助于内置的类型转换器，<code>Struts2</code>可以完成字符串和基本类型之间的转换。除此之外，借助于<code>OGNL</code>表达式，<code>Struts2</code>允许以另一种简单的方法将请求参数转换成复合类型。</p>
</li>
<li><p>不仅如此，还可以直接将请求参数转换成<code>Collection</code>集合。</p>
<h3 id="指定集合元素的类型"><a href="#指定集合元素的类型" class="headerlink" title="指定集合元素的类型"></a>指定集合元素的类型</h3></li>
<li><p>使用集合时都使用了泛型，这种泛型可以让<code>Struts2</code>了解集合元素的类型，<code>Struts2</code>就可以通过反射来创建对应类的对象，并将这些对象加入到<code>List</code>中。</p>
</li>
<li><p>如果不使用泛型的话，这时得通过局部类型转换文件来指定集合元素的类型。</p>
</li>
<li><p>局部类型转换文件文件名应该为：<code>actionName-convention.properties</code></p>
</li>
<li><p>类型转换文件应该与<code>Action</code>存放在相同的位置。</p>
</li>
<li><p>为了指定<code>List</code>集合里元素的类型，需要指定两个部分</p>
<blockquote>
<ul>
<li>List集合属性名称</li>
<li>List集合里元素的类型</li>
</ul>
</blockquote>
</li>
<li><p>提示：为了让Struts2了解集合中元素的类型，可以使用如下两种方式：</p>
<blockquote>
<ul>
<li>通过为集合指定泛型。</li>
<li>通过在<code>Action</code>的局部类型转换文件中指定集合元素的类型。</li>
</ul>
</blockquote>
<h3 id="自定义类型转换器"><a href="#自定义类型转换器" class="headerlink" title="自定义类型转换器"></a>自定义类型转换器</h3></li>
<li><p>大部分时候，使用<code>Struts2</code>提供的类型转换器，以及基于<code>OGNL</code>的类型转换机制,就能满足大部分类型转换的需求。但在某些特殊的情况下，例如需要把一个字符串转换成一个复合对象，这时候就需要使用到类型转换器。</p>
</li>
<li><p><code>Struts2</code>的类型转换器实际上依然是基于<code>OGNL</code>框架的，在<code>OGNL</code>项目中有一个<code>TypeConverter</code>接口，这个接口就是自定义类型转换器要实现的接口。该接口的定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//OGNL提供的类型转换器接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TypeConverter</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">converterValue</span><span class="params">(Map context,Object target,Member member,String propertyName,Object value,Class toType)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现类型转换器必须实现上面的<code>TypeConverter</code>接口，不过上面接口里面的方法太过复杂，所有<code>OGNL</code>项目还为该接口提供了一个实现类：<code>DefultTypeConverter</code>，通常采用扩展该方法来实现自定义类型转换器。实现类型转换器需要重写<code>DefaultTypeConverter</code>类的<code>converterValue</code>方法。</p>
</li>
<li><p><code>converterValue</code>方法：为了实现该方法的双向转换，程序需要通过判断<code>toType</code>的类型即可判断转换的方向。</p>
<h3 id="注册类型转换器"><a href="#注册类型转换器" class="headerlink" title="注册类型转换器"></a>注册类型转换器</h3></li>
<li><p>自定义类型转换器完成之后，必须在<code>web</code>应用中注册该类型转换器，<code>Struts2</code>才可以正常使用该类型转换器。</p>
</li>
<li><p><code>Struts2</code>支持如下三种类型转换器</p>
<blockquote>
<ul>
<li>注册局部类型转换器：<code>ActionName-conversion.properties</code></li>
<li>注册全局类型转换器：<code>xwork-conversion.properties</code></li>
<li>使用<code>JDK1.5</code>的注解来注册类型转换器：通过注解方法来注册类型转换器。</li>
</ul>
</blockquote>
</li>
<li><p>局部转换器只对指定的<code>Action</code>的执行属性有效，全局转换器指对指定类型的全部属性有效。</p>
<h3 id="基于Struts2的类型转换器"><a href="#基于Struts2的类型转换器" class="headerlink" title="基于Struts2的类型转换器"></a>基于<code>Struts2</code>的类型转换器</h3></li>
<li><p><code>Struts2</code>提供了<code>StrutsTypeConverter</code>抽象类，实际上它是<code>DefaultTypeConverter</code>的子类，实现该抽象类，需要实现两个方法<code>convertFromString()</code>和<code>convertToString()</code>。第一个方法是将字符串类型转换成复合类型时调用，第二方法是将复合类型转换为字符串类型的调用。</p>
</li>
<li><p>注册该方法的方式与上面三种方法一样。</p>
<h3 id="处理set集合"><a href="#处理set集合" class="headerlink" title="处理set集合"></a>处理set集合</h3></li>
<li><p>由于<code>set</code>集合元素是无序状态，所以<code>Struts2</code>无法准确将字符串转换为<code>set</code>集合，也无法准确读取<code>set</code>集合元素。</p>
</li>
<li><p>如果想要实现处理<code>set</code>集合，就需要为集合里每个元素添加一个标识属性。</p>
</li>
<li><p><code>Struts2</code>允许使用局部类型转换文件来指定<code>Set</code>集合元素的标识属性，在局部类型转换文件中增加如下一行代码即可指定<code>Set</code>集合标识属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KeyProperty_&lt;SetPropName&gt; = &lt;KeyPropName&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>jsp</code>页面中访问<code>set</code>元素的方式：<code>&lt;SetPropName&gt;(&#39;&lt;indexPropValue&gt;&#39;)</code></p>
<h3 id="类型转换中的错误处理"><a href="#类型转换中的错误处理" class="headerlink" title="类型转换中的错误处理"></a>类型转换中的错误处理</h3></li>
<li><p>实际上，表现层数据设计两个处理：类型转换和数据校验。</p>
</li>
<li><p>可以进行有效的类型转换是基础，只有当数据完成有效数据转换后，下一步才去进行数据校验。</p>
</li>
<li><p><code>Struts2</code>中类型转换的错误处理流程</p>
</li>
</ul>
<p><img src="https://i.loli.net/2019/10/02/61rFQTAGaekqKE5.png" alt="1569982729_1_.png"></p>
<ul>
<li>当<code>conversionError</code>拦截器对异常进行处理后，系统会跳到名为<code>input</code>的逻辑视图名。</li>
<li>处理类型转换错误<blockquote>
<ul>
<li>为了让<code>struts2</code>的类型转换机制生效，必须让<code>Action</code>实现<code>ActionSupport</code>基类，因为<code>ActionSupport</code>基类负责收集异常信息，并将他们封装到<code>FieldError</code>对象，添加到<code>ActionContext</code>中。</li>
<li>在jsp页面中使用<code>&lt;s:fielderror&gt;</code>输出异常信息。</li>
</ul>
</blockquote>
</li>
</ul>
<hr>
<h2 id="使用Struts2的输入校验"><a href="#使用Struts2的输入校验" class="headerlink" title="使用Struts2的输入校验"></a>使用Struts2的输入校验</h2><ul>
<li>输入校验分为客户端校验和服务器端校验，客户端校验主要是过滤正常用户的误操作，主要由<code>JavaScript</code>代码完成；服务器端校验是整个应用阻止非法数据的最后防线，主要通过在应用编程中实现。</li>
<li><code>Struts2</code>的输入校验即包括服务器端的校验，也包括客户端的校验。<h3 id="编写校验规则文件"><a href="#编写校验规则文件" class="headerlink" title="编写校验规则文件"></a>编写校验规则文件</h3></li>
<li><code>Struts2</code>提供了基于框架的输入校验，在这种输入校验下，所有的输入校验只需要编写简单的配置文件，<code>Struts2</code>的验证框架将会负责服务器端校验和客户端校验.</li>
<li>输入校验的配置文件的文件名：<code>ActionName-validation.xml</code>。</li>
<li>该文件的配置：<blockquote>
<ul>
<li>&lt;validtors../&gt;:该配置文件的根元素。</li>
<li>&lt;field-validator../&gt;：字段校验配置风格。</li>
<li>&lt;validator ../&gt;：非字段校验配置风格。</li>
</ul>
</blockquote>
</li>
<li>当输入校验失败后，Struts2会自动返回名为<code>input</code>的逻辑视图名。</li>
<li>案例实现：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   &lt;!--registerForm.jsp--&gt;</span><br><span class="line">&lt;h2&gt;请输入您的注册信息&lt;/h2&gt;</span><br><span class="line">&lt;s:fielderror/&gt;</span><br><span class="line">&lt;s:form action=<span class="string">"register"</span>&gt;</span><br><span class="line">	&lt;s:textarea name="name" label="用户名"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">	&lt;s:textarea name="pass" label="密码"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">	&lt;s:textarea name="age" label="年龄"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">	&lt;s:textarea name="birth" label="生日"&gt;&lt;/s:textarea&gt;</span><br><span class="line">	&lt;s:submit value="注册"&gt;&lt;/s:submit&gt;</span><br><span class="line">&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Register Action</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="comment">//定义四个成员变量封装请求参数</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="comment">//此处省略了getter和setter方法</span></span><br><span class="line">    <span class="comment">//处理方采用ActionSupport中的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--校验配置文件 RegisetAction-validation.xml--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定校验配置文件的dtd信息 --&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE validators PUBLIC</span></span><br><span class="line"><span class="meta">  		"-//Apache Struts//XWork Validator 1.0.3//EN"</span></span><br><span class="line"><span class="meta">  		"http://struts.apache.org/dtds/xwork-validator-1.0.3.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 校验文件根元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的name属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>必须输入用户名<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>您输入的用户只能是字母或数字，且长度必须在4-25位之间<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的pass属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"pass"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>必须输入密码<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>您输入的密码只能是字母或数字，且长度必须在4-25位之间<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 指定age必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>年纪必须在1到150之间的整数<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定birth必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"birth"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"date"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 下面指定日期字符串时，必须使用Locale的日期格式 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2050-20-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span>&gt;</span>生日必须在$&#123;min&#125;到s&#123;max&#125;之间<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--struts.xml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"register"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.RegisterAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/show.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/WEB-INF/content/registerForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--show.jsp--&gt;</span><br><span class="line">用户名：&lt;s:property value=<span class="string">"name"</span>/&gt;&lt;br/&gt;</span><br><span class="line">密    码：&lt;s:property value=<span class="string">"pass"</span>/&gt;&lt;br/&gt;</span><br><span class="line">年    龄：&lt;s:property value=<span class="string">"age"</span>/&gt;&lt;br/&gt;</span><br><span class="line">生    日：&lt;s:property value=<span class="string">"birth"</span>/&gt;&lt;br/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：上面案例的校验配置文件与Action类放在同一个包下面。</li>
<li>从上面可以看出，这种校验方式的可用性很高，只要在配置文件中配置校验规则，即可完成数据校验，无须用户书写任何的数据校验代码。<h3 id="国家化提示信息"><a href="#国家化提示信息" class="headerlink" title="国家化提示信息"></a>国家化提示信息</h3></li>
<li>在上面的数据校验中，所有的提示信息都是通过硬编码的方式写在配置文件中，这种方式显然不利于程序国际化。</li>
<li>使用国际化资源文件案例：<blockquote>
<ul>
<li>数据校验配置文件：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--输入校验配置文件--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定校验配置文件的dtd信息 --&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE validators PUBLIC</span></span><br><span class="line"><span class="meta">  		"-//Apache Struts//XWork Validator 1.0.3//EN"</span></span><br><span class="line"><span class="meta">  		"http://struts.apache.org/dtds/xwork-validator-1.0.3.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 校验文件根元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的name属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--  &lt;message&gt;必须输入用户名&lt;/message&gt;--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.required"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定name属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 采用国际化资源文件配置提示信息 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.regex"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 校验Action的pass属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"pass"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须满足必填规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- &lt;message&gt;必须输入密码&lt;/message&gt; --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.required"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定pass属性必须匹配正则表达式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.regex"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 指定age必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"age.range"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 指定birth必须在指定范围内 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"birth"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"date"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 下面指定日期字符串时，必须使用Locale的日期格式 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2050-20-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"birth.range"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>国际资源文件：<code>RegisterAction_zh_CN.properties</code></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name.required=您必须输入用户名！</span><br><span class="line">name.regex=您输入的用户只能是字母或数字，且长度必须在4-25位之间</span><br><span class="line">pass.required=必须输入密码</span><br><span class="line">pass.regex=您输入的密码只能是字母或数字，且长度必须在4-25位之间</span><br><span class="line">age.range=年纪必须在$&#123;min&#125;和$&#123;max&#125;之间的整数</span><br><span class="line">birth.range=生日必须在$&#123;min&#125;和$&#123;max&#125;之间</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>其它代码与上面一样。</li>
</ul>
<ul>
<li>从上面可以看出：<code>&lt;message../&gt;</code>没有直接给出提示信息，而是添加一个<code>key</code>属性，用它来指定国际资源文件。</li>
</ul>
</blockquote>
<h3 id="使用客户端校验"><a href="#使用客户端校验" class="headerlink" title="使用客户端校验"></a>使用客户端校验</h3><ul>
<li>在<code>Struts2</code>应用中使用客户端校验非常简单，只需要改变人如下两个地方即可。<blockquote>
<ul>
<li>将输入页面的表单标签改为使用<code>Struts2</code>标签来生成表单。</li>
<li>为该<code>&lt;s:form&gt;</code>元素增加<code>validate=&quot;true&quot;</code></li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;请输入您的注册信息&lt;/h2&gt;</span><br><span class="line">	&lt;s:fielderror/&gt; </span><br><span class="line">	&lt;s:form action=<span class="string">"register"</span> validate=<span class="string">"true"</span>&gt;</span><br><span class="line">		&lt;s:textarea name="name" label="用户名"&gt;&lt;/s:textarea&gt;</span><br><span class="line">	</span><br><span class="line">		&lt;s:textarea name="pass" label="密码"&gt;&lt;/s:textarea&gt;</span><br><span class="line">	</span><br><span class="line">		&lt;s:textarea name="age" label="年龄"&gt;&lt;/s:textarea&gt;</span><br><span class="line"></span><br><span class="line">		&lt;s:textarea name="birth" label="生日"&gt;&lt;/s:textarea&gt;</span><br><span class="line">		&lt;s:submit value="注册"&gt;&lt;/s:submit&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="字段校验器配置风格"><a href="#字段校验器配置风格" class="headerlink" title="字段校验器配置风格"></a>字段校验器配置风格</h3><ul>
<li><p><code>Struts2</code>提供了两种方式来配置校验规则，字段校验风格和非字段校验风格。</p>
</li>
<li><p>字段校验风格是以字段为优先的配置方式</p>
</li>
<li><p>非字段校验风格是以校验器为优先的配置方式</p>
</li>
<li><p>字段校验器风格配置文件</p>
<blockquote>
<ul>
<li>&lt;field ../&gt;：校验规则文件的基本组成单位。</li>
<li>&lt;field-validator ../&gt;：指定一个校验规则。</li>
<li><param ..>：用于指定该校验器的参数。</li>
<li>&lt;message ../&gt;：确定失败后的提示信息。</li>
</ul>
</blockquote>
<h3 id="非字段校验配置风格"><a href="#非字段校验配置风格" class="headerlink" title="非字段校验配置风格"></a>非字段校验配置风格</h3></li>
<li><p>对于非字段校验配置风格，这是一种以校验器为优先的配置方式</p>
</li>
<li><p>文件格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定校验配置文件的dtd信息 --&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE validators PUBLIC</span></span><br><span class="line"><span class="meta">  		"-//Apache Struts//XWork Validator 1.0.3//EN"</span></span><br><span class="line"><span class="meta">  		"http://struts.apache.org/dtds/xwork-validator-1.0.3.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 校验文件根元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 非字段校验配置风格 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定必填字符串的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器name属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>name<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出name.required的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.required"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--使用该校验器校验name属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>name<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出name.regex的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"name.regex"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定必填字符串的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器pass属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>pass<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出pass.required的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.required"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"regex"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--使用该校验器校验name属性  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>pass<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"regex"</span>&gt;</span>&lt;![CDATA[(\w&#123;4,25&#125;)]]&gt;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 指定校验失败后 输出pass.regex的国际化提示信息 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"pass.regex"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定整数的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器name属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>age<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置指定整数的范围 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--  年纪必须在1到150之间的整数--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"age.range"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置指定整数的校验器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"date"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 使用该校验器name属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>birth<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 下面指定日期字符串时，必须使用Locale的日期格式 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2050-20-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 生日必须在$&#123;min&#125;到$&#123;max&#125;之间 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">message</span> <span class="attr">key</span>=<span class="string">"birth.range"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>非字段校验器配置风格的配置文件</p>
<blockquote>
<ul>
<li>&lt;validator ../&gt;:定义一个校验规则</li>
<li>&lt;validator type=”” ../&gt;：用于指定校验器名称。</li>
<li><param ..> 功能与字段校验规则一样。</li>
<li><message>：功能与字段校验规则一样。</message></li>
<li><param fieldname ..>：用于指定需要被校验的`Action`的属性。
</li>
</ul>
</blockquote>
<h3 id="短路校验器"><a href="#短路校验器" class="headerlink" title="短路校验器"></a>短路校验器</h3></li>
<li><p><code>short-circuit</code>：在<code>&lt;field-validator ../&gt;</code>元素上添加该属性实现短路验证器。</p>
<h3 id="校验文件的搜索规则"><a href="#校验文件的搜索规则" class="headerlink" title="校验文件的搜索规则"></a>校验文件的搜索规则</h3></li>
<li><p>如果一个<code>Action</code>中可能包含多个处理逻辑，<code>Struts2</code>中允许为不同的处理逻辑提供不同的校验规则。</p>
</li>
<li><p>校验规则名字：<code>&lt;Action Name&gt; - &lt;ActionAliasName&gt; - validation.xml</code>；<code>ActionAliasName</code>为<code>struts.xml</code>配置文件Action的`name``值。</p>
</li>
<li><p>如果一个处理逻辑，例如登录请求处理逻辑，既有<code>LoginAction-volidator.xml</code>校验规则，又有<code>LoginAction-loginPro-volidator.xml</code>的校验规则，则该处理逻辑的校验规则为这两个校验规则的总和。</p>
</li>
<li><p>此处之外，还有另外一种情形：如果系统包含两个<code>Action</code>处理类：<code>BaseAction</code>和<code>RegisterAction</code>，<code>RegisterAction</code>继承了<code>BaseAction</code>,则<code>registerAction</code>的校验规则是<code>RegisterAction-validation.xml</code>和<code>BaseAction-validation.xml</code>这两个规则文件的总和。</p>
</li>
<li><p>假设系统中有两个<code>Action</code>：<code>BaseAction</code>和<code>RegisterAction</code>，则系统搜索规则文件的顺序如下：</p>
<blockquote>
<ul>
<li><code>BaseAction-validation.xml</code></li>
<li><code>BaseAction-别名-validation.xml</code></li>
<li><code>RegisterAction-validation.xml</code></li>
<li><code>RegisterAction-别名-validation.xml</code></li>
</ul>
</blockquote>
</li>
<li><p>如果上面的<code>RegisterAction</code>继承了<code>BaseAction</code>，那么<code>RegisterAction</code>的校验规则是上面四个校验规则文件的总和。</p>
</li>
<li><p>注意：<code>Struts2</code>校验规则文件是从上到下搜索的，实际用的校验规则是所有校验规则的总和。如果校验规则有冲突时，则后面文件中的校验规则取胜。</p>
<h3 id="校验顺序和短路"><a href="#校验顺序和短路" class="headerlink" title="校验顺序和短路"></a>校验顺序和短路</h3></li>
<li><p>校验器的执行顺序有如下原则：</p>
<blockquote>
<ul>
<li>所有非字段风格的校验器优先于字段风格的校验器。</li>
<li>所有的非字段风格的校验器，排在前面的会先执行。</li>
<li>所有的字段风格的校验器，排在前面的会先执行。</li>
</ul>
</blockquote>
</li>
<li><p>校验器短路的原则如下：</p>
<blockquote>
<ul>
<li>所有非字段校验器是最优先执行，如果某个非字段校验器校验失败了，则该字段上所有的校验器都不会获得校验的机会。</li>
<li>非字段校验器的校验失败，不会阻止其他非字段校验器的执行。</li>
<li>如果一个字段校验器校验失败后，则该字段下且排在该校验失败的校验器之后的其他校验器不会获得校验的机会。</li>
</ul>
</blockquote>
</li>
<li><p>如果应用中所需要的校验规则非常复杂，用户可以两个选择，开发自己的校验器，或者重写<code>Action</code>中的<code>validate</code>方法。</p>
<h3 id="内建校验器"><a href="#内建校验器" class="headerlink" title="内建校验器"></a>内建校验器</h3></li>
<li><p>注册一个校验器，通过一个<code>&lt;validator../&gt;</code>元素即可注册一个校验器，<code>name</code>属性指定校验器名称，<code>class</code>指定校验器的实现类。</p>
</li>
<li><p>如果开发者开发了一个自己的校验器，则可以通过添加一个<code>validators.xml</code>文件来注册校验器。</p>
</li>
<li><p>注意：如果<code>Struts2</code>系统在<code>src</code>路径下找到一个<code>validators.xml</code>文件，则不会加载系统默认的<code>default.xml</code>文件。如果开发者开发自己的校验器时，要把<code>default.xml</code>文件里的内容全部复制到<code>validators.xml</code>文件中。</p>
</li>
<li><p>必填校验器(<code>name=required</code>):要求指定的字段必须有值（非空）。</p>
<blockquote>
<ul>
<li>必填校验器可以接受如下参数：<blockquote>
<ul>
<li><code>fieldName</code>:该参数用于指定校验的<code>Action</code>属性名，如果采用字段校验器风格，则无需指定该参数</li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"required"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"required"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>必填字符串校验器（<code>requiredstring</code>）:该校验器要求字段值必须非空且长度大于0，即该字符串不能是””.<blockquote>
<ul>
<li>必填字符串校验器可以接受如下参数：<blockquote>
<ul>
<li>fieldName:该属性指定校验的<code>Action</code>属性名，如果采用字段校验器配置风格，则无须指定该属性</li>
<li>trim:是否在校验前截断被校验属性值前后的空白，该属性是可选的，默认为<code>true</code></li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格来配置必填字符串校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格来配置必填字符串校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"requiredstring"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"trim"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>整数校验器（<code>int</code>）:整数校验器包括<code>int</code>、<code>short</code>、<code>long</code>，该校验器要求字段的整数值必须在指定的范围内.<blockquote>
<ul>
<li>该校验器可以接受如下参数:<blockquote>
<ul>
<li>fieldName:该属性指定校验的<code>Action</code>属性名，如果采用字段校验器配置风格，则无须指定该属性</li>
<li>min：指定该属性的最小值，该参数可选，如果没有指定，则不检查最小值。</li>
<li>max：指定该属性的最大值，该参数可选，如果没有指定，则不检查最大值。</li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格来配置整数校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>age<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格来配置整数校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>150<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>日期校验器（<code>date</code>）:，该校验器要求字段的日期值必须在指定的范围内.<blockquote>
<ul>
<li>该校验器可以接受如下参数:<blockquote>
<ul>
<li>fieldName:该属性指定校验的<code>Action</code>属性名，如果采用字段校验器配置风格，则无须指定该属性</li>
<li>min：指定该属性的最小值，该参数可选，如果没有指定，则不检查最小值。</li>
<li>max：指定该属性的最大值，该参数可选，如果没有指定，则不检查最大值。</li>
</ul>
</blockquote>
</li>
<li>采用非字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用非字段校验配置风格来配置日期校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">validator</span> <span class="attr">type</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定需要校验的字段名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fieldName"</span>&gt;</span>birth<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2020-02-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">validator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>采用字段校验器配置风格，该校验器的配置示例如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">validators</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用字段校验配置风格来配置日期校验器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">field-validator</span> <span class="attr">type</span>=<span class="string">"birth"</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最小值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min"</span>&gt;</span>1900-01-01<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--指定最大值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max"</span>&gt;</span>2020-02-21<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指定校验失败的提示信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">message</span>&gt;</span>username must not be null<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">field-validator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>表达式校验器（<code>expression</code>）：它是一个非字段校验器，不可在字段校验配置风格中使用。</li>
<li>字段表达式验证器（<code>fieldexpression</code>）：它要求指定字段满足一个逻辑表达式。</li>
<li>邮箱地址校验器（<code>email</code>）：它要求检查的字段如果不为空，则必须满足的邮箱地址。</li>
<li>网址校验器（<code>url</code>）：它要求被检查的字符如果非空，则必须满足合法的<code>url</code>地址。</li>
<li><code>Visitor</code>校验器：主要用于检测Action里的复合属性。</li>
<li>转换器校验（<code>conversion</code>）：主要用于被检验字段在类型转换过程中是否出现错误。</li>
<li>字符串长度校验器（<code>stringlength</code>）：它要求被校验字段的长度必须在指定范围内，否则校验失败。</li>
<li>正则表达式校验器（<code>regex</code>）：它用于检查被校验字符是否匹配一个正则表达式。<h3 id="基于注册的输入校验"><a href="#基于注册的输入校验" class="headerlink" title="基于注册的输入校验"></a>基于注册的输入校验</h3></li>
<li>案例实现：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterAction02</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//定义User类型的成员变量用于封装请求参数</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//使用注解指定必填，正则表达式两个校验器</span></span><br><span class="line">	<span class="meta">@RequiredStringValidator</span>(key=<span class="string">"name.required"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="meta">@RegexFieldValidator</span>(regex=<span class="string">"\\w&#123;4,25&#125;"</span>,key=<span class="string">"name.regex"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pass;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//使用注解指定必填，正则表达式两个校验器</span></span><br><span class="line">	<span class="meta">@RequiredStringValidator</span>(key=<span class="string">"pass.required"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="meta">@RegexFieldValidator</span>(regex=<span class="string">"\\w&#123;4,25&#125;"</span>,key=<span class="string">"pass.regex"</span>,message=<span class="string">""</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPass</span><span class="params">(String pass)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pass = pass;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@IntRangeFieldValidator</span>(message=<span class="string">""</span>,key=<span class="string">"age.range"</span>,min=<span class="string">"1"</span>,max=<span class="string">"150"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birth;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@DateRangeFieldValidator</span>(message=<span class="string">""</span>,key=<span class="string">"birth.range"</span>,min=<span class="string">"1900/01/01"</span>,max=<span class="string">"2050/02/21"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="手动完成输入校验"><a href="#手动完成输入校验" class="headerlink" title="手动完成输入校验"></a>手动完成输入校验</h3><ul>
<li>重写<code>validate()</code>方法</li>
<li>重写<code>validateXxx()</code>方法</li>
</ul>
<hr>
<h2 id="使用Struts2控制文件上传"><a href="#使用Struts2控制文件上传" class="headerlink" title="使用Struts2控制文件上传"></a>使用Struts2控制文件上传</h2><h3 id="Struts2的文件上传"><a href="#Struts2的文件上传" class="headerlink" title="Struts2的文件上传"></a><code>Struts2</code>的文件上传</h3><ul>
<li>实现步骤:<blockquote>
<ul>
<li>实现文件上传的<code>Action</code></li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:form action=<span class="string">"upload"</span> method=<span class="string">"POST"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">		&lt;s:textfield name="title" label="文件标题"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:file name="upload" label="选择文件"&gt;&lt;/s:file&gt;</span><br><span class="line">		&lt;s:submit value="上传"&gt;&lt;/s:submit&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="comment">//封装文件标题请求参数的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String title;</span><br><span class="line">	<span class="comment">//封装上传文件域的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> File upload;</span><br><span class="line">	<span class="comment">//封装上传文件类型的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String uploadContentType;</span><br><span class="line">	<span class="comment">//封装上传文件名的属性</span></span><br><span class="line">	<span class="keyword">private</span> String uploadFileName;</span><br><span class="line">	<span class="comment">//直接在`struts.xml`文件中配置的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String savePath;</span><br><span class="line">	<span class="comment">//接收`struts.xml`文件配置值的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSavePath</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.savePath=value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//获取上传文件的保存位置</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSavePath</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ServletActionContext.getServletContext().getRealPath(savePath);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> title;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.title = title;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> File <span class="title">getUpload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> upload;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpload</span><span class="params">(File upload)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.upload = upload;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUploadContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> uploadContentType;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUploadContentType</span><span class="params">(String uploadContentType)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.uploadContentType = uploadContentType;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUploadFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> uploadFileName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUploadFileName</span><span class="params">(String uploadFileName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.uploadFileName = uploadFileName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//以服务器的文件保存地址和原文件建立上传文件输出流</span></span><br><span class="line">		FileOutputStream fos=<span class="keyword">new</span> FileOutputStream(getSavePath()+<span class="string">"\\"</span>+getUploadFileName());</span><br><span class="line">		FileInputStream fis=<span class="keyword">new</span> FileInputStream(getUpload());</span><br><span class="line">		<span class="keyword">byte</span>[] buffer=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((len=fis.read(buffer))!=-<span class="number">1</span>) &#123;</span><br><span class="line">			fos.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">		&#125;</span><br><span class="line">		fos.flush();</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>配置文件上传的<code>Action</code></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.i18n.encoding"</span> <span class="attr">value</span>=<span class="string">"GBK"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置處理文件上傳的Action --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.UploadAction"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 動態設置Action的属性值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"savePath"</span>&gt;</span>/uploadFiles<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/succ.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="手动实现文件过滤"><a href="#手动实现文件过滤" class="headerlink" title="手动实现文件过滤"></a>手动实现文件过滤</h3><ul>
<li>如果需要手动实现文件过滤，可按如下步骤进行：<blockquote>
<ul>
<li>在Action中定义一个专门用于过滤文件的方法，该方法的方法名是任意的，该方法的逻辑就是判断上传文件的类型是否为允许类型。例如增加<code>filterTypes()</code>方法,方法代码如下：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">filterTypes</span><span class="params">(String[] types)</span> </span>&#123;</span><br><span class="line">    System.out.println(types);</span><br><span class="line">    <span class="comment">//获取允许上传的所有文件类型</span></span><br><span class="line">    String fileType=getUploadContentType();</span><br><span class="line">    <span class="keyword">for</span>(String type:types) &#123;</span><br><span class="line">        <span class="keyword">if</span>(type.equals(fileType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>上面的方法判断了上传文件的文件类型是否在允许上传的文件类型列表中。为了让程序可以动态设置允许上传的文件类型，为该action增加一个<code>allowTypes</code>属性，该属性的值列出了所有允许上传的文件类型。为了可以在<code>struts.xml</code>文件中配置<code>allowTypes</code>属性的值，必须在<code>Action</code>类中提供如下代码:</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义该action允许上传的文件类型</span></span><br><span class="line"><span class="keyword">private</span> String allowTypes;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAllowTypes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> allowTypes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAllowTypes</span><span class="params">(String allowTypes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.allowTypes = allowTypes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>利用<code>Struts2</code>的数据校验来判断用户输入的文件是否符合要求。如果不符合要求，接下来将错误提示信息添加到<code>FieldError</code>中。该<code>Action</code>中添加的<code>validate()</code>代码如下：</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行输入校验</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将允许上传的文件类型的字符串以英文逗号(,)</span></span><br><span class="line">    <span class="comment">//分解成字符串数字从而判断当前文件类型是否允许上传</span></span><br><span class="line">    String filterResult=filterTypes(getAllowTypes().split(<span class="string">","</span>));</span><br><span class="line">    <span class="keyword">if</span>(filterResult!=<span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        addFieldError(<span class="string">"upload"</span>, <span class="string">"您要上传的文件类型不符合！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在Struts.xml配置文件的配置如下：</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.UploadAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 動態設置Action的属性值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"savePath"</span>&gt;</span>/uploadFiles<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置允许上传的文件类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"allowTypes"</span>&gt;</span>image/png,image/gif<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/WEB-INF/content/uploadForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/succ.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>为了在页面显示错误提示信息，可以在该页面添加如下代码：</li>
</ul>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:fielderror/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="拦截器实现文件过滤"><a href="#拦截器实现文件过滤" class="headerlink" title="拦截器实现文件过滤"></a>拦截器实现文件过滤</h3><ul>
<li>配置文件如下：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"upload"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.UploadAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置fileUpload拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"fileUpload"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置允许上传的文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"allowTypes"</span>&gt;</span>image/png,image/gif<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置允许上传的文件的大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"maximumSize"</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统默认的拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 動態設置Action的属性值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"savePath"</span>&gt;</span>/uploadFiles<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置允许上传的文件类型 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/WEB-INF/content/uploadForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/succ.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="输出错误提示信息"><a href="#输出错误提示信息" class="headerlink" title="输出错误提示信息"></a>输出错误提示信息</h3><ul>
<li>…<h3 id="文件上传的常量配置"><a href="#文件上传的常量配置" class="headerlink" title="文件上传的常量配置"></a>文件上传的常量配置</h3></li>
<li>…</li>
</ul>
<hr>
<h2 id="使用Struts2控制文件下载"><a href="#使用Struts2控制文件下载" class="headerlink" title="使用Struts2控制文件下载"></a>使用Struts2控制文件下载</h2><h3 id="实现文件下载的Action"><a href="#实现文件下载的Action" class="headerlink" title="实现文件下载的Action"></a>实现文件下载的<code>Action</code></h3><ul>
<li><p>实现文件下载的<code>Action</code>与普通的<code>Action</code>没有太大的区别，，仅仅需要提供一个返回<code>InputStream</code>流的方法，该输入流代表了被下载文件的入口。该<code>Action</code>类的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileDownloadAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line">	<span class="comment">//该成员变量可以在配置文件中动态指定该值</span></span><br><span class="line">	<span class="keyword">private</span> String inputPath;</span><br><span class="line">	<span class="comment">//inputName的setter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInputPath</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.inputPath = value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	定义一个返回InputStream的方法，</span></span><br><span class="line"><span class="comment">	该方法将作为被下载文件的入口，</span></span><br><span class="line"><span class="comment">	且需要配置stream类型结果时指定inputName参数，</span></span><br><span class="line"><span class="comment">	inputName参数的值就是方法去掉get前缀、首字母小写的字符串</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getTargetFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">// ServletContext提供getResourceAsStream()方法</span></span><br><span class="line">		<span class="comment">// 返回指定文件对应的输入流</span></span><br><span class="line">		<span class="keyword">return</span> ServletActionContext.getServletContext().getResourceAsStream(inputPath);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>一旦定义了该<code>Action</code>就可以实现文件下载。</p>
<h3 id="配置Action"><a href="#配置Action" class="headerlink" title="配置Action"></a>配置Action</h3></li>
<li><p>配置文件下载的<code>Action</code>与配置普通的<code>Action</code>并没有太大的不同，关键是要配置一个类型为<code>stream</code>的结果，该<code>Stream</code>的结果将使用文件下载作为响应。</p>
</li>
<li><p><code>Stream</code>结果类型的逻辑视图是返回客户端一个输入流，因此无需指定<code>location</code>属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"down"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.FileDownloadAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定被下载资源的位置 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputPath"</span>&gt;</span>/WEB-INF/img/56efbc0d6b66e.jpg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>image/jpg<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定由getTargetFile()方法返回被下载文件的InputStream --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>targetFile<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载的文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>filename="demo.jpg"<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的缓冲大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"bufferSize"</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="下载前的权限控制"><a href="#下载前的权限控制" class="headerlink" title="下载前的权限控制"></a>下载前的权限控制</h3><blockquote>
<ul>
<li>案例</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorityDownAction</span> <span class="keyword">implements</span> <span class="title">Action</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String inputPath;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInputPath</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.inputPath=value;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getTargetFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ServletActionContext.getServletContext().getResourceAsStream(inputPath);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得ActionContext实例</span></span><br><span class="line">		ActionContext ctx=ActionContext.getContext();</span><br><span class="line">		<span class="comment">//通过ActionContext访问用户的HttpSession</span></span><br><span class="line">		Map session=ctx.getSession();</span><br><span class="line">		String user=(String) session.get(<span class="string">"user"</span>);</span><br><span class="line">		<span class="comment">//判断Session里的user是否通过检查</span></span><br><span class="line">		<span class="keyword">if</span>(user!=<span class="keyword">null</span>&amp;&amp;user.equals(<span class="string">"crazyit.org"</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		ctx.put(<span class="string">"tip"</span>, <span class="string">"您还没有登录"</span>);</span><br><span class="line">		<span class="keyword">return</span> LOGIN;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"download2"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.AuthorityDownAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义被下载文件的物理资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputPath"</span>&gt;</span>/WEB-INF/images/wjc_logo.zip<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>application/zip<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定由getTargetFile()方法返回被下载文件的InputStream --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>targetFile<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>filename="wjc_logo.zip"<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定下载文件的缓冲大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"bufferSize"</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义一个名为login的结果 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span>/WEB-INF/content/loginForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/struts2Down.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="详解Struts2的拦截器机制"><a href="#详解Struts2的拦截器机制" class="headerlink" title="详解Struts2的拦截器机制"></a>详解Struts2的拦截器机制</h2><h3 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h3><ul>
<li><p>定义拦截器使用<code>&lt;interceptor../&gt;</code>元素来定义，定义拦截器的简答的格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过指定拦截器名和拦截器实现类来定义拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"拦截器名"</span> <span class="attr">class</span>=<span class="string">"拦截器实现类"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果还需要在配置拦截器是传入拦截器参数，需要在<code>&lt;interceptor../&gt;</code>元素中使用<code>&lt;param ../&gt;</code>子元素即可。下面是它配置的简单格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过指定拦截器名和拦截器实现类来定义拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"拦截器名"</span> <span class="attr">class</span>=<span class="string">"拦截器实现类"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--下面的元素可以出现0次，或者是无限次--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--name属性指定参数名，中间值指定的该参数名对象的参数值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>还可以把多个拦截器连在一起组成拦截器栈，定于拦截器栈可以使用<code>&lt;interceptor-stack ../&gt;</code>元素，拦截器栈是由多个拦截器组成的，因此需要在该元素中使用<code>&lt;interceptor-ref ../&gt;</code>元素来定义多个拦截器引用，即该拦截器栈由多个<code>&lt;inteceptor-ref../&gt;</code>元素指定的拦截器组成。配置拦截器栈的语法格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈名"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器2"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>因为拦截器栈与拦截器在功能上完全统一，因此可能出现，拦截器里也可能包含其他拦截器栈。因此，可能出现如下配置片段：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器2"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器3"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>系统为拦截器指定参数有两种时机。</p>
<blockquote>
<ul>
<li>定义拦截器时指定参数值：这种参数值将作为拦截器参数的默认参数值。</li>
<li>使用拦截器时指定参数值：在配置Action时为拦截器参数指定值。</li>
</ul>
</blockquote>
</li>
<li><p>通过为<code>&lt;interceptor-ref&gt;</code>元素增加<code>&lt;param../&gt;</code>子元素，就可以在拦截器使用时为参数指定值。因此可能出现以下片段</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器2"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"拦截器栈2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器3"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器栈1"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">inteceptor-stack</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器的配置语法"><a href="#使用拦截器的配置语法" class="headerlink" title="使用拦截器的配置语法"></a>使用拦截器的配置语法</h3><ul>
<li>下面是在Action中定义拦截器的配置实例：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义全部拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义第一个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"lee.SimpleInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义第二个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"later"</span> <span class="attr">class</span>=<span class="string">"lee.LaterInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"参数名"</span>&gt;</span>参数值<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用系统默认的拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用第一个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用第二个拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"later"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--为该Action指定拦截器参数，该参数会覆盖默认值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>动态参数<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="配置默认拦截器"><a href="#配置默认拦截器" class="headerlink" title="配置默认拦截器"></a>配置默认拦截器</h3><ul>
<li>配置默认拦截器使用<code>&lt;default-interceptor-ref&gt;</code>元素，该元素作为<code>package</code>的子元素,为该包下的所有<code>Action</code>配置默认拦截器。</li>
<li>下面配置默认拦截器的配置示例：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">namespace</span>=<span class="string">""</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义拦截器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义拦截器栈--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置该包下的默认拦截器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"拦截器名或拦截器栈名"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">..</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器类"><a href="#使用拦截器类" class="headerlink" title="使用拦截器类"></a>使用拦截器类</h3><ul>
<li><p>如果用户想要开发自己的拦截器，需要实现<code>com.opensymphony.xwork2.interceptor.Interceptor</code>接口.</p>
</li>
<li><p>该接口的类定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Interceptor</span></span>&#123;</span><br><span class="line">    <span class="comment">//销毁该拦截器之前的回调方法</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//初始化该拦截器的回调方法</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//拦截器实现拦截的逻辑方法</span></span><br><span class="line">    <span class="function">String <span class="title">interceptor</span><span class="params">(ActionInvocation innovation)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>下面实现一个简单的拦截器示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//简单拦截器的名字</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">super</span>.init();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">super</span>.destroy();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得被拦截的Action实例</span></span><br><span class="line">		LoginAction action=(LoginAction) invocation.getAction();</span><br><span class="line">		<span class="comment">//打印开始执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"开始执行登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="comment">//取得开始执行Action的事件</span></span><br><span class="line">		<span class="keyword">long</span> start =System.currentTimeMillis();</span><br><span class="line">		<span class="comment">//执行该烂机器的最后一个拦截器</span></span><br><span class="line">		String result=invocation.invoke();</span><br><span class="line">		<span class="comment">//打印结束执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"介绍登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="keyword">long</span> end=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"执行时间"</span>+(end-start)+<span class="string">"ms"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器"><a href="#使用拦截器" class="headerlink" title="使用拦截器"></a>使用拦截器</h3><ul>
<li>使用拦截器需要两个步骤：<blockquote>
<ul>
<li>通过<code>&lt;interceptor&gt;</code>元素来定义拦截器</li>
<li>通过<code>&lt;interceptor-ref&gt;</code>元素来使用拦截器</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 应用所需的拦截器需要在该元素下配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.SimpleInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>简单拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/eeor.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统的默认拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>改名后的拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="拦截方法的拦截器"><a href="#拦截方法的拦截器" class="headerlink" title="拦截方法的拦截器"></a>拦截方法的拦截器</h3><ul>
<li>方法过滤的拦截器方法的示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 拦截器方法的拦截器，应该继承MethodFilterInterceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 1huangzewei</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilterInterceptor</span> <span class="keyword">extends</span> <span class="title">MethodFilterInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">//简单拦截器的名字</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> String <span class="title">doIntercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得被拦截的Action实例</span></span><br><span class="line">		LoginAction action=(LoginAction) invocation.getAction();</span><br><span class="line">		<span class="comment">//打印开始执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"开始执行登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="comment">//取得开始执行Action的事件</span></span><br><span class="line">		<span class="keyword">long</span> start =System.currentTimeMillis();</span><br><span class="line">		<span class="comment">//执行该烂机器的最后一个拦截器</span></span><br><span class="line">		String result=invocation.invoke();</span><br><span class="line">		<span class="comment">//打印结束执行时间</span></span><br><span class="line">		System.out.println(name+<span class="string">"拦截器的动作----------"</span>+<span class="string">"介绍登录Action的时间："</span>+<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="keyword">long</span> end=System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">"执行时间"</span>+(end-start)+<span class="string">"ms"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 应用所需的拦截器需要在该元素下配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.MyFilterInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>拦截器方法拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/eeor.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统的默认拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>改名后的拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定execute方法不需要被拦截 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"excludeMethods"</span>&gt;</span>execute<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>Struts2</code>中提供了方法过滤的拦截器有如下几个</p>
<blockquote>
<ul>
<li><code>TokenInterceptor</code>、<code>TokenSessionStoreInterceptor</code>、<code>DefaultWorkflowInterceptor</code>、<code>ValidationInterceptor</code></li>
</ul>
</blockquote>
<h3 id="拦截器的执行顺序"><a href="#拦截器的执行顺序" class="headerlink" title="拦截器的执行顺序"></a>拦截器的执行顺序</h3></li>
<li><p>在<code>Action</code>的控制方法执行之前，位于拦截器链前面的拦截器将先发生作用，在<code>Action</code>控制方法执行之后，为于拦截器链前面的拦截器将后发生作用。</p>
<h3 id="拦截结果的监听器"><a href="#拦截结果的监听器" class="headerlink" title="拦截结果的监听器"></a>拦截结果的监听器</h3></li>
<li><p>拦截结果的监听器代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPreResultListener</span> <span class="keyword">implements</span> <span class="title">PreResultListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//定义在处理result之前的行为。</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeResult</span><span class="params">(ActionInvocation invocation, String resultCode)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//打印出执行结果</span></span><br><span class="line">		System.out.println(<span class="string">"返回的逻辑视图名："</span>+resultCode);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在拦截器中手动注册拦截结果监听器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeResultInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//将一个拦截结果的监听器注册给该监听器</span></span><br><span class="line">		invocation.addPreResultListener(<span class="keyword">new</span> MyPreResultListener());</span><br><span class="line">		System.out.println(<span class="string">"execute方法执行之前的拦截..."</span>);</span><br><span class="line">		String result=invocation.invoke();</span><br><span class="line">		System.out.println(<span class="string">"execute方法执行之后拦截..."</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>值得注意的是，虽然<code>beforeResule()</code>方法中也可获得<code>ActionInvocation</code>实例，但千万不可通过该实例再次调用<code>invoke()</code>方法，如果再次调用<code>invoke()</code>方法，将会再次执行<code>Action</code>处理，<code>Action</code>处理后紧跟<code>beforeResule()</code>方法……这样会陷入死循环。</p>
<h3 id="覆盖拦截器栈里特定拦截器的参数"><a href="#覆盖拦截器栈里特定拦截器的参数" class="headerlink" title="覆盖拦截器栈里特定拦截器的参数"></a>覆盖拦截器栈里特定拦截器的参数</h3></li>
<li><p>如果需要覆盖拦截器栈里特定拦截器的参数，则在定义<code>&lt;param&gt;</code>元素的<code>name</code>属性时使用：<code>&lt;拦截器名&gt;.&lt;参数名&gt;</code></p>
</li>
<li><p>代码示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"mySimple"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.BeforeResultInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>简单拦截器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"second"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.SecondInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"mySimple"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>第一个<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"second"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 为拦截器指定参数值 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span>第二个<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content/eeor.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置系统的默认拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 覆盖指定拦截器的指定参数值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"second.name"</span>&gt;</span>改名后的拦截结果监听器<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用拦截器完成权限控制"><a href="#使用拦截器完成权限控制" class="headerlink" title="使用拦截器完成权限控制"></a>使用拦截器完成权限控制</h3><ul>
<li>登录权限案例实现:</li>
</ul>
<ol>
<li><p>拦截代码的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//权限检查拦截器继承 AbstractInterceptor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorityInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//拦截Action处理的拦截方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//取得请求相关的ActionContext实例</span></span><br><span class="line">		ActionContext ctx=invocation.getInvocationContext();</span><br><span class="line">		Map session=ctx.getSession();</span><br><span class="line">		<span class="comment">//取出session里的user属性</span></span><br><span class="line">		String user=(String) session.get(<span class="string">"user"</span>);</span><br><span class="line">		<span class="comment">//如果没有登录，或者登录的用户名不是crazyit.org，都返回登录</span></span><br><span class="line">		<span class="keyword">if</span>(user!=<span class="keyword">null</span> &amp;&amp; user.equals(<span class="string">"crazyit.org"</span>)) &#123;</span><br><span class="line">			invocation.invoke();</span><br><span class="line">		&#125;</span><br><span class="line">		ctx.put(<span class="string">"tip"</span>,<span class="string">"您还没有登录"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.LOGIN;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件中进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用户拦截器定义在该元素下 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义了一个名为authority的拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"authority"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.interceptor.AuthorityInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 定义全局Result --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当返回login视图名时，转入loginForm.jsp页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"login"</span>&gt;</span>/WEB-INF/content/loginForm.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>/WEB-INF/content//error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 定义一个名为viewBook的Action，其实现类为ActionSupport --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"viewBook"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 返回success视图名时，转入viewBook.jsp页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/viewBook.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 应用自定义拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"authority"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"*"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span>&gt;</span>/WEB-INF/content/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="使用Struts2的ajax支持"><a href="#使用Struts2的ajax支持" class="headerlink" title="使用Struts2的ajax支持"></a>使用Struts2的ajax支持</h2><h3 id="使用Stream类型的Result实现Ajax"><a href="#使用Stream类型的Result实现Ajax" class="headerlink" title="使用Stream类型的Result实现Ajax"></a>使用Stream类型的Result实现Ajax</h3><ul>
<li>案例实现<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;使用JSON插件&lt;/title&gt;</span><br><span class="line">&lt;script type="text/javascript" src="$&#123;pageContext.request.contextPath&#125;/jquery-3.2.1.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form id=<span class="string">"loginForm"</span>&gt;</span><br><span class="line">		&lt;s:textfield name="user" label="用户名"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;s:textfield name="pass" label="密码"&gt;&lt;/s:textfield&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td colspan=<span class="string">"2"</span>&gt;</span><br><span class="line">				&lt;input id=<span class="string">"loginBn"</span> type=<span class="string">"button"</span> value=<span class="string">"提交"</span>/&gt;	</span><br><span class="line">			&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">	&lt;div id="show" style="display:none"&gt;&lt;/div&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		$(<span class="string">"#loginBn"</span>).click(function()&#123;</span><br><span class="line"></span><br><span class="line">			$.get(<span class="string">"login"</span>,$(<span class="string">"#loginForm"</span>).serializeArray(),</span><br><span class="line">				function(data,statusText)&#123;</span><br><span class="line">					</span><br><span class="line">					$(<span class="string">"#show"</span>).height(<span class="number">80</span>)</span><br><span class="line">							.width(<span class="number">230</span>)</span><br><span class="line">							.css(<span class="string">"border"</span>,<span class="string">"1px solid black"</span>)</span><br><span class="line">							.css(<span class="string">"border-radius"</span>,<span class="string">"15px"</span>)</span><br><span class="line">							.css(<span class="string">"background-color"</span>,<span class="string">"#efef99"</span>)</span><br><span class="line">							.css(<span class="string">"color"</span>,<span class="string">"#ff0000"</span>)</span><br><span class="line">							.css(<span class="string">"padding"</span>,<span class="string">"20px"</span>)</span><br><span class="line">							.empty();</span><br><span class="line">					$(<span class="string">"#show"</span>).append(<span class="string">"登录结果："</span>+data+<span class="string">"&lt;br/&gt;"</span>);</span><br><span class="line">					$(<span class="string">"#show"</span>).show(<span class="number">600</span>);</span><br><span class="line">				&#125;,<span class="string">"html"</span>		</span><br><span class="line">			)</span><br><span class="line">		&#125;)</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">implements</span> <span class="title">Action</span></span>&#123;</span><br><span class="line">	<span class="comment">//封装请求参数的两个成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="comment">//封装输出结果二进制流</span></span><br><span class="line">	<span class="keyword">private</span> InputStream inputStream;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.inputStream;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//此处省略了setter和getter</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//判断用户名和密码，生成响应</span></span><br><span class="line">		inputStream=(getUser().equals(<span class="string">"crazyit.org"</span>) &amp;&amp; getPass().equals(<span class="string">"leegang"</span>))?</span><br><span class="line">				<span class="keyword">new</span> ByteArrayInputStream(<span class="string">"恭喜你！登录成功"</span>.getBytes(<span class="string">"UTF-8"</span>)):<span class="keyword">new</span> ByteArrayInputStream(<span class="string">"对不起，用户名，密码不匹配。"</span>.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.LoginAction"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定stream生成的响应数据的类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定由getResult()返回输出结果的InputStream --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"inputName"</span>&gt;</span>result<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>除此之外，<code>Strust2</code>还提供了一个<code>JSON</code>插件，通过该插件可以更简单的完成<code>Ajax</code>。</p>
<h3 id="JSON的基本知识"><a href="#JSON的基本知识" class="headerlink" title="JSON的基本知识"></a>JSON的基本知识</h3></li>
<li><p>JSON主要有如下两种格式：</p>
<blockquote>
<ul>
<li>key-value</li>
<li>有序集合</li>
</ul>
</blockquote>
</li>
<li><p>在Javascript中主要有两种JSON语法，一种用于创建对象，另一种用于创建数组。</p>
</li>
<li><p>使用JSON语法创建对象</p>
<blockquote>
<ul>
<li>语法格式如下：</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object=&#123;</span><br><span class="line">    propertyName1:propertyValue1,</span><br><span class="line">    propertyName2:propertyValue2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,sex</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name=name;</span><br><span class="line">    <span class="keyword">this</span>.sex=sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p=<span class="keyword">new</span> Person(<span class="string">"kk"</span>,<span class="string">"man"</span>);</span><br><span class="line">alert(p.name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2=&#123;<span class="string">"name"</span>:<span class="string">"yeeku"</span>,<span class="string">"age"</span>:<span class="number">12</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(p2.age)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p3=&#123;</span><br><span class="line">    name:<span class="string">"yeeku"</span>,</span><br><span class="line">    sex:<span class="string">"man"</span>,</span><br><span class="line">    son:&#123;</span><br><span class="line">        name:<span class="string">'nono'</span>,</span><br><span class="line">        grade:<span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    info:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"姓名："</span>+<span class="keyword">this</span>.son.name+<span class="string">" 年龄："</span>+<span class="keyword">this</span>.son.grade)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">p3.info();</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用JSON语法创建数组</p>
<blockquote>
<ul>
<li>使用教程如下</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建数组 方式1</span></span><br><span class="line"><span class="keyword">var</span> a=<span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">a[<span class="number">0</span>]=<span class="string">'yeeku'</span>;</span><br><span class="line">a[<span class="number">1</span>]=<span class="string">'man'</span>;</span><br><span class="line">alert(a[<span class="number">0</span>])</span><br><span class="line"><span class="comment">//创建数组 方式2</span></span><br><span class="line"><span class="keyword">var</span> b=<span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">"yeeku"</span>,<span class="string">"man"</span>);</span><br><span class="line">alert(b[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">//创建数组 方式3</span></span><br><span class="line"><span class="keyword">var</span> c=[<span class="string">'yeeu'</span>,<span class="string">'name'</span>];</span><br><span class="line">alert(c[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<ul>
<li>使用JSON创建数组的语法格式:<code>arr=[value1,value2]</code></li>
</ul>
</blockquote>
<h3 id="实现Action逻辑"><a href="#实现Action逻辑" class="headerlink" title="实现Action逻辑"></a>实现Action逻辑</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.crazyit.app.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.json.annotations.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONExample</span> </span>&#123;</span><br><span class="line">	<span class="comment">//模拟处理结果的成员变量</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>[] ints= &#123;<span class="number">10</span>,<span class="number">20</span>&#125;;</span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,String&gt; map=<span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">	<span class="keyword">private</span> String customName=<span class="string">"顾客"</span>;</span><br><span class="line">	<span class="comment">//封装请求参数的三个成员变量</span></span><br><span class="line">	<span class="keyword">private</span> String field1;</span><br><span class="line">	<span class="comment">//`transient`修饰的成员变量不会被序列化</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">transient</span> String field2;</span><br><span class="line">	<span class="comment">//没有getter和setter方法的成员变量不会被序列化</span></span><br><span class="line">	<span class="keyword">private</span> String field3;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span></span>&#123;</span><br><span class="line">		map.put(<span class="string">"name"</span>, <span class="string">"疯狂Java讲义"</span>);</span><br><span class="line">		<span class="keyword">return</span> Action.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//使用注解来改变该成员变量序列化后的名字</span></span><br><span class="line">	<span class="meta">@JSON</span>(name=<span class="string">"newName"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map <span class="title">getMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.map;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// customName的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomName</span><span class="params">(String customName)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.customName = customName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCustomName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.customName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// field1的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setField1</span><span class="params">(String field1)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.field1 = field1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getField1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.field1;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// field2的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setField2</span><span class="params">(String field2)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.field2 = field2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getField2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.field2;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// field3的setter和getter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setField3</span><span class="params">(String field3)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.field3 = field3;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getField3</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.field3;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JSON插件与json类型的Result"><a href="#JSON插件与json类型的Result" class="headerlink" title="JSON插件与json类型的Result"></a>JSON插件与json类型的Result</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"JSONExample"</span> <span class="attr">class</span>=<span class="string">"org.crazyit.app.action.JSONExample"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"json"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置类型的json的Result --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为该Result指定参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"noCache"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置只序列Action的map属性 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  param name="root"&gt;map&lt;/param --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现JSP页面"><a href="#实现JSP页面" class="headerlink" title="实现JSP页面"></a>实现JSP页面</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"s"</span> uri=<span class="string">"/struts-tags"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;使用JSON插件&lt;/title&gt;</span><br><span class="line">&lt;script type="text/javascript" src="$&#123;pageContext.request.contextPath&#125;/jquery-3.2.1.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;s:form id=<span class="string">"form1"</span>&gt;</span><br><span class="line">		&lt;s:textfield name=<span class="string">"field1"</span> label=<span class="string">"Field 1"</span>/&gt;</span><br><span class="line">		&lt;s:textfield name=<span class="string">"field2"</span> label=<span class="string">"Field 2"</span>/&gt;</span><br><span class="line">		&lt;s:textfield name=<span class="string">"field3"</span> label=<span class="string">"Field 3"</span>/&gt;</span><br><span class="line">		&lt;tr&gt;&lt;td colspan=<span class="string">"2"</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">"button"</span> value=<span class="string">"提交"</span> onclick=<span class="string">"gotClick();"</span>/&gt;</span><br><span class="line">		&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">	&lt;/s:form&gt;</span><br><span class="line">	&lt;div id="show"&gt;&lt;/div&gt;</span><br><span class="line">	&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="function">function <span class="title">gotClick</span><span class="params">()</span></span>&#123;</span><br><span class="line">			console.log(<span class="number">1</span>)</span><br><span class="line">			$(<span class="string">"#show"</span>).hide();</span><br><span class="line">			<span class="comment">// 指定向JSONExample发送请求，将id为form1的表单所包含的表单控件转换为请求参数</span></span><br><span class="line">			$.post(<span class="string">"JSONExample"</span> , $(<span class="string">"#form1"</span>).serializeArray() , </span><br><span class="line">				<span class="comment">// 指定回调函数</span></span><br><span class="line">				function(data , statusText)</span><br><span class="line">				&#123;</span><br><span class="line">					console.log(data)</span><br><span class="line">					console.log(statusText)</span><br><span class="line">					$(<span class="string">"#show"</span>).height(<span class="number">120</span>)</span><br><span class="line">						.width(<span class="number">340</span>)</span><br><span class="line">						.css(<span class="string">"border"</span> , <span class="string">"1px solid black"</span>)</span><br><span class="line">						.css(<span class="string">"border-radius"</span> , <span class="string">"15px"</span>)</span><br><span class="line">						.css(<span class="string">"background-color"</span> , <span class="string">"#efef99"</span>)</span><br><span class="line">						.css(<span class="string">"color"</span> , <span class="string">"#ff0000"</span>)</span><br><span class="line">						.css(<span class="string">"padding"</span> , <span class="string">"20px"</span>)</span><br><span class="line">						.empty();</span><br><span class="line">					<span class="comment">// 遍历JavaScript对象的各属性</span></span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">var</span> propName in data)</span><br><span class="line">					&#123;</span><br><span class="line">					</span><br><span class="line">						$(<span class="string">"#show"</span>).append(propName + <span class="string">"--&gt;"</span></span><br><span class="line">							+ data[propName] + <span class="string">"&lt;br /&gt;"</span>);</span><br><span class="line">					&#125;</span><br><span class="line">					$(<span class="string">"#show"</span>).show(<span class="number">600</span>);</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="comment">// 指定服务器响应为JSON数据</span></span><br><span class="line">				<span class="string">"json"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</article>
<ol class="animated rollIn hannah-toc"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-2"><a class="animated rollIn hannah-toc-link" href="#详解Struts2的类型转换"><span class="animated rollIn hannah-toc-text">详解Struts2的类型转换</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#Strut2内建的类型转换器"><span class="animated rollIn hannah-toc-text">Strut2内建的类型转换器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#基于OGNL的类型转换"><span class="animated rollIn hannah-toc-text">基于OGNL的类型转换</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#指定集合元素的类型"><span class="animated rollIn hannah-toc-text">指定集合元素的类型</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#自定义类型转换器"><span class="animated rollIn hannah-toc-text">自定义类型转换器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#注册类型转换器"><span class="animated rollIn hannah-toc-text">注册类型转换器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#基于Struts2的类型转换器"><span class="animated rollIn hannah-toc-text">基于Struts2的类型转换器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#处理set集合"><span class="animated rollIn hannah-toc-text">处理set集合</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#类型转换中的错误处理"><span class="animated rollIn hannah-toc-text">类型转换中的错误处理</span></a></li></ol></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-2"><a class="animated rollIn hannah-toc-link" href="#使用Struts2的输入校验"><span class="animated rollIn hannah-toc-text">使用Struts2的输入校验</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#编写校验规则文件"><span class="animated rollIn hannah-toc-text">编写校验规则文件</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#国家化提示信息"><span class="animated rollIn hannah-toc-text">国家化提示信息</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#使用客户端校验"><span class="animated rollIn hannah-toc-text">使用客户端校验</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#字段校验器配置风格"><span class="animated rollIn hannah-toc-text">字段校验器配置风格</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#非字段校验配置风格"><span class="animated rollIn hannah-toc-text">非字段校验配置风格</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#短路校验器"><span class="animated rollIn hannah-toc-text">短路校验器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#校验文件的搜索规则"><span class="animated rollIn hannah-toc-text">校验文件的搜索规则</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#校验顺序和短路"><span class="animated rollIn hannah-toc-text">校验顺序和短路</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#内建校验器"><span class="animated rollIn hannah-toc-text">内建校验器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#基于注册的输入校验"><span class="animated rollIn hannah-toc-text">基于注册的输入校验</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#手动完成输入校验"><span class="animated rollIn hannah-toc-text">手动完成输入校验</span></a></li></ol></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-2"><a class="animated rollIn hannah-toc-link" href="#使用Struts2控制文件上传"><span class="animated rollIn hannah-toc-text">使用Struts2控制文件上传</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#Struts2的文件上传"><span class="animated rollIn hannah-toc-text">Struts2的文件上传</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#手动实现文件过滤"><span class="animated rollIn hannah-toc-text">手动实现文件过滤</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#拦截器实现文件过滤"><span class="animated rollIn hannah-toc-text">拦截器实现文件过滤</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#输出错误提示信息"><span class="animated rollIn hannah-toc-text">输出错误提示信息</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#文件上传的常量配置"><span class="animated rollIn hannah-toc-text">文件上传的常量配置</span></a></li></ol></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-2"><a class="animated rollIn hannah-toc-link" href="#使用Struts2控制文件下载"><span class="animated rollIn hannah-toc-text">使用Struts2控制文件下载</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#实现文件下载的Action"><span class="animated rollIn hannah-toc-text">实现文件下载的Action</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#配置Action"><span class="animated rollIn hannah-toc-text">配置Action</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#下载前的权限控制"><span class="animated rollIn hannah-toc-text">下载前的权限控制</span></a></li></ol></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-2"><a class="animated rollIn hannah-toc-link" href="#详解Struts2的拦截器机制"><span class="animated rollIn hannah-toc-text">详解Struts2的拦截器机制</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#配置拦截器"><span class="animated rollIn hannah-toc-text">配置拦截器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#使用拦截器的配置语法"><span class="animated rollIn hannah-toc-text">使用拦截器的配置语法</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#配置默认拦截器"><span class="animated rollIn hannah-toc-text">配置默认拦截器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#使用拦截器类"><span class="animated rollIn hannah-toc-text">使用拦截器类</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#使用拦截器"><span class="animated rollIn hannah-toc-text">使用拦截器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#拦截方法的拦截器"><span class="animated rollIn hannah-toc-text">拦截方法的拦截器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#拦截器的执行顺序"><span class="animated rollIn hannah-toc-text">拦截器的执行顺序</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#拦截结果的监听器"><span class="animated rollIn hannah-toc-text">拦截结果的监听器</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#覆盖拦截器栈里特定拦截器的参数"><span class="animated rollIn hannah-toc-text">覆盖拦截器栈里特定拦截器的参数</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#使用拦截器完成权限控制"><span class="animated rollIn hannah-toc-text">使用拦截器完成权限控制</span></a></li></ol></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-2"><a class="animated rollIn hannah-toc-link" href="#使用Struts2的ajax支持"><span class="animated rollIn hannah-toc-text">使用Struts2的ajax支持</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#使用Stream类型的Result实现Ajax"><span class="animated rollIn hannah-toc-text">使用Stream类型的Result实现Ajax</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#JSON的基本知识"><span class="animated rollIn hannah-toc-text">JSON的基本知识</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#实现Action逻辑"><span class="animated rollIn hannah-toc-text">实现Action逻辑</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#JSON插件与json类型的Result"><span class="animated rollIn hannah-toc-text">JSON插件与json类型的Result</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#实现JSP页面"><span class="animated rollIn hannah-toc-text">实现JSP页面</span></a></li></ol></li></ol>
<div class="animated bounceInDown paginations">
    <div class="col-md-8 col-md-push-2 col-xs-12">
        <nav>
            
            <a href="/CPWS.github.io/2019/10/07/Hibernate4/" class="prev col-md-2 col-xs-4 text-left">&larr; Prev</a>
            
            <span class="page-content col-md-8  col-xs-4 text-center">
                
            </span>
            
            <a href="/CPWS.github.io/2019/09/25/Java邮箱接口/" class="next col-md-2 col-xs-4 text-right">Next &rarr;</a>
            
        </nav>
        <div>
            <div class="col-md-6 col-xs-6 text-left">
                
                Hibernate4
                
            </div>
            <div class="col-md-6 col-xs-6 text-right">
                
                Java邮箱接口
                
            </div>
        </div>
    </div>
</div>

        <!--begin comments-->
        
<div class="comments" id="comments">
    

</div>


        <!--end comments-->
    </div>
</div>

<!--begin footer-->
<footer id="footer" class="footer animated fadeInUp hide">
    <p><i class="copy">&copy;</i> 2019 <a href="https://CPWS.github.io">zhuli</a> All Right Reserved.</p>
    <p>Powered by <a href="http://hexo.io">Hexo</a>. Theme by <a href="https://github.com/objectyan/hexo-theme-hannah">hannah</a></p>
</footer>
<!--end footer-->


<!-- scripts list from theme config.yml -->

<script src="/js/hannah.js"></script>

<script src="/js/canvas-nest.js"></script>


<!--begin analytics-->

<script type="text/javascript">
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?8fb2a05be303b36faebf141d7317de43";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!--end analytics-->
</body>
<!--end body-->
</html>
